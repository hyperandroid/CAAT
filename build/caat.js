var CAAT=CAAT||{};(function(){CAAT.Behavior=function(){this.lifecycleListenerList=[];this.setDefaultInterpolator();return this};CAAT.Behavior.prototype={lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:false,expired:true,interpolator:null,actor:null,id:0,setId:function(id){this.id=id;return this},setDefaultInterpolator:function(){this.interpolator=(new CAAT.Interpolator).createLinearInterpolator(false);return this},setPingPong:function(){this.interpolator=(new CAAT.Interpolator).createLinearInterpolator(true);
return this},setFrameTime:function(startTime,duration){this.behaviorStartTime=startTime;this.behaviorDuration=duration;this.expired=false;return this},setInterpolator:function(interpolator){this.interpolator=interpolator;return this},apply:function(time,actor){var orgTime=time;if(this.isBehaviorInTime(time,actor)){time=this.normalizeTime(time);this.fireBehaviorAppliedEvent(actor,orgTime,time,this.setForTime(time,actor))}},setCycle:function(bool){this.cycleBehavior=bool;return this},addListener:function(behaviorListener){this.lifecycleListenerList.push(behaviorListener);
return this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(time,actor){if(this.expired)return false;if(this.cycleBehavior)if(time>this.behaviorStartTime)time=(time-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime;if(time>this.behaviorStartTime+this.behaviorDuration){if(!this.expired)this.setExpired(actor,time);return false}return this.behaviorStartTime<=time&&time<this.behaviorStartTime+this.behaviorDuration},
fireBehaviorExpiredEvent:function(actor,time){for(var i=0;i<this.lifecycleListenerList.length;i++)this.lifecycleListenerList[i].behaviorExpired(this,time,actor)},fireBehaviorAppliedEvent:function(actor,time,normalizedTime,value){for(var i=0;i<this.lifecycleListenerList.length;i++)if(this.lifecycleListenerList[i].behaviorApplied)this.lifecycleListenerList[i].behaviorApplied(this,time,normalizedTime,actor,value)},normalizeTime:function(time){time=time-this.behaviorStartTime;if(this.cycleBehavior)time%=
this.behaviorDuration;return this.interpolator.getPosition(time/this.behaviorDuration).y},setExpired:function(actor,time){this.expired=true;this.setForTime(this.interpolator.getPosition(1).y,actor);this.fireBehaviorExpiredEvent(actor,time)},setForTime:function(time,actor){},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this}}})();
(function(){CAAT.ContainerBehavior=function(){CAAT.ContainerBehavior.superclass.constructor.call(this);this.behaviors=[];return this};extend(CAAT.ContainerBehavior,CAAT.Behavior,{behaviors:null,addBehavior:function(behavior){this.behaviors.push(behavior);behavior.addListener(this);return this},apply:function(time,actor){if(this.isBehaviorInTime(time,actor)){time-=this.getStartTime();if(this.cycleBehavior)time%=this.getDuration();for(var i=0;i<this.behaviors.length;i++)this.behaviors[i].apply(time,
actor)}},setInterpolator:function(interpolator){return this},behaviorExpired:function(behavior,time,actor){if(this.cycleBehavior)behavior.expired=false},setForTime:function(time,actor){for(var i=0;i<this.behaviors.length;i++)this.behaviors[i].setForTime(time,actor);return null}})})();
(function(){CAAT.RotateBehavior=function(){CAAT.RotateBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};extend(CAAT.RotateBehavior,CAAT.Behavior,{startAngle:0,endAngle:0,anchor:0,rx:0,ry:0,setForTime:function(time,actor){var angle=this.startAngle+time*(this.endAngle-this.startAngle);if(this.anchor==CAAT.Actor.prototype.ANCHOR_CUSTOM)actor.setRotationAnchored(angle,this.rx,this.ry);else{var obj=actor.getAnchor(this.anchor);actor.setRotationAnchored(angle,
obj.x,obj.y)}return angle},setValues:function(startAngle,endAngle){this.startAngle=startAngle;this.endAngle=endAngle;return this},setAngles:function(start,end){return this.setValues(start,end)},setAnchor:function(anchor,rx,ry){this.anchor=anchor;if(anchor==CAAT.Actor.prototype.ANCHOR_CUSTOM){this.rx=rx;this.ry=ry}return this}})})();
(function(){CAAT.GenericBehavior=function(){CAAT.GenericBehavior.superclass.constructor.call(this);return this};extend(CAAT.GenericBehavior,CAAT.Behavior,{callback:null,start:0,end:0,target:null,property:null,callback:null,setForTime:function(time,actor){var value=this.start+time*(this.end-this.start);if(this.callback)this.callback(value,this.target);else this.target[this.property]=value},setValues:function(start,end,target,property,callback){this.start=start;this.end=end;this.target=target;this.property=
property;this.callback=callback;return this}})})();
(function(){CAAT.ScaleBehavior=function(){CAAT.RotateBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};extend(CAAT.ScaleBehavior,CAAT.Behavior,{startScaleX:0,endScaleX:0,startScaleY:0,endScaleY:0,anchor:0,setForTime:function(time,actor){var scaleX=this.startScaleX+time*(this.endScaleX-this.startScaleX);var scaleY=this.startScaleY+time*(this.endScaleY-this.startScaleY);if(0==scaleX)scaleX=0.01;if(0==scaleY)scaleY=0.01;actor.setScaleAnchored(scaleX,
scaleY,this.anchor);return{scaleX:scaleX,scaleY:scaleY}},setValues:function(startX,endX,startY,endY){this.startScaleX=startX;this.endScaleX=endX;this.startScaleY=startY;this.endScaleY=endY;return this},setAnchor:function(anchor){this.anchor=anchor;return this}})})();
(function(){CAAT.AlphaBehavior=function(){CAAT.AlphaBehavior.superclass.constructor.call(this);return this};extend(CAAT.AlphaBehavior,CAAT.Behavior,{startAlpha:0,endAlpha:0,setForTime:function(time,actor){var alpha=this.startAlpha+time*(this.endAlpha-this.startAlpha);actor.setAlpha(alpha);return alpha},setValues:function(start,end){this.startAlpha=start;this.endAlpha=end;return this}})})();
(function(){CAAT.PathBehavior=function(){CAAT.PathBehavior.superclass.constructor.call(this);return this};extend(CAAT.PathBehavior,CAAT.Behavior,{path:null,autoRotate:false,prevX:-1,prevY:-1,translateX:0,translateY:0,setAutoRotate:function(autorotate){this.autoRotate=autorotate;return this},setPath:function(path){this.path=path;return this},setFrameTime:function(startTime,duration){CAAT.PathBehavior.superclass.setFrameTime.call(this,startTime,duration);this.prevX=-1;this.prevY=-1;return this},setTranslation:function(tx,
ty){this.translateX=tx;this.translateY=ty;return this},setForTime:function(time,actor){var point=this.path.getPosition(time);if(this.autoRotate){if(-1==this.prevX&&-1==this.prevY){this.prevX=point.x;this.prevY=point.y}var ax=point.x-this.prevX;var ay=point.y-this.prevY;if(ax==0&&ay==0)return;var angle=Math.atan2(ay,ax);if(this.prevX<=point.x)actor.transformation=CAAT.SpriteActor.prototype.TR_NONE;else{actor.transformation=CAAT.SpriteActor.prototype.TR_FLIP_HORIZONTAL;angle+=Math.PI}actor.setRotation(angle);
this.prevX=point.x;this.prevY=point.y;var modulo=Math.sqrt(ax*ax+ay*ay);ax/=modulo;ay/=modulo}actor.setLocation(point.x-this.translateX,point.y-this.translateY);return{x:actor.x,y:actor.y}},positionOnTime:function(time){if(this.isBehaviorInTime(time,null)){time=this.normalizeTime(time);return this.path.getPosition(time)}return{x:-1,y:-1}}})})();(function(){CAAT.BrowserDetect=function(){this.init();return this};CAAT.BrowserDetect.prototype={browser:"",version:0,OS:"",init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=
data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)return data[i].identity}else if(dataProp)return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",
identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",
identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},
{string:navigator.platform,subString:"Linux",identity:"Linux"}]}})();function extend(subc,superc,overrides){var F=function(){};var i;F.prototype=superc.prototype;subc.prototype=new F;subc.prototype.constructor=subc;subc.superclass=superc.prototype;if(superc.prototype.constructor==Object.prototype.constructor)superc.prototype.constructor=superc;if(overrides)for(i in overrides)if(overrides.hasOwnProperty(i))subc.prototype[i]=overrides[i]};(function(){CAAT.Matrix=function(){this.matrix=[[1,0,0],[0,1,0],[0,0,1]];return this};CAAT.Matrix.prototype={matrix:null,type:false,TYPE_ROTATE:0,TYPE_SCALE:1,TYPE_TRANSLATE:2,transform:function(point){var x=point.x;var y=point.y;if(this.type==this.TYPE_ROTATE){point.x=x*this.matrix[0][0]+y*this.matrix[1][0]+this.matrix[0][2];point.y=x*this.matrix[0][1]+y*this.matrix[1][1]+this.matrix[1][2]}else if(this.type==this.TYPE_SCALE){point.x*=this.matrix[0][0];point.y*=this.matrix[1][1]}else if(this.type==
this.TYPE_TRANSLATE){point.x+=this.matrix[0][2];point.y+=this.matrix[1][2]}else{point.x=x*this.matrix[0][0]+y*this.matrix[0][1]+this.matrix[0][2];point.y=x*this.matrix[1][0]+y*this.matrix[1][1]+this.matrix[1][2]}return point},rotate:function(angle){var m=new CAAT.Matrix;m.matrix[0][0]=Math.cos(angle);m.matrix[1][0]=-Math.sin(angle);m.matrix[0][1]=Math.sin(angle);m.matrix[1][1]=Math.cos(angle);m.type=this.TYPE_ROTATE;return m},_rotateAnchor:function(angle,tx,ty){var m=new CAAT.Matrix;m.matrix[0][0]=
Math.cos(angle);m.matrix[1][0]=-Math.sin(angle);m.matrix[0][1]=Math.sin(angle);m.matrix[1][1]=Math.cos(angle);m.matrix[0][2]=tx;m.matrix[1][2]=ty;m.type=this.TYPE_ROTATE;return m},scale:function(scalex,scaley){var m=new CAAT.Matrix;m.matrix[0][0]=scalex;m.matrix[1][1]=scaley;m.type=this.TYPE_SCALE;return m},translate:function(x,y){var m=new CAAT.Matrix;m.matrix[0][2]=x;m.matrix[1][2]=y;m.type=this.TYPE_TRANSLATE;return m},copy:function(matrix){this.matrix[0][0]=matrix[0][0];this.matrix[0][1]=matrix[0][1];
this.matrix[0][2]=matrix[0][2];this.matrix[1][0]=matrix[1][0];this.matrix[1][1]=matrix[1][1];this.matrix[1][2]=matrix[1][2];this.matrix[2][0]=matrix[2][0];this.matrix[2][1]=matrix[2][1];this.matrix[2][2]=matrix[2][2]},identity:function(){this.matrix[0][0]=1;this.matrix[0][1]=0;this.matrix[0][2]=0;this.matrix[1][0]=0;this.matrix[1][1]=1;this.matrix[1][2]=0;this.matrix[2][0]=0;this.matrix[2][1]=0;this.matrix[2][2]=1},multiply:function(m){var m00=this.matrix[0][0]*m.matrix[0][0]+this.matrix[0][1]*m.matrix[1][0]+
this.matrix[0][2]*m.matrix[2][0];var m01=this.matrix[0][0]*m.matrix[0][1]+this.matrix[0][1]*m.matrix[1][1]+this.matrix[0][2]*m.matrix[2][1];var m02=this.matrix[0][0]*m.matrix[0][2]+this.matrix[0][1]*m.matrix[1][2]+this.matrix[0][2]*m.matrix[2][2];var m10=this.matrix[1][0]*m.matrix[0][0]+this.matrix[1][1]*m.matrix[1][0]+this.matrix[1][2]*m.matrix[2][0];var m11=this.matrix[1][0]*m.matrix[0][1]+this.matrix[1][1]*m.matrix[1][1]+this.matrix[1][2]*m.matrix[2][1];var m12=this.matrix[1][0]*m.matrix[0][2]+
this.matrix[1][1]*m.matrix[1][2]+this.matrix[1][2]*m.matrix[2][2];var m20=this.matrix[2][0]*m.matrix[0][0]+this.matrix[2][1]*m.matrix[1][0]+this.matrix[2][2]*m.matrix[2][0];var m21=this.matrix[2][0]*m.matrix[0][1]+this.matrix[2][1]*m.matrix[1][1]+this.matrix[2][2]*m.matrix[2][1];var m22=this.matrix[2][0]*m.matrix[0][2]+this.matrix[2][1]*m.matrix[1][2]+this.matrix[2][2]*m.matrix[2][2];this.matrix[0][0]=m00;this.matrix[0][1]=m01;this.matrix[0][2]=m02;this.matrix[1][0]=m10;this.matrix[1][1]=m11;this.matrix[1][2]=
m12;this.matrix[2][0]=m20;this.matrix[2][1]=m21;this.matrix[2][2]=m22},premultiply:function(m){var m00=m.matrix[0][0]*this.matrix[0][0]+m.matrix[0][1]*this.matrix[1][0]+m.matrix[0][2]*this.matrix[2][0];var m01=m.matrix[0][0]*this.matrix[0][1]+m.matrix[0][1]*this.matrix[1][1]+m.matrix[0][2]*this.matrix[2][1];var m02=m.matrix[0][0]*this.matrix[0][2]+m.matrix[0][1]*this.matrix[1][2]+m.matrix[0][2]*this.matrix[2][2];var m10=m.matrix[1][0]*this.matrix[0][0]+m.matrix[1][1]*this.matrix[1][0]+m.matrix[1][2]*
this.matrix[2][0];var m11=m.matrix[1][0]*this.matrix[0][1]+m.matrix[1][1]*this.matrix[1][1]+m.matrix[1][2]*this.matrix[2][1];var m12=m.matrix[1][0]*this.matrix[0][2]+m.matrix[1][1]*this.matrix[1][2]+m.matrix[1][2]*this.matrix[2][2];var m20=m.matrix[2][0]*this.matrix[0][0]+m.matrix[2][1]*this.matrix[1][0]+m.matrix[2][2]*this.matrix[2][0];var m21=m.matrix[2][0]*this.matrix[0][1]+m.matrix[2][1]*this.matrix[1][1]+m.matrix[2][2]*this.matrix[2][1];var m22=m.matrix[2][0]*this.matrix[0][2]+m.matrix[2][1]*
this.matrix[1][2]+m.matrix[2][2]*this.matrix[2][2];this.matrix[0][0]=m00;this.matrix[0][1]=m01;this.matrix[0][2]=m02;this.matrix[1][0]=m10;this.matrix[1][1]=m11;this.matrix[1][2]=m12;this.matrix[2][0]=m20;this.matrix[2][1]=m21;this.matrix[2][2]=m22},getInverse:function(){var tx=this.matrix[0][2];var ty=this.matrix[1][2];var m00=this.matrix[0][0];var m01=this.matrix[0][1];var m10=this.matrix[1][0];var m11=this.matrix[1][1];var newMatrix=new CAAT.Matrix;if(this.type==this.TYPE_ROTATE){newMatrix.matrix[0][0]=
m00;newMatrix.matrix[0][1]=m10;newMatrix.matrix[1][0]=m01;newMatrix.matrix[1][1]=m11}else if(this.type==this.TYPE_SCALE){newMatrix.matrix[0][0]=1/m00;newMatrix.matrix[1][1]=1/m11}else if(this.type==this.TYPE_TRANSLATE){newMatrix.matrix[0][2]=-tx;newMatrix.matrix[1][2]=-ty}newMatrix.type=this.type;return newMatrix}}})();
(function(){CAAT.MatrixStack=function(){this.matrix=new CAAT.Matrix;this.stack=[];this.saved=[];return this};CAAT.MatrixStack.prototype={matrix:null,stack:null,saved:null,pushMatrix:function(matrix){this.stack.push(matrix)},popMatrix:function(){return this.stack.pop()},save:function(){this.saved.push(this.stack.length)},restore:function(){var pos=this.saved.pop();while(this.stack.length!=pos)this.popMatrix()},transform:function(ctx){for(var i=0;i<this.stack.length;i++){var m=this.stack[i].matrix;
ctx.transform(m[0][0],m[0][1],m[1][0],m[1][1],m[0][2],m[1][2])}},transformInverse:function(ctx){for(var i=this.stack.length-1;i>=0;i--){var im=this.stack[i].getInverse();ctx.transform(im.matrix[0][0],im.matrix[0][1],im.matrix[1][0],im.matrix[1][1],im.matrix[0][2],im.matrix[1][2])}},prepareGraphics:function(canvas,actor){this.stack=[];if(actor.dirty){this.pushMatrix(CAAT.Matrix.prototype.translate(actor.x,actor.y));if(actor.rotationAngle!=0){this.pushMatrix(CAAT.Matrix.prototype.translate(actor.rotationX,
actor.rotationY));this.pushMatrix(CAAT.Matrix.prototype.rotate(actor.rotationAngle));this.pushMatrix(CAAT.Matrix.prototype.translate(-actor.rotationX,-actor.rotationY))}if(actor.scaleX!=1||actor.scaleY!=1)if(actor.scaleX!=0&&actor.scaleY!=0){this.pushMatrix(CAAT.Matrix.prototype.translate(actor.scaleTX-actor.width,actor.scaleTY-actor.height));this.pushMatrix(CAAT.Matrix.prototype.scale(actor.scaleX,actor.scaleY));this.pushMatrix(CAAT.Matrix.prototype.translate(-(actor.scaleTX-actor.width/actor.scaleX),
-(actor.scaleTY-actor.height/actor.scaleY)))}else this.pushMatrix(CAAT.Matrix.prototype.scale(0.01,0.01))}if(this.oldX!=actor.x||this.oldY!=actor.y){this.stack[0].matrix[0][2]=actor.x;this.stack[0].matrix[1][2]=actor.y}this.oldX=actor.x;this.oldY=actor.y;this.transform(canvas)},transformCoord:function(point){for(var i=this.stack.length-1;i>=0;i--){var matrix=this.stack[i];matrix.transform(point)}return point},transformCoordNoTranslate:function(point){for(var i=this.stack.length-1;i>=1;i--){var matrix=
this.stack[i];matrix.transform(point)}return point},inverseTransformCoord:function(point){for(var i=0;i<this.stack.length;i++){var matrix=this.stack[i].getInverse();matrix.transform(point)}return point},getMatrix:function(){var matrix=new CAAT.Matrix;for(var i=0;i<this.stack.length;i++){var matrixStack=this.stack[i];matrix.multiply(matrixStack)}return matrix}}})();(function(){CAAT.Color=function(){return this};CAAT.Color.prototype={hsvToRgb:function(h,s,v){var r,g,b;var i;var f,p,q,t;h=Math.max(0,Math.min(360,h));s=Math.max(0,Math.min(100,s));v=Math.max(0,Math.min(100,v));s/=100;v/=100;if(s==0){r=g=b=v;return[Math.round(r*255),Math.round(g*255),Math.round(b*255)]}h/=60;i=Math.floor(h);f=h-i;p=v*(1-s);q=v*(1-s*f);t=v*(1-s*(1-f));switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;
default:r=v;g=p;b=q}return new CAAT.Color.RGB(Math.round(r*255),Math.round(g*255),Math.round(b*255))}}})();(function(){CAAT.Color.RGB=function(r,g,b){this.r=r||255;this.g=g||255;this.b=b||255;return this};CAAT.Color.RGB.prototype={r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}})();
(function(){CAAT.ColorUtils=function(){return this};CAAT.ColorUtils.prototype={RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5,interpolate:function(r0,g0,b0,r1,g1,b1,nsteps,step){if(step<=0)return{r:r0,g:g0,b:b0};else if(step>=nsteps)return{r:r1,g:g1,b:b1};var r=r0+(r1-r0)/nsteps*step>>0;var g=g0+(g1-g0)/nsteps*step>>0;var b=b0+(b1-b0)/nsteps*step>>0;if(r>255)r=255;else if(r<0)r=0;if(g>255)g=255;else if(g<0)g=0;if(b>255)b=255;else if(b<
0)b=0;return{r:r,g:g,b:b}},makeRGBColorRamp:function(fromColorsArray,rampSize,returnType){var ramp=[];var nc=fromColorsArray.length-1;var chunk=rampSize/nc;for(var i=0;i<nc;i++){var c=fromColorsArray[i];var a0=c>>24&255;var r0=(c&16711680)>>16;var g0=(c&65280)>>8;var b0=c&255;var c1=fromColorsArray[i+1];var a1=c1>>24&255;var r1=(c1&16711680)>>16;var g1=(c1&65280)>>8;var b1=c1&255;var da=(a1-a0)/chunk;var dr=(r1-r0)/chunk;var dg=(g1-g0)/chunk;var db=(b1-b0)/chunk;for(var j=0;j<chunk;j++){var na=a0+
da*j>>0;var nr=r0+dr*j>>0;var ng=g0+dg*j>>0;var nb=b0+db*j>>0;switch(returnType){case this.RAMP_RGBA:ramp.push("argb("+na+","+nr+","+ng+","+nb+")");break;case this.RAMP_RGB:ramp.push("rgb("+nr+","+ng+","+nb+")");break;case this.RAMP_CHANNEL_RGB:ramp.push(4278190080|nr<<16|ng<<8|nb);break;case this.RAMP_CHANNEL_RGBA:ramp.push(na<<24|nr<<16|ng<<8|nb);break;case this.RAMP_CHANNEL_RGBA_ARRAY:ramp.push([nr,ng,nb,na]);break;case this.RAMP_CHANNEL_RGB_ARRAY:ramp.push([nr,ng,nb]);break}}}return ramp}}})();(function(){CAAT.Rectangle=function(){return this};CAAT.Rectangle.prototype={x:0,y:0,x1:0,y1:0,width:0,height:0,contains:function(px,py){return px>=0&&px<this.width&&py>=0&&py<this.height},isEmpty:function(){return this.width==0&&this.height==0},union:function(px,py){if(this.isEmpty()&&this.x==0&&this.y==0){this.x=px;this.y=py;return}this.x1=this.x+this.width;this.y1=this.y+this.height;if(py<this.y)this.y=py;if(px<this.x)this.x=px;if(py>this.y1)this.y1=py;if(px>this.x1)this.x1=px;this.width=this.x1-
this.x;this.height=this.y1-this.y}}})();(function(){CAAT.Curve=function(){return this};CAAT.Curve.prototype={coordlist:null,k:0.05,length:-1,interpolator:false,HANDLE_SIZE:20,drawHandles:true,paint:function(director){if(false==this.drawHandles)return;var canvas=director.crc;canvas.save();canvas.beginPath();canvas.strokeStyle="#a0a0a0";canvas.moveTo(this.coordlist[0].x,this.coordlist[0].y);canvas.lineTo(this.coordlist[1].x,this.coordlist[1].y);canvas.stroke();if(this.cubic){canvas.moveTo(this.coordlist[2].x,this.coordlist[2].y);canvas.lineTo(this.coordlist[3].x,
this.coordlist[3].y);canvas.stroke()}canvas.globalAlpha=0.5;for(var i=0;i<this.coordlist.length;i++){canvas.fillStyle="#7f7f00";canvas.beginPath();canvas.arc(this.coordlist[i].x,this.coordlist[i].y,this.HANDLE_SIZE/2,0,2*Math.PI,false);canvas.fill()}canvas.restore()},update:function(){this.calcLength()},solve:function(point,t){},getBoundingBox:function(rectangle){if(!rectangle)rectangle=new CAAT.Rectangle;var pt=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(pt);rectangle.union(pt.x,
pt.y)}return rectangle},calcLength:function(){var x1,x2,y1,y2;x1=this.coordlist[0].x;y1=this.coordlist[0].y;var llength=0;var pt=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(pt,t);llength+=Math.sqrt((pt.x-x1)*(pt.x-x1)+(pt.y-y1)*(pt.y-y1));x1=pt.x;y1=pt.y}this.length=llength;return llength},getLength:function(){return this.length},endCurvePosition:function(point){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(point){return this.coordlist[0]}}})();
(function(){CAAT.Bezier=function(){CAAT.Bezier.superclass.constructor.call(this);return this};extend(CAAT.Bezier,CAAT.Curve,{cubic:false,setCubic:function(cp0x,cp0y,cp1x,cp1y,cp2x,cp2y,cp3x,cp3y){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(cp0x,cp0y));this.coordlist.push((new CAAT.Point).set(cp1x,cp1y));this.coordlist.push((new CAAT.Point).set(cp2x,cp2y));this.coordlist.push((new CAAT.Point).set(cp3x,cp3y));this.cubic=true;this.update()},setQuadric:function(cp0x,cp0y,cp1x,cp1y,cp2x,
cp2y){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(cp0x,cp0y));this.coordlist.push((new CAAT.Point).set(cp1x,cp1y));this.coordlist.push((new CAAT.Point).set(cp2x,cp2y));this.cubic=false;this.update()},paint:function(director){if(this.cubic)this.paintCubic(director);else this.paintCuadric(director);CAAT.Bezier.superclass.paint.call(this,director)},paintCuadric:function(director){var x1,y1;x1=this.coordlist[0].x;y1=this.coordlist[0].y;var canvas=director.crc;canvas.save();canvas.beginPath();
canvas.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(point,t);canvas.lineTo(point.x,point.y)}canvas.stroke();canvas.restore()},paintCubic:function(director){var x1,y1;x1=this.coordlist[0].x;y1=this.coordlist[0].y;var canvas=director.crc;canvas.save();canvas.beginPath();canvas.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(point,t);canvas.lineTo(point.x,point.y)}canvas.stroke();canvas.restore()},solve:function(point,
t){if(this.cubic)return this.solveCubic(point,t);else return this.solveQuadric(point,t)},solveCubic:function(point,t){var t2=t*t;var t3=t*t2;point.x=this.coordlist[0].x+t*(-this.coordlist[0].x*3+t*(3*this.coordlist[0].x-this.coordlist[0].x*t))+t*(3*this.coordlist[1].x+t*(-6*this.coordlist[1].x+this.coordlist[1].x*3*t))+t2*(this.coordlist[2].x*3-this.coordlist[2].x*3*t)+this.coordlist[3].x*t3;point.y=this.coordlist[0].y+t*(-this.coordlist[0].y*3+t*(3*this.coordlist[0].y-this.coordlist[0].y*t))+t*(3*
this.coordlist[1].y+t*(-6*this.coordlist[1].y+this.coordlist[1].y*3*t))+t2*(this.coordlist[2].y*3-this.coordlist[2].y*3*t)+this.coordlist[3].y*t3;return point},solveQuadric:function(point,t){point.x=(1-t)*(1-t)*this.coordlist[0].x+2*(1-t)*t*this.coordlist[1].x+t*t*this.coordlist[2].x;point.y=(1-t)*(1-t)*this.coordlist[0].y+2*(1-t)*t*this.coordlist[1].y+t*t*this.coordlist[2].y;return point}})})();
(function(){CAAT.CatmullRom=function(){CAAT.CatmullRom.superclass.constructor.call(this);return this};extend(CAAT.CatmullRom,CAAT.Curve,{setCurve:function(cp0x,cp0y,cp1x,cp1y,cp2x,cp2y,cp3x,cp3y){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(cp0x,cp0y));this.coordlist.push((new CAAT.Point).set(cp1x,cp1y));this.coordlist.push((new CAAT.Point).set(cp2x,cp2y));this.coordlist.push((new CAAT.Point).set(cp3x,cp3y));this.cubic=true;this.update()},paint:function(director){var x1,x2,y1,y2;x1=
this.coordlist[0].x;y1=this.coordlist[0].y;var canvas=director.crc;canvas.save();canvas.beginPath();canvas.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(point,t);canvas.lineTo(point.x,point.y)}canvas.stroke();canvas.restore();CAAT.CatmullRom.superclass.paint.call(this,director)},solve:function(point,t){var t2=t*t;var t3=t*t2;var c=this.coordlist;point.x=0.5*(2*c[1].x+(-c[0].x+c[2].x)*t+(2*c[0].x-5*c[1].x+4*c[2].x-c[3].x)*t2+(-c[0].x+3*c[1].x-3*c[2].x+c[3].x)*
t3);point.y=0.5*(2*c[1].y+(-c[0].y+c[2].y)*t+(2*c[0].y-5*c[1].y+4*c[2].y-c[3].y)*t2+(-c[0].y+3*c[1].y-3*c[2].y+c[3].y)*t3);return point}})})();(function(){CAAT.Point=function(xpos,ypos){this.x=xpos||0;this.y=ypos||0;return this};CAAT.Point.prototype={x:0,y:0,set:function(x,y){this.x=x;this.y=y;return this},clone:function(){var p=new CAAT.Point;p.set(this.x,this.y);return p},translate:function(x,y){this.x+=x;this.y+=y;return this},translatePoint:function(aPoint){this.x+=aPoint.x;this.y+=aPoint.y;return this},subtract:function(aPoint){this.x-=aPoint.x;this.y-=aPoint.y;return this},multiply:function(factor){this.x*=factor;this.y*=factor;return this},
rotate:function(angle){var x=this.x,y=this.y;this.x=x*Math.cos(angle)-Math.sin(angle)*y;this.y=x*Math.sin(angle)+Math.cos(angle)*y;return this},setAngle:function(angle){var len=this.getLength();this.x=Math.cos(angle)*len;this.y=Math.sin(angle)*len;return this},setLength:function(length){var len=this.getLength();if(len)this.multiply(length/len);else this.x=this.y=length;return this},normalize:function(){var len=this.getLength();this.x/=len;this.y/=len;return this},getAngle:function(){return Math.atan2(this.y,
this.x)},limit:function(max){var aLenthSquared=this.getLengthSquared();if(aLenthSquared+0.01>max*max){var aLength=Math.sqrt(aLenthSquared);this.x=this.x/aLength*max;this.y=this.y/aLength*max}},getLength:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y);if(length<0.0050&&length>-0.0050)return 1.0E-6;return length},getLengthSquared:function(){var lengthSquared=this.x*this.x+this.y*this.y;if(lengthSquared<0.0050&&lengthSquared>-0.0050)return 0;return lengthSquared},getDistance:function(point){var deltaX=
this.x-point.x;var deltaY=this.y-point.y;return Math.sqrt(deltaX*deltaX+deltaY*deltaY)},getDistanceSquared:function(point){var deltaX=this.x-point.x;var deltaY=this.y-point.y;return deltaX*deltaX+deltaY*deltaY},toString:function(){return"(CAAT.Point) x:'"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)}}})();(function(){CAAT.Actor=function(){this.transformationMatrix=new CAAT.MatrixStack;this.rpoint=new CAAT.Point;this.behaviorList=[];this.lifecycleListenerList=[];this.screenBounds=new CAAT.Rectangle;return this};CAAT.Actor.prototype={lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,start_time:0,duration:Number.MAX_VALUE,transformationMatrix:null,rpoint:null,clip:false,scaleX:0,scaleY:0,scaleTX:0,scaleTY:0,scaleAnchor:0,rotationAngle:0,rotationY:0,alpha:1,rotationX:0,
isGlobalAlpha:false,frameAlpha:1,expired:false,discardable:false,pointed:false,mouseEnabled:true,ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,fillStyle:null,strokeStyle:null,time:0,screenBounds:null,inFrame:false,dirty:true,setOutOfFrameTime:function(){this.setFrameTime(-1,0);return this},addListener:function(actorListener){this.lifecycleListenerList.push(actorListener)},removeListener:function(actorListener){var n=
this.lifecycleListenerList.length;while(n--)if(this.lifecycleListenerList[n]==actorListener){this.lifecycleListenerList.splice(n,1);return}},setGlobalAlpha:function(global){this.isGlobalAlpha=global;return this},fireEvent:function(sEventType,time){for(var i=0;i<this.lifecycleListenerList.length;i++)this.lifecycleListenerList[i].actorLyfeCycleEvent(this,sEventType,time)},setScreenBounds:function(){var p=[];p.push((new CAAT.Point).set(0,0));p.push((new CAAT.Point).set(this.width,this.height));p.push((new CAAT.Point).set(0,
this.height));p.push((new CAAT.Point).set(this.width,0));for(var k=0;k<p.length;k++)this.transformCoord(p[k]);var xmin=Number.MAX_VALUE,xmax=Number.MIN_VALUE;var ymin=Number.MAX_VALUE,ymax=Number.MIN_VALUE;for(var i=0;i<p.length;i++){if(p[i].x<xmin)xmin=p[i].x;if(p[i].x>xmax)xmax=p[i].x;if(p[i].y<ymin)ymin=p[i].y;if(p[i].y>ymax)ymax=p[i].y}this.screenBounds.x=xmin;this.screenBounds.y=ymin;this.screenBounds.width=xmax-xmin;this.screenBounds.height=ymax-ymin},setExpired:function(time){this.expired=
true;this.fireEvent("expired",time);return this},enableEvents:function(enable){this.mouseEnabled=enable;return this},emptyBehaviorList:function(){this.behaviorList=[];return this},setFillStyle:function(style){this.fillStyle=style;return this},setStrokeStyle:function(style){this.strokeStyle=style;return this},setPaint:function(paint){return this.setFillStyle(paint)},setAlpha:function(alpha){this.alpha=alpha;return this},resetTransform:function(){this.rotationAngle=0;this.rotateAnchor=0;this.rotationX=
0;this.rotationY=0;this.scaleX=1;this.scaleY=1;this.scaleTX=0;this.scaleTY=0;this.scaleAnchor=0;this.dirty=true;return this},setFrameTime:function(startTime,duration){this.start_time=startTime;this.duration=duration;this.expired=false;this.dirty=true;return this},paint:function(director,time){var ctx=director.crc;if(null!=this.parent&&null!=this.fillStyle){ctx.fillStyle=this.pointed?"orange":this.fillStyle!=null?this.fillStyle:"white";ctx.fillRect(0,0,this.width,this.height)}},setScale:function(sx,
sy){this.setScaleAnchored(sx,sy,this.ANCHOR_CENTER);this.dirty=true;return this},getAnchor:function(anchor){var tx=0,ty=0;switch(anchor){case this.ANCHOR_CENTER:tx=this.width/2;ty=this.height/2;break;case this.ANCHOR_TOP:tx=this.width/2;ty=0;break;case this.ANCHOR_BOTTOM:tx=this.width/2;ty=this.height;break;case this.ANCHOR_LEFT:tx=0;ty=this.height/2;break;case this.ANCHOR_RIGHT:tx=this.width;ty=this.height/2;break;case this.ANCHOR_TOP_RIGHT:tx=this.width;ty=0;break;case this.ANCHOR_BOTTOM_LEFT:tx=
0;ty=this.height;break;case this.ANCHOR_BOTTOM_RIGHT:tx=this.width;ty=this.height;break;case this.ANCHOR_TOP_LEFT:tx=0;ty=0;break}return{x:tx,y:ty}},setScaleAnchored:function(sx,sy,anchor){this.scaleAnchor=anchor;var obj=this.getAnchor(this.scaleAnchor);this.scaleTX=obj.x;this.scaleTY=obj.y;this.scaleX=sx;this.scaleY=sy;this.dirty=true;return this},setRotation:function(angle){this.setRotationAnchored(angle,this.width/2,this.height/2);return this},setRotationAnchored:function(angle,rx,ry){this.rotationAngle=
angle;this.rotationX=rx?rx:0;this.rotationY=ry?ry:0;this.dirty=true;return this},setSize:function(w,h){this.width=w>>0;this.height=h>>0;return this},setBounds:function(x,y,w,h){this.x=x>>0;this.y=y>>0;this.width=w>>0;this.height=h>>0;return this},setLocation:function(x,y){this.x=x>>0;this.y=y>>0;return this},isInAnimationFrame:function(time){if(this.expired)return false;if(this.duration==Number.MAX_VALUE)return this.start_time<=time;if(time>=this.start_time+this.duration){if(!this.expired)this.setExpired(time);
return false}return this.start_time<=time&&time<this.start_time+this.duration},contains:function(x,y){return x>=0&&y>=0&&x<this.width&&y<this.height},create:function(){this.scaleAnchor=this.ANCHOR_CENTER;this.rotateAnchor=this.ANCHOR_CENTER;this.setScale(1,1);this.setRotation(0);this.behaviorList=[];return this},addBehavior:function(behavior){this.behaviorList.push(behavior);return this},removeBehaviour:function(behavior){var n=this.behaviorList.length-1;while(n)if(this.behaviorList[n]==behavior){this.behaviorList.splice(n,
1);return this}return this},removeBehavior:function(id){for(var n=0;n<this.behaviorList.length;n++)if(this.behaviorList[n].id==id)this.behaviorList.splice(n,1);return this},setDiscardable:function(discardable){this.discardable=discardable;return this},destroy:function(time){this.fireEvent("destroyed",time)},transformCoord:function(point){var tthis=this;while(!(tthis instanceof CAAT.Director)){tthis.transformationMatrix.transformCoord(point);tthis=tthis.parent}return point},inverseTransformCoord:function(point){var tthis=
this;while(tthis){tthis.transformationMatrix.inverseTransformCoord(point);tthis=tthis.parent}return point},findActorAtPosition:function(point){if(!this.mouseEnabled||!this.isInAnimationFrame(this.time))return null;this.rpoint.set(point.x,point.y);this.transformationMatrix.inverseTransformCoord(this.rpoint);return this.contains(this.rpoint.x,this.rpoint.y)?this:null},enableDrag:function(){this.ax=0;this.ay=0;this.mx=0;this.my=0;this.asx=1;this.asy=1;this.ara=0;this.screenx=0;this.screeny=0;this.mouseEnter=
function(mouseEvent){this.ax=-1;this.ay=-1;this.pointed=true;document.body.style.cursor="move"};this.mouseExit=function(mouseEvent){this.ax=-1;this.ay=-1;this.pointed=false;document.body.style.cursor="default"};this.mouseMove=function(mouseEvent){this.mx=mouseEvent.point.x;this.my=mouseEvent.point.y};this.mouseUp=function(mouseEvent){this.ax=-1;this.ay=-1};this.mouseDrag=function(mouseEvent){if(this.ax==-1||this.ay==-1){this.ax=mouseEvent.point.x;this.ay=mouseEvent.point.y;this.asx=this.scaleX;this.asy=
this.scaleY;this.ara=this.rotationAngle;this.screenx=mouseEvent.screenPoint.x;this.screeny=mouseEvent.screenPoint.y}if(mouseEvent.isShiftDown()){var scx=(mouseEvent.screenPoint.x-this.screenx)/100;var scy=(mouseEvent.screenPoint.y-this.screeny)/100;if(!mouseEvent.isAltDown()){var sc=Math.max(scx,scy);scx=sc;scy=sc}this.setScale(scx+this.asx,scy+this.asy)}else if(mouseEvent.isControlDown()){var vx=mouseEvent.screenPoint.x-this.screenx;var vy=mouseEvent.screenPoint.y-this.screeny;this.setRotation(-Math.atan2(vx,
vy)+this.ara)}else{this.x+=mouseEvent.point.x-this.ax;this.y+=mouseEvent.point.y-this.ay;this.ax=mouseEvent.point.x;this.ay=mouseEvent.point.y}};return this},mouseClick:function(mouseEvent){},mouseDblClick:function(mouseEvent){},mouseEnter:function(mouseEvent){this.pointed=true},mouseExit:function(mouseEvent){this.pointed=false},mouseMove:function(mouseEvent){},mouseDown:function(mouseEvent){},mouseUp:function(mouseEvent){},mouseDrag:function(mouseEvent){},drawScreenBoundingBox:function(director,
time){if(this.inFrame&&null!=this.screenBounds){director.crc.strokeStyle="red";director.crc.strokeRect(this.screenBounds.x,this.screenBounds.y,this.screenBounds.width,this.screenBounds.height)}},animate:function(director,time){for(var i=0;i<this.behaviorList.length;i++)this.behaviorList[i].apply(time,this)},paintActor:function(director,time){if(!this.isInAnimationFrame(time)){this.inFrame=false;return false}var canvas=director.crc;this.frameAlpha=this.parent.frameAlpha*this.alpha;canvas.globalAlpha=
this.frameAlpha;this.transformationMatrix.prepareGraphics(canvas,this);this.setScreenBounds();if(this.clip){canvas.beginPath();canvas.rect(0,0,this.width,this.height);canvas.clip()}this.paint(director,time);this.inFrame=true;return true},endAnimate:function(director,time){},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this},setClip:function(clip){this.clip=clip;return this}}})();
(function(){CAAT.ActorContainer=function(){CAAT.ActorContainer.superclass.constructor.call(this);this.childrenList=[];this.pendingChildrenList=[];return this};extend(CAAT.ActorContainer,CAAT.Actor,{childrenList:null,pendingChildrenList:null,drawScreenBoundingBox:function(director,time){if(!this.inFrame)return;for(var i=0;i<this.childrenList.length;i++)this.childrenList[i].drawScreenBoundingBox(director,time);CAAT.ActorContainer.superclass.drawScreenBoundingBox.call(this,director,time)},emptyChildren:function(){this.childrenList=
[];return this},paintActor:function(director,time){var canvas=director.crc;canvas.save();if(!CAAT.ActorContainer.superclass.paintActor.call(this,director,time))return false;if(!this.isGlobalAlpha)this.frameAlpha=this.parent.frameAlpha;for(var i=0;i<this.childrenList.length;i++){canvas.save();this.childrenList[i].paintActor(director,time);canvas.restore()}canvas.restore();return true},animate:function(director,time){CAAT.ActorContainer.superclass.animate.call(this,director,time);var i;for(i=0;i<this.childrenList.length;i++)if(this.childrenList[i].isInAnimationFrame(time)){this.childrenList[i].time=
time;this.childrenList[i].animate(director,time)}return this},endAnimate:function(director,time){CAAT.ActorContainer.superclass.endAnimate.call(this,director,time);var i;for(i=this.childrenList.length-1;i>=0;i--){var actor=this.childrenList[i];if(actor.expired&&actor.discardable){actor.destroy(time);this.childrenList.splice(i,1)}else actor.endAnimate(director,time)}for(i=0;i<this.pendingChildrenList.length;i++){var child=this.pendingChildrenList[i];child.parent=this;this.childrenList.push(child)}this.pendingChildrenList=
[]},addChildImmediately:function(child){this.addChild(child)},addChild:function(child){child.parent=this;this.childrenList.push(child);return this},addChildDelayed:function(child){this.pendingChildrenList.push(child);return this},addChildAt:function(child,index){if(index<0||index>this.childrenList.length)return this;child.parent=this;this.childrenList.unshift(child);return this},findChild:function(child){var i=0,len=this.childrenList.length;for(i=0;i<len;i++)if(this.childrenList[i]==child)return i;
return-1},removeChild:function(child){var pos=this.findChild(child);if(-1!=pos)this.childrenList.splice(pos,1);return this},findActorAtPosition:function(point){if(null==CAAT.ActorContainer.superclass.findActorAtPosition.call(this,point))return null;for(var i=this.childrenList.length-1;i>=0;i--){var contained=this.childrenList[i].findActorAtPosition(this.rpoint);if(null!=contained)return contained}return this},destroy:function(){for(var i=this.childrenList.length-1;i>=0;i--)this.childrenList[i].destroy();
CAAT.ActorContainer.superclass.destroy.call(this);return this},getNumChildren:function(){return this.childrenList.length},getChildAt:function(iPosition){return this.childrenList[iPosition]},setZOrder:function(actor,index){var actorPos=this.findChild(actor);if(-1!=actorPos){if(index==actorPos)return;if(index>=this.childrenList.length){this.childrenList.splice(actorPos,1);this.childrenList.push(actor)}else{var nActor=this.childrenList.splice(actorPos,1);if(index<0)index=0;else if(index>this.childrenList.length)index=
this.childrenList.length;this.childrenList.splice(index,1,nActor)}}}})})();
(function(){CAAT.SpriteActor=function(){CAAT.SpriteActor.superclass.constructor.call(this);return this};extend(CAAT.SpriteActor,CAAT.ActorContainer,{compoundbitmap:null,animationImageIndex:null,prevAnimationTime:-1,changeFPS:1E3,transformation:0,spriteIndex:0,TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,setSpriteImage:function(conpoundimage){this.compoundbitmap=conpoundimage;this.width=conpoundimage.singleWidth;this.height=conpoundimage.singleHeight;if(null==this.animationImageIndex)this.setAnimationImageIndex([0]);
return this},setChangeFPS:function(fps){this.changeFPS=fps;return this},setSpriteTransformation:function(transformation){this.transformation=transformation;return this},setAnimationImageIndex:function(aAnimationImageIndex){this.animationImageIndex=aAnimationImageIndex;this.spriteIndex=aAnimationImageIndex[0];return this},animate:function(director,time){if(this.compoundbitmap&&this.animationImageIndex){if(this.animationImageIndex.length>1)if(this.prevAnimationTime==-1)this.prevAnimationTime=time;else{var ttime=
time;ttime-=this.prevAnimationTime;ttime/=this.changeFPS;ttime%=this.animationImageIndex.length;this.spriteIndex=this.animationImageIndex[Math.floor(ttime)]}CAAT.SpriteActor.superclass.animate.call(this,director,time)}},paint:function(director,time){var canvas=director.crc;switch(this.transformation){case this.TR_FLIP_HORIZONTAL:this.compoundbitmap.paintInvertedH(canvas,this.spriteIndex,0,0);break;case this.TR_FLIP_VERTICAL:this.compoundbitmap.paintInvertedV(canvas,this.spriteIndex,0,0);break;case this.TR_FLIP_ALL:this.compoundbitmap.paintInvertedHV(canvas,
this.spriteIndex,0,0);break;default:this.compoundbitmap.paint(canvas,this.spriteIndex,0,0)}}})})();
(function(){CAAT.ImageActor=function(){CAAT.ImageActor.superclass.constructor.call(this);return this};extend(CAAT.ImageActor,CAAT.ActorContainer,{image:null,transformation:0,TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,offsetX:0,offsetY:0,setOffsetX:function(x){this.offsetX=x;return this},setOffsetY:function(y){this.offsetY=y;return this},setImage:function(image){this.image=image;if(this.width==0||this.height==0){this.width=image.width;this.height=image.height}return this},setImageTransformation:function(transformation){this.transformation=
transformation;return this},paint:function(director,time){var canvas=director.crc;switch(this.transformation){case this.TR_FLIP_HORIZONTAL:this.paintInvertedH(canvas);break;case this.TR_FLIP_VERTICAL:this.paintInvertedV(canvas);break;case this.TR_FLIP_ALL:this.paintInvertedHV(canvas);break;default:this._paint(canvas)}},paintInvertedH:function(canvas){canvas.save();canvas.translate(this.width,0);canvas.scale(-1,1);canvas.drawImage(this.image,this.offsetX,this.offsetY);canvas.restore()},paintInvertedV:function(canvas,
imageIndex){canvas.save();canvas.translate(0,this.height);canvas.scale(1,-1);canvas.drawImage(this.image,this.offsetX,this.offsetY);canvas.restore()},paintInvertedHV:function(canvas){canvas.save();canvas.translate(0,this.height);canvas.scale(1,-1);canvas.translate(this.width,0);canvas.scale(-1,1);canvas.drawImage(this.image,this.offsetX,this.offsetY);canvas.restore()},_paint:function(canvas){canvas.drawImage(this.image,this.offsetX,this.offsetY)}})})();
(function(){CAAT.TextActor=function(){CAAT.TextActor.superclass.constructor.call(this);this.font="10px sans-serif";this.textAlign="left";this.textBaseline="top";this.outlineColor="black";this.clip=false;return this};extend(CAAT.TextActor,CAAT.ActorContainer,{font:null,textAlign:null,textBaseline:null,fill:true,text:null,textWidth:0,textHeight:0,outline:false,outlineColor:null,path:null,pathInterpolator:null,pathDuration:1E4,sign:1,setFill:function(fill){this.fill=fill;return this},setOutline:function(outline){this.outline=
outline;return this},setOutlineColor:function(color){this.outlineColor=color;return this},setText:function(sText){this.text=sText;this.setFont(this.font);return this},setAlign:function(align){this.textAlign=align;return this},setBaseline:function(baseline){this.textBaseline=baseline;return this},setFont:function(font){if(!font)return this;this.font=font;if(this.text==""||null==this.text)this.width=this.height=0;return this},calcTextSize:function(director){director.crc.save();director.crc.font=this.font;
this.textWidth=director.crc.measureText(this.text).width;if(this.width==0)this.width=this.textWidth;try{var pos=this.font.indexOf("px");var s=this.font.substring(0,pos);this.textHeight=parseInt(s,10)}catch(e){this.textHeight=20}if(this.height==0)this.height=this.textHeight;director.crc.restore();return this},paint:function(director,time){if(null==this.text)return;if(this.textWidth==0||this.textHeight==0)this.calcTextSize(director);var canvas=director.crc;if(null!=this.font)canvas.font=this.font;if(null!=
this.textAlign)canvas.textAlign=this.textAlign;if(null!=this.textBaseline)canvas.textBaseline=this.textBaseline;if(null!=this.fillStyle)canvas.fillStyle=this.fillStyle;if(null==this.path){var tx=0;if(this.textAlign=="center")tx=this.width/2;else if(this.textAlign=="right")tx=this.width;if(this.fill){canvas.fillText(this.text,tx,0);if(this.outline){if(null!=this.outlineColor)canvas.strokeStyle=this.outlineColor;canvas.beginPath();canvas.strokeText(this.text,tx,0)}}else{if(null!=this.outlineColor)canvas.strokeStyle=
this.outlineColor;canvas.strokeText(this.text,tx,0)}}else this.drawOnPath(director,time)},drawOnPath:function(director,time){var canvas=director.crc;var textWidth=this.sign*this.pathInterpolator.getPosition(time%this.pathDuration/this.pathDuration).y*this.path.getLength();var p0=new CAAT.Point;var p1=new CAAT.Point;for(var i=0;i<this.text.length;i++){var caracter=this.text[i].toString();var charWidth=canvas.measureText(caracter).width;var pathLength=this.path.getLength();var currentCurveLength=charWidth/
2+textWidth;p0=this.path.getPositionFromLength(currentCurveLength).clone();p1=this.path.getPositionFromLength(currentCurveLength-0.1).clone();var angle=Math.atan2(p0.y-p1.y,p0.x-p1.x);canvas.save();canvas.translate(p0.x,p0.y);canvas.rotate(angle);if(this.fill)canvas.fillText(caracter,0,0);if(this.outline){canvas.strokeStyle=this.outlineColor;canvas.strokeText(caracter,0,0)}canvas.restore();textWidth+=charWidth}},setPath:function(path,interpolator,duration){this.path=path;this.pathInterpolator=interpolator||
(new CAAT.Interpolator).createLinearInterpolator();this.pathDuration=duration||1E4;this.mouseEnabled=false;return this}})})();
(function(){CAAT.Button=function(){CAAT.Button.superclass.constructor.call(this);return this};extend(CAAT.Button,CAAT.ActorContainer,{buttonImage:null,iNormal:0,iOver:0,iPress:0,iDisabled:0,iCurrent:0,fnOnClick:null,enabled:true,setEnabled:function(enabled){this.enabled=enabled},initialize:function(buttonImage,iNormal,iOver,iPress,iDisabled,fn){this.buttonImage=buttonImage;this.iNormal=iNormal||0;this.iOver=iOver||this.iNormal;this.iPress=iPress||this.iNormal;this.iDisabled=iDisabled||this.iNormal;
this.iCurrent=this.iNormal;this.width=buttonImage.singleWidth;this.height=buttonImage.singleHeight;this.fnOnClick=fn;return this},paint:function(director,time){this.buttonImage.paint(director.ctx,this.enabled?this.iCurrent:this.iDisabled,0,0)},mouseEnter:function(mouseEvent){this.iCurrent=this.iOver;document.body.style.cursor="hand"},mouseExit:function(mouseEvent){this.iCurrent=this.iNormal;document.body.style.cursor="default"},mouseDown:function(mouseEvent){this.iCurrent=this.iPress},mouseUp:function(mouseEvent){this.iCurrent=
this.iNormal},mouseClick:function(mouseEvent){if(this.enabled&&null!=this.fnOnClick)this.fnOnClick()},toString:function(){return"CAAT.Button "+this.iNormal}})})();
(function(){CAAT.ShapeActor=function(){CAAT.ShapeActor.superclass.constructor.call(this);this.compositeOp="source-over";return this};extend(CAAT.ShapeActor,CAAT.ActorContainer,{shape:0,compositeOp:null,SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1,setShape:function(iShape){this.shape=iShape;return this},setCompositeOp:function(compositeOp){this.compositeOp=compositeOp;return this},paint:function(director,time){switch(this.shape){case 0:this.paintCircle(director,time);break;case 1:this.paintRectangle(director,
time);break}},paintCircle:function(director,time){var ctx=director.crc;ctx.globalCompositeOperation=this.compositeOp;if(null!=this.fillStyle){ctx.fillStyle=this.fillStyle;ctx.beginPath();ctx.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2,0,2*Math.PI,false);ctx.fill()}if(null!=this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.beginPath();ctx.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2,0,2*Math.PI,false);ctx.stroke()}},paintRectangle:function(director,time){var ctx=
director.crc;ctx.globalCompositeOperation=this.compositeOp;if(null!=this.fillStyle){ctx.fillStyle=this.fillStyle;ctx.beginPath();ctx.fillRect(0,0,this.width,this.height);ctx.fill()}if(null!=this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.beginPath();ctx.strokeRect(0,0,this.width,this.height);ctx.stroke()}}})})();
(function(){CAAT.StarActor=function(){CAAT.StarActor.superclass.constructor.call(this);return this};extend(CAAT.StarActor,CAAT.ActorContainer,{nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,outlined:false,filled:true,setFilled:function(filled){this.filled=filled;return this},setOutlined:function(outlined){this.outlined=outlined;return this},initialize:function(nPeaks,maxRadius,minRadius){this.setSize(maxRadius,maxRadius);this.nPeaks=nPeaks;this.maxRadius=maxRadius;this.minRadius=minRadius;return this},
paint:function(director,timer){var ctx=director.ctx;var centerX=this.width/2;var centerY=this.height/2;var r1=this.maxRadius;var r2=this.minRadius;var ix=centerX+r1*Math.cos(this.initialAngle);var iy=centerY+r1*Math.sin(this.initialAngle);ctx.moveTo(ix,iy);for(var i=1;i<this.nPeaks*2;i++){var angleStar=Math.PI/this.nPeaks*i+this.initialAngle;var rr=i%2==0?r1:r2;var x=centerX+rr*Math.cos(angleStar);var y=centerY+rr*Math.sin(angleStar);ctx.lineTo(x,y)}ctx.closePath();ctx.lineTo(this.centerX+r1*Math.cos(this.initialAngle),
this.centerY+r1*Math.sin(this.initialAngle));if(this.filled){ctx.fillStyle=this.fillStyle;ctx.fill()}if(this.outlined&&this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.stroke()}}})})();
(function(){CAAT.IMActor=function(){CAAT.IMActor.superclass.constructor.call(this);return this};extend(CAAT.IMActor,CAAT.ActorContainer,{imageProcessor:null,changeTime:100,lastApplicationTime:-1,setImageProcessor:function(im){this.imageProcessor=im;return this},setImageProcessingTime:function(time){this.changeTime=time;return this},paint:function(director,time){if(time-this.lastApplicationTime>this.changeTime){this.imageProcessor.apply(director,time);this.lastApplicationTime=time}var ctx=director.ctx;
ctx.drawImage(this.imageProcessor.getCanvas(),0,0)}})})();
(function(){CAAT.CSSActor=function(){CAAT.CSSActor.superclass.constructor.call(this);this.setFillStyle(null);this.setStrokeStyle(null);return this};extend(CAAT.CSSActor,CAAT.ActorContainer,{domElement:null,dirty:true,oldX:-1,oldY:-1,setInnerHTML:function(innerHTML){this.domElement.innerHTML=innerHTML;return this},create:function(){CAAT.CSSActor.superclass.create.call(this);this.domElement=document.createElement("div");document.body.appendChild(this.domElement);this.domElement.style["position"]="absolute";
this.domElement.style["-webkit-transition"]="all 0s linear";this.domElement.style["border"]="top:1px";return this},setLocation:function(x,y){CAAT.CSSActor.superclass.setLocation.call(this,x,y);this.domElement.style["left"]=x+"px";this.domElement.style["top"]=y+"px";return this},setSize:function(w,h){CAAT.CSSActor.superclass.setSize.call(this,w,h);this.domElement.style["width"]=""+w+"px";this.domElement.style["height"]=""+h+"px";return this},setBounds:function(x,y,w,h){this.setLocation(x,y);this.setSize(w,
h);return this},setBackground:function(backgroundImage_Local_URL){this.domElement.style.background="url("+backgroundImage_Local_URL+")";return this},setOpacity:function(){this.domElement.style["filter"]="alpha(opacity="+(this.alpha*100>>0)+")";this.domElement.style["-moz-opacity"]=this.alpha;this.domElement.style["-khtml-opacity"]=this.alpha;this.domElement.style["-opacity"]=this.alpha},addChild:function(actor){if(actor instanceof CAAT.CSSActor){this.domElement.appendChild(actor.domElement);CAAT.CSSActor.superclass.addChild.call(this,
actor)}},paintActor:function(director,time){if(!this.isInAnimationFrame(time)){this.inFrame=false;return false}if(this.oldX!=this.x||this.oldY!=this.y){this.domElement.style["top"]=this.y+"px";this.domElement.style["left"]=this.x+"px";this.oldX=this.x;this.oldY=this.y}if(this.dirty){var strMatrix="translateZ(0px)";if(this.rotationAngle!=0)strMatrix=strMatrix+" rotate("+this.rotationAngle+"rad)";if(this.scaleX!=1)strMatrix=strMatrix+" scale("+this.scaleX+")";this.domElement.style["-webkit-transform"]=
strMatrix;this.domElement.style["-o-transform"]=strMatrix;this.domElement.style["-moz-transform"]=strMatrix;this.dirty=false}for(var i=0;i<this.childrenList.length;i++)this.childrenList[i].paintActor(director,time);this.inFrame=true;return true},paint:function(director,time){}})})();(function(){CAAT.AudioManager=function(){return this};CAAT.AudioManager.prototype={audioCache:null,channels:null,workingChannels:null,audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(numChannels){this.audioCache=[];this.channels=[];this.workingChannels=[];for(var i=0;i<numChannels;i++){var channel=document.createElement("audio");if(null!=channel){channel.finished=-1;this.channels.push(channel);var me=
this;channel.addEventListener("ended",function(audioEvent){var target=audioEvent.target;var i;for(i=0;i<me.workingChannels.length;i++)if(me.workingChannels[i]==target){me.workingChannels.splice(i,1);break}me.channels.push(target)},false)}}return this},addAudio:function(id,url){var audio=null;if(typeof url=="string"){audio=document.createElement("audio");if(null!=audio){if(!audio.canPlayType)return;var extension=url.substr(url.lastIndexOf(".")+1);var canplay=audio.canPlayType(this.audioTypes[extension]);
if(canplay!==""&&canplay!=="no"){audio.src=url;audio.preload="auto";audio.load();this.audioCache.push({id:id,audio:audio})}}}else try{if(url instanceof HTMLAudioElement){var audio=url;var extension=audio.src.substr(audio.src.lastIndexOf(".")+1);if(audio.canPlayType(this.audioTypes[extension]))this.audioCache.push({id:id,audio:audio})}}catch(e){}return this},addAudioFromDOM:function(id,audioElement){this.audioCache.push({id:id,audio:audioElement})},getAudio:function(aId){for(var i=0;i<this.audioCache.length;i++)if(this.audioCache[i].id==
aId)return this.audioCache[i].audio;return null},play:function(id){var audio=this.getAudio(id);if(null!=audio&&this.channels.length>0){var channel=this.channels.shift();channel.src=audio.src;channel.load();channel.play();this.workingChannels.push(channel)}return this},loop:function(id){var audio_in_cache=this.getAudio(id);if(null!=audio_in_cache){var audio=document.createElement("audio");if(null!=audio){audio.src=audio_in_cache.src;audio.preload="auto";audio.loop=true;audio.load();audio.play();return audio}}return null},
endSound:function(){for(var i=0;i<this.workingChannels.length;i++){this.workingChannels[i].pause();this.channels.push(this.workingChannels[i])}return this}}})();(function(){CAAT.Dock=function(){CAAT.Dock.superclass.constructor.call(this);return this};extend(CAAT.Dock,CAAT.ActorContainer,{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3,setApplicationRange:function(range){this.range=range;return this},setLayoutOp:function(lo){this.layoutOp=lo;return this},setSizes:function(min,max){this.minSize=min;this.maxSize=max;return this},layout:function(){var i;if(this.layoutOp==this.OP_LAYOUT_BOTTOM||
this.layoutOp==this.OP_LAYOUT_TOP){var currentWidth=0,currentX=0;for(i=0;i<this.getNumChildren();i++)currentWidth+=this.getChildAt(i).width;currentX=(this.width-currentWidth)/2;for(i=0;i<this.getNumChildren();i++){var actor=this.getChildAt(i);actor.x=currentX;currentX+=actor.width;if(this.layoutOp==this.OP_LAYOUT_BOTTOM)actor.y=this.maxSize-actor.height;else actor.y=0}}else{var currentHeight=0,currentY=0;for(i=0;i<this.getNumChildren();i++)currentHeight+=this.getChildAt(i).height;currentY=(this.height-
currentHeight)/2;for(i=0;i<this.getNumChildren();i++){var actor=this.getChildAt(i);actor.y=currentY;currentY+=actor.height;if(this.layoutOp==this.OP_LAYOUT_LEFT)actor.x=0;else actor.x=this.width-actor.width}}},mouseMove:function(mouseEvent){this.actorNotPointed()},mouseExit:function(mouseEvent){this.actorNotPointed()},actorNotPointed:function(){var i;var me=this;for(i=0;i<this.getNumChildren();i++){var actor=this.getChildAt(i);actor.emptyBehaviorList();actor.addBehavior((new CAAT.GenericBehavior).setValues(actor.width,
this.minSize,actor,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.GenericBehavior).setValues(actor.height,this.minSize,actor,"height").setFrameTime(this.scene.time,250));if(i==this.getNumChildren()-1)actor.behaviorList[0].addListener({behaviorApplied:function(behavior,time,normalizedTime,targetActor,value){targetActor.parent.layout()},behaviorExpired:function(behavior,time,targetActor){for(i=0;i<me.getNumChildren();i++){actor=me.getChildAt(i);actor.width=me.minSize;actor.height=
me.minSize}targetActor.parent.layout()}})}},actorPointed:function(x,y,pointedActor){var index=this.findChild(pointedActor);var across=0;if(this.layoutOp==this.OP_LAYOUT_BOTTOM||this.layoutOp==this.OP_LAYOUT_TOP)across=x/pointedActor.width;else across=y/pointedActor.height;var i;for(i=0;i<this.childrenList.length;i++){var actor=this.childrenList[i];actor.emptyBehaviorList();var wwidth=0;if(i<index-this.range||i>index+this.range)wwidth=this.minSize;else if(i==index)wwidth=this.maxSize;else if(i<index)wwidth=
this.minSize+(this.maxSize-this.minSize)*(Math.cos((i-index-across+1)/this.range*Math.PI)+1)/2;else wwidth=this.minSize+(this.maxSize-this.minSize)*(Math.cos((i-index-across)/this.range*Math.PI)+1)/2;actor.height=wwidth;actor.width=wwidth}this.layout()},actorMouseExit:function(mouseEvent){if(null!=this.ttask)this.ttask.cancel();this.ttask=this.scene.createTimer(this.scene.time,100,function timeout(sceneTime,time,timerTask){mouseEvent.source.parent.actorNotPointed()},null,null)},actorMouseEnter:function(mouseEvent){if(null!=
this.ttask){this.ttask.cancel();this.ttask=null}}})})();(function(){CAAT.Director=function(){CAAT.Director.superclass.constructor.call(this);this.browserInfo=new CAAT.BrowserDetect;this.audioManager=(new CAAT.AudioManager).initialize(8);this.scenes=[];return this};extend(CAAT.Director,CAAT.ActorContainer,{debug:false,scenes:null,currentScene:null,canvas:null,crc:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:true,transitionScene:null,browserInfo:null,initialize:function(width,height,canvas){canvas=canvas||document.createElement("canvas");
canvas.width=width;canvas.height=height;this.setBounds(0,0,canvas.width,canvas.height);this.create();this.canvas=canvas;this.ctx=canvas.getContext("2d");this.crc=this.ctx;if(!CAAT.director){CAAT.director=[];CAAT.GlobalEnableEvents()}CAAT.director.push(this);this.timeline=(new Date).getTime();this.transitionScene=(new CAAT.Scene).create().setBounds(0,0,width,height);var transitionCanvas=document.createElement("canvas");transitionCanvas.width=width;transitionCanvas.height=height;var transitionImageActor=
(new CAAT.ImageActor).create().setImage(transitionCanvas);this.transitionScene.ctx=transitionCanvas.getContext("2d");this.transitionScene.addChildImmediately(transitionImageActor);this.transitionScene.setEaseListener(this);return this},createScene:function(){var scene=(new CAAT.Scene).create();this.addScene(scene);return scene},render:function(time){this.time+=time;this.crc.globalAlpha=1;this.crc.globalCompositeOperation="source-over";if(this.clear)this.crc.clearRect(0,0,this.width,this.height);this.crc.setTransform(1,
0,0,1,0,0);var i;var tt;for(i=0;i<this.childrenList.length;i++)if(this.childrenList[i].isInAnimationFrame(this.time)){tt=this.childrenList[i].time-this.childrenList[i].start_time;this.childrenList[i].animate(this,tt)}for(i=0;i<this.childrenList.length;i++)if(this.childrenList[i].isInAnimationFrame(this.time)){this.crc.save();tt=this.childrenList[i].time-this.childrenList[i].start_time;this.childrenList[i].paintActor(this,tt);this.childrenList[i].time+=time;this.crc.restore();if(this.debug)this.childrenList[i].drawScreenBoundingBox(this,
tt)}this.endAnimate(this,time)},renderToContext:function(ctx,scene){ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";ctx.clearRect(0,0,this.width,this.height);ctx.setTransform(1,0,0,1,0,0);var octx=this.ctx;var ocrc=this.crc;this.ctx=this.crc=ctx;if(scene.isInAnimationFrame(this.time)){ctx.save();scene.paintActor(this,scene.time-scene.start_time);ctx.restore()}this.ctx=octx;this.crc=ocrc},addScene:function(scene){scene.setBounds(0,0,this.width,this.height);this.scenes.push(scene);scene.setEaseListener(this);
if(null==this.currentScene)this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(inSceneIndex,typein,anchorin,outSceneIndex,typeout,anchorout,time,alpha,interpolatorIn,interpolatorOut){if(inSceneIndex==this.getCurrentSceneIndex())return;var ssin=this.scenes[inSceneIndex];var sout=this.scenes[outSceneIndex];this.renderToContext(this.transitionScene.ctx,sout);sout=this.transitionScene;ssin.setExpired(false);sout.setExpired(false);ssin.mouseEnabled=false;sout.mouseEnabled=
false;ssin.resetTransform();sout.resetTransform();ssin.setLocation(0,0);sout.setLocation(0,0);ssin.alpha=1;sout.alpha=1;if(typein==CAAT.Scene.prototype.EASE_ROTATION)ssin.easeRotationIn(time,alpha,anchorin,interpolatorIn);else if(typein==CAAT.Scene.prototype.EASE_SCALE)ssin.easeScaleIn(0,time,alpha,anchorin,interpolatorIn);else ssin.easeTranslationIn(time,alpha,anchorin,interpolatorIn);if(typeout==CAAT.Scene.prototype.EASE_ROTATION)sout.easeRotationOut(time,alpha,anchorout,interpolatorOut);else if(typeout==
CAAT.Scene.prototype.EASE_SCALE)sout.easeScaleOut(0,time,alpha,anchorout,interpolatorOut);else sout.easeTranslationOut(time,alpha,anchorout,interpolatorOut);this.childrenList=[];this.addChild(sout);this.addChild(ssin)},easeInOutRandom:function(inIndex,outIndex,time,alpha){var pin=Math.random();var pout=Math.random();var typeIn;var interpolatorIn;if(pin<0.33){typeIn=CAAT.Scene.prototype.EASE_ROTATION;interpolatorIn=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)}else if(pin<0.66){typeIn=
CAAT.Scene.prototype.EASE_SCALE;interpolatorIn=(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4)}else{typeIn=CAAT.Scene.prototype.EASE_TRANSLATE;interpolatorIn=(new CAAT.Interpolator).createBounceOutInterpolator()}var typeOut;var interpolatorOut;if(pout<0.33){typeOut=CAAT.Scene.prototype.EASE_ROTATION;interpolatorOut=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)}else if(pout<0.66){typeOut=CAAT.Scene.prototype.EASE_SCALE;interpolatorOut=(new CAAT.Interpolator).createExponentialOutInterpolator(4)}else{typeOut=
CAAT.Scene.prototype.EASE_TRANSLATE;interpolatorOut=(new CAAT.Interpolator).createBounceOutInterpolator()}this.easeInOut(inIndex,typeIn,Math.random()*8.99>>0,outIndex,typeOut,Math.random()*8.99>>0,time,alpha,interpolatorIn,interpolatorOut)},easeIn:function(inSceneIndex,type,time,alpha,anchor,interpolator){var sin=this.scenes[inSceneIndex];if(type==CAAT.Scene.prototype.EASE_ROTATION)sin.easeRotationIn(time,alpha,anchor,interpolator);else if(type==CAAT.Scene.prototype.EASE_SCALE)sin.easeScaleIn(0,time,
alpha,anchor,interpolator);else sin.easeTranslationIn(time,alpha,anchor,interpolator);this.childrenList=[];this.addChild(sin);sin.resetTransform();sin.setLocation(0,0);sin.alpha=1;sin.mouseEnabled=false;sin.setExpired(false)},setScene:function(sceneIndex){var sin=this.scenes[sceneIndex];this.childrenList=[];this.addChild(sin);this.currentScene=sin;sin.setExpired(false);sin.mouseEnabled=true;sin.resetTransform();sin.setLocation(0,0);sin.alpha=1;sin.activated()},switchToScene:function(iNewSceneIndex,
time,alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(!transition)this.setScene(iNewSceneIndex);else this.easeInOutRandom(iNewSceneIndex,currentSceneIndex,time,alpha)},switchToPrevScene:function(time,alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||currentSceneIndex==0)return;if(!transition)this.setScene(currentSceneIndex-1);else this.easeInOutRandom(currentSceneIndex-1,currentSceneIndex,time,alpha)},switchToNextScene:function(time,
alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||currentSceneIndex==this.getNumScenes()-1)return;if(!transition)this.setScene(currentSceneIndex+1);else this.easeInOutRandom(currentSceneIndex+1,currentSceneIndex,time,alpha)},mouseEnter:function(mouseEvent){},mouseExit:function(mouseEvent){},mouseMove:function(mouseEvent){},mouseDown:function(mouseEvent){},mouseUp:function(mouseEvent){},mouseDrag:function(mouseEvent){},easeEnd:function(scene,b_easeIn){if(!b_easeIn)scene.setExpired(true);
else{this.currentScene=scene;this.currentScene.activated()}scene.mouseEnabled=true;scene.emptyBehaviorList()},getSceneIndex:function(scene){for(var i in this.scenes)if(this.scenes[i]==scene)return i>>0;return-1},getScene:function(index){return this.scenes[index]},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},
getImage:function(sId){for(var i=0;i<this.imagesCache.length;i++)if(this.imagesCache[i].id==sId)return this.imagesCache[i].image;return null},addAudio:function(id,url){this.audioManager.addAudio(id,url);return this},audioPlay:function(id){this.audioManager.play(id)},audioLoop:function(id){this.audioManager.loop(id)},emptyScenes:function(){this.scenes=[]},addChild:function(scene){scene.parent=this;this.childrenList.push(scene)},loop:function(fps,callback){fps=fps||30;fps=1E3/fps;var me=this;var floop=
function loop(){var t=(new Date).getTime(),delta=t-me.timeline;me.render(delta);me.timeline=t;if(callback)callback(me,delta)};floop();setInterval(floop,fps)},setClear:function(clear){this.clear=clear;return this},getAudioManager:function(){return this.audioManager}})})();(function(){CAAT.MouseEvent=function(){this.point=new CAAT.Point;this.screenPoint=new CAAT.Point;return this};CAAT.MouseEvent.prototype={screenPoint:null,point:null,modifiers:0,time:0,source:null,SHIFT:16,CONTROL:17,ALT:18,SHIFT_MASK:1,CONTROL_MASK:2,ALT_MASK:4,init:function(x,y,modifiers,source,screenPoint){this.point.set(x,y);this.modifiers=modifiers;this.source=source;this.screenPoint=screenPoint;return this},isAltDown:function(){return this.modifiers&this.ALT_MASK},isControlDown:function(){return this.modifiers&
this.CONTROL_MASK},isShiftDown:function(){return this.modifiers&this.SHIFT_MASK}}})();CAAT.GlobalEventsEnabled=false;CAAT.lastSelectedActor=null;CAAT.mousePoint=null;CAAT.prevMousePoint=null;CAAT.screenMousePoint=null;CAAT.mouseDown=false;CAAT.modifiers=0;CAAT.dragging=false;CAAT.targetDirector=null;CAAT.prevOnDeviceMotion=null;CAAT.onDeviceMotion=null;CAAT.accelerationIncludingGravity={x:0,y:0,z:0};CAAT.rotationRate={alpha:0,beta:0,gamma:0};CAAT.DRAG_THRESHOLD_X=5;CAAT.DRAG_THRESHOLD_Y=5;
CAAT.DEBUG=true;
CAAT.getCanvasCoord=function __getCanvasCoord(point,e){var posx=0;var posy=0;if(!e)e=window.event;if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY}else if(e.clientX||e.clientY){posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}var pposx;var pposy;var i;for(i=0;i<CAAT.director.length;i++){pposx=posx;pposy=posy;pposx-=CAAT.director[i].canvas.offsetLeft;pposy-=CAAT.director[i].canvas.offsetTop;if(CAAT.director[i].contains(pposx,
pposy)){CAAT.targetDirector=CAAT.director[i];point.set(pposx,pposy);CAAT.screenMousePoint.set(pposx,pposy);return}}CAAT.targetDirector=null};CAAT.log=function(msg){if(window.console)window.console.log(msg)};
CAAT.GlobalDisableEvents=function __GlobalDisableEvents(){CAAT.log("(CAAT.MouseEvent) Disabling CAAT event capture");window.removeEventListener("keydown",CAAT.keyDownFunc,false);window.removeEventListener("keyup",CAAT.keyUpFunc,false);window.removeEventListener("mousedown",CAAT.mouseDownFunc,false);window.removeEventListener("mouseup",CAAT.mouseUpFunc,false);window.removeEventListener("mousemove",CAAT.mouseMoveFunc,false);window.removeEventListener("mouseover",CAAT.mouseOverFunc,false);window.removeEventListener("mouseout",
CAAT.mouseOutFunc,false);window.removeEventListener("dblclick",CAAT.dblClickFunc,false);window.ondevicemotion=CAAT.prevOnDeviceMotion;CAAT.GlobalEventsEnabled=false};
CAAT.GlobalEnableEvents=function __GlobalEnableEvents(){if(CAAT.GlobalEventsEnabled)return;CAAT.log("(CAAT.MouseEvent) Enabling CAAT event capture");CAAT.mousePoint=new CAAT.Point;CAAT.prevMousePoint=new CAAT.Point;CAAT.screenMousePoint=new CAAT.Point;try{if(window.DeviceMotionEvent!=undefined){CAAT.prevOnDeviceMotion=window.ondevicemotion;window.ondevicemotion=CAAT.onDeviceMotion=function(e){CAAT.accelerationIncludingGravity={x:e.accelerationIncludingGravity.x,y:e.accelerationIncludingGravity.y,
z:e.accelerationIncludingGravity.z};if(e.rotationRate)CAAT.rotationRate={alpha:e.rotationRate.alpha,beta:e.rotationRate.beta,gamma:e.rotationRate.gamma}}}}catch(e){}window.addEventListener("keydown",CAAT.keyDownFunc=function(evt,c){var key=evt.which?evt.which:evt.keyCode;switch(key){case CAAT.MouseEvent.prototype.SHIFT:CAAT.modifiers|=CAAT.MouseEvent.prototype.SHIFT_MASK;break;case CAAT.MouseEvent.prototype.CONTROL:CAAT.modifiers|=CAAT.MouseEvent.prototype.CONTROL_MASK;break;case CAAT.MouseEvent.prototype.ALT:CAAT.modifiers|=
CAAT.MouseEvent.prototype.ALT_MASK;break}},false);window.addEventListener("keyup",CAAT.keyUpFunc=function(evt,c){var key=evt.which?evt.which:evt.keyCode;switch(key){case CAAT.MouseEvent.prototype.SHIFT:CAAT.modifiers&=~CAAT.MouseEvent.prototype.SHIFT_MASK;break;case CAAT.MouseEvent.prototype.CONTROL:CAAT.modifiers&=~CAAT.MouseEvent.prototype.CONTROL_MASK;break;case CAAT.MouseEvent.prototype.ALT:CAAT.modifiers&=~CAAT.MouseEvent.prototype.ALT_MASK;break;case 68:if(CAAT.DEBUG)if(null!=CAAT.targetDirector)CAAT.targetDirector.debug=
!CAAT.targetDirector.debug;break}},false);window.addEventListener("mouseup",CAAT.mouseUpFunc=function(e){CAAT.mouseDown=false;if(null!=CAAT.lastSelectedActor)CAAT.lastSelectedActor.mouseUp((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,CAAT.lastSelectedActor.rpoint.y,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint));if(!CAAT.dragging){if(null!=CAAT.lastSelectedActor)CAAT.lastSelectedActor.mouseClick((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,CAAT.lastSelectedActor.rpoint.y,
CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint))}else CAAT.dragging=false},false);window.addEventListener("mousedown",CAAT.mouseDownFunc=function(e){CAAT.getCanvasCoord(CAAT.mousePoint,e);if(null==CAAT.targetDirector)return;CAAT.mouseDown=true;CAAT.lastSelectedActor=CAAT.targetDirector.findActorAtPosition(CAAT.mousePoint);var px=CAAT.mousePoint.x;var py=CAAT.mousePoint.y;if(null!=CAAT.lastSelectedActor){CAAT.prevMousePoint.x=px;CAAT.prevMousePoint.y=py;CAAT.lastSelectedActor.mouseDown((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,
CAAT.lastSelectedActor.rpoint.y,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint))}},false);window.addEventListener("mouseover",CAAT.mouseOverFunc=function(e){CAAT.getCanvasCoord(CAAT.mousePoint,e);if(null==CAAT.targetDirector)return;CAAT.lastSelectedActor=CAAT.targetDirector.findActorAtPosition(CAAT.mousePoint);if(null!=CAAT.lastSelectedActor)CAAT.lastSelectedActor.mouseEnter((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,CAAT.lastSelectedActor.rpoint.y,CAAT.modifiers,CAAT.lastSelectedActor,
CAAT.screenMousePoint))},false);window.addEventListener("mouseout",CAAT.mouseOutFunc=function(e){if(null!=CAAT.lastSelectedActor){CAAT.lastSelectedActor.mouseExit((new CAAT.MouseEvent).init(0,0,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint));CAAT.lastSelectedActor=null}CAAT.mouseDown=false},false);window.addEventListener("mousemove",CAAT.mouseMoveFunc=function(e){CAAT.getCanvasCoord(CAAT.mousePoint,e);if(null==CAAT.targetDirector)return;if(CAAT.mouseDown&&null!=CAAT.lastSelectedActor){if(!CAAT.dragging)if(Math.abs(CAAT.prevMousePoint.x-
CAAT.mousePoint.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(CAAT.prevMousePoint.y-CAAT.mousePoint.y)<CAAT.DRAG_THRESHOLD_Y)return;CAAT.dragging=true;if(null!=CAAT.lastSelectedActor.parent)CAAT.lastSelectedActor.parent.inverseTransformCoord(CAAT.mousePoint);CAAT.lastSelectedActor.mouseDrag((new CAAT.MouseEvent).init(CAAT.mousePoint.x,CAAT.mousePoint.y,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint));return}var lactor=CAAT.targetDirector.findActorAtPosition(CAAT.mousePoint);if(lactor!=CAAT.lastSelectedActor){if(null!=
CAAT.lastSelectedActor)CAAT.lastSelectedActor.mouseExit((new CAAT.MouseEvent).init(CAAT.mousePoint.x,CAAT.mousePoint.y,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint));if(null!=lactor)lactor.mouseEnter((new CAAT.MouseEvent).init(lactor.rpoint.x,lactor.rpoint.y,CAAT.modifiers,lactor,CAAT.screenMousePoint))}CAAT.lastSelectedActor=lactor;if(null!=lactor)CAAT.lastSelectedActor.mouseMove((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,CAAT.lastSelectedActor.rpoint.y,CAAT.modifiers,
CAAT.lastSelectedActor,CAAT.screenMousePoint))},false);window.addEventListener("dblclick",CAAT.dblClickFunc=function(e){CAAT.getCanvasCoord(CAAT.mousePoint,e);if(null!=CAAT.lastSelectedActor)CAAT.lastSelectedActor.mouseDblClick((new CAAT.MouseEvent).init(CAAT.lastSelectedActor.rpoint.x,CAAT.lastSelectedActor.rpoint.y,CAAT.modifiers,CAAT.lastSelectedActor,CAAT.screenMousePoint))},false);function touchHandler(event){var touches=event.changedTouches,first=touches[0],type="";switch(event.type){case "touchstart":type=
"mousedown";break;case "touchmove":type="mousemove";break;case "touchend":type="mouseup";break;default:return}var simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);window.dispatchEvent(simulatedEvent);event.preventDefault()}window.addEventListener("touchstart",touchHandler,true);window.addEventListener("touchmove",touchHandler,true);window.addEventListener("touchend",
touchHandler,true);window.addEventListener("touchcancel",touchHandler,true)};(function(){CAAT.CompoundImage=function(){return this};CAAT.CompoundImage.prototype={NORMAL:1,INV_VERTICAL:2,INV_HORIZONTAL:4,INV_VERTICAL_AND_HORIZONTAL:8,image:null,rows:0,cols:0,width:0,height:0,singleWidth:0,singleHeight:0,initialize:function(image,rows,cols){this.image=image;this.rows=rows;this.cols=cols;this.width=image.width;this.height=image.height;this.singleWidth=Math.floor(this.width/cols);this.singleHeight=Math.floor(this.height/rows);return this},paintInvertedH:function(canvas,imageIndex,
x,y){var sx0=Math.floor(imageIndex%this.cols)*this.singleWidth;var sy0=Math.floor(imageIndex/this.cols)*this.singleHeight;canvas.save();canvas.translate(x+this.singleWidth,y);canvas.scale(-1,1);canvas.drawImage(this.image,sx0,sy0,this.singleWidth,this.singleHeight,0,0,this.singleWidth,this.singleHeight);canvas.restore()},paintInvertedV:function(canvas,imageIndex,x,y){var sx0=Math.floor(imageIndex%this.cols)*this.singleWidth;var sy0=Math.floor(imageIndex/this.cols)*this.singleHeight;canvas.save();
canvas.translate(x,y+this.singleHeight);canvas.scale(1,-1);canvas.drawImage(this.image,sx0,sy0,this.singleWidth,this.singleHeight,0,0,this.singleWidth,this.singleHeight);canvas.restore()},paintInvertedHV:function(canvas,imageIndex,x,y){var sx0=Math.floor(imageIndex%this.cols)*this.singleWidth;var sy0=Math.floor(imageIndex/this.cols)*this.singleHeight;canvas.save();canvas.translate(x,y+this.singleHeight);canvas.scale(1,-1);canvas.translate(this.singleWidth,0);canvas.scale(-1,1);canvas.drawImage(this.image,
sx0,sy0,this.singleWidth,this.singleHeight,0,0,this.singleWidth,this.singleHeight);canvas.restore()},paint:function(canvas,imageIndex,x,y){var sx0=Math.floor(imageIndex%this.cols)*this.singleWidth;var sy0=Math.floor(imageIndex/this.cols)*this.singleHeight;if(sx0<0||sy0<0)return;canvas.drawImage(this.image,sx0,sy0,this.singleWidth,this.singleHeight,x,y,this.singleWidth,this.singleHeight)},paintScaled:function(canvas,imageIndex,x,y,w,h){var sx0=Math.floor(imageIndex%this.cols)*this.singleWidth;var sy0=
Math.floor(imageIndex/this.cols)*this.singleHeight;canvas.drawImage(this.image,sx0,sy0,this.singleWidth,this.singleHeight,x,y,w,h)},getNumImages:function(){return this.rows*this.cols}}})();(function(){CAAT.ImagePreloader=function(){this.images=new Array;return this};CAAT.ImagePreloader.prototype={images:null,notificationCallback:null,imageCounter:0,loadImages:function(aImages,callback){var me=this;this.notificationCallback=callback;this.images=[];for(var i=0;i<aImages.length;i++){this.images.push({id:aImages[i].id,image:new Image});this.images[i].image.onload=function imageLoaded(){me.imageCounter++;me.notificationCallback.call(this,me.imageCounter,me.images)};this.images[i].image.src=
aImages[i].url}}}})();(function(){CAAT.TimerTask=function(){return this};CAAT.TimerTask.prototype={startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,scene:null,taskId:0,remove:false,create:function(startTime,duration,callback_timeout,callback_tick,callback_cancel){this.startTime=startTime;this.duration=duration;this.callback_timeout=callback_timeout;this.callback_tick=callback_tick;return this},checkTask:function(time){var ttime=time;ttime-=this.startTime;if(ttime>=this.duration){this.remove=
true;if(this.callback_timeout)this.callback_timeout(time,ttime,this)}else if(this.callback_tick)this.callback_tick(time,ttime,this);return this},reset:function(time){this.remove=false;this.startTime=time;return this},cancel:function(){this.remove=true;if(null!=this.callback_cancel)this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this);return this}}})();
(function(){CAAT.Scene=function(){CAAT.Scene.superclass.constructor.call(this);this.timerList=[];this.fillStyle=null;return this};extend(CAAT.Scene,CAAT.ActorContainer,{easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:false,EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3,timerList:null,timerSequence:0,checkTimers:function(time){var i=this.timerList.length-1;while(i>=0){if(!this.timerList[i].remove)this.timerList[i].checkTask(time);i--}},createTimer:function(startTime,duration,
callback_timeout,callback_tick,callback_cancel){var tt=(new CAAT.TimerTask).create(startTime,duration,callback_timeout,callback_tick,callback_cancel);tt.taskId=this.timerSequence++;tt.sceneTime=this.time;tt.scene=this;this.timerList.push(tt);return tt},removeExpiredTimers:function(){var i;for(i=0;i<this.timerList.length;i++)if(this.timerList[i].remove)this.timerList.splice(i,1)},animate:function(director,time){this.checkTimers(time);CAAT.Scene.superclass.animate.call(this,director,time);this.removeExpiredTimers()},
createAlphaBehaviour:function(time,isIn){var ab=new CAAT.AlphaBehavior;ab.setFrameTime(0,time);ab.startAlpha=isIn?0:1;ab.endAlpha=isIn?1:0;this.easeContainerBehaviour.addBehavior(ab)},easeTranslationIn:function(time,alpha,anchor,interpolator){this.easeTranslation(time,alpha,anchor,true,interpolator)},easeTranslationOut:function(time,alpha,anchor,interpolator){this.easeTranslation(time,alpha,anchor,false,interpolator)},easeTranslation:function(time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=
new CAAT.ContainerBehavior;this.easeIn=isIn;var pb=new CAAT.PathBehavior;if(interpolator)pb.setInterpolator(interpolator);pb.setFrameTime(0,time);if(anchor<1)anchor=1;else if(anchor>4)anchor=4;switch(anchor){case CAAT.Actor.prototype.ANCHOR_TOP:if(isIn)pb.setPath((new CAAT.Path).setLinear(0,-this.height,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,0,-this.height));break;case CAAT.Actor.prototype.ANCHOR_BOTTOM:if(isIn)pb.setPath((new CAAT.Path).setLinear(0,this.height,0,0));else pb.setPath((new CAAT.Path).setLinear(0,
0,0,this.height));break;case CAAT.Actor.prototype.ANCHOR_LEFT:if(isIn)pb.setPath((new CAAT.Path).setLinear(-this.width,0,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,-this.width,0));break;case CAAT.Actor.prototype.ANCHOR_RIGHT:if(isIn)pb.setPath((new CAAT.Path).setLinear(this.width,0,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,this.width,0));break}if(alpha)this.createAlphaBehaviour(time,isIn);this.easeContainerBehaviour.addBehavior(pb);this.easeContainerBehaviour.setFrameTime(this.time,
time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(starttime,time,alpha,anchor,interpolator){this.easeScale(starttime,time,alpha,anchor,true,interpolator);this.easeIn=true},easeScaleOut:function(starttime,time,alpha,anchor,interpolator){this.easeScale(starttime,time,alpha,anchor,false,interpolator);this.easeIn=false},easeScale:function(starttime,time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=
new CAAT.ContainerBehavior;var x=0;var y=0;var x2=0;var y2=0;switch(anchor){case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:case CAAT.Actor.prototype.ANCHOR_CENTER:x2=1;y2=1;break;case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:x=1;x2=1;y=0;y2=1;break;case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:y=1;y2=1;x=0;x2=
1;break;default:alert("scale anchor ?? "+anchor)}if(!isIn){var tmp;tmp=x;x=x2;x2=tmp;tmp=y;y=y2;y2=tmp}if(alpha)this.createAlphaBehaviour(time,isIn);var sb=new CAAT.ScaleBehavior;sb.setFrameTime(starttime,time);sb.startScaleX=x;sb.startScaleY=y;sb.endScaleX=x2;sb.endScaleY=y2;sb.anchor=anchor;if(interpolator)sb.setInterpolator(interpolator);this.easeContainerBehaviour.addBehavior(sb);this.easeContainerBehaviour.setFrameTime(this.time,time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();
CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(behaviour){},easeRotationIn:function(time,alpha,anchor,interpolator){this.easeRotation(time,alpha,anchor,true,interpolator);this.easeIn=true},easeRotationOut:function(time,alpha,anchor,interpolator){this.easeRotation(time,alpha,anchor,false,interpolator);this.easeIn=false},easeRotation:function(time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=new CAAT.ContainerBehavior;var start=0;var end=
0;switch(anchor){case CAAT.Actor.prototype.ANCHOR_CENTER:anchor=CAAT.Actor.prototype.ANCHOR_TOP;case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:start=Math.PI*(Math.random()<0.5?1:-1);break;case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:start=Math.PI/2*(Math.random()<
0.5?1:-1);break;default:alert("rot anchor ?? "+anchor)}if(false==isIn){var tmp=start;start=end;end=tmp}if(alpha)this.createAlphaBehaviour(time,isIn);var rb=new CAAT.RotateBehavior;rb.setFrameTime(0,time);rb.startAngle=start;rb.endAngle=end;rb.anchor=anchor;if(interpolator)rb.setInterpolator(interpolator);this.easeContainerBehaviour.addBehavior(rb);this.easeContainerBehaviour.setFrameTime(this.time,time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,
this.easeContainerBehaviour)},setEaseListener:function(listener){this.easeContainerBehaviourListener=listener},behaviorExpired:function(actor){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(bExpired){this.expired=bExpired},paint:function(director,time){if(this.fillStyle){var ctx=director.crc;ctx.fillStyle=this.fillStyle;ctx.fillRect(0,0,this.width,this.height)}}})})();(function(){CAAT.modules=CAAT.modules||{};CAAT.modules.CircleManager=CAAT.modules.CircleManager||{};CAAT.modules.CircleManager.PackedCircle=function(){this.boundsRule=CAAT.modules.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE;this.position=new CAAT.Point(0,0);this.offset=new CAAT.Point(0,0);this.targetPosition=new CAAT.Point(0,0);return this};CAAT.modules.CircleManager.PackedCircle.prototype={id:0,delegate:null,position:new CAAT.Point(0,0),offset:new CAAT.Point(0,0),targetPosition:null,targetChaseSpeed:0.02,
isFixed:false,boundsRule:0,collisionMask:0,collisionGroup:0,BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8,containsPoint:function(aPoint){var distanceSquared=this.position.getDistanceSquared(aPoint);return distanceSquared<this.radiusSquared},getDistanceSquaredFromPosition:function(aPosition){var distanceSquared=this.position.getDistanceSquared(aPosition);return distanceSquared<this.radiusSquared},intersects:function(aCircle){var distanceSquared=this.position.getDistanceSquared(aCircle.position);
return distanceSquared<this.radiusSquared||distanceSquared<aCircle.radiusSquared},setPosition:function(aPosition){this.position=aPosition;return this},setDelegate:function(aDelegate){this.delegate=aDelegate;return this},setOffset:function(aPosition){this.offset=aPosition;return this},setTargetPosition:function(aTargetPosition){this.targetPosition=aTargetPosition;return this},setTargetChaseSpeed:function(aTargetChaseSpeed){this.targetChaseSpeed=aTargetChaseSpeed;return this},setIsFixed:function(value){this.isFixed=
value;return this},setCollisionMask:function(aCollisionMask){this.collisionMask=aCollisionMask;return this},setCollisionGroup:function(aCollisionGroup){this.collisionGroup=aCollisionGroup;return this},setRadius:function(aRadius){this.radius=aRadius;this.radiusSquared=this.radius*this.radius;return this},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this},dealloc:function(){this.position=null;this.offset=null;this.delegate=null;this.targetPosition=null}}})();(function(){CAAT.modules=CAAT.modules||{};CAAT.modules.CircleManager=CAAT.modules.CircleManager||{};CAAT.modules.CircleManager.PackedCircleManager=function(){return this};CAAT.modules.CircleManager.PackedCircleManager.prototype={allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:new CAAT.Rectangle,addCircle:function(aCircle){aCircle.id=this.allCircles.length;this.allCircles.push(aCircle);return this},removeCircle:function(aCircle){var index=0,found=false,len=this.allCircles.length;
if(len===0)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";while(len--)if(this.allCircles[len]===aCircle){found=true;index=len;break}if(!found)throw"Could not locate circle in allCircles array!";this.allCircles[index].dealloc();this.allCircles[index]=null;return this},forceCirclesToMatchDelegatePositions:function(){var len=this.allCircles.length;for(var n=0;n<len;n++){var aCircle=this.allCircles[n];if(!aCircle||!aCircle.delegate)continue;aCircle.position.set(aCircle.delegate.x+
aCircle.offset.x,aCircle.delegate.y+aCircle.offset.y)}},pushAllCirclesTowardTarget:function(aTarget){var v=(new CAAT.Point).set(0,0),circleList=this.allCircles,len=circleList.length;for(var n=0;n<this.numberOfTargetingPasses;n++)for(var i=0;i<len;i++){var c=circleList[i];if(c.isFixed)continue;v.x=c.position.x-(c.targetPosition.x+c.offset.x);v.y=c.position.y-(c.targetPosition.y+c.offset.y);v.multiply(c.targetChaseSpeed);c.position.x-=v.x;c.position.y-=v.y}},handleCollisions:function(){this.removeExpiredElements();
var v=(new CAAT.Point).set(0,0),circleList=this.allCircles,len=circleList.length;for(var n=0;n<this.numberOfCollisionPasses;n++)for(var i=0;i<len;i++){var ci=circleList[i];for(var j=i+1;j<len;j++){var cj=circleList[j];if(!this.circlesCanCollide(ci,cj))continue;var dx=cj.position.x-ci.position.x,dy=cj.position.y-ci.position.y;var r=(ci.radius+cj.radius)*1.08,d=ci.position.getDistanceSquared(cj.position);if(d<r*r-0.02){v.x=dx;v.y=dy;v.normalize();var inverseForce=(r-Math.sqrt(d))*0.5;v.multiply(inverseForce);
if(!cj.isFixed){if(ci.isFixed)v.multiply(2.2);cj.position.translatePoint(v)}if(!ci.isFixed){if(cj.isFixed)v.multiply(2.2);ci.position.subtract(v)}}}}},handleBoundaryForCircle:function(aCircle,boundsRule){var xpos=aCircle.position.x;var ypos=aCircle.position.y;var radius=aCircle.radius;var diameter=radius*2;var wrapXMask=1<<0;var wrapYMask=1<<2;var constrainXMask=1<<3;var constrainYMask=1<<4;var emitEvent=1<<5;boundsRule=wrapYMask|constrainXMask;if(boundsRule&wrapXMask&&xpos-diameter>this.bounds.right)aCircle.position.x=
this.bounds.left+radius;else if(boundsRule&wrapXMask&&xpos+diameter<this.bounds.left)aCircle.position.x=this.bounds.right-radius;if(boundsRule&wrapYMask&&ypos-diameter>this.bounds.bottom)aCircle.position.y=this.bounds.top-radius;else if(boundsRule&wrapYMask&&ypos+diameter<this.bounds.top)aCircle.position.y=this.bounds.bottom+radius;if(boundsRule&constrainXMask&&xpos+radius>=this.bounds.right)aCircle.position.x=aCircle.position.x=this.bounds.right-radius;else if(boundsRule&constrainXMask&&xpos-radius<
this.bounds.left)aCircle.position.x=this.bounds.left+radius;if(boundsRule&constrainYMask&&ypos+radius>this.bounds.bottom)aCircle.position.y=this.bounds.bottom-radius;else if(boundsRule&constrainYMask&&ypos-radius<this.bounds.top)aCircle.position.y=this.bounds.top+radius},getCircleAt:function(xpos,ypos,buffer){var circleList=this.allCircles;var len=circleList.length;var grabVector=new CAAT.Point(xpos,ypos);var closestCircle=null;var closestDistance=Number.MAX_VALUE;for(var i=0;i<len;i++){var aCircle=
circleList[i];if(!aCircle)continue;var distanceSquared=aCircle.position.getDistanceSquared(grabVector);if(distanceSquared<closestDistance&&distanceSquared<aCircle.radiusSquared+buffer){closestDistance=distanceSquared;closestCircle=aCircle}}return closestCircle},circlesCanCollide:function(circleA,circleB){if(!circleA||!circleB||circleA===circleB)return false;return true},setBounds:function(x,y,w,h){this.bounds.x=x;this.bounds.y=y;this.bounds.width=w;this.bounds.height=h},setNumberOfCollisionPasses:function(value){this.numberOfCollisionPasses=
value;return this},setNumberOfTargetingPasses:function(value){this.numberOfTargetingPasses=value;return this},sortOnDistanceToTarget:function(circleA,circleB){var valueA=circleA.getDistanceSquaredFromPosition(circleA.targetPosition);var valueB=circleB.getDistanceSquaredFromPosition(circleA.targetPosition);var comparisonResult=0;if(valueA>valueB)comparisonResult=-1;else if(valueA<valueB)comparisonResult=1;return comparisonResult},removeExpiredElements:function(){for(var k=this.allCircles.length;k>=
0;k--)if(this.allCircles[k]===null)this.allCircles.splice(k,1)},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this}}})();(function(){CAAT.Interpolator=function(){this.interpolated=new CAAT.Point;return this};CAAT.Interpolator.prototype={interpolated:null,paintScale:90,createLinearInterpolator:function(bPingPong,bInverse){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(bInverse!=null&&bInverse)time=1-time;return this.interpolated.set(orgTime,time)};return this},createBackOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){var orgTime=
time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;time=time-1;var overshoot=1.70158;return this.interpolated.set(orgTime,time*time*((overshoot+1)*time+overshoot)+1)};return this},createExponentialInInterpolator:function(exponent,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.interpolated.set(orgTime,Math.pow(time,exponent))};return this},createExponentialOutInterpolator:function(exponent,bPingPong){this.getPosition=
function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.interpolated.set(orgTime,1-Math.pow(1-time,exponent))};return this},createExponentialInOutInterpolator:function(exponent,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time*2<1)return this.interpolated.set(orgTime,Math.pow(time*2,exponent)/2);return this.interpolated.set(orgTime,1-Math.abs(Math.pow(time*
2-2,exponent))/2)};return this},createQuadricBezierInterpolator:function(p0,p1,p2,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;time=(1-time)*(1-time)*p0.y+2*(1-time)*time*p1.y+time*time*p2.y;return this.interpolated.set(orgTime,time)};return this},createCubicBezierInterpolator:function(p0,p1,p2,p3,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-
(time-0.5)*2;var t2=time*time;var t3=time*t2;time=p0.y+time*(-p0.y*3+time*(3*p0.y-p0.y*time))+time*(3*p1.y+time*(-6*p1.y+p1.y*3*time))+t2*(p2.y*3-p2.y*3*time)+p3.y*t3;return this.interpolated.set(orgTime,time)};return this},createElasticOutInterpolator:function(amplitude,p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time==0)return{x:0,y:0};if(time==1)return{x:1,y:1};var s=p/(2*Math.PI)*Math.asin(1/amplitude);return this.interpolated.set(time,
amplitude*Math.pow(2,-10*time)*Math.sin((time-s)*2*Math.PI/p)+1)};return this},createElasticInInterpolator:function(amplitude,p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time==0)return{x:0,y:0};if(time==1)return{x:1,y:1};var s=p/(2*Math.PI)*Math.asin(1/amplitude);return this.interpolated.set(time,-(amplitude*Math.pow(2,10*(time-=1))*Math.sin((time-s)*2*Math.PI/p)))};return this},createElasticInOutInterpolator:function(amplitude,
p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;var s=p/(2*Math.PI)*Math.asin(1/amplitude);time*=2;if(time<=1)return this.interpolated.set(time,-0.5*amplitude*Math.pow(2,10*(time-=1))*Math.sin((time-s)*2*Math.PI/p));return this.interpolated.set(time,1+0.5*amplitude*Math.pow(2,-10*(time-=1))*Math.sin((time-s)*2*Math.PI/p))};return this},bounce:function(time){if((time/=1)<1/2.75)return{x:time,y:7.5625*time*time};else if(time<2/2.75)return{x:time,
y:7.5625*(time-=1.5/2.75)*time+0.75};else if(time<2.5/2.75)return{x:time,y:7.5625*(time-=2.25/2.75)*time+0.9375};else return{x:time,y:7.5625*(time-=2.625/2.75)*time+0.984375}},createBounceOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.bounce(time)};return this},createBounceInInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-
(time-0.5)*2;var r=this.bounce(1-time);r.y=1-r.y;return r};return this},createBounceInOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;var r;if(time<0.5){r=this.bounce(1-time*2);r.y=(1-r.y)*0.5;return r}r=this.bounce(time*2-1,bPingPong);r.y=r.y*0.5+0.5;return r};return this},paint:function(director,time){var canvas=director.crc;canvas.save();canvas.beginPath();canvas.moveTo(0,this.getPosition(0).y*this.paintScale);
for(var i=0;i<=this.paintScale;i++)canvas.lineTo(i,this.getPosition(i/this.paintScale).y*this.paintScale);canvas.strokeStyle="black";canvas.stroke();canvas.restore()},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push({x:i/iSize,y:this.getPosition(i/iSize).y});return contour},enumerateInterpolators:function(){return[(new CAAT.Interpolator).createLinearInterpolator(false,false),"Linear pingpong=false, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(true,
false),"Linear pingpong=true, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(false,true),"Linear pingpong=false, inverse=true",(new CAAT.Interpolator).createLinearInterpolator(true,true),"Linear pingpong=true, inverse=true",(new CAAT.Interpolator).createExponentialInInterpolator(2,false),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,false),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialInOutInterpolator(2,
false),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(2,true),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,true),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInOutInterpolator(2,true),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(4,false),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialOutInterpolator(4,
false),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,false),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInInterpolator(4,true),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialOutInterpolator(4,true),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,true),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialInInterpolator(6,
false),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,false),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInOutInterpolator(6,false),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInInterpolator(6,true),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,true),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Interpolator).createExponentialInOutInterpolator(6,
true),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Interpolator).createBounceInInterpolator(false),"BounceIn pingpong=false",(new CAAT.Interpolator).createBounceOutInterpolator(false),"BounceOut pingpong=false",(new CAAT.Interpolator).createBounceInOutInterpolator(false),"BounceInOut pingpong=false",(new CAAT.Interpolator).createBounceInInterpolator(true),"BounceIn pingpong=true",(new CAAT.Interpolator).createBounceOutInterpolator(true),"BounceOut pingpong=true",(new CAAT.Interpolator).createBounceInOutInterpolator(true),
"BounceInOut pingpong=true",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,false),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4,false),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,false),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,true),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticOutInterpolator(1.1,
0.4,true),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,true),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1,0.2,false),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,false),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,false),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInInterpolator(1,
0.2,true),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,true),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,true),"ElasticInOut pingpong=true, amp=1.0, d=.2"]}}})();(function(){CAAT.InterpolatorActor=function(){CAAT.InterpolatorActor.superclass.constructor.call(this);return this};extend(CAAT.InterpolatorActor,CAAT.Actor,{interpolator:null,contour:null,S:50,gap:5,setGap:function(gap){this.gap=gap;return this},setInterpolator:function(interpolator,size){this.interpolator=interpolator;this.contour=interpolator.getContour(size||this.S);return this},paint:function(director,time){CAAT.InterpolatorActor.superclass.paint.call(this,director,time);if(this.interpolator){var canvas=
director.crc;var xs=this.width-2*this.gap;var ys=this.height-2*this.gap;canvas.beginPath();canvas.moveTo(this.gap+xs*this.contour[0].x,-this.gap+this.height-ys*this.contour[0].y);for(var i=1;i<this.contour.length;i++)canvas.lineTo(this.gap+xs*this.contour[i].x,-this.gap+this.height-ys*this.contour[i].y);canvas.strokeStyle=this.strokeStyle;canvas.stroke()}},getInterpolator:function(){return this.interpolator}})})();(function(){CAAT.PathSegment=function(){return this};CAAT.PathSegment.prototype={color:"black",setColor:function(color){if(color)this.color=color;return this},endCurvePosition:function(){},startCurvePosition:function(){},getPosition:function(time){},getLength:function(){},getBoundingBox:function(rectangle){},numControlPoints:function(){},getControlPoint:function(index){},endPath:function(){},getContour:function(iSize){},updatePath:function(){}}})();
(function(){CAAT.LinearPath=function(){this.initialPosition=new CAAT.Point;this.finalPosition=new CAAT.Point;this.newPosition=new CAAT.Point;return this};extend(CAAT.LinearPath,CAAT.PathSegment,{initialPosition:null,finalPosition:null,newPosition:null,setInitialPosition:function(x,y){this.initialPosition.x=x;this.initialPosition.y=y;this.newPosition.set(x,y);return this},setFinalPosition:function(finalX,finalY){this.finalPosition.x=finalX;this.finalPosition.y=finalY;return this},endCurvePosition:function(){return this.finalPosition},
startCurvePosition:function(){return this.initialPosition},getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;this.newPosition.set(this.initialPosition.x+(this.finalPosition.x-this.initialPosition.x)*time,this.initialPosition.y+(this.finalPosition.y-this.initialPosition.y)*time);return this.newPosition},getLength:function(){var x=this.finalPosition.x-this.initialPosition.x;var y=this.finalPosition.y-this.initialPosition.y;return Math.sqrt(x*x+y*y)},initialPositionX:function(){return this.initialPosition.x},
finalPositionX:function(){return this.finalPosition.x},paint:function(director,bDrawHandles){var canvas=director.crc;canvas.save();canvas.strokeStyle=this.color;canvas.beginPath();canvas.moveTo(this.initialPosition.x,this.initialPosition.y);canvas.lineTo(this.finalPosition.x,this.finalPosition.y);canvas.stroke();if(bDrawHandles){canvas.globalAlpha=0.5;canvas.fillStyle="#7f7f00";canvas.beginPath();canvas.arc(this.initialPosition.x,this.initialPosition.y,CAAT.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,
false);canvas.arc(this.finalPosition.x,this.finalPosition.y,CAAT.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,false);canvas.fill()}canvas.restore()},getBoundingBox:function(rectangle){rectangle.union(this.initialPosition.x,this.initialPosition.y);rectangle.union(this.finalPosition.x,this.finalPosition.y);return rectangle},numControlPoints:function(){return 2},getControlPoint:function(index){if(0==index)return this.initialPosition;else if(1==index)return this.finalPosition},getContour:function(iSize){var contour=
[];contour.push(this.getPosition(0).clone());contour.push(this.getPosition(1).clone());return contour}})})();
(function(){CAAT.CurvePath=function(){this.newPosition=new CAAT.Point;return this};extend(CAAT.CurvePath,CAAT.PathSegment,{curve:null,newPosition:null,setQuadric:function(p0x,p0y,p1x,p1y,p2x,p2y){var curve=new CAAT.Bezier;curve.setQuadric(p0x,p0y,p1x,p1y,p2x,p2y);this.curve=curve;return this},setCubic:function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var curve=new CAAT.Bezier;curve.setCubic(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y);this.curve=curve;return this},updatePath:function(){this.curve.update();return this},
getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;this.curve.solve(this.newPosition,time);return this.newPosition},getPositionFromLength:function(iLength){this.curve.solve(this.newPosition,iLength/this.getLength());return this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},getLength:function(){return this.curve.getLength()},paint:function(director,bDrawHandles){this.curve.drawHandles=
bDrawHandles;director.ctx.strokeStyle=this.color;this.curve.paint(director)},getBoundingBox:function(rectangle){this.curve.getBoundingBox(rectangle);return rectangle},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(index){return this.curve.coordlist[index]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push({x:i/
iSize,y:this.getPosition(i/iSize).y});return contour}})})();
(function(){CAAT.Path=function(){this.newPosition=new CAAT.Point;this.pathSegments=[];return this};extend(CAAT.Path,CAAT.PathSegment,{pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:true,setInteractive:function(interactive){this.interactive=interactive;return this},endCurvePosition:function(){return this.pathSegments[this.pathSegments.length-1].endCurvePosition()},
startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},setLinear:function(x0,y0,x1,y1){this.beginPath(x0,y0);this.addLineTo(x1,y1);this.endPath();return this},setQuadric:function(x0,y0,x1,y1,x2,y2){this.beginPath(x0,y0);this.addQuadricTo(x1,y1,x2,y2);this.endPath();return this},setCubic:function(x0,y0,x1,y1,x2,y2,x3,y3){this.beginPath(x0,y0);this.addCubicTo(x1,y1,x2,y2,x3,y3);this.endPath();return this},addSegment:function(pathSegment){this.pathSegments.push(pathSegment);
return this},addQuadricTo:function(px1,py1,px2,py2,color){var bezier=new CAAT.Bezier;bezier.setQuadric(this.trackPathX,this.trackPathY,px1,py1,px2,py2);this.trackPathX=px2;this.trackPathY=py2;var segment=(new CAAT.CurvePath).setColor(color);segment.curve=bezier;this.pathSegments.push(segment);return this},addCubicTo:function(px1,py1,px2,py2,px3,py3,color){var bezier=new CAAT.Bezier;bezier.setCubic(this.trackPathX,this.trackPathY,px1,py1,px2,py2,px3,py3);this.trackPathX=px3;this.trackPathY=py3;var segment=
(new CAAT.CurvePath).setColor(color);segment.curve=bezier;this.pathSegments.push(segment);return this},addCatmullTo:function(px1,py1,px2,py2,px3,py3,color){var curve=(new CAAT.CatmullRom).setColor(color);curve.setCurve(this.trackPathX,this.trackPathY,px1,py1,px2,py2,px3,py3);this.trackPathX=px3;this.trackPathY=py3;var segment=new CAAT.CurvePath;segment.curve=curve;this.pathSegments.push(segment);return this},addLineTo:function(px1,py1,color){var segment=(new CAAT.LinearPath).setColor(color);segment.setInitialPosition(this.trackPathX,
this.trackPathY);segment.setFinalPosition(px1,py1);this.trackPathX=px1;this.trackPathY=py1;this.pathSegments.push(segment);return this},beginPath:function(px0,py0){this.trackPathX=px0;this.trackPathY=py0;this.beginPathX=px0;this.beginPathY=py0;return this},closePath:function(){this.addLineTo(this.beginPathX,this.beginPathY);this.trackPathX=this.beginPathX;this.trackPathY=this.beginPathY;this.endPath();return this},endPath:function(){this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];this.pathLength=
0;var i;for(i=0;i<this.pathSegments.length;i++){this.pathLength+=this.pathSegments[i].getLength();this.pathSegmentStartTime.push(0);this.pathSegmentDurationTime.push(0)}for(i=0;i<this.pathSegments.length;i++){this.pathSegmentDurationTime[i]=this.pathSegments[i].getLength()/this.pathLength;if(i>0)this.pathSegmentStartTime[i]=this.pathSegmentStartTime[i-1]+this.pathSegmentDurationTime[i-1];else this.pathSegmentStartTime[0]=0;this.pathSegments[i].endPath()}return this},getLength:function(){return this.pathLength},
getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;for(var i=0;i<this.pathSegments.length;i++)if(this.pathSegmentStartTime[i]<=time&&time<=this.pathSegmentStartTime[i]+this.pathSegmentDurationTime[i]){time=(time-this.pathSegmentStartTime[i])/this.pathSegmentDurationTime[i];var pointInPath=this.pathSegments[i].getPosition(time);this.newPosition.x=pointInPath.x;this.newPosition.y=pointInPath.y;break}return this.newPosition},getPositionFromLength:function(iLength){iLength%=this.getLength();
if(iLength<0)iLength+=this.getLength();var accLength=0;for(var i=0;i<this.pathSegments.length;i++){if(accLength<=iLength&&iLength<=this.pathSegments[i].getLength()+accLength){iLength-=accLength;var pointInPath=this.pathSegments[i].getPositionFromLength(iLength);this.newPosition.x=pointInPath.x;this.newPosition.y=pointInPath.y;break}accLength+=this.pathSegments[i].getLength()}return this.newPosition},paint:function(director){for(var i=0;i<this.pathSegments.length;i++)this.pathSegments[i].paint(director,
this.interactive)},getBoundingBox:function(rectangle){if(null==rectangle)rectangle=new CAAT.Rectangle;for(var i=0;i<this.pathSegments.length;i++)this.pathSegments[i].getBoundingBox(rectangle);return rectangle},release:function(){this.ax=-1;this.ay=-1},getNumSegments:function(){return this.pathSegments.length},getSegment:function(index){return this.pathSegments[index]},updatePath:function(){for(var i=0;i<this.pathSegments.length;i++)this.pathSegments[i].updatePath();this.endPath()},press:function(x,
y){if(!this.interactive)return;var HS=CAAT.Curve.prototype.HANDLE_SIZE/2;for(var i=0;i<this.pathSegments.length;i++)for(var j=0;j<this.pathSegments[i].numControlPoints();j++){var point=this.pathSegments[i].getControlPoint(j);if(x>=point.x-HS&&y>=point.y-HS&&x<point.x+HS&&y<point.y+HS){this.point=[];this.point.push(point);if(j==0){var xx=i-1;if(xx<0)xx=this.pathSegments.length-1;this.point.push(this.pathSegments[xx].endCurvePosition())}else if(j==this.pathSegments[i].numControlPoints()-1)this.point.push(this.pathSegments[(i+
1)%this.pathSegments.length].startCurvePosition());return}}this.point=null},drag:function(x,y){if(!this.interactive)return;if(null==this.point)return;if(-1==this.ax||-1==this.ay){this.ax=x;this.ay=y}for(var i=0;i<this.point.length;i++){this.point[i].x+=x-this.ax;this.point[i].y+=y-this.ay}this.ax=x;this.ay=y;this.updatePath()},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push((new CAAT.Point).set(i/iSize,this.getPosition(i/iSize).y));return contour}})})();(function(){CAAT.PathActor=function(){CAAT.PathActor.superclass.constructor.call(this);return this};extend(CAAT.PathActor,CAAT.Actor,{path:null,pathBoundingRectangle:null,bOutline:false,getPath:function(){return this.path},setPath:function(path){this.path=path;this.pathBoundingRectangle=path.getBoundingBox();return this},paint:function(director,time){var canvas=director.crc;canvas.strokeStyle="black";this.path.paint(director);if(this.bOutline){canvas.strokeStyle="black";canvas.strokeRect(0,0,this.width,
this.height)}},mouseDrag:function(mouseEvent){this.path.drag(mouseEvent.point.x,mouseEvent.point.y)},mouseDown:function(mouseEvent){this.path.press(mouseEvent.point.x,mouseEvent.point.y)},mouseUp:function(mouseEvent){this.path.release()}})})();(function(){CAAT.ImageProcessor=function(){return this};CAAT.ImageProcessor.prototype={canvas:null,ctx:null,width:0,height:0,imageData:null,bufferImage:null,grabPixels:function(image){var canvas=document.createElement("canvas");if(canvas!=null){canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext("2d");ctx.drawImage(image,0,0);try{var imageData=ctx.getImageData(0,0,canvas.width,canvas.height)}catch(e){CAAT.log("error pixelgrabbing.");return null}return imageData}return null},
makeArray:function(size,initValue){var a=[];for(var i=0;i<size;i++)a.push(initValue);return a},makeArray2D:function(size,size2,initvalue){var a=[];for(var i=0;i<size;i++)a.push(this.makeArray(size2,initvalue));return a},initialize:function(width,height){this.width=width;this.height=height;this.canvas=document.createElement("canvas");if(this.canvas!=null){this.canvas.width=width;this.canvas.height=height;this.ctx=this.canvas.getContext("2d");this.imageData=this.ctx.getImageData(0,0,width,height);this.bufferImage=
this.imageData.data}return this},clear:function(r,g,b,a){var data=this.imageData.data;for(var i=0;i<this.width*this.height;i++){data[i*4+0]=r;data[i*4+1]=g;data[i*4+2]=b;data[i*4+3]=a}},getImageData:function(){return this.ctx.getImageData(0,0,this.width,this.height)},apply:function(director,time){this.ctx.putImageData(this.imageData,0,0);return this},getCanvas:function(){return this.canvas},createPattern:function(type){return this.ctx.createPattern(this.canvas,type?type:"repeat")}}})();
(function(){CAAT.IMPlasma=function(){CAAT.IMPlasma.superclass.constructor.call(this);return this};extend(CAAT.IMPlasma,CAAT.ImageProcessor,{wavetable:null,m_colorMap:null,spd1:1,spd2:2,spd3:3,spd4:4,pos1:0,pos2:0,pos3:0,pos4:0,tpos1:0,tpos2:0,tpos3:0,tpos4:0,m_colorMapSize:256,i1:0,i2:0,i3:0,i4:0,b1:false,b2:false,b3:false,b4:false,color:[4294967295,4294902015,4294967040,4278255360,4294901760,4278190335,4278190080],initialize:function(width,height,colors){CAAT.IMPlasma.superclass.initialize.call(this,
width,height);this.wavetable=[];for(var x=0;x<256;x++)this.wavetable.push(Math.floor(32*(1+Math.cos(x*2*Math.PI/256))));this.pos1=Math.floor(255*Math.random());this.pos2=Math.floor(255*Math.random());this.pos3=Math.floor(255*Math.random());this.pos4=Math.floor(255*Math.random());this.m_colorMap=CAAT.ColorUtils.prototype.makeRGBColorRamp(colors!=null?colors:this.color,256,CAAT.ColorUtils.prototype.RAMP_CHANNEL_RGBA_ARRAY);this.setB();return this},setB:function(){this.b1=Math.random()>0.5;this.b2=Math.random()>
0.5;this.b3=Math.random()>0.5;this.b4=Math.random()>0.5;this.spd1=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd2=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd3=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd4=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.i1=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1));this.i2=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1));this.i3=Math.floor((Math.random()*2.4+1)*(Math.random()<
0.5?1:-1));this.i4=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1))},apply:function(director,time){var v=0;this.tpos1=this.pos1;this.tpos2=this.pos2;for(var x=0;x<this.height;x++){this.tpos3=this.pos3;this.tpos4=this.pos4;for(var y=0;y<this.width;y++){var o1=this.tpos1+this.tpos2+this.tpos3;var o2=this.tpos2+this.tpos3-this.tpos1;var o3=this.tpos3+this.tpos4-this.tpos2;var o4=this.tpos4+this.tpos1-this.tpos2;if(this.b1)o1=-o1;if(this.b2)o2=-o2;if(this.b3)o3=-o3;if(this.b4)o4=-o4;var z=Math.floor(this.wavetable[o1&
255]+this.wavetable[o2&255]+this.wavetable[o3&255]+this.wavetable[o4&255]);this.bufferImage[v++]=this.m_colorMap[z][0];this.bufferImage[v++]=this.m_colorMap[z][1];this.bufferImage[v++]=this.m_colorMap[z][2];this.bufferImage[v++]=this.m_colorMap[z][3];this.tpos3+=this.i1;this.tpos3&=255;this.tpos4+=this.i2;this.tpos4&=255}this.tpos1+=this.i3;this.tpos1&=255;this.tpos2+=this.i4;this.tpos2&=255}this.pos1+=this.spd1;this.pos2-=this.spd2;this.pos3+=this.spd3;this.pos4-=this.spd4;this.pos1&=255;this.pos3&=
255;this.pos2&=255;this.pos4&=255;return CAAT.IMPlasma.superclass.apply.call(this,director,time)}})})();
(function(){CAAT.IMBump=function(){CAAT.IMBump.superclass.constructor.call(this);return this};extend(CAAT.IMBump,CAAT.ImageProcessor,{m_avgX:null,m_avgY:null,m_tt:null,phong:null,m_radius:75,m_lightcolor:null,bcolor:false,lightPosition:[],prepareBump:function(image,radius){var i,j;this.m_radius=radius?radius:75;var imageData=this.grabPixels(image);this.m_tt=this.makeArray(this.height,0);for(i=0;i<this.height;i++)this.m_tt[i]=this.width*i;this.m_avgX=this.makeArray2D(this.height,this.width,0);this.m_avgY=
this.makeArray2D(this.height,this.width,0);var bump=this.makeArray2D(this.height,this.width,0);if(null==imageData)return;var sourceImagePixels=imageData.data;for(i=0;i<this.height;i++)for(j=0;j<this.width;j++){var pos=(i*this.width+j)*4;bump[i][j]=sourceImagePixels[pos]+sourceImagePixels[pos+1]+sourceImagePixels[pos+2]}bump=this.soften(bump);for(var x=1;x<this.width-1;x++)for(var y=1;y<this.height-1;y++){this.m_avgX[y][x]=Math.floor(bump[y][x+1]-bump[y][x-1]);this.m_avgY[y][x]=Math.floor(bump[y+1][x]-
bump[y-1][x])}bump=null},soften:function(bump){var temp;var sbump=this.makeArray2D(this.height,this.width,0);for(var j=0;j<this.width;j++)for(var i=0;i<this.height;i++){temp=bump[i][j];temp+=bump[(i+1)%this.height][j];temp+=bump[(i+this.height-1)%this.height][j];temp+=bump[i][(j+1)%this.width];temp+=bump[i][(j+this.width-1)%this.width];temp+=bump[(i+1)%this.height][(j+1)%this.width];temp+=bump[(i+this.height-1)%this.height][(j+this.width-1)%this.width];temp+=bump[(i+this.height-1)%this.height][(j+
1)%this.width];temp+=bump[(i+1)%this.height][(j+this.width-1)%this.width];temp/=9;sbump[i][j]=temp/3}return sbump},calculatePhong:function(){this.phong=this.makeArray2D(this.m_radius,this.m_radius,0);var i,j,z;for(i=0;i<this.m_radius;i++)for(j=0;j<this.m_radius;j++){var x=j/this.m_radius;var y=i/this.m_radius;z=(1-Math.sqrt(x*x+y*y))*0.8;if(z<0)z=0;this.phong[i][j]=Math.floor(z*255)}},drawColored:function(dstPixels){var i,j,k;for(i=0;i<this.height;i++)for(j=0;j<this.width;j++){var rrr=0;var ggg=0;
var bbb=0;for(k=0;k<this.m_lightcolor.length;k++){var lx=this.lightPosition[k].x;var ly=this.lightPosition[k].y;var dx=Math.floor(Math.abs(this.m_avgX[i][j]-j+lx));var dy=Math.floor(Math.abs(this.m_avgY[i][j]-i+ly));if(dx>=this.m_radius)dx=this.m_radius-1;if(dy>=this.m_radius)dy=this.m_radius-1;var c=this.phong[dx][dy];var r=0;var g=0;var b=0;if(c>=0){r=this.m_lightcolor[k][0]*c/128;g=this.m_lightcolor[k][1]*c/128;b=this.m_lightcolor[k][2]*c/128}else{c=128+c;var rr=this.m_lightcolor[k][0];var gg=
this.m_lightcolor[k][1];var bb=this.m_lightcolor[k][2];r=Math.floor(rr+(255-rr)*c/128);g=Math.floor(gg+(255-gg)*c/128);b=Math.floor(bb+(255-bb)*c/128)}rrr+=r;ggg+=g;bbb+=b}if(rrr>255)rrr=255;if(ggg>255)ggg=255;if(bbb>255)bbb=255;var pos=(j+this.m_tt[i])*4;dstPixels[pos]=rrr;dstPixels[pos+1]=ggg;dstPixels[pos+2]=bbb;dstPixels[pos+3]=255}},setLightColors:function(colors_rgb_array){this.m_lightcolor=colors_rgb_array;this.lightPosition=[];for(var i=0;i<this.m_lightcolor.length;i++){var x=this.width*Math.random();
var y=this.height*Math.random();this.lightPosition.push((new CAAT.Point).set(x,y))}return this},initialize:function(image,radius){CAAT.IMBump.superclass.initialize.call(this,image.width,image.height);this.setLightColors([[255,128,0],[0,0,255]]);this.prepareBump(image,radius);this.calculatePhong();return this},setLightPosition:function(lightIndex,x,y){this.lightPosition[lightIndex].set(x,y);return this},apply:function(director,time){this.drawColored(this.bufferImage);return CAAT.IMBump.superclass.apply.call(this,
director,time)}})})();
(function(){CAAT.IMRotoZoom=function(){CAAT.IMRotoZoom.superclass.constructor.call(this);return this};extend(CAAT.IMRotoZoom,CAAT.ImageProcessor,{m_alignv:1,m_alignh:1,distortion:2,mask:0,shift:0,sourceImageData:null,initialize:function(width,height,patternImage){CAAT.IMRotoZoom.superclass.initialize(width,height);this.clear(255,128,0,255);this.sourceImageData=this.grabPixels(patternImage);if(null!=this.sourceImageData)switch(this.sourceImageData.width){case 1024:this.mask=1023;this.shift=10;break;
case 512:this.mask=511;this.shift=9;break;case 256:this.mask=255;this.shift=8;break;case 128:this.mask=127;this.shift=7;break;case 64:this.mask=63;this.shift=6;break;case 32:this.mask=31;this.shift=5;break;case 16:this.mask=15;this.shift=4;break;case 8:this.mask=7;this.shift=3;break}this.setCenter();return this},rotoZoom:function(director,time){var timer=(new Date).getTime();var angle=Math.PI*2*Math.cos(timer*1.0E-4);var distance=600+550*Math.sin(timer*2.0E-4);var dist=this.distortion;var off=0;var ddx=
Math.floor(Math.cos(angle)*distance);var ddy=Math.floor(Math.sin(angle)*distance);var hh=0,ww=0;switch(this.m_alignh){case 0:hh=0;break;case 1:hh=this.height>>1;break;case 2:hh=this.height-1;break}switch(this.m_alignv){case 0:ww=0;break;case 1:ww=this.width>>1;break;case 2:ww=this.width-1;break}var i=(this.width>>1<<8)-ddx*ww+ddy*hh&65535;var j=(this.height>>1<<8)-ddy*ww-ddx*hh&65535;var srcwidth=this.sourceImageData.width;var srcheight=this.sourceImageData.height;var srcdata=this.sourceImageData.data;
while(off<this.width*this.height*4){var addx=i;var addy=j;for(var m=0;m<this.width;m++){var dstoff=(addy>>this.shift&this.mask)*srcwidth+(addx>>this.shift&this.mask);dstoff<<=2;this.bufferImage[off++]=srcdata[dstoff++];this.bufferImage[off++]=srcdata[dstoff++];this.bufferImage[off++]=srcdata[dstoff++];this.bufferImage[off++]=srcdata[dstoff++];addx+=ddx;addy+=ddy}dist+=this.distortion;i-=ddy;j+=ddx-dist}},apply:function(director,time){if(null!=this.sourceImageData)this.rotoZoom(director,time);return CAAT.IMRotoZoom.superclass.apply.call(this,
director,time)},setCenter:function(){var d=Math.random();if(d<0.33)this.m_alignv=0;else if(d<0.66)this.m_alignv=1;else this.m_alignv=2;d=Math.random();if(d<0.33)this.m_alignh=0;else if(d<0.66)this.m_alignh=1;else this.m_alignh=2}})})();
