<<<<<<< HEAD
/*! CAAT 2013-02-06 */
(function(t){function e(e){for(var i=e.split("."),n=t,s=0;i.length-1>s;s++)n[i[s]]||(n[i[s]]={}),n=n[i[s]]}function i(e,i){for(var n=e.split("."),s=t,r=0;n.length-1>r;r++){if(!s[n[r]])return console.log("    Error assigning value to namespace :"+e+". '"+n[r]+"' does not exist."),null;s=s[n[r]]}return s[n[n.length-1]]=i,s[n[n.length-1]]}function n(e){for(var i=e.split("."),n=t,s=0;i.length>s;s++){if(!n[i[s]])return null;n=n[i[s]]}return n}String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)},Function.prototype.bind=Function.prototype.bind||function(){var t=this,e=Array.prototype.slice.call(arguments),i=e.shift();return function(){return t.apply(i,e.concat(Array.prototype.slice.call(arguments)))}},t.isArray=function(t){return"object"==typeof t&&t instanceof Array},t.isString=function(t){return"string"==typeof t},t.isFunction=function(t){return"function"==typeof t};var s=!1,r=function(){};r.extend=function(t,n,a,o,h){function l(){!s&&this.__init&&this.__init.apply(this,arguments)}var u=this.prototype;s=!0;var c=new this;if(s=!1,l.prototype=c,l.prototype.constructor=l,l.superclass=u,l.extend=r.extend,i(a,l),n){n=isFunction(n)?n():n;for(var d in n)n.hasOwnProperty(d)&&(l[d]=n[d])}if(o){isArray(o)||(o=[o]);for(var A=0;o.length>A;A++){e(o[A]);var f=i(o[A],l);if(n)for(var d in n)n.hasOwnProperty(d)&&(f[d]=n[d])}}t=isFunction(t)?t():t;for(var g in t)c[g]=("__init"===g||h&&h.decorated)&&isFunction(t[g])&&isFunction(u[g])?function(t,e){return function(){var i=this.__super;this.__super=u[t];var n=e.apply(this,arguments);return this.__super=i,n}}(g,t[g]):t[g];return l};var a=function(t){return this.name=t.defines,this.extendWith=t.extendsWith,this.callback=t.onCreate,this.callbackPreCreation=t.onPreCreate,this.dependencies=t.depends,this.baseClass=t.extendsClass,this.aliases=t.aliases,this.constants=t.constants,this.decorated=t.decorated,this.children=[],this};a.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:!1,solved:!1,visited:!1,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?" unsolved_deps:["+this.dependencies+"]":" no dependencies.")+(this.solved?" solved":" ------> NOT solved."))},removeDependency:function(t){for(var e=0;this.dependencies.length>e;e++)if(this.dependencies[e]===t){this.dependencies.splice(e,1);break}},assignDependency:function(t){var e;for(e=0;this.dependencies.length>e;e++)if(this.dependencies[e]===t.name){this.children.push(t),this.dependencies.splice(e,1);break}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited)return!0;if(this.visited=!0,this.solved)return!0;if(0!==this.dependencies.length)return!1;for(var t=0;this.children.length>t;t++)if(!this.children[t].solveDeep())return!1;return this.__initModule(),this.solved=!0,l.solved(this),!0},__initModule:function(){var t=null;if(this.baseClass){if(t=n(this.baseClass),!t)return console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass),void 0}else t=r;t=t.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated}),console.log("Created module: "+this.name),this.callback&&this.callback()}};var o=function(t,e){return this.path=t,this.module=e,this};o.prototype={path:null,processed:!1,module:null,setProcessed:function(){this.processed=!0},isProcessed:function(){return this.processed}};var h=function(){return this.nodes=[],this.loadedFiles=[],this.path={},this.solveListener=[],this.orderedSolvedModules=[],this.readyListener=[],this};h.baseURL="",h.modulePath={},h.sortedModulePath=[],h.symbol={},h.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(t,e){this.solveListener.push({name:t,callback:e})},solved:function(t){var e;for(e=0;this.solveListener.length>e;e++)this.solveListener[e].name===t.name&&this.solveListener[e].callback();this.orderedSolvedModules.push(t),this.notifyReady()},notifyReady:function(){var t;for(t=0;this.nodes.length>t;t++)if(!this.nodes[t].isSolved())return;for(t=0;this.loadedFiles.length>t;t++)if(!this.loadedFiles[t].isProcessed())return;var e=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var t=0;e.length>t;t++)e[t]()},0),this.readyListener=[]},status:function(){for(var t=0;this.nodes.length>t;t++)this.nodes[t].status()},module:function(t){var e,i;if(this.isModuleScheduledToSolve(t.defines))return this;if(t.onPreCreate)try{t.onPreCreate()}catch(n){console.log("  -> catched "+n+" on module "+t.defines+" preCreation.")}t.depends||(t.depends=[]);var s=t.depends;for(s&&(isArray(s)||(s=[s],t.depends=s)),i=0;s.length>i;)this.alreadySolved(s[i])?s.splice(i,1):i++;e=new a(t);for(var i=0;this.nodes.length>i;i++)this.nodes[i].assignDependency(e);for(this.nodes.push(e),i=0;t.depends.length>i;)if(this.isModuleScheduledToSolve(t.depends[i])){var r=this.findNode(t.depends[i]);null!==r?e.assignDependency(r):(alert("Module loaded and does not exist in loaded modules nodes. "+t.depends[i]),i++)}else i+=1;return function(t,e){setTimeout(function(){for(i=0;e.depends.length>i;i++)t.loadFile(e.depends[i])},0)}(this,t),this},findNode:function(t){for(var e=0;this.nodes.length>e;e++)if(this.nodes[e].name===t)return this.nodes[e];return null},alreadySolved:function(t){for(var e=0;this.nodes.length>e;e++)if(this.nodes[e].name===t&&this.nodes[e].isSolved())return!0;return!1},exists:function(e){for(var e=e.split("."),i=t,n=0;e.length>n;n++){if(!i[e[n]])return!1;i=i[e[n]]}return!0},loadFile:function(t){if(!this.exists(t)){for(var e=this.getPath(t),i=0;this.loadedFiles.length>i;i++)if(this.loadedFiles[i].path===e)return;var n=new o(e,t);this.loadedFiles.push(n);var s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.addEventListener("load",this.moduleLoaded.bind(this),!1),s.addEventListener("error",this.moduleErrored.bind(this),!1),s.setAttribute("module-name",t),s.src=e+(u?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(s)}},getPath:function(t){if(t.endsWith(".js"))return t="/"!==t.charAt(0)?h.baseURL+t:t.substring(1);var e,i;for(i in h.symbol)if(t===i)return h.baseURL+h.symbol[i];for(e=0;h.sortedModulePath.length>e;e++){var n=h.sortedModulePath[e];if(h.modulePath.hasOwnProperty(n)){var s=h.modulePath[n];if(0===t.indexOf(n)){var r=t.substring(n.length+1);return r=r.replace(/\./g,"/"),r=s+r+".js",h.baseURL+r}}}return h.baseURL+t.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(t){for(var e=0;this.nodes.length>e;e++)if(this.nodes[e].name===t)return!0;return!1},moduleLoaded:function(t){if("load"===t.type){for(var e=t.currentTarget||t.srcElement||t.target,i=e.getAttribute("module-name"),n=0;this.loadedFiles.length>n;n++)if(this.loadedFiles[n].module===i){this.loadedFiles[n].setProcessed();break}for(var n=0;this.nodes.length>n;n++)this.nodes[n].removeDependency(i);for(var n=0;this.nodes.length>n;n++){for(var s=0;this.nodes.length>s;s++)this.nodes[s].visited=!1;this.nodes[n].solveDeep()}var r=this;setTimeout(function(){r.notifyReady()},0)}},moduleErrored:function(t){var e=t.currentTarget||t.srcElement;console.log("Error loading module: "+e.getAttribute("module-name"))},solvedInOrder:function(){for(var t=0;this.orderedSolvedModules.length>t;t++)console.log(this.orderedSolvedModules[t].name)},solveAll:function(){for(var t=0;this.nodes.length>t;t++)this.nodes[t].solveDeep()},onReady:function(t){this.readyListener.push(t)}};var l=new h,u=!1;t.CAAT=t.CAAT||{},CAAT.Module=function(t){return t.defines?(e(t.defines),l.module(t),void 0):(console.error("Bad module definition: "+t),void 0)},CAAT.ModuleManager={},CAAT.ModuleManager.baseURL=function(t){return t?(t.endsWith("/")||(t+="/"),h.baseURL=t,CAAT.ModuleManager):CAAT.Module},CAAT.ModuleManager.setModulePath=function(t,e){return e.endsWith("/")||(e+="/"),h.modulePath[t]||(h.modulePath[t]=e,h.sortedModulePath.push(t),h.sortedModulePath.sort(function(t,e){return t==e?0:e>t?1:-1})),CAAT.ModuleManager},CAAT.ModuleManager.symbol=function(t,e){return h.symbol[t]||(h.symbol[t]=e),CAAT.ModuleManager},CAAT.ModuleManager.bring=function(t){isArray(t)||(t=[t]);for(var e=0;t.length>e;e++)l.loadFile(t[e]);return CAAT.ModuleManager},CAAT.ModuleManager.status=function(){l.status()},CAAT.ModuleManager.addModuleSolvedListener=function(t,e){return l.addSolveListener(t,e),CAAT.ModuleManager},CAAT.ModuleManager.load=function(t,e,i){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.async=!0,e&&n.addEventListener("load",e,!1),i&&n.addEventListener("error",i,!1),n.addEventListener("load",function(){l.solveAll()},!1),n.src=t+(u?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(n)},CAAT.ModuleManager.solvedInOrder=function(){l.solvedInOrder()},CAAT.ModuleManager.onReady=function(t){return l.onReady(t),CAAT.ModuleManager},CAAT.ModuleManager.solveAll=function(){l.solveAll()},CAAT.ModuleManager.debug=function(t){return u=t,CAAT.ModuleManager}})(this),CAAT.Module({defines:"CAAT.Core.Constants",extendsWith:function(){return CAAT.setCoordinateClamping=function(t){t?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)},CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},CAAT.CSS_TEXT_METRICS=0,CAAT.GLRENDER=!1,CAAT.DEBUG=!1,CAAT.DEBUGBB=!1,CAAT.DEBUGBBBCOLOR="#00f",CAAT.DEBUGAABB=!1,CAAT.DEBUGAABBCOLOR="#f00",CAAT.DEBUG_DIRTYRECTS=!1,CAAT.DRAG_THRESHOLD_X=5,CAAT.DRAG_THRESHOLD_Y=5,{}}}),extend=function(t,e){var i=t.prototype,n=function(){};n.prototype=e.prototype,t.prototype=new n,t.superclass=e.prototype,t.prototype.constructor=t,e.prototype.constructor===Object.prototype.constructor&&(e.prototype.constructor=e);for(var s in i)i.hasOwnProperty(s)&&(t.prototype[s]=i[s])},extendWith=function(t,e,i){var n=function(){};if(n.prototype=t.prototype,e.prototype=new n,e.superclass=t.prototype,e.prototype.constructor=e,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t),i)for(var s in i)i.hasOwnProperty(s)&&(e.prototype[s]=i[s])},proxy=function(t,e,i,n){if("function"==typeof t)return t.__isProxy?t:function(t){var s=function(){e&&e({fn:t,arguments:Array.prototype.slice.call(arguments)});var s=null;try{s=t.apply(t,Array.prototype.slice.call(arguments)),i&&(s=i({fn:t,arguments:Array.prototype.slice.call(arguments)}))}catch(r){if(!n)throw r;s=n({fn:t,arguments:Array.prototype.slice.call(arguments),exception:r})}return s};s.__isProxy=!0;for(var r in t)t.hasOwnProperty(r)&&"function"!=typeof t[r]&&"__object"!==r&&"__isProxy"!==r&&function(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}(s,t,r);return s}(t);if("object"!=typeof t||isArray(t)||isString(t)||t.__isProxy)return t;var s=function(){},r=new s;r.__object=t,r.__isProxy=!0;for(var a in t)t.hasOwnProperty(a)&&"function"==typeof t[a]?r[a]=function(t,s,r){return function(){e&&e({object:t.__object,method:r,arguments:Array.prototype.slice.call(arguments)});var a=null;try{a=s.apply(t.__object,arguments),i&&i({object:t.__object,method:r,arguments:Array.prototype.slice.call(arguments)})}catch(o){if(!n)throw o;a=n({object:t.__object,method:r,arguments:Array.prototype.slice.call(arguments),exception:o})}return a}}(r,t[a],a):"__object"!==a&&"__isProxy"!==a&&function(t,e){t.__defineGetter__(e,function(){return t.__object[e]}),t.__defineSetter__(e,function(i){t.__object[e]=i})}(r,a);return r},proxify=function(t,e,i,n,s,r){for(var a="__"+t+"__",o=window,h=t.split(".");h.length>1;)o=o[h.shift()];window[a]=o[h],function(t,a,o,h,l){var u=function(){console.log("Creating object of type proxy["+l+"]");var a=new t[h](Array.prototype.slice.call(arguments));return a.____name=l,proxyObject(a,e,i,n,s,r)};u.prototype=t[h].prototype;for(var c in a[o])a[o].hasOwnProperty(c)&&"function"!=typeof a[o][c]&&"__object"!==c&&"__isProxy"!==c&&function(t,e,i){i.__defineGetter__(e,function(){return t[e]}),i.__defineSetter__(e,function(i){t[e]=i})}(a[o],c,u);a[o]=u}(window,o,h,a,t)},proxyObject=function(t,e,i,n,s,r){if("object"!=typeof t||isArray(t)||isString(t)||t.__isProxy)return t;t.$proxy__isProxy=!0;for(var a in t)if(t.hasOwnProperty(a)&&"constructor"!==a)if("function"==typeof t[a]){var o=t[a];t["$proxy__"+a]=o,t[a]=function(t,s,r){return function(){var a=Array.prototype.slice.call(arguments);e&&e({object:t,objectName:t.____name,method:r,arguments:a});var o=null;try{o=s.apply(t,a),i&&i({object:t,objectName:t.____name,method:r,arguments:a})}catch(h){if(!n)throw h;o=n({object:t,objectName:t.____name,method:r,arguments:a,exception:h})}return o}}(t,o,a)}else"____name"!==a&&function(t,e,i,n){t["$proxy__"+e]=t[e],t.__defineGetter__(e,function(){return i&&i(t.____name,e),t["$proxy__"+e]}),t.__defineSetter__(e,function(i){t["$proxy__"+e]=i,n&&n(t.____name,e,i)})}(t,a,s,r);return t},CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:!1,applyAsPath:function(t){var e=this.coordlist;return this.cubic?t.ctx.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y):t.ctx.quadraticCurveTo(e[1].x,e[1].y,e[2].x,e[2].y),this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(t,e,i,n,s,r,a,o){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(t,e)),this.coordlist.push((new CAAT.Math.Point).set(i,n)),this.coordlist.push((new CAAT.Math.Point).set(s,r)),this.coordlist.push((new CAAT.Math.Point).set(a,o)),this.cubic=!0,this.update(),this},setQuadric:function(t,e,i,n,s,r){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(t,e)),this.coordlist.push((new CAAT.Math.Point).set(i,n)),this.coordlist.push((new CAAT.Math.Point).set(s,r)),this.cubic=!1,this.update(),this},setPoints:function(t){if(3===t.length)this.coordlist=t,this.cubic=!1,this.update();else{if(4!==t.length)throw"points must be an array of 3 or 4 CAAT.Point instances.";this.coordlist=t,this.cubic=!0,this.update()}return this},paint:function(t){this.cubic?this.paintCubic(t):this.paintCuadric(t),CAAT.Math.Bezier.superclass.paint.call(this,t)},paintCuadric:function(t){var e,i;e=this.coordlist[0].x,i=this.coordlist[0].y;var n=t.ctx;n.save(),n.beginPath(),n.moveTo(e,i);for(var s=new CAAT.Math.Point,r=this.k;1+this.k>=r;r+=this.k)this.solve(s,r),n.lineTo(s.x,s.y);n.stroke(),n.restore()},paintCubic:function(t){var e,i;e=this.coordlist[0].x,i=this.coordlist[0].y;var n=t.ctx;n.save(),n.beginPath(),n.moveTo(e,i);for(var s=new CAAT.Math.Point,r=this.k;1+this.k>=r;r+=this.k)this.solve(s,r),n.lineTo(s.x,s.y);n.stroke(),n.restore()},solve:function(t,e){return this.cubic?this.solveCubic(t,e):this.solveQuadric(t,e)},solveCubic:function(t,e){var i=e*e,n=e*i,s=this.coordlist,r=s[0],a=s[1],o=s[2],h=s[3];return t.x=r.x+e*(3*-r.x+e*(3*r.x-r.x*e))+e*(3*a.x+e*(-6*a.x+3*a.x*e))+i*(3*o.x-3*o.x*e)+h.x*n,t.y=r.y+e*(3*-r.y+e*(3*r.y-r.y*e))+e*(3*a.y+e*(-6*a.y+3*a.y*e))+i*(3*o.y-3*o.y*e)+h.y*n,t},solveQuadric:function(t,e){var i=this.coordlist,n=i[0],s=i[1],r=i[2],a=1-e;return t.x=a*a*n.x+2*a*e*s.x+e*e*r.x,t.y=a*a*n.y+2*a*e*s.y+e*e*r.y,t}}}}),CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(t,e,i,n){return this.coordlist=[],this.coordlist.push(t),this.coordlist.push(e),this.coordlist.push(i),this.coordlist.push(n),this.update(),this},paint:function(t){var e,i;e=this.coordlist[1].x,i=this.coordlist[1].y;var n=t.ctx;n.save(),n.beginPath(),n.moveTo(e,i);for(var s=new CAAT.Point,r=this.k;1+this.k>=r;r+=this.k)this.solve(s,r),n.lineTo(s.x,s.y);n.stroke(),n.restore(),CAAT.Math.CatmullRom.superclass.paint.call(this,t)},solve:function(t,e){var i=this.coordlist,n=.5*((-e+2)*e-1)*e,s=.5*((3*e-5)*e*e+2),r=.5*((-3*e+4)*e+1)*e,a=.5*(e-1)*e*e;return t.x=i[0].x*n+i[1].x*s+i[2].x*r+i[3].x*a,t.y=i[0].y*n+i[1].y*s+i[2].y*r+i[3].y*a,t},applyAsPath:function(t){for(var e=t.ctx,i=new CAAT.Math.Point,n=this.k;1+this.k>=n;n+=this.k)this.solve(i,n),e.lineTo(i.x,i.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}}}}),CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:.05,length:-1,interpolator:!1,HANDLE_SIZE:20,drawHandles:!0,paint:function(t){if(!1!==this.drawHandles){var e=this.coordlist,i=t.ctx;i.save(),i.beginPath(),i.strokeStyle="#a0a0a0",i.moveTo(e[0].x,e[0].y),i.lineTo(e[1].x,e[1].y),i.stroke(),this.cubic&&(i.moveTo(e[2].x,e[2].y),i.lineTo(e[3].x,e[3].y),i.stroke()),i.globalAlpha=.5;for(var n=0;this.coordlist.length>n;n++){i.fillStyle="#7f7f00";var s=this.HANDLE_SIZE/2;i.beginPath(),i.arc(e[n].x,e[n].y,s,0,2*Math.PI,!1),i.fill()}i.restore()}},update:function(){this.calcLength()},solve:function(){},getContour:function(t){var e,i=[];for(e=0;t>=e;e++){var n=new CAAT.Math.Point;this.solve(n,e/t),i.push(n)}return i},getBoundingBox:function(t){t||(t=new CAAT.Math.Rectangle),t.setEmpty(),t.union(this.coordlist[0].x,this.coordlist[0].y);for(var e=new CAAT.Math.Point,i=this.k;1+this.k>=i;i+=this.k)this.solve(e,i),t.union(e.x,e.y);return t},calcLength:function(){var t,e;t=this.coordlist[0].x,e=this.coordlist[0].y;for(var i=0,n=new CAAT.Math.Point,s=this.k;1+this.k>=s;s+=this.k)this.solve(n,s),i+=Math.sqrt((n.x-t)*(n.x-t)+(n.y-e)*(n.y-e)),t=n.x,e=n.y;return this.length=i,i},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(){},setPoint:function(t,e){e>=0&&this.coordlist.length>e&&(this.coordlist[e]=t)},applyAsPath:function(){}}}}),CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(t,e){return this.width=t,this.height=e,this}}}}),CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},extendsWith:function(){return{matrix:null,__init:function(){return this.matrix=[1,0,0,0,1,0,0,0,1],"undefined"!=typeof Float32Array&&(this.matrix=new Float32Array(this.matrix)),this},transformCoord:function(t){var e=t.x,i=t.y,n=this.matrix;return t.x=e*n[0]+i*n[1]+n[2],t.y=e*n[3]+i*n[4]+n[5],t},rotate:function(t){var e=new CAAT.Math.Matrix;return e.setRotation(t),e},setRotation:function(t){this.identity();var e=this.matrix,i=Math.cos(t),n=Math.sin(t);return e[0]=i,e[1]=-n,e[3]=n,e[4]=i,this},scale:function(t,e){var i=new CAAT.Math.Matrix;return i.matrix[0]=t,i.matrix[4]=e,i},setScale:function(t,e){return this.identity(),this.matrix[0]=t,this.matrix[4]=e,this},translate:function(t,e){var i=new CAAT.Math.Matrix;return i.matrix[2]=t,i.matrix[5]=e,i},setTranslate:function(t,e){return this.identity(),this.matrix[2]=t,this.matrix[5]=e,this},copy:function(t){t=t.matrix;var e=this.matrix;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},identity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},multiply:function(t){var e=this.matrix,i=t.matrix,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=i[0],A=i[1],f=i[2],g=i[3],p=i[4],m=i[5],v=i[6],C=i[7],T=i[8];return e[0]=n*d+s*g+r*v,e[1]=n*A+s*p+r*C,e[2]=n*f+s*m+r*T,e[3]=a*d+o*g+h*v,e[4]=a*A+o*p+h*C,e[5]=a*f+o*m+h*T,e[6]=l*d+u*g+c*v,e[7]=l*A+u*p+c*C,e[8]=l*f+u*m+c*T,this},premultiply:function(t){var e=t.matrix[0]*this.matrix[0]+t.matrix[1]*this.matrix[3]+t.matrix[2]*this.matrix[6],i=t.matrix[0]*this.matrix[1]+t.matrix[1]*this.matrix[4]+t.matrix[2]*this.matrix[7],n=t.matrix[0]*this.matrix[2]+t.matrix[1]*this.matrix[5]+t.matrix[2]*this.matrix[8],s=t.matrix[3]*this.matrix[0]+t.matrix[4]*this.matrix[3]+t.matrix[5]*this.matrix[6],r=t.matrix[3]*this.matrix[1]+t.matrix[4]*this.matrix[4]+t.matrix[5]*this.matrix[7],a=t.matrix[3]*this.matrix[2]+t.matrix[4]*this.matrix[5]+t.matrix[5]*this.matrix[8],o=t.matrix[6]*this.matrix[0]+t.matrix[7]*this.matrix[3]+t.matrix[8]*this.matrix[6],h=t.matrix[6]*this.matrix[1]+t.matrix[7]*this.matrix[4]+t.matrix[8]*this.matrix[7],l=t.matrix[6]*this.matrix[2]+t.matrix[7]*this.matrix[5]+t.matrix[8]*this.matrix[8];return this.matrix[0]=e,this.matrix[1]=i,this.matrix[2]=n,this.matrix[3]=s,this.matrix[4]=r,this.matrix[5]=a,this.matrix[6]=o,this.matrix[7]=h,this.matrix[8]=l,this},getInverse:function(){var t=this.matrix,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=new CAAT.Math.Matrix,c=e*(r*l-h*a)-s*(i*l-h*n)+o*(i*a-r*n);if(0===c)return null;var d=u.matrix;return d[0]=r*l-a*h,d[1]=n*h-i*l,d[2]=i*a-n*r,d[3]=a*o-s*l,d[4]=e*l-n*o,d[5]=n*s-e*a,d[6]=s*h-r*o,d[7]=i*o-e*h,d[8]=e*r-i*s,u.multiplyScalar(1/c),u},multiplyScalar:function(t){var e;for(e=0;9>e;e++)this.matrix[e]*=t;return this},transformRenderingContextSet_NoClamp:function(t){var e=this.matrix;return t.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this},transformRenderingContext_NoClamp:function(t){var e=this.matrix;return t.transform(e[0],e[3],e[1],e[4],e[2],e[5]),this},transformRenderingContextSet_Clamp:function(t){var e=this.matrix;return t.setTransform(e[0],e[3],e[1],e[4],e[2]>>0,e[5]>>0),this},transformRenderingContext_Clamp:function(t){var e=this.matrix;return t.transform(e[0],e[3],e[1],e[4],e[2]>>0,e[5]>>0),this}}}}),CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){return this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},transformCoord:function(t){var e=t.x,i=t.y,n=t.z;return t.x=e*this.matrix[0][0]+i*this.matrix[0][1]+n*this.matrix[0][2]+this.matrix[0][3],t.y=e*this.matrix[1][0]+i*this.matrix[1][1]+n*this.matrix[1][2]+this.matrix[1][3],t.z=e*this.matrix[2][0]+i*this.matrix[2][1]+n*this.matrix[2][2]+this.matrix[2][3],t},initialize:function(t,e,i,n,s,r,a,o,h){return this.identity(),this.matrix[0][0]=t,this.matrix[0][1]=e,this.matrix[0][2]=i,this.matrix[1][0]=n,this.matrix[1][1]=s,this.matrix[1][2]=r,this.matrix[2][0]=a,this.matrix[2][1]=o,this.matrix[2][2]=h,this},initWithMatrix:function(t){return this.matrix=t,this},flatten:function(){var t=this.fmatrix,e=this.matrix;return t[0]=e[0][0],t[1]=e[1][0],t[2]=e[2][0],t[3]=e[3][0],t[4]=e[0][1],t[5]=e[1][1],t[6]=e[2][1],t[7]=e[2][1],t[8]=e[0][2],t[9]=e[1][2],t[10]=e[2][2],t[11]=e[3][2],t[12]=e[0][3],t[13]=e[1][3],t[14]=e[2][3],t[15]=e[3][3],this.fmatrix},identity:function(){for(var t=0;4>t;t++)for(var e=0;4>e;e++)this.matrix[t][e]=t===e?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(t){return this.rotate(t,0,0)},rotateXZ:function(t){return this.rotate(0,t,0)},rotateYZ:function(t){return this.rotate(0,0,t)},setRotate:function(t,e,i){var n=this.rotate(t,e,i);return this.copy(n),this},rotate:function(t,e,i){var n,s,r,a=new CAAT.Math.Matrix3;return 0!==t&&(r=new CAAT.Math.Math.Matrix3,n=Math.sin(t),s=Math.cos(t),r.matrix[1][1]=s,r.matrix[1][2]=-n,r.matrix[2][1]=n,r.matrix[2][2]=s,a.multiply(r)),0!==e&&(r=new CAAT.Math.Matrix3,n=Math.sin(e),s=Math.cos(e),r.matrix[0][0]=s,r.matrix[0][2]=-n,r.matrix[2][0]=n,r.matrix[2][2]=s,a.multiply(r)),0!==i&&(r=new CAAT.Math.Matrix3,n=Math.sin(i),s=Math.cos(i),r.matrix[0][0]=s,r.matrix[0][1]=-n,r.matrix[1][0]=n,r.matrix[1][1]=s,a.multiply(r)),a},getClone:function(){var t=new CAAT.Math.Matrix3;return t.copy(this),t},multiply:function(t){var e=this.getClone(),i=e.matrix,n=i[0][0],s=i[0][1],r=i[0][2],a=i[0][3],o=i[1][0],h=i[1][1],l=i[1][2],u=i[1][3],c=i[2][0],d=i[2][1],A=i[2][2],f=i[2][3];i[3][0],i[3][1],i[3][2],i[3][3];var g=t.matrix,p=g[0][0],m=g[0][1],v=g[0][2],C=g[0][3],T=g[1][0],x=g[1][1],_=g[1][2],y=g[1][3],b=g[2][0],w=g[2][1],M=g[2][2],S=g[2][3],P=g[3][0],E=g[3][1],I=g[3][2],R=g[3][3];return this.matrix[0][0]=n*p+s*T+r*b+a*P,this.matrix[0][1]=n*m+s*x+r*w+a*E,this.matrix[0][2]=n*v+s*_+r*M+a*I,this.matrix[0][3]=n*C+s*y+r*S+a*R,this.matrix[1][0]=o*p+h*T+l*b+u*P,this.matrix[1][1]=o*m+h*x+l*w+u*E,this.matrix[1][2]=o*v+h*_+l*M+u*I,this.matrix[1][3]=o*C+h*y+l*S+u*R,this.matrix[2][0]=c*p+d*T+A*b+f*P,this.matrix[2][1]=c*m+d*x+A*w+f*E,this.matrix[2][2]=c*v+d*_+A*M+f*I,this.matrix[2][3]=c*C+d*y+A*S+f*R,this},premultiply:function(t){var e=this.getClone(),i=e.matrix,n=i[0][0],s=i[0][1],r=i[0][2],a=i[0][3],o=i[1][0],h=i[1][1],l=i[1][2],u=i[1][3],c=i[2][0],d=i[2][1],A=i[2][2],f=i[2][3];i[3][0],i[3][1],i[3][2],i[3][3];var g=t.matrix,p=g[0][0],m=g[0][1],v=g[0][2],C=g[0][3],T=g[1][0],x=g[1][1],_=g[1][2],y=g[1][3],b=g[2][0],w=g[2][1],M=g[2][2],S=g[2][3];return g[3][0],g[3][1],g[3][2],g[3][3],this.matrix[0][0]=n*p+s*T+r*b,this.matrix[0][1]=n*m+s*x+r*w,this.matrix[0][2]=n*v+s*_+r*M,this.matrix[0][3]=n*C+s*y+r*S+a,this.matrix[1][0]=o*p+h*T+l*b,this.matrix[1][1]=o*m+h*x+l*w,this.matrix[1][2]=o*v+h*_+l*M,this.matrix[1][3]=o*C+h*y+l*S+u,this.matrix[2][0]=c*p+d*T+A*b,this.matrix[2][1]=c*m+d*x+A*w,this.matrix[2][2]=c*v+d*_+A*M,this.matrix[2][3]=c*C+d*y+A*S+f,this},setTranslate:function(t,e,i){return this.identity(),this.matrix[0][3]=t,this.matrix[1][3]=e,this.matrix[2][3]=i,this},translate:function(t,e,i){var n=new CAAT.Math.Matrix3;return n.setTranslate(t,e,i),n},setScale:function(t,e,i){return this.identity(),this.matrix[0][0]=t,this.matrix[1][1]=e,this.matrix[2][2]=i,this},scale:function(t,e,i){var n=new CAAT.Math.Matrix3;return n.setScale(t,e,i),n},rotateModelView:function(t,e,i){var n=Math.sin(t),s=Math.sin(e),r=Math.sin(i),a=Math.cos(t),o=Math.cos(e),h=Math.cos(i);return this.matrix[0][0]=o*a,this.matrix[0][1]=-o*n,this.matrix[0][2]=s,this.matrix[0][3]=0,this.matrix[1][0]=r*s*a+n*h,this.matrix[1][1]=h*a-r*s*n,this.matrix[1][2]=-r*o,this.matrix[1][3]=0,this.matrix[2][0]=r*n-h*s*a,this.matrix[2][1]=h*s*n+r*a,this.matrix[2][2]=h*o,this.matrix[2][3]=0,this.matrix[3][0]=0,this.matrix[3][1]=0,this.matrix[3][2]=0,this.matrix[3][3]=1,this},copy:function(t){for(var e=0;4>e;e++)for(var i=0;4>i;i++)this.matrix[e][i]=t.matrix[e][i];return this},calculateDeterminant:function(){var t=this.matrix,e=t[0][0],i=t[0][1],n=t[0][2],s=t[0][3],r=t[1][0],a=t[1][1],o=t[1][2],h=t[1][3],l=t[2][0],u=t[2][1],c=t[2][2],d=t[2][3],A=t[3][0],f=t[3][1],g=t[3][2],p=t[3][3];return s*a*c*A+i*h*c*A+s*o*l*f+n*h*l*f+n*r*d*f+e*o*d*f+s*r*u*g+e*h*u*g+n*a*l*p+i*o*l*p+i*r*c*p+e*a*c*p+s*o*u*A-n*h*u*A-n*a*d*A-i*o*d*A-s*r*c*f-e*h*c*f-s*a*l*g-i*h*l*g-i*r*d*g-e*a*d*g-n*r*u*p-e*o*u*p},getInverse:function(){var t=this.matrix,e=t[0][0],i=t[0][1],n=t[0][2],s=t[0][3],r=t[1][0],a=t[1][1],o=t[1][2],h=t[1][3],l=t[2][0],u=t[2][1],c=t[2][2],d=t[2][3],A=t[3][0],f=t[3][1],g=t[3][2],p=t[3][3],m=new CAAT.Math.Matrix3;return m.matrix[0][0]=o*d*f+h*u*g+a*c*p-h*c*f-a*d*g-o*u*p,m.matrix[0][1]=s*c*f+i*d*g+n*u*p-i*c*p-n*d*f-s*u*g,m.matrix[0][2]=n*h*f+i*o*p+s*a*g-i*h*g-n*a*p-s*o*f,m.matrix[0][3]=s*o*u+i*h*c+n*a*d-n*h*u-s*a*c-i*o*d,m.matrix[1][0]=h*c*A+r*d*g+o*l*p-o*d*A-h*l*g-r*c*p,m.matrix[1][1]=n*d*A+s*l*g+e*c*p-s*c*A-e*d*g-n*l*p,m.matrix[1][2]=s*o*A+e*h*g+n*r*p-n*h*A-s*r*g-e*o*p,m.matrix[1][3]=n*h*l+s*r*c+e*o*d-s*o*l-e*h*c-n*r*d,m.matrix[2][0]=a*d*A+h*l*f+r*u*p-h*u*A-r*d*f-a*l*p,m.matrix[2][1]=s*u*A+e*d*f+i*l*p-e*u*p-i*d*A-s*l*f,m.matrix[2][2]=n*h*A+s*r*f+e*a*p-s*a*A-e*h*f-i*r*p,m.matrix[2][3]=s*a*l+e*h*u+i*r*d-e*a*d-i*h*l-s*r*u,m.matrix[3][0]=o*u*A+r*c*f+a*l*g-a*c*A-o*l*f-r*u*g,m.matrix[3][1]=i*c*A+n*l*f+e*u*g-n*u*A-e*c*f-i*l*g,m.matrix[3][2]=n*a*A+e*o*f+i*r*g-e*a*g-i*o*A-n*r*f,m.matrix[3][3]=i*o*l+n*r*u+e*a*c-n*a*l-e*o*u-i*r*c,m.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(t){var e,i;for(e=0;4>e;e++)for(i=0;4>i;i++)this.matrix[e][i]*=t;return this}}}}),CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(t,e,i){return this.x=t,this.y=e,this.z=i||0,this},set:function(t,e,i){return this.x=t,this.y=e,this.z=i||0,this},clone:function(){var t=new CAAT.Math.Point(this.x,this.y,this.z);return t},translate:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},translatePoint:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this},rotate:function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-Math.sin(t)*i,this.y=e*Math.sin(t)+Math.cos(t)*i,this.z=0,this},setAngle:function(t){var e=this.getLength();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this.z=0,this},setLength:function(t){var e=this.getLength();return e?this.multiply(t/e):this.x=this.y=this.z=t,this},normalize:function(){var t=this.getLength();return this.x/=t,this.y/=t,this.z/=t,this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(t){var e=this.getLengthSquared();if(e+.01>t*t){var i=Math.sqrt(e);this.x=this.x/i*t,this.y=this.y/i*t,this.z=this.z/i*t}return this},getLength:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return.005>t&&t>-.005?1e-6:t},getLengthSquared:function(){var t=this.x*this.x+this.y*this.y+this.z*this.z;return.005>t&&t>-.005?0:t},getDistance:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)},getDistanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},toString:function(){return"(CAAT.Math.Point) x:"+(Math.round(Math.floor(10*this.x))/10+"")+" y:"+(Math.round(Math.floor(10*this.y))/10+"")+" z:"+(Math.round(Math.floor(10*this.z))/10+"")}}}}),CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(t,e,i,n){this.setLocation(t,e),this.setDimension(i,n)},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){return this.width=-1,this.height=-1,this.x=0,this.y=0,this.x1=0,this.y1=0,this},setLocation:function(t,e){return this.x=t,this.y=e,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setDimension:function(t,e){return this.width=t,this.height=e,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setBounds:function(t,e,i,n){return this.setLocation(t,e),this.setDimension(i,n),this},contains:function(t,e){return t>=this.x&&this.x1>t&&e>=this.y&&this.y1>e},isEmpty:function(){return-1===this.width&&-1===this.height},union:function(t,e){return this.isEmpty()?(this.x=t,this.x1=t,this.y=e,this.y1=e,this.width=0,this.height=0,void 0):(this.x1=this.x+this.width,this.y1=this.y+this.height,this.y>e&&(this.y=e),this.x>t&&(this.x=t),e>this.y1&&(this.y1=e),t>this.x1&&(this.x1=t),this.width=this.x1-this.x,this.height=this.y1-this.y,void 0)},unionRectangle:function(t){return this.union(t.x,t.y),this.union(t.x1,t.y),this.union(t.x,t.y1),this.union(t.x1,t.y1),this},intersects:function(t){return t.isEmpty()||this.isEmpty()?!1:t.x1<=this.x?!1:t.x>=this.x1?!1:t.y1<=this.y?!1:t.y<this.y1},intersectsRect:function(t,e,i,n){if(-1===i||-1===n)return!1;
var s=t+i-1,r=e+n-1;return this.x>s?!1:t>this.x1?!1:this.y>r?!1:this.y1>=e},intersect:function(t,e){return e===void 0&&(e=new CAAT.Math.Rectangle),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.x1=Math.min(this.x1,t.x1),e.y1=Math.min(this.y1,t.y1),e.width=e.x1-e.x,e.height=e.y1-e.y,e}}}}),CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!1),"Linear pingpong=false, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!1),"Linear pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!0),"Linear pingpong=false, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!0),"Linear pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!1),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!1),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!1),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!0),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!0),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!0),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!1),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!1),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!1),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!0),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!0),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!0),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!1),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!1),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!1),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!0),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!0),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!0),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!1),"BounceIn pingpong=false",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!1),"BounceOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!1),"BounceInOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!0),"BounceIn pingpong=true",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!0),"BounceOut pingpong=true",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!0),"BounceInOut pingpong=true",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!1),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!1),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!1),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!0),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!0),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!0),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!1),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!1),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!1),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!0),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!0),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!0),"ElasticInOut pingpong=true, amp=1.0, d=.2"]}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){return this.interpolated=new CAAT.Math.Point(0,0,0),this},createLinearInterpolator:function(t,e){return this.getPosition=function(i){var n=i;return t&&(.5>i?i*=2:i=1-2*(i-.5)),null!==e&&e&&(i=1-i),this.interpolated.set(n,i)},this},createBackOutInterpolator:function(t){return this.getPosition=function(e){var i=e;t&&(.5>e?e*=2:e=1-2*(e-.5)),e-=1;var n=1.70158;return this.interpolated.set(i,e*e*((n+1)*e+n)+1)},this},createExponentialInInterpolator:function(t,e){return this.getPosition=function(i){var n=i;return e&&(.5>i?i*=2:i=1-2*(i-.5)),this.interpolated.set(n,Math.pow(i,t))},this},createExponentialOutInterpolator:function(t,e){return this.getPosition=function(i){var n=i;return e&&(.5>i?i*=2:i=1-2*(i-.5)),this.interpolated.set(n,1-Math.pow(1-i,t))},this},createExponentialInOutInterpolator:function(t,e){return this.getPosition=function(i){var n=i;return e&&(.5>i?i*=2:i=1-2*(i-.5)),1>2*i?this.interpolated.set(n,Math.pow(2*i,t)/2):this.interpolated.set(n,1-Math.abs(Math.pow(2*i-2,t))/2)},this},createQuadricBezierInterpolator:function(t,e,i,n){return this.getPosition=function(s){var r=s;return n&&(.5>s?s*=2:s=1-2*(s-.5)),s=(1-s)*(1-s)*t.y+2*(1-s)*s*e.y+s*s*i.y,this.interpolated.set(r,s)},this},createCubicBezierInterpolator:function(t,e,i,n,s){return this.getPosition=function(r){var a=r;s&&(.5>r?r*=2:r=1-2*(r-.5));var o=r*r,h=r*o;return r=t.y+r*(3*-t.y+r*(3*t.y-t.y*r))+r*(3*e.y+r*(-6*e.y+3*e.y*r))+o*(3*i.y-3*i.y*r)+n.y*h,this.interpolated.set(a,r)},this},createElasticOutInterpolator:function(t,e,i){return this.getPosition=function(n){if(i&&(.5>n?n*=2:n=1-2*(n-.5)),0===n)return{x:0,y:0};if(1===n)return{x:1,y:1};var s=e/(2*Math.PI)*Math.asin(1/t);return this.interpolated.set(n,t*Math.pow(2,-10*n)*Math.sin((n-s)*2*Math.PI/e)+1)},this},createElasticInInterpolator:function(t,e,i){return this.getPosition=function(n){if(i&&(.5>n?n*=2:n=1-2*(n-.5)),0===n)return{x:0,y:0};if(1===n)return{x:1,y:1};var s=e/(2*Math.PI)*Math.asin(1/t);return this.interpolated.set(n,-(t*Math.pow(2,10*(n-=1))*Math.sin((n-s)*2*Math.PI/e)))},this},createElasticInOutInterpolator:function(t,e,i){return this.getPosition=function(n){i&&(.5>n?n*=2:n=1-2*(n-.5));var s=e/(2*Math.PI)*Math.asin(1/t);return n*=2,1>=n?this.interpolated.set(n,-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-s)*2*Math.PI/e)):this.interpolated.set(n,1+.5*t*Math.pow(2,-10*(n-=1))*Math.sin((n-s)*2*Math.PI/e))},this},bounce:function(t){return 1/2.75>(t/=1)?{x:t,y:7.5625*t*t}:2/2.75>t?{x:t,y:7.5625*(t-=1.5/2.75)*t+.75}:2.5/2.75>t?{x:t,y:7.5625*(t-=2.25/2.75)*t+.9375}:{x:t,y:7.5625*(t-=2.625/2.75)*t+.984375}},createBounceOutInterpolator:function(t){return this.getPosition=function(e){return t&&(.5>e?e*=2:e=1-2*(e-.5)),this.bounce(e)},this},createBounceInInterpolator:function(t){return this.getPosition=function(e){t&&(.5>e?e*=2:e=1-2*(e-.5));var i=this.bounce(1-e);return i.y=1-i.y,i},this},createBounceInOutInterpolator:function(t){return this.getPosition=function(e){t&&(.5>e?e*=2:e=1-2*(e-.5));var i;return.5>e?(i=this.bounce(1-2*e),i.y=.5*(1-i.y),i):(i=this.bounce(2*e-1,t),i.y=.5*i.y+.5,i)},this},paint:function(t){t.save(),t.beginPath(),t.moveTo(0,this.getPosition(0).y*this.paintScale);for(var e=0;this.paintScale>=e;e++)t.lineTo(e,this.getPosition(e/this.paintScale).y*this.paintScale);t.strokeStyle="black",t.stroke(),t.restore()},getContour:function(t){for(var e=[],i=0;t>=i;i++)e.push({x:i/t,y:this.getPosition(i/t).y});return e}}}}),CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var t=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1),e=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0);return{__init:function(){return this.lifecycleListenerList=[],this.setDefaultInterpolator(),this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:!1,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:!0,solved:!0,discardable:!1,setValueApplication:function(t){return this.doValueApplication=t,this},setTimeOffset:function(t){return this.timeOffset=t,this},setStatus:function(t){return this.status=t,this},setId:function(t){return this.id=t,this},setDefaultInterpolator:function(){return this.interpolator=t,this},setPingPong:function(){return this.interpolator=e,this},setFrameTime:function(t,e){return this.behaviorStartTime=t,this.behaviorDuration=e,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this},setDelayTime:function(t,e){return this.behaviorStartTime=t,this.behaviorDuration=e,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this.solved=!1,this.expired=!1,this},setOutOfFrameTime:function(){return this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.behaviorStartTime=Number.MAX_VALUE,this.behaviorDuration=0,this},setInterpolator:function(t){return this.interpolator=t,this},apply:function(t,e){this.solved||(this.behaviorStartTime+=t,this.solved=!0),t+=this.timeOffset*this.behaviorDuration;var i=t;this.isBehaviorInTime(t,e)&&(t=this.normalizeTime(t),this.fireBehaviorAppliedEvent(e,i,t,this.setForTime(t,e)))},setCycle:function(t){return this.cycleBehavior=t,this},addListener:function(t){return this.lifecycleListenerList.push(t),this},emptyListenerList:function(){return this.lifecycleListenerList=[],this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(t,e){var i=CAAT.Behavior.BaseBehavior.Status;return this.status===i.EXPIRED||0>this.behaviorStartTime?!1:(this.cycleBehavior&&t>=this.behaviorStartTime&&(t=(t-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime),t>this.behaviorStartTime+this.behaviorDuration?(this.status!==i.EXPIRED&&this.setExpired(e,t),!1):(this.status===i.NOT_STARTED&&(this.status=i.STARTED,this.fireBehaviorStartedEvent(e,t)),t>=this.behaviorStartTime))},fireBehaviorStartedEvent:function(t,e){for(var i=0,n=this.lifecycleListenerList.length;n>i;i++){var s=this.lifecycleListenerList[i];s.behaviorStarted&&s.behaviorStarted(this,e,t)}},fireBehaviorExpiredEvent:function(t,e){for(var i=0,n=this.lifecycleListenerList.length;n>i;i++){var s=this.lifecycleListenerList[i];s.behaviorExpired&&s.behaviorExpired(this,e,t)}},fireBehaviorAppliedEvent:function(t,e,i,n){for(var s=0,r=this.lifecycleListenerList.length;r>s;s++){var a=this.lifecycleListenerList[s];a.behaviorApplied&&a.behaviorApplied(this,e,i,t,n)}},normalizeTime:function(t){return t-=this.behaviorStartTime,this.cycleBehavior&&(t%=this.behaviorDuration),this.interpolator.getPosition(t/this.behaviorDuration).y},setExpired:function(t,e){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.setForTime(this.interpolator.getPosition(1).y,t),this.fireBehaviorExpiredEvent(t,e),this.discardable&&this.actor.removeBehavior(this)},setForTime:function(){},initialize:function(t){if(t)for(var e in t)this[e]=t[e];return this},getPropertyName:function(){return""}}}}),CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,getPropertyName:function(){return"opacity"},setForTime:function(t,e){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,t,e);var i=this.startAlpha+t*(this.endAlpha-this.startAlpha);return this.doValueApplication&&e.setAlpha(i),i},setValues:function(t,e){return this.startAlpha=t,this.endAlpha=e,this},calculateKeyFrameData:function(t){return t=this.interpolator.getPosition(t).y,this.startAlpha+t*(this.endAlpha-this.startAlpha)},calculateKeyFramesData:function(t,e,i){i===void 0&&(i=100),i>>=0;var n,s,r="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)s=""+100*(n/i)+"%"+"{"+"opacity: "+this.calculateKeyFrameData(n/i)+"}",r+=s;return r+="}"}}}}),CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{behaviors:null,__init:function(){return this.__super(),this.behaviors=[],this},conformToDuration:function(t){this.duration=t;for(var e,i=t/this.duration,n=0;this.behaviors.length>n;n++)e=this.behaviors[n],e.setFrameTime(e.getStartTime()*i,e.getDuration()*i);return this},getBehaviorById:function(t){for(var e=0;this.behaviors.length>e;e++)if(this.behaviors[e].id===t)return this.behaviors[e];return null},addBehavior:function(t){return this.behaviors.push(t),t.addListener(this),this},apply:function(t,e){if(this.solved||(this.behaviorStartTime+=t,this.solved=!0),t+=this.timeOffset*this.behaviorDuration,this.isBehaviorInTime(t,e)){t-=this.getStartTime(),this.cycleBehavior&&(t%=this.getDuration());for(var i=this.behaviors,n=0;i.length>n;n++)i[n].apply(t,e)}},behaviorExpired:function(t){this.cycleBehavior&&t.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)},setForTime:function(t,e){for(var i=this.behaviors,n=0;i.length>n;n++)i[n].setForTime(t,e);return null},setExpired:function(t,e){for(var i=this.behaviors,n=0;i.length>n;n++){var s=i[n];s.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&s.setExpired(t,e-this.behaviorStartTime)}return CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,t,e),this},setFrameTime:function(t,e){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,t,e);for(var i=this.behaviors,n=0;i.length>n;n++)i[n].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},setDelayTime:function(t,e){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,t,e);for(var i=this.behaviors,n=0;i.length>n;n++)i[n].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},calculateKeyFrameData:function(t,e,i){function n(t){l[t]?c+=l[t]:i&&(u=i[t],u&&(c+=u,l[t]=u))}var s,r,a,o,h,l={};for(s=0;this.behaviors.length>s;s++)r=this.behaviors[s],r.status===CAAT.Behavior.BehaviorConstants.Status.EXPIRED||r instanceof CAAT.Behavior.GenericBehavior||(a=t*this.behaviorDuration,a>=r.behaviorStartTime&&r.behaviorStartTime+r.behaviorDuration>=a&&(a=(a-r.behaviorStartTime)/r.behaviorDuration,o=r.calculateKeyFrameData(a),h=r.getPropertyName(e),l[h]===void 0&&(l[h]=""),l[h]+=o+" "));var u,c="";n("translate"),n("rotate"),n("scale");var d="";return c&&(d="-"+e+"-transform: "+c+";"),c="",n("opacity"),c&&(d+=" opacity: "+c+";"),{rules:d,ret:l}},calculateKeyFramesData:function(t,e,i){if(this.duration===Number.MAX_VALUE)return"";i===void 0&&(i=100);var n,s,r,a,o=null,h="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)r=this.interpolator.getPosition(n/i).y,s=this.calculateKeyFrameData(r,t,o),a=""+100*(n/i)+"%"+"{"+s.rules+"}\n",o=s.ret,h+=a;return h+="}"}}}}),CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(t,e){var i=this.start+t*(this.end-this.start);this.callback&&this.callback(i,this.target,e),this.property&&(this.target[this.property]=i)},setValues:function(t,e,i,n,s){return this.start=t,this.end=e,this.target=i,this.property=n,this.callback=s,this}}}}),CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{path:null,autoRotate:!1,prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,getPropertyName:function(){return"translate"},setAutoRotate:function(t,e){return this.autoRotate=t,void 0!==e&&(this.autoRotateOp=e),this},setPath:function(t){return this.path=t,this},setValues:function(t){return this.setPath(t)},setTranslation:function(){return this},calculateKeyFrameData:function(t){t=this.interpolator.getPosition(t).y;var e=this.path.getPosition(t);return"translateX("+e.x+"px) translateY("+e.y+"px)"},calculateKeyFramesData:function(t,e,i){i===void 0&&(i=100),i>>=0;var n,s,r="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)s=""+100*(n/i)+"%"+"{"+"-"+t+"-transform:"+this.calculateKeyFrameData(n/i)+"}",r+=s;return r+="}"},setForTime:function(t,e){if(!this.path)return{x:e.x,y:e.y};var i=this.path.getPosition(t);if(this.autoRotate){-1===this.prevX&&-1===this.prevY&&(this.prevX=i.x,this.prevY=i.y);var n=i.x-this.prevX,s=i.y-this.prevY;if(0===n&&0===s)return e.setLocation(i.x,i.y),{x:e.x,y:e.y};var r=Math.atan2(s,n),a=CAAT.Foundation.SpriteImage,o=CAAT.Behavior.PathBehavior.autorotate;this.autoRotateOp===o.LEFT_TO_RIGHT?this.prevX<=i.x?e.setImageTransformation(a.TR_NONE):(e.setImageTransformation(a.TR_FLIP_HORIZONTAL),r+=Math.PI):this.autoRotateOp===o.RIGHT_TO_LEFT&&(this.prevX<=i.x?e.setImageTransformation(a.TR_FLIP_HORIZONTAL):(e.setImageTransformation(a.TR_NONE),r-=Math.PI)),e.setRotation(r),this.prevX=i.x,this.prevY=i.y;var h=Math.sqrt(n*n+s*s);n/=h,s/=h}return this.doValueApplication?(e.setLocation(i.x,i.y),{x:e.x,y:e.y}):{x:i.x,y:i.y}},positionOnTime:function(t){return this.isBehaviorInTime(t,null)?(t=this.normalizeTime(t),this.path.getPosition(t)):{x:-1,y:-1}}}}}),CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startAngle:0,endAngle:0,anchorX:.5,anchorY:.5,getPropertyName:function(){return"rotate"},setForTime:function(t,e){var i=this.startAngle+t*(this.endAngle-this.startAngle);return this.doValueApplication&&e.setRotationAnchored(i,this.anchorX,this.anchorY),i},setValues:function(t,e,i,n){return this.startAngle=t,this.endAngle=e,i!==void 0&&n!==void 0&&(this.anchorX=i,this.anchorY=n),this},setAngles:function(t,e){return this.setValues(t,e)},setAnchor:function(t,e,i){return this.anchorX=e/t.width,this.anchorY=i/t.height,this},calculateKeyFrameData:function(t){return t=this.interpolator.getPosition(t).y,"rotate("+(this.startAngle+t*(this.endAngle-this.startAngle))+"rad)"},calculateKeyFramesData:function(t,e,i){i===void 0&&(i=100),i>>=0;var n,s,r="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)s=""+100*(n/i)+"%"+"{"+"-"+t+"-transform:"+this.calculateKeyFrameData(n/i)+"}\n",r+=s;return r+="}"}}}}),CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScale:1,endScale:1,anchorX:.5,anchorY:.5,sx:1,sy:1,applyOnX:!0,applyOnAxis:function(t){this.applyOnX=t===CAAT.Behavior.Scale1Behavior.Axis.X?!1:!0},getPropertyName:function(){return"scale"},setForTime:function(t,e){var i=this.startScale+t*(this.endScale-this.startScale);return 0===i&&(i=.01),this.doValueApplication&&(this.applyOnX?e.setScaleAnchored(i,e.scaleY,this.anchorX,this.anchorY):e.setScaleAnchored(e.scaleX,i,this.anchorX,this.anchorY)),i},setValues:function(t,e,i,n,s){return this.startScale=t,this.endScale=e,this.applyOnX=!!i,n!==void 0&&s!==void 0&&(this.anchorX=n,this.anchorY=s),this},setAnchor:function(t,e,i){return this.anchorX=e/t.width,this.anchorY=i/t.height,this},calculateKeyFrameData:function(t){var e;return t=this.interpolator.getPosition(t).y,e=this.startScale+t*(this.endScale-this.startScale),this.applyOnX?"scaleX("+e+")":"scaleY("+e+")"},calculateKeyFramesData:function(t,e,i){i===void 0&&(i=100),i>>=0;var n,s,r="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)s=""+100*(n/i)+"%"+"{"+"-"+t+"-transform:"+this.calculateKeyFrameData(n/i)+"}",r+=s;return r+="}"}}}}),CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:.5,anchorY:.5,getPropertyName:function(){return"scale"},setForTime:function(t,e){var i=this.startScaleX+t*(this.endScaleX-this.startScaleX),n=this.startScaleY+t*(this.endScaleY-this.startScaleY);return 0===i&&(i=.01),0===n&&(n=.01),this.doValueApplication&&e.setScaleAnchored(i,n,this.anchorX,this.anchorY),{scaleX:i,scaleY:n}},setValues:function(t,e,i,n,s,r){return this.startScaleX=t,this.endScaleX=e,this.startScaleY=i,this.endScaleY=n,s!==void 0&&r!==void 0&&(this.anchorX=s,this.anchorY=r),this},setAnchor:function(t,e,i){return this.anchorX=e/t.width,this.anchorY=i/t.height,this},calculateKeyFrameData:function(t){var e,i;return t=this.interpolator.getPosition(t).y,e=this.startScaleX+t*(this.endScaleX-this.startScaleX),i=this.startScaleY+t*(this.endScaleY-this.startScaleY),"scaleX("+e+") scaleY("+i+")"},calculateKeyFramesData:function(t,e,i){i===void 0&&(i=100),i>>=0;var n,s,r="@-"+t+"-keyframes "+e+" {";for(n=0;i>=n;n++)s=""+100*(n/i)+"%"+"{"+"-"+t+"-transform:"+this.calculateKeyFrameData(n/i)+"}",r+=s;return r+="}"}}}}),CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function t(t){for(var e=0;t.length>e;e++){var i=t[e].string,n=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,i){if(-1!==i.indexOf(t[e].subString))return t[e].identity}else if(n)return t[e].identity}}function e(t){var e=t.indexOf(this.versionSearchString);if(-1!==e)return parseFloat(t.substring(e+this.versionSearchString.length+1))}var i=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],n=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],s=t(i)||"An unknown browser",r=e(navigator.userAgent)||e(navigator.appVersion)||"an unknown version",a=t(n)||"an unknown OS",o=window.devicePixelRatio||1;return{browser:s,version:r,OS:a,DevicePixelRatio:o}}}),CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",depends:["CAAT.Module.Runtime.BrowserInfo"],extendsWith:function(){return{__init:function(){return this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this},musicChannel:null,browserInfo:null,musicEnabled:!0,fxEnabled:!0,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(t){this.audioCache=[],this.channels=[],this.workingChannels=[];for(var e=0;t>=e;e++){var i=document.createElement("audio");if(null!==i){i.finished=-1,this.channels.push(i);var n=this;i.addEventListener("ended",function(t){var e,i=t.target;for(e=0;n.workingChannels.length>e;e++)if(n.workingChannels[e]===i){n.workingChannels.splice(e,1);break}i.caat_callback&&i.caat_callback(i.caat_id),n.channels.push(i)},!1)}}return this.musicChannel=this.channels.pop(),this},addAudioFromURL:function(t,e,i){var n=null,s=document.createElement("audio");if(null!==s){if(!s.canPlayType)return!1;n=e.substr(e.lastIndexOf(".")+1);var r=s.canPlayType(this.audioTypes[n]);if(""!==r&&"no"!==r)return s.src=e,s.preload="auto",s.load(),i&&(s.caat_callback=i,s.caat_id=t),this.audioCache.push({id:t,audio:s}),!0}return!1},addAudioFromDomNode:function(t,e,i){var n=e.src.substr(e.src.lastIndexOf(".")+1);return e.canPlayType(this.audioTypes[n])?(i&&(e.caat_callback=i,e.caat_id=t),this.audioCache.push({id:t,audio:e}),!0):!1},addAudioElement:function(t,e,i){if("string"==typeof e)return this.addAudioFromURL(t,e,i);try{if(e instanceof HTMLAudioElement)return this.addAudioFromDomNode(t,e,i)}catch(n){}return!1},addAudio:function(t,e,i){if(e instanceof Array)for(var n=0;e.length>n&&!this.addAudioElement(t,e[n],i);n++);else this.addAudioElement(t,e,i);return this},getAudio:function(t){for(var e=0;this.audioCache.length>e;e++)if(this.audioCache[e].id===t)return this.audioCache[e].audio;return null},stopMusic:function(){this.musicChannel.pause()},playMusic:function(t){if(!this.musicEnabled)return null;var e=this.getAudio(t);if(null!==e){var i=this.musicChannel;if(null!==i)return i.src=e.src,i.preload="auto","Firefox"===this.browserInfo.browser?i.addEventListener("ended",function(t){var e=t.target;e.currentTime=0},!1):i.loop=!0,i.load(),i.play(),i}return null},setVolume:function(t,e){var i=this.getAudio(t);return null!=i&&(i.volume=e),this},play:function(t){if(!this.fxEnabled)return null;var e=this.getAudio(t);if(null!==e&&this.channels.length>0){var i=this.channels.shift();i.src=e.src,i.volume=e.volume,i.play(),this.workingChannels.push(i)}return e},cancelPlay:function(t){for(var e=0;this.workingChannels.length;e++){var i=this.workingChannels[e];i.caat_id===t&&(i.pause(),this.channels.push(i),this.workingChannels.splice(e,1))}return this},cancelPlayByChannel:function(t){for(var e=0;this.workingChannels.length;e++)if(this.workingChannels[e]===t)return this.channels.push(t),this.workingChannels.splice(e,1),this;return this},loop:function(t){if(!this.musicEnabled)return null;var e=this.getAudio(t);if(null!==e){var i=document.createElement("audio");if(null!==i)return i.src=e.src,i.preload="auto","Firefox"===this.browserInfo.browser?i.addEventListener("ended",function(t){var e=t.target;e.currentTime=0},!1):i.loop=!0,i.load(),i.play(),this.loopingChannels.push(i),i}return null},endSound:function(){var t;for(t=0;this.workingChannels.length>t;t++)this.workingChannels[t].pause(),this.channels.push(this.workingChannels[t]);for(t=0;this.loopingChannels.length>t;t++)this.loopingChannels[t].pause();return this.workingChannels=[],this.loopingChannels=[],this.stopMusic(),this},setSoundEffectsEnabled:function(t){this.fxEnabled=t;for(var e=0;this.loopingChannels.length>e;e++)t?this.loopingChannels[e].play():this.loopingChannels[e].pause();return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(t){return this.musicEnabled=t,this.stopMusic(),this},isMusicEnabled:function(){return this.musicEnabled}}}}),CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(i){}return this},load:function(t,e){try{var i=localStorage.getItem(t);return null===i?e:JSON.parse(i)}catch(n){return null}},remove:function(t){try{localStorage.removeItem(t)}catch(e){}return this}},extendsWith:{}}),CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(t,e,i){var n,s,r,a,o,h,l,u;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),e/=100,i/=100,0===e)return n=s=r=i,[Math.round(255*n),Math.round(255*s),Math.round(255*r)];switch(t/=60,a=Math.floor(t),o=t-a,h=i*(1-e),l=i*(1-e*o),u=i*(1-e*(1-o)),a){case 0:n=i,s=u,r=h;break;case 1:n=l,s=i,r=h;break;case 2:n=h,s=i,r=u;break;case 3:n=h,s=l,r=i;break;case 4:n=u,s=h,r=i;break;default:n=i,s=h,r=l}return new CAAT.Module.ColorUtil.Color(Math.round(255*n),Math.round(255*s),Math.round(255*r))},interpolate:function(t,e,i,n,s,r,a,o){var h,l,u;return 0>=o?{r:t,g:e,b:i}:o>=a?{r:n,g:s,b:r}:(h=t+(n-t)/a*o>>0,l=e+(s-e)/a*o>>0,u=i+(r-i)/a*o>>0,h>255?h=255:0>h&&(h=0),l>255?l=255:0>l&&(l=0),u>255?u=255:0>u&&(u=0),{r:h,g:l,b:u})},makeRGBColorRamp:function(t,e,i){var n,s,r,a,o,h,l,u,c,d,A,f,g,p,m,v,C,T,x,_,y=[],b=t.length-1,w=e/b;for(n=0;b>n;n+=1)for(l=t[n],u=255&l>>24,c=(16711680&l)>>16,d=(65280&l)>>8,A=255&l,f=t[n+1],g=255&f>>24,p=(16711680&f)>>16,m=(65280&f)>>8,v=255&f,C=(g-u)/w,T=(p-c)/w,x=(m-d)/w,_=(v-A)/w,s=0;w>s;s+=1){r=u+C*s>>0,a=c+T*s>>0,o=d+x*s>>0,h=A+_*s>>0;var M=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(i){case M.RAMP_RGBA:y.push("argb("+r+","+a+","+o+","+h+")");break;case M.RAMP_RGB:y.push("rgb("+a+","+o+","+h+")");break;case M.RAMP_CHANNEL_RGB:y.push(4278190080|a<<16|o<<8|h);break;case M.RAMP_CHANNEL_RGBA:y.push(r<<24|a<<16|o<<8|h);break;case M.RAMP_CHANNEL_RGBA_ARRAY:y.push([a,o,h,r]);break;case M.RAMP_CHANNEL_RGB_ARRAY:y.push([a,o,h])}}return y},random:function(){for(var t="0123456789abcdef",e="#",i=0;3>i;i++)e+=t[Math.random()*t.length>>0];return e}},extendsWith:{__init:function(t,e,i){return this.r=t||255,this.g=e||255,this.b=i||255,this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}}),CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:!1,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',setScale:function(t){return this.scale=t,this
},initialize:function(w,h){w=window.innerWidth,this.width=w,this.height=h,this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1e3,fpsMax:0};var debugContainer=document.getElementById("caat-debug");if(!debugContainer){var wrap=document.createElement("div");wrap.innerHTML=this.debugTpl,document.body.appendChild(wrap),eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}return this.canvas=document.getElementById("caat-debug-canvas"),null===this.canvas?(this.canDebug=!1,void 0):(this.canvas.width=w,this.canvas.height=h,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.textDiscardDR=document.getElementById("textDiscardDR"),this.canDebug=!0,this)},debugInfo:function(t){this.statistics=t;var e=CAAT;if(this.frameTimeAcc+=e.FRAME_TIME,this.frameRAFAcc+=e.REQUEST_ANIMATION_FRAME_TIME,this.framerate.frames++,e.RAF>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=0|1e3*this.framerate.frames/(e.RAF-this.framerate.timeLastRefresh),this.framerate.fpsMin=this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin,this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps),this.textFPS.innerHTML=this.framerate.fps;var i=(0|100*this.frameTimeAcc/this.framerate.frames)/100;this.frameTimeAcc=0,this.textDrawTime.innerHTML=i;var n=(0|100*this.frameRAFAcc/this.framerate.frames)/100;this.frameRAFAcc=0,this.textRAFTime.innerHTML=n,this.framerate.timeLastRefresh=e.RAF,this.framerate.frames=0,this.paint(n)}this.textEntitiesTotal.innerHTML=this.statistics.size_total,this.textEntitiesActive.innerHTML=this.statistics.size_active,this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects,this.textDraws.innerHTML=this.statistics.draws,this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(t){var e=this.ctx,i=0;e.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height),e.strokeStyle="black",e.beginPath(),e.moveTo(this.width-.5,0),e.lineTo(this.width-.5,this.height),e.stroke(),e.strokeStyle="#a22",e.beginPath(),i=this.height-(20/this.SCALE*this.height>>0)-.5,e.moveTo(.5,i),e.lineTo(this.width+.5,i),e.stroke(),e.strokeStyle="#aa2",e.beginPath(),i=this.height-(30/this.SCALE*this.height>>0)-.5,e.moveTo(.5,i),e.lineTo(this.width+.5,i),e.stroke();var n=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);-1===this.framerate.prevFps&&(this.framerate.prevFps=0|n),e.strokeStyle="#0ff",e.beginPath(),e.moveTo(this.width,(0|n)-.5),e.lineTo(this.width,this.framerate.prevFps-.5),e.stroke(),this.framerate.prevFps=n;var s=(this.height-t/this.SCALE*this.height>>0)-.5;e.strokeStyle="#ff0",e.beginPath(),e.moveTo(this.width,s),e.lineTo(this.width,s),e.stroke()}}}),CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(t){var e;if(CAAT.CSS_TEXT_METRICS)try{return e=CAAT.Module.Font.Font.getFontMetricsCSS(t)}catch(i){}return CAAT.Module.Font.Font.getFontMetricsNoCSS(t)},getFontMetricsNoCSS:function(t){var e,i=/(\d+)p[x|t]/i,n=i.exec(t);e=n?0|n[1]:32;var s=e-1,r=0|e+.2*e;return{height:r,ascent:s,descent:r-s}},getFontMetricsCSS:function(t){function e(t){var e,i,n,s,r,a,o,h,l,u,c=t&&t.ownerDocument;return i=c.documentElement,e=t.getBoundingClientRect(),n=document.body,s=9===c.nodeType?c.defaultView||c.parentWindow:!1,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,o=s.pageYOffset||i.scrollTop,h=s.pageXOffset||i.scrollLeft,l=e.top+o-r,u=e.left+h-a,{top:l,left:u}}try{var i=document.createElement("span");i.style.font=t,i.innerHTML="Hg";var n=document.createElement("div");n.style.display="inline-block",n.style.width="1px",n.style.heigh="0px";var s=document.createElement("div");s.appendChild(i),s.appendChild(n);var r=document.body;r.appendChild(s);try{var a={};return n.style.verticalAlign="baseline",a.ascent=e(n).top-e(i).top,n.style.verticalAlign="bottom",a.height=e(n).top-e(i).top,a.ascent=Math.ceil(a.ascent),a.height=Math.ceil(a.height),a.descent=a.height-a.ascent,a}finally{r.removeChild(s)}}catch(o){return null}}},extendsWith:function(){var t=10;return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,ascent:0,descent:0,setPadding:function(t){return this.padding=t,this},setFontStyle:function(t){return this.fontStyle=t,this},setStrokeSize:function(t){return this.strokeSize=t,this},setFontSize:function(t){return this.fontSize=t,this.fontSizeUnit="px",this},setFont:function(t){return this.font=t,this},setFillStyle:function(t){return this.fillStyle=t,this},setStrokeStyle:function(t){return this.strokeStyle=t,this},createDefault:function(t){for(var e="",i=32;128>i;i++)e+=String.fromCharCode(i);return this.create(e,t)},create:function(t,e){e=0|e,this.padding=e;var i=document.createElement("canvas"),n=i.getContext("2d");n.textBaseline="bottom",n.font=this.fontStyle+" "+this.fontSize+this.fontSizeUnit+" "+this.font;var s,r,a,o=0,h=[];for(s=0;t.length>s;s++){var l=Math.max(1,(n.measureText(t.charAt(s)).width>>0)+1)+2*e;h.push(l),o+=l}var u,c,d=CAAT.Font.getFontMetrics(n.font),A="alphabetic";for(c=d.height,this.ascent=d.ascent,this.descent=d.descent,this.height=d.height,u=d.ascent,i.width=o,i.height=c,n=i.getContext("2d"),n.textBaseline=A,n.font=this.fontStyle+" "+this.fontSize+this.fontSizeUnit+" "+this.font,n.fillStyle=this.fillStyle,n.strokeStyle=this.strokeStyle,this.charMap={},r=0,s=0;t.length>s;s++)a=t.charAt(s),n.fillText(a,r+e,u),this.strokeStyle&&(n.beginPath(),n.lineWidth=this.strokeSize,n.strokeText(a,r+e,u)),this.charMap[a]={x:r+e,width:h[s]-2*e},r+=h[s];return this.image=i,this},setAsSpriteImage:function(){var t=[],e=0;for(var i in this.charMap){var n=i,s=this.charMap[i];t[i]={id:e++,height:this.height,xoffset:0,letter:n,yoffset:0,width:s.width,xadvance:s.width,x:s.x,y:0}}return this.spriteImage=(new CAAT.Foundation.SpriteImage).initializeAsGlyphDesigner(this.image,t),this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(e){var i,n,s,r=0;for(i=0,n=e.length;n>i;i++)s=this.charMap[e.charAt(i)],r+=s?s.width:t;return r},drawText:function(e,i,n,s){var r,a,o,h,l=this.image.height;for(r=0,a=e.length;a>r;r++)o=this.charMap[e.charAt(r)],o?(h=o.width,i.drawImage(this.image,o.x,0,h,l,n,s,h,l),n+=h):(i.strokeStyle="#f00",i.strokeRect(n,s,t,l),n+=t)},save:function(){var t="image/png",e=this.image.toDataURL(t);document.location.href=e.replace(t,"image/octet-stream")},drawSpriteText:function(t,e){this.spriteImage.drawSpriteText(t,e)}}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){return this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE,this.position=new CAAT.Math.Point(0,0,0),this.offset=new CAAT.Math.Point(0,0,0),this.targetPosition=new CAAT.Math.Point(0,0,0),this},id:0,delegate:null,position:null,offset:null,targetPosition:null,targetChaseSpeed:.02,isFixed:!1,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(t){var e=this.position.getDistanceSquared(t);return this.radiusSquared>e},getDistanceSquaredFromPosition:function(t){var e=this.position.getDistanceSquared(t);return this.radiusSquared>e},intersects:function(t){var e=this.position.getDistanceSquared(t.position);return this.radiusSquared>e||t.radiusSquared>e},setPosition:function(t){return this.position=t,this},setDelegate:function(t){return this.delegate=t,this},setOffset:function(t){return this.offset=t,this},setTargetPosition:function(t){return this.targetPosition=t,this},setTargetChaseSpeed:function(t){return this.targetChaseSpeed=t,this},setIsFixed:function(t){return this.isFixed=t,this},setCollisionMask:function(t){return this.collisionMask=t,this},setCollisionGroup:function(t){return this.collisionGroup=t,this},setRadius:function(t){return this.radius=t,this.radiusSquared=this.radius*this.radius,this},initialize:function(t){if(t)for(var e in t)this[e]=t[e];return this},dealloc:function(){this.position=null,this.offset=null,this.delegate=null,this.targetPosition=null}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(t){return t.id=this.allCircles.length,this.allCircles.push(t),this},removeCircle:function(t){var e=0,i=!1,n=this.allCircles.length;if(0===n)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";for(;n--;)if(this.allCircles[n]===t){i=!0,e=n;break}if(!i)throw"Could not locate circle in allCircles array!";return this.allCircles[e].dealloc(),this.allCircles[e]=null,this},forceCirclesToMatchDelegatePositions:function(){for(var t=this.allCircles.length,e=0;t>e;e++){var i=this.allCircles[e];i&&i.delegate&&i.position.set(i.delegate.x+i.offset.x,i.delegate.y+i.offset.y)}},pushAllCirclesTowardTarget:function(){for(var t=new CAAT.Math.Point(0,0,0),e=this.allCircles,i=e.length,n=0;this.numberOfTargetingPasses>n;n++)for(var s=0;i>s;s++){var r=e[s];r.isFixed||(t.x=r.position.x-(r.targetPosition.x+r.offset.x),t.y=r.position.y-(r.targetPosition.y+r.offset.y),t.multiply(r.targetChaseSpeed),r.position.x-=t.x,r.position.y-=t.y)}},handleCollisions:function(){this.removeExpiredElements();for(var t=new CAAT.Math.Point(0,0,0),e=this.allCircles,i=e.length,n=0;this.numberOfCollisionPasses>n;n++)for(var s=0;i>s;s++)for(var r=e[s],a=s+1;i>a;a++){var o=e[a];if(this.circlesCanCollide(r,o)){var h=o.position.x-r.position.x,l=o.position.y-r.position.y,u=1.08*(r.radius+o.radius),c=r.position.getDistanceSquared(o.position);if(u*u-.02>c){t.x=h,t.y=l,t.normalize();var d=.5*(u-Math.sqrt(c));t.multiply(d),o.isFixed||(r.isFixed&&t.multiply(2.2),o.position.translatePoint(t)),r.isFixed||(o.isFixed&&t.multiply(2.2),r.position.subtract(t))}}}},handleBoundaryForCircle:function(t,e){var i=t.position.x,n=t.position.y,s=t.radius,r=2*s,a=1,o=4,h=8,l=16;e=o|h,e&a&&i-r>this.bounds.right?t.position.x=this.bounds.left+s:e&a&&this.bounds.left>i+r&&(t.position.x=this.bounds.right-s),e&o&&n-r>this.bounds.bottom?t.position.y=this.bounds.top-s:e&o&&this.bounds.top>n+r&&(t.position.y=this.bounds.bottom+s),e&h&&i+s>=this.bounds.right?t.position.x=t.position.x=this.bounds.right-s:e&h&&this.bounds.left>i-s&&(t.position.x=this.bounds.left+s),e&l&&n+s>this.bounds.bottom?t.position.y=this.bounds.bottom-s:e&l&&this.bounds.top>n-s&&(t.position.y=this.bounds.top+s)},getCircleAt:function(t,e,i){for(var n=this.allCircles,s=n.length,r=new CAAT.Math.Point(t,e,0),a=null,o=Number.MAX_VALUE,h=0;s>h;h++){var l=n[h];if(l){var u=l.position.getDistanceSquared(r);o>u&&l.radiusSquared+i>u&&(o=u,a=l)}}return a},circlesCanCollide:function(t,e){return t&&e&&t!==e?!0:!1},setBounds:function(t,e,i,n){this.bounds.x=t,this.bounds.y=e,this.bounds.width=i,this.bounds.height=n},setNumberOfCollisionPasses:function(t){return this.numberOfCollisionPasses=t,this},setNumberOfTargetingPasses:function(t){return this.numberOfTargetingPasses=t,this},sortOnDistanceToTarget:function(t,e){var i=t.getDistanceSquaredFromPosition(t.targetPosition),n=e.getDistanceSquaredFromPosition(t.targetPosition),s=0;return i>n?s=-1:n>i&&(s=1),s},removeExpiredElements:function(){for(var t=this.allCircles.length;t>=0;t--)null===this.allCircles[t]&&this.allCircles.splice(t,1)},initialize:function(t){if(t)for(var e in t)this[e]=t[e];return this}}}),CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var t=function(t,e,i){var n=this;return this.id=t,this.path=e,this.image=new Image,this.image.onload=function(){i.__onload(n)},this.image.onerror=function(){i.__onerror(n)},this.load=function(){n.image.src=n.path},this};return{__init:function(){return this.elements=[],this},elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,addElement:function(e,i){return this.elements.push(new t(e,i,this)),this},__onload:function(t){this.cloaded&&this.cloaded(t.id),this.loadedCount++,this.loadedCount===this.elements.length&&this.cfinished&&this.cfinished(this.elements)},__onerror:function(t){this.cerrored&&this.cerrored(t.id)},load:function(t,e,i){this.cfinished=t,this.cloaded=e,this.cerroed=i;var n;for(n=0;this.elements.length>n;n++)this.elements[n].load();return this}}}}),CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){return this.images=[],this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(t,e,i){t||e&&e(0,[]);var n,s=this;for(this.notificationCallback=e,this.images=[],n=0;t.length>n;n++)this.images.push({id:t[n].id,image:new Image});for(n=0;t.length>n;n++)this.images[n].image.onload=function(){s.imageCounter++,s.notificationCallback(s.imageCounter,s.images)},this.images[n].image.onerror=function(t){return function(e){i&&i(e,t)}}(n),this.images[n].image.src=t[n].url;0===t.length&&e(0,[])}}}),CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(t,e,i,n,s){if(e>t){var r=t;t=e,e=r}var a=document.createElement("canvas");a.width=n.width,a.height=n.height*i;var o=a.getContext("2d");o.fillStyle=s?s:"rgba(255,255,255,0)",o.fillRect(0,0,n.width,n.height*i);var h;for(h=0;i>h;h++)o.globalAlpha=1-(t-e)/i*(h+1),o.drawImage(n,0,h*n.height);return a},rotate:function(t,e){if(e=e||0,!e)return t;var i=document.createElement("canvas");i.width=t.height,i.height=t.width;var n=i.getContext("2d");n.globalAlpha=1,n.fillStyle="rgba(0,0,0,0)",n.clearRect(0,0,i.width,i.height);var s=new CAAT.Math.Matrix;return s.multiply((new CAAT.Math.Matrix).setTranslate(i.width/2,i.width/2)),s.multiply((new CAAT.Math.Matrix).setRotation(e*Math.PI/180)),s.multiply((new CAAT.Math.Matrix).setTranslate(-i.width/2,-i.width/2)),s.transformRenderingContext(n),n.drawImage(t,0,0),i},optimize:function(t,e,i){e>>=0;var n=!0,s=!0,r=!0,a=!0;i!==void 0&&(i.top!==void 0&&(n=i.top),i.bottom!==void 0&&(s=i.bottom),i.left!==void 0&&(r=i.left),i.right!==void 0&&(a=i.right));var o=document.createElement("canvas");o.width=t.width,o.height=t.height;var h=o.getContext("2d");h.fillStyle="rgba(0,0,0,0)",h.fillRect(0,0,t.width,t.height),h.drawImage(t,0,0);var l,u,c=h.getImageData(0,0,t.width,t.height),d=c.data,A=0,f=o.height-1,g=0,p=o.width-1,m=!1;if(n){for(l=0;o.height>l;l++){for(u=0;o.width>u;u++)if(d[4*l*o.width+3+4*u]>e){m=!0;break}if(m)break}A=l}if(s){for(m=!1,l=o.height-1;l>=A;l--){for(u=0;o.width>u;u++)if(d[4*l*o.width+3+4*u]>e){m=!0;break}if(m)break}f=l}if(r){for(m=!1,u=0;o.width>u;u++){for(l=A;f>=l;l++)if(d[4*l*o.width+3+4*u]>e){m=!0;break}if(m)break}g=u}if(a){for(m=!1,u=o.width-1;u>=g;u--){for(l=A;f>=l;l++)if(d[4*l*o.width+3+4*u]>e){m=!0;break}if(m)break}p=u}if(0===g&&0===A&&o.width-1===p&&o.height-1===f)return o;var v=p-g+1,C=f-A+1,T=h.getImageData(g,A,v,C);return o.width=v,o.height=C,h=o.getContext("2d"),h.putImageData(T,0,0),o},createThumb:function(t,e,i,n){e=e||24,i=i||24;var s=document.createElement("canvas");s.width=e,s.height=i;var r=s.getContext("2d");if(n){var a=Math.max(t.width,t.height),o=t.width/a*e,h=t.height/a*i;r.drawImage(t,(e-o)/2,(i-h)/2,o,h)}else r.drawImage(t,0,0,e,i);return s}}}),CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){var t=1,e=32;return{bgActors:null,quadData:null,create:function(i,n,s,r,a,o,h){o===void 0&&(o=e),h===void 0&&(h=t);var l=(i+s)/2,u=(n+r)/2;return this.x=i,this.y=n,this.x1=s,this.y1=r,this.width=s-i,this.height=r-n,this.bgActors=this.__getOverlappingActorList(a),h>=this.bgActors.length||o>=this.width?this:(this.quadData=Array(4),this.quadData[0]=(new CAAT.Module.Collision.QuadTree).create(i,n,l,u,this.bgActors),this.quadData[1]=(new CAAT.Module.Collision.QuadTree).create(l,n,s,u,this.bgActors),this.quadData[2]=(new CAAT.Module.Collision.QuadTree).create(i,u,l,r,this.bgActors),this.quadData[3]=(new CAAT.Module.Collision.QuadTree).create(l,u,s,r,this.bgActors),this)},__getOverlappingActorList:function(t){for(var e=[],i=0,n=t.length;n>i;i++){var s=t[i];this.intersects(s.AABB)&&e.push(s)}return e},getOverlappingActors:function(t){var e,i,n,s,r,a=[],o=this.bgActors;if(this.quadData){for(e=0;4>e;e++)if(this.quadData[e].intersects(t))for(s=this.quadData[e].getOverlappingActors(t),i=0,n=s.length;n>i;i++)a.push(s[i])}else for(e=0,n=o.length;n>e;e++)r=o[e],t.intersects(r.AABB)&&a.push(r);return a}}}}),CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(t,e,i,n){var s,r;for(this.elements=[],s=0;i*n>s;s++)this.elements.push([]);for(this.width=t,this.height=e,this.rows=i,this.columns=n,this.xcache=[],s=0;t>s;s++)this.xcache.push(s/(t/n)>>0);for(this.ycache=[],s=0;e>s;s++)this.ycache.push(s/(e/i)>>0);for(this.xycache=[],s=0;this.rows>s;s++)for(this.xycache.push([]),r=0;this.columns>r;r++)this.xycache[s].push(r+s*n);return this.rectangle=(new CAAT.Math.Rectangle).setBounds(0,0,t,e),this.r0=new CAAT.Math.Rectangle,this.r1=new CAAT.Math.Rectangle,this},clearObject:function(){var t;for(t=0;this.rows*this.columns>t;t++)this.elements[t]=[];return this},addObject:function(t){for(var e=0|t.x,i=0|t.y,n=0|t.width,s=0|t.height,r=this.__getCells(e,i,n,s),a=0;r.length>a;a++)this.elements[r[a]].push(t)},__getCells:function(t,e,i,n){var s=[];if(this.rectangle.contains(t,e)&&s.push(this.xycache[this.ycache[e]][this.xcache[t]]),this.rectangle.contains(t+i-1,e+n-1)){var r=this.xycache[this.ycache[e+n-1]][this.xcache[t+i-1]];if(r===s[0])return s;s.push(r)}if(this.rectangle.contains(t+i-1,e)){var r=this.xycache[this.ycache[e]][this.xcache[t+i-1]];if(r===s[0]||r===s[1])return s;s.push(r)}if(this.rectangle.contains(t+i-1,e+n-1)){var r=this.xycache[this.ycache[e+n-1]][this.xcache[t]];s.push(r)}return s},solveCollision:function(t){var e;for(e=0;this.elements.length>e;e++){var i=this.elements[e];i.length>1&&this._solveCollisionCell(i,t)}},_solveCollisionCell:function(t,e){var i,n;for(i=0;t.length>i;i++){var s=t[i];for(this.r0.setBounds(s.x,s.y,s.width,s.height),n=i+1;t.length>n;n++){var r=t[n];this.r0.intersects(this.r1.setBounds(r.x,r.y,r.width,r.height))&&e(s,r)}}},collide:function(t,e,i,n,s){t|=0,e|=0,i|=0,n|=0;var r,a,o,h=this.__getCells(t,e,i,n),l=this.elements;for(this.r0.setBounds(t,e,i,n),r=0;h.length>r;r++){var u=h[r],c=l[u];for(a=0,o=c.length;o>a;a++){var d=c[a];if(this.r1.setBounds(d.x,d.y,d.width,d.height),this.r0.intersects(this.r1)&&s(d))return}}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:!1,image:null,u:0,v:0,glTexture:null}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(t){return this.freeChunks=[{position:0,size:t||1024}],this},freeChunks:null,findWhereFits:function(t){if(0===this.freeChunks.length)return[];var e,i=[];for(e=0;this.freeChunks.length>e;e++)for(var n=0;this.freeChunks[e].size>=n+t;)i.push(n+this.freeChunks[e].position),n+=t;return i},fits:function(t,e){var i=0;for(i=0;this.freeChunks.length>i;i++){var n=this.freeChunks[i];if(t>=n.position&&n.position+n.size>=t+e)return!0}return!1},substract:function(t,e){var i=0;for(i=0;this.freeChunks.length>i;i++){var n=this.freeChunks[i];if(t>=n.position&&n.position+n.size>=t+e){var s=0,r=0,a=0,o=0;return s=n.position,r=t-n.position,a=t+e,o=n.position+n.size-a,this.freeChunks.splice(i,1),r>0&&this.freeChunks.splice(i++,0,{position:s,size:r}),o>0&&this.freeChunks.splice(i,0,{position:a,size:o}),!0}}return!1},log:function(t){if(0===this.freeChunks.length)CAAT.log("index "+t+" empty");else{for(var e="index "+t,i=0;this.freeChunks.length>i;i++){var n=this.freeChunks[i];e+="["+n.position+","+n.size+"]"}CAAT.log(e)}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(t,e){this.scanMapHeight=e,this.scanMapWidth=t,this.scanMap=[];for(var i=0;this.scanMapHeight>i;i++)this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth));return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(t,e){if(t>this.width||e>this.height)return null;for(var i,n,s=0;this.scanMapHeight-e>=s;){for(var r=null,a=!1;this.scanMapHeight-e>=s;s++)if(r=this.scanMap[s].findWhereFits(t),null!==r&&r.length>0){a=!0;break}if(!a)return null;for(Number.MAX_VALUE,n=0;r.length>n;n++){var o=!0;for(i=s;s+e>i;i++)if(!this.scanMap[i].fits(r[n],t)){o=!1;break}if(o)return{x:r[n],y:s}}s++}return null},substract:function(t,e,i,n){for(var s=0;n>s;s++)this.scanMap[s+e].substract(t,i)||CAAT.log("Error: removing chunk ",i,n," at ",t,e)},log:function(){for(var t=0;this.scanMapHeight>t;t++)this.scanMap[t].log(t)}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(t,e){return this.width=t||1024,this.height=e||1024,this.images=[],this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:!1,padding:4,scan:null,images:null,criteria:"area",initialize:function(t){this.gl=t,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);for(var e=new Uint8Array(4*this.width*this.height),i=0;4*this.width*this.height>i;)e[i++]=0,e[i++]=0,e[i++]=0,e[i++]=0;t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,e),t.enable(t.BLEND);for(var n=0;this.images.length>n;n++){var s=this.images[n];s.inverted&&(s=CAAT.Module.Image.ImageUtil.rotate(s,-90)),t.texSubImage2D(t.TEXTURE_2D,0,this.images[n].__tx,this.images[n].__ty,t.RGBA,t.UNSIGNED_BYTE,s)}},create:function(t){for(var e=[],i=0;t.length>i;i++){var n=t[i].image;n.__texturePage||e.push(n)}this.createFromImages(e)},clear:function(){this.createFromImages([])},update:function(t,e,i,n){this.allowImagesInvertion=t,this.padding=e,100>i&&(i=100),100>n&&(n=100),this.width=i,this.height=n,this.createFromImages(this.images)},createFromImages:function(t){var e;if(this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height),this.images=[],this.allowImagesInvertion)for(e=0;t.length>e;e++)t[e].inverted=this.allowImagesInvertion&&t[e].height<t[e].width;var i=this;for(t.sort(function(t,e){var n=t.width*t.height,s=e.width*e.height;return"width"===i.criteria?t.width<e.width?1:t.width>e.width?-1:0:"height"===i.criteria?t.height<e.height?1:t.height>e.height?-1:0:s>n?1:n>s?-1:0}),e=0;t.length>e;e++){var n=t[e];this.packImage(n)}},addImage:function(t,e,i){this.allowImagesInvertion=e,this.padding=i,this.images.push(t),this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var t=this.gl;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D)},deletePage:function(){for(var t=0;this.images.length>t;t++)delete this.images[t].__texturePage,delete this.images[t].__u,delete this.images[t].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(t,e){t=t||document.createElement("canvas"),t.width=this.width,t.height=this.height;var i=t.getContext("2d");i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,this.width,this.height);for(var n=0;this.images.length>n;n++)i.drawImage(this.images[n].inverted?CAAT.Modules.Image.ImageUtil.rotate(this.images[n],90):this.images[n],this.images[n].__tx,this.images[n].__ty),e&&(i.strokeStyle="red",i.strokeRect(this.images[n].__tx,this.images[n].__ty,this.images[n].__w,this.images[n].__h));return e&&(i.strokeStyle="red",i.strokeRect(0,0,this.width,this.height)),t},packImage:function(t){var e,i;t.inverted?(e=t.height,i=t.width):(e=t.width,i=t.height);var n,s=e,r=i;s&&this.padding&&(n=this.padding,this.width>=s+n&&(s+=n)),r&&this.padding&&(n=this.padding,this.height>=r+n&&(r+=n));var a=this.scan.whereFitsChunk(s,r);null!==a?(this.images.push(t),t.__tx=a.x,t.__ty=a.y,t.__u=a.x/this.width,t.__v=a.y/this.height,t.__u1=(a.x+e)/this.width,t.__v1=(a.y+i)/this.height,t.__texturePage=this,t.__w=e,t.__h=i,this.scan.substract(a.x,a.y,s,r)):CAAT.log("Imagen ",t.src," de tamano ",t.width,t.height," no cabe.")},changeHeuristic:function(t){this.criteria=t}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){return this.pages=[],this},pages:null,createPages:function(t,e,i,n){for(var s=!1;!s;){var r=new CAAT.Module.TexturePacker.TexturePage(e,i);r.create(n),r.initialize(t),r.endCreation(),this.pages.push(r),s=!0;for(var a=0;n.length>a;a++)if(!n[a].image.__texturePage){e>=n[a].image.width&&i>=n[a].image.height&&(s=!1);break}}},deletePages:function(){for(var t=0;this.pages.length>t;t++)this.pages[t].deletePage();this.pages=null}}}),CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(t,e,i){var n=t.width,s=0,r=0,a=0,o=0,h=-Number.MAX_VALUE,l=Number.MAX_VALUE;for(a=e.length-1;a;a-=1)e[a].width>l&&(l=e[a].width),e[a].height>h&&(h=e[a].height);if(i.padding_left&&(s=i.padding_left,n-=s),i.padding_right&&(n-=i.padding_right),i.top){var u=parseInt(i.top,10);if(isNaN(u))switch(i.top){case"center":r=(t.height-h)/2;break;case"top":r=0;break;case"bottom":r=t.height-h;break;default:r=0}else r=u}var c=n/e.length;for(a=0,o=e.length;o>a;a++)e[a].setLocation(s+a*c+(c-e[a].width)/2,r)}}}),CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(t,e,i,n,s){var r,a=document.getElementById(i);if(CAAT.__CSS__)a&&!1==a instanceof HTMLDivElement&&(a=null),null===a&&(a=document.createElement("div"),document.body.appendChild(a)),r=(new CAAT.Foundation.Director).initialize(t||800,e||600,a);else{if(a){if(a instanceof HTMLDivElement){var o=document.createElement("canvas");a.appendChild(o),a=o}else if(0==a instanceof HTMLCanvasElement){var o=document.createElement("canvas");document.body.appendChild(o),a=o}}else a=document.createElement("canvas"),document.body.appendChild(a);r=(new CAAT.Foundation.Director).initialize(t||800,e||600,a)}(new CAAT.Module.Preloader.ImagePreloader).loadImages(n,function(t,e){t===e.length&&(r.emptyScenes(),r.setImagesCache(e),s(r),r.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4)),CAAT.loop(60))})}}}),CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(t,e,i,n,s,r,a,o){function h(t,e,i){var n=t.getImage("spinner"),s=t.getImage("splash"),r=t.createScene(),a=e,o=(new Date).getTime();return s&&r.addChild((new CAAT.Foundation.Actor).setBackgroundImage(s,!1).setBounds(0,0,t.width,t.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE)),n&&r.addChild((new CAAT.Foundation.Actor).setBackgroundImage(n).centerAt(r.width/2,r.height/2).addBehavior((new CAAT.Behavior.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1e3).setCycle(!0))),r.loadedImage=function(e,n){if(!n||e===n.length){var s=(new Date).getTime()-o;a>s?(s=Math.abs(a-s),s>a&&(s=a),setTimeout(function(){l(t,n,i)},s)):l(t,n,i)}},r}function l(t,e,i){t.emptyScenes(),t.setImagesCache(e),t.setClear(!0),i(t),t.setClear(CAAT.Foundation.Director.CLEAR_ALL),t.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4))}var u,c=document.getElementById(i);if(CAAT.__CSS__)c&&!1==c instanceof HTMLDivElement&&(c=null),null===c&&(c=document.createElement("div"),document.body.appendChild(c)),u=(new CAAT.Foundation.Director).initialize(t||800,e||600,c);else{if(c){if(c instanceof HTMLDivElement){var d=document.createElement("canvas");
c.appendChild(d),c=d}else if(0==c instanceof HTMLCanvasElement){var d=document.createElement("canvas");document.body.appendChild(d),c=d}}else c=document.createElement("canvas"),document.body.appendChild(c);u=(new CAAT.Foundation.Director).initialize(t||800,e||600,c)}var A=[];a&&A.push({id:"splash",url:a}),o&&A.push({id:"spinner",url:o}),u.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS),(new CAAT.Module.Preloader.ImagePreloader).loadImages(A,function(t,e){if(t===e.length){u.setImagesCache(e);var i=h(u,n||5e3,r);CAAT.loop(60),s&&s.length>0?(new CAAT.Module.Preloader.ImagePreloader).loadImages(s,i.loadedImage):i.loadedImage(0,null)}})}}}),CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){return this.bbox=new CAAT.Math.Rectangle,this},color:"#000",length:0,bbox:null,parent:null,setParent:function(t){return this.parent=t,this},setColor:function(t){return t&&(this.color=t),this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(){},setPoint:function(){},getPosition:function(){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(){},endPath:function(){},getContour:function(){},updatePath:function(){},applyAsPath:function(){},transform:function(){},drawHandle:function(t,e,i){t.beginPath(),t.arc(e,i,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,!1),t.fill()}}}}),CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,length:-1,cw:!0,bbox:null,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:!1,setRadius:function(t){return this.radius=t,this},isArcTo:function(){return this.arcTo},setArcTo:function(t){return this.arcTo=t,this},initialize:function(t,e,i,n){return this.setInitialPosition(t,e),this.setFinalPosition(t+i,e),this.angle=n||2*Math.PI,this},applyAsPath:function(t){var e=t.ctx;return this.arcTo?e.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):e.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw),this},setPoint:function(t,e){e>=0&&this.points.length>e&&(this.points[e]=t)},setPoints:function(t){return this.points=[],this.points[0]=t[0],this.points[1]=t[1],this.updatePath(),this},setClockWise:function(t){return this.cw=void 0!==t?t:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(t,e){for(var i=0,n=this.points.length;n>i;i++)this.points[0].x=t,this.points[0].y=e;return this},setFinalPosition:function(t,e){return this.points[1].x=t,this.points[1].y=e,this.updatePath(this.points[1]),this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(t){if((t>1||0>t)&&(t%=1),0>t&&(t=1+t),-1===this.length)this.newPosition.set(this.points[0].x,this.points[0].y);else{var e=this.angle*t*(this.cw?1:-1)+this.startAngle;this.newPosition.set(this.points[0].x+this.radius*Math.cos(e),this.points[0].y+this.radius*Math.sin(e))}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(t,e){var i=t.ctx;if(i.save(),i.strokeStyle=this.color,i.beginPath(),this.arcTo?i.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):i.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw),i.stroke(),e){i.globalAlpha=.5,i.fillStyle="#7f7f00";for(var n=0;this.points.length>n;n++)this.drawHandle(i,this.points[n].x,this.points[n].y)}i.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(t){return this.points[t]},getContour:function(t){for(var e=[],i=0;t>i;i++)e.push({x:this.points[0].x+this.radius*Math.cos(i*Math.PI/(t/2)),y:this.points[0].y+this.radius*Math.sin(i*Math.PI/(t/2))});return e},getPositionFromLength:function(t){var e=t/this.length*(this.cw?1:-1);return this.getPosition(e)},updatePath:function(t){return this.points[1]===t?(this.arcTo||(this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))),this.length=this.angle*this.radius,this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)):this.points[0]===t&&this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle)),this.bbox.setEmpty(),this.bbox.x=this.points[0].x-this.radius,this.bbox.y=this.points[0].y-this.radius,this.bbox.x1=this.points[0].x+this.radius,this.bbox.y1=this.points[0].y+this.radius,this.bbox.width=2*this.radius,this.bbox.height=2*this.radius,this}}}}),CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this},curve:null,newPosition:null,applyAsPath:function(t){return this.curve.applyAsPath(t),this},setPoint:function(t,e){this.curve&&this.curve.setPoint(t,e)},setPoints:function(t){var e=new CAAT.Math.Bezier;return e.setPoints(t),this.curve=e,this},setQuadric:function(t,e,i,n,s,r){var a=new CAAT.Math.Bezier;return a.setQuadric(t,e,i,n,s,r),this.curve=a,this.updatePath(),this},setCubic:function(t,e,i,n,s,r,a,o){var h=new CAAT.Math.Bezier;return h.setCubic(t,e,i,n,s,r,a,o),this.curve=h,this.updatePath(),this},updatePath:function(){return this.curve.update(),this.length=this.curve.getLength(),this.curve.getBoundingBox(this.bbox),this},getPosition:function(t){return(t>1||0>t)&&(t%=1),0>t&&(t=1+t),this.curve.solve(this.newPosition,t),this.newPosition},getPositionFromLength:function(t){return this.curve.solve(this.newPosition,t/this.length),this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(t,e){this.curve.drawHandles=e,t.ctx.strokeStyle=this.color,this.curve.paint(t,e)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(t){return this.curve.coordlist[t]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(t){for(var e=[],i=0;t>=i;i++)e.push({x:i/t,y:this.getPosition(i/t).y});return e}}}}),CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point(0,0,0),this},points:null,newPosition:null,applyAsPath:function(t){t.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(t,e){0===e?this.points[0]=t:1===e&&(this.points[1]=t)},updatePath:function(){var t=this.points[1].x-this.points[0].x,e=this.points[1].y-this.points[0].y;return this.length=Math.sqrt(t*t+e*e),this.bbox.setEmpty(),this.bbox.union(this.points[0].x,this.points[0].y),this.bbox.union(this.points[1].x,this.points[1].y),this},setPoints:function(t){return this.points[0]=t[0],this.points[1]=t[1],this.updatePath(),this},setInitialPosition:function(t,e){return this.points[0].x=t,this.points[0].y=e,this.newPosition.set(t,e),this},setFinalPosition:function(t,e){return this.points[1].x=t,this.points[1].y=e,this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(t){return(t>1||0>t)&&(t%=1),0>t&&(t=1+t),this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*t,this.points[0].y+(this.points[1].y-this.points[0].y)*t),this.newPosition},getPositionFromLength:function(t){return this.getPosition(t/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(t,e){var i=t.ctx;i.save(),i.strokeStyle=this.color,i.beginPath(),i.moveTo(this.points[0].x,this.points[0].y),i.lineTo(this.points[1].x,this.points[1].y),i.stroke(),e&&(i.globalAlpha=.5,i.fillStyle="#7f7f00",i.beginPath(),this.drawHandle(i,this.points[0].x,this.points[0].y),this.drawHandle(i,this.points[1].x,this.points[1].y)),i.restore()},numControlPoints:function(){return 2},getControlPoint:function(t){return 0===t?this.points[0]:1===t?this.points[1]:void 0},getContour:function(){var t=[];return t.push(this.getPosition(0).clone()),t.push(this.getPosition(1).clone()),t}}}}),CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,length:-1,cw:!0,bbox:null,newPosition:null,applyAsPath:function(t){var e=t.ctx;return this.cw?(e.lineTo(this.points[0].x,this.points[0].y),e.lineTo(this.points[1].x,this.points[1].y),e.lineTo(this.points[2].x,this.points[2].y),e.lineTo(this.points[3].x,this.points[3].y),e.lineTo(this.points[4].x,this.points[4].y)):(e.lineTo(this.points[4].x,this.points[4].y),e.lineTo(this.points[3].x,this.points[3].y),e.lineTo(this.points[2].x,this.points[2].y),e.lineTo(this.points[1].x,this.points[1].y),e.lineTo(this.points[0].x,this.points[0].y)),this},setPoint:function(t,e){e>=0&&this.points.length>e&&(this.points[e]=t)},setPoints:function(t){return this.points=[],this.points.push(t[0]),this.points.push((new CAAT.Math.Point).set(t[1].x,t[0].y)),this.points.push(t[1]),this.points.push((new CAAT.Math.Point).set(t[0].x,t[1].y)),this.points.push(t[0].clone()),this.updatePath(),this},setClockWise:function(t){return this.cw=void 0!==t?t:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(t,e){for(var i=0,n=this.points.length;n>i;i++)this.points[i].x=t,this.points[i].y=e;return this},setFinalPosition:function(t,e){return this.points[2].x=t,this.points[2].y=e,this.points[1].x=t,this.points[1].y=this.points[0].y,this.points[3].x=this.points[0].x,this.points[3].y=e,this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y,this.updatePath(),this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(t){if((t>1||0>t)&&(t%=1),0>t&&(t=1+t),-1===this.length)this.newPosition.set(0,0);else{var e,i,n=this.bbox.width/this.length,s=this.bbox.height/this.length,r=0,a=0;for(this.cw?(i=[0,1,2,3,4],e=[n,s,n,s]):(i=[4,3,2,1,0],e=[s,n,s,n]);e.length>a&&t>r+e[a];)r+=e[a],a++;t-=r;var o=i[a],h=i[a+1];this.newPosition.set(this.points[o].x+(this.points[h].x-this.points[o].x)*t/e[a],this.points[o].y+(this.points[h].y-this.points[o].y)*t/e[a])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(t,e){var i=t.ctx;if(i.save(),i.strokeStyle=this.color,i.beginPath(),i.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height),e){i.globalAlpha=.5,i.fillStyle="#7f7f00";for(var n=0;this.points.length>n;n++)this.drawHandle(i,this.points[n].x,this.points[n].y)}i.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(t){return this.points[t]},getContour:function(){for(var t=[],e=0;this.points.length>e;e++)t.push(this.points[e]);return t},updatePath:function(t){t&&(t===this.points[0]?(this.points[1].y=t.y,this.points[3].x=t.x):t===this.points[1]?(this.points[0].y=t.y,this.points[2].x=t.x):t===this.points[2]?(this.points[3].y=t.y,this.points[1].x=t.x):t===this.points[3]&&(this.points[0].x=t.x,this.points[2].y=t.y),this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y),this.bbox.setEmpty();for(var e=0;4>e;e++)this.bbox.union(this.points[e].x,this.points[e].y);return this.length=2*this.bbox.width+2*this.bbox.height,this.points[0].x=this.bbox.x,this.points[0].y=this.bbox.y,this.points[1].x=this.bbox.x+this.bbox.width,this.points[1].y=this.bbox.y,this.points[2].x=this.bbox.x+this.bbox.width,this.points[2].y=this.bbox.y+this.bbox.height,this.points[3].x=this.bbox.x,this.points[3].y=this.bbox.y+this.bbox.height,this.points[4].x=this.bbox.x,this.points[4].y=this.bbox.y,this},getPositionFromLength:function(t){return this.getPosition(t/(2*this.bbox.width+2*this.bbox.height))}}}}),CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:["CAAT.PathUtil.PathSegment","CAAT.PathUtil.ArcPath","CAAT.PathUtil.CurvePath","CAAT.PathUtil.LinearPath","CAAT.PathUtil.RectPath","CAAT.Math.Bezier","CAAT.Math.CatmullRom","CAAT.Math.Point","CAAT.Math.Matrix"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this.pathSegments=[],this.behaviorList=[],this.matrix=new CAAT.Math.Matrix,this.tmpMatrix=new CAAT.Math.Matrix,this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:!0,behaviorList:null,rb_angle:0,rb_rotateAnchorX:.5,rb_rotateAnchorY:.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:.5,sb_scaleAnchorY:.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,applyAsPath:function(t){var e=t.ctx;t.modelViewMatrix.transformRenderingContext(e),e.beginPath(),e.globalCompositeOperation="source-out",e.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var i=0;this.pathSegments.length>i;i++)this.pathSegments[i].applyAsPath(t);return e.globalCompositeOperation="source-over",this},setInteractive:function(t){return this.interactive=t,this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Math.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(t,e,i,n){return this.pathSegments=[],this.beginPath(t,e),this.addLineTo(i,n),this.endPath(),this},setQuadric:function(t,e,i,n,s,r){return this.beginPath(t,e),this.addQuadricTo(i,n,s,r),this.endPath(),this},setCubic:function(t,e,i,n,s,r,a,o){return this.beginPath(t,e),this.addCubicTo(i,n,s,r,a,o),this.endPath(),this},setRectangle:function(t,e,i,n){return this.beginPath(t,e),this.addRectangleTo(i,n),this.endPath(),this},setCatmullRom:function(t,e){e&&(t=t.slice(0),t.unshift(t[t.length-1]),t.push(t[1]),t.push(t[2]));for(var i=1;t.length-2>i;i++){var n=(new CAAT.PathUtil.CurvePath).setColor("#000").setParent(this),s=(new CAAT.Math.CatmullRom).setCurve(t[i-1],t[i],t[i+1],t[i+2]);n.curve=s,this.pathSegments.push(n)}return this},addSegment:function(t){return t.setParent(this),this.pathSegments.push(t),this},addArcTo:function(t,e,i,n,s,r,a){var o=new CAAT.PathUtil.ArcPath;return o.setArcTo(!0),o.setRadius(s),o.setInitialPosition(t,e).setFinalPosition(i,n),o.setParent(this),o.setColor(a),this.pathSegments.push(o),this},addRectangleTo:function(t,e,i,n){var s=new CAAT.PathUtil.RectPath;return s.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(t,e)]),s.setClockWise(i),s.setColor(n),s.setParent(this),this.pathSegments.push(s),this},addQuadricTo:function(t,e,i,n,s){var r=new CAAT.Math.Bezier;r.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(t,e),(new CAAT.Math.Point).set(i,n)]),this.trackPathX=i,this.trackPathY=n;var a=(new CAAT.PathUtil.CurvePath).setColor(s).setParent(this);return a.curve=r,this.pathSegments.push(a),this},addCubicTo:function(t,e,i,n,s,r,a){var o=new CAAT.Math.Bezier;o.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(t,e),(new CAAT.Math.Point).set(i,n),(new CAAT.Math.Point).set(s,r)]),this.trackPathX=s,this.trackPathY=r;var h=(new CAAT.PathUtil.CurvePath).setColor(a).setParent(this);return h.curve=o,this.pathSegments.push(h),this},addCatmullTo:function(t,e,i,n,s,r,a){var o=(new CAAT.Math.CatmullRom).setColor(a);o.setCurve(this.trackPathX,this.trackPathY,t,e,i,n,s,r),this.trackPathX=s,this.trackPathY=r;var h=(new CAAT.PathUtil.CurvePath).setParent(this);return h.curve=o,this.pathSegments.push(h),this},addLineTo:function(t,e,i){var n=(new CAAT.PathUtil.LinearPath).setColor(i);return n.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(t,e)]),n.setParent(this),this.trackPathX=t,this.trackPathY=e,this.pathSegments.push(n),this},beginPath:function(t,e){return this.trackPathX=t,this.trackPathY=e,this.beginPathX=t,this.beginPathY=e,this},closePath:function(){return this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1),this.trackPathX=this.beginPathX,this.trackPathY=this.beginPathY,this.endPath(),this},endPath:function(){return this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[],this.updatePath(),this},getPosition:function(t){(t>1||0>t)&&(t%=1),0>t&&(t=1+t);for(var e,i,n=this.pathSegments,s=this.pathSegmentStartTime,r=this.pathSegmentDurationTime,a=0,o=n.length,h=this.newPosition;a!==o;){if(e=0|(o+a)/2,i=s[e],t>=i&&i+r[e]>=t){t=r[e]?(t-i)/r[e]:0,t>1?t=1:0>t&&(t=0);var l=n[e].getPosition(t);return h.x=l.x,h.y=l.y,h}i>t?o=e:a=e+1}return this.endCurvePosition()},getPositionFromLength:function(t){t%=this.getLength(),0>t&&(t+=this.getLength());for(var e=0,i=0;this.pathSegments.length>i;i++){if(t>=e&&this.pathSegments[i].getLength()+e>=t){t-=e;var n=this.pathSegments[i].getPositionFromLength(t);this.newPosition.x=n.x,this.newPosition.y=n.y;break}e+=this.pathSegments[i].getLength()}return this.newPosition},paint:function(t){for(var e=0;this.pathSegments.length>e;e++)this.pathSegments[e].paint(t,this.interactive)},release:function(){this.ax=-1,this.ay=-1},getNumSegments:function(){return this.pathSegments.length},getSegment:function(t){return this.pathSegments[t]},numControlPoints:function(){return this.points.length},getControlPoint:function(t){return this.points[t]},updatePath:function(t,e){var i,n;this.length=0,this.bbox.setEmpty(),this.points=[];var s=Number.MAX_VALUE,r=Number.MAX_VALUE;for(i=0;this.pathSegments.length>i;i++)for(this.pathSegments[i].updatePath(t),this.length+=this.pathSegments[i].getLength(),this.bbox.unionRectangle(this.pathSegments[i].bbox),n=0;this.pathSegments[i].numControlPoints()>n;n++){var a=this.pathSegments[i].getControlPoint(n);this.points.push(a),s>a.x&&(s=a.x),r>a.y&&(r=a.y)}this.clipOffsetX=-s,this.clipOffsetY=-r,this.width=this.bbox.width,this.height=this.bbox.height,this.setLocation(this.bbox.x,this.bbox.y),this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[];var i;for(i=0;this.pathSegments.length>i;i++)this.pathSegmentStartTime.push(0),this.pathSegmentDurationTime.push(0);for(i=0;this.pathSegments.length>i;i++)this.pathSegmentDurationTime[i]=this.getLength()?this.pathSegments[i].getLength()/this.getLength():0,i>0?this.pathSegmentStartTime[i]=this.pathSegmentStartTime[i-1]+this.pathSegmentDurationTime[i-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[i].endPath();return this.extractPathPoints(),e&&e(this),this},press:function(t,e){if(this.interactive){for(var i=CAAT.Math.Curve.prototype.HANDLE_SIZE/2,n=0;this.pathSegments.length>n;n++)for(var s=0;this.pathSegments[n].numControlPoints()>s;s++){var r=this.pathSegments[n].getControlPoint(s);if(t>=r.x-i&&e>=r.y-i&&r.x+i>t&&r.y+i>e)return this.point=r,void 0}this.point=null}},drag:function(t,e,i){this.interactive&&null!==this.point&&((-1===this.ax||-1===this.ay)&&(this.ax=t,this.ay=e),this.point.x+=t-this.ax,this.point.y+=e-this.ay,this.ax=t,this.ay=e,this.updatePath(this.point,i))},getContour:function(t){for(var e=[],i=0;t>=i;i++)e.push((new CAAT.Math.Point).set(i/t,this.getPosition(i/t).y,0));return e},setPoints:function(t){if(this.points.length===t.length)for(var e=0;t.length>e;e++)this.points[e].x=t[e].x,this.points[e].y=t[e].y;return this},setPoint:function(t,e){return e>=0&&this.points.length>e&&(this.points[e].x=t.x,this.points[e].y=t.y),this},emptyBehaviorList:function(){return this.behaviorList=[],this},extractPathPoints:function(){if(!this.pathPoints){var t;for(this.pathPoints=[],t=0;this.numControlPoints()>t;t++)this.pathPoints.push(this.getControlPoint(t).clone())}return this},addBehavior:function(t){return this.behaviorList.push(t),this},removeBehaviour:function(t){for(var e=this.behaviorList.length-1;e;)if(this.behaviorList[e]===t)return this.behaviorList.splice(e,1),this;return this},removeBehaviorById:function(t){for(var e=0;this.behaviorList.length>e;e++)this.behaviorList[e].id===t&&this.behaviorList.splice(e,1);return this},applyBehaviors:function(t){for(var e=0;this.behaviorList.length>e;e++)this.behaviorList[e].apply(t,this);for(this.setATMatrix(),e=0;this.numControlPoints()>e;e++)this.setPoint(this.matrix.transformCoord(this.pathPoints[e].clone().translate(this.clipOffsetX,this.clipOffsetY)),e);return this},setATMatrix:function(){this.matrix.identity(),this.tmpMatrix.identity();var t,e,i,n,s,r,a,o,h,l,u,c,d=this.matrix.matrix,A=this.bbox,f=A.width,g=A.height,p=A.x,m=A.y;if(a=1,o=0,l=0,u=1,h=this.tb_x-p-this.tAnchorX*f,c=this.tb_y-m-this.tAnchorY*g,this.rb_angle){var v=this.rb_rotateAnchorX*f+p,C=this.rb_rotateAnchorY*g+m;h+=a*v+o*C,c+=l*v+u*C,t=Math.cos(this.rb_angle),e=Math.sin(this.rb_angle),i=a,n=o,s=l,r=u,a=i*t+n*e,o=-i*e+n*t,l=s*t+r*e,u=-s*e+r*t,h+=-a*v-o*C,c+=-l*v-u*C}if(1!=this.sb_scaleX||1!=this.sb_scaleY){var T=this.sb_scaleAnchorX*f+p,x=this.sb_scaleAnchorY*g+m;h+=a*T+o*x,c+=l*T+u*x,a*=this.sb_scaleX,o*=this.sb_scaleY,l*=this.sb_scaleX,u*=this.sb_scaleY,h+=-a*T-o*x,c+=-l*T-u*x}return d[0]=a,d[1]=o,d[2]=h,d[3]=l,d[4]=u,d[5]=c,this},setRotationAnchored:function(t,e,i){return this.rb_angle=t,this.rb_rotateAnchorX=e,this.rb_rotateAnchorY=i,this},setRotationAnchor:function(t,e){this.rb_rotateAnchorX=t,this.rb_rotateAnchorY=e},setRotation:function(t){this.rb_angle=t},setScaleAnchored:function(t,e,i,n){return this.sb_scaleX=t,this.sb_scaleAnchorX=i,this.sb_scaleY=e,this.sb_scaleAnchorY=n,this},setScale:function(t,e){return this.sb_scaleX=t,this.sb_scaleY=e,this},setScaleAnchor:function(t,e){return this.sb_scaleAnchorX=t,this.sb_scaleAnchorY=e,this},setPositionAnchor:function(t,e){return this.tAnchorX=t,this.tAnchorY=e,this},setPositionAnchored:function(t,e,i,n){return this.tb_x=t,this.tb_y=e,this.tAnchorX=i,this.tAnchorY=n,this},setPosition:function(t,e){return this.tb_x=t,this.tb_y=e,this},setLocation:function(t,e){return this.tb_x=t,this.tb_y=e,this},flatten:function(t,e){for(var i=this.getPositionFromLength(0),n=(new CAAT.PathUtil.Path).beginPath(i.x,i.y),s=0;t>s;s++)i=this.getPositionFromLength(s/t*this.length),n.addLineTo(i.x,i.y);return e?n.closePath():n.endPath(),n}}}),CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],onCreate:function(){makePerspective=function(t,e,i,n,s){var r=i*Math.tan(t*Math.PI/360),a=-r,o=a*e,h=r*e;return makeFrustum(o,h,a,r,i,n,s)},makeFrustum=function(t,e,i,n,s,r,a){var o=2*s/(e-t),h=2*s/(n-i),l=(e+t)/(e-t),u=(n+i)/(n-i),c=-(r+s)/(r-s),d=-2*r*s/(r-s);return(new CAAT.Math.Matrix3).initWithMatrix([[o,0,l,-a/2],[0,-h,u,a/2],[0,0,c,d],[0,0,-1,0]])},makeOrtho=function(t,e,i,n,s,r){var a=-(e+t)/(e-t),o=-(n+i)/(n-i),h=-(r+s)/(r-s);return(new CAAT.Math.Matrix3).initWithMatrix([[2/(e-t),0,0,a],[0,2/(n-i),0,o],[0,0,-2/(r-s),h],[0,0,0,1]])}}}),CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(t){return this.gl=t,this},shaderProgram:null,gl:null,setAlpha:function(){},getShader:function(t,e,i){var n;if("x-shader/x-fragment"===e)n=t.createShader(t.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==e)return null;n=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert(t.getShaderInfoLog(n)),null)},getDomShader:function(t,e){var i=document.getElementById(e);if(!i)return null;for(var n="",s=i.firstChild;s;)3===s.nodeType&&(n+=s.textContent),s=s.nextSibling;var r;if("x-shader/x-fragment"===i.type)r=t.createShader(t.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==i.type)return null;r=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(alert(t.getShaderInfoLog(r)),null)},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var t=this.gl;return this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,this.getVertexShader()),t.attachShader(this.shaderProgram,this.getFragmentShader()),t.linkProgram(this.shaderProgram),t.useProgram(this.shaderProgram),this},setMatrixUniform:function(t){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,new Float32Array(t.flatten()))},useProgram:function(){return this.gl.useProgram(this.shaderProgram),this}}}),CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(t){return this.__super(t),this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.useProgram(),this.colorBuffer=this.gl.createBuffer(),this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);var t=512;return this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(12*t),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,!1,0,0)}}}),CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(t){return this.__super(t),this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var t;this.linesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var e=[];for(t=0;1024>t;t++)e[t]=t;this.linesBufferArray=new Uint16Array(e),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW),this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler"),this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha"),this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,"uUseColor"),this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor"),this.setAlpha(1),this.setUseColor(!1);var i=4096;this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(12*i),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),this.vertexUVBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.vertexUVArray=new Float32Array(8*i),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,!1,0,0),this.vertexIndexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);var n=[];for(t=0;i>t;t++)n.push(0+4*t),n.push(1+4*t),n.push(2+4*t),n.push(0+4*t),n.push(2+4*t),n.push(3+4*t);return this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),this.gl.DYNAMIC_DRAW),CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(t,e,i,n,s){this.gl.uniform1i(this.shaderProgram.useColor,t?1:0),t&&(this.prevA!==s||this.prevR!==e||this.prevG!==i||this.prevB!==n)&&(this.gl.uniform4f(this.shaderProgram.color,e,i,n,s),this.prevA=s,this.prevR=e,this.prevG=i,this.prevB=n)
},setTexture:function(t){if(this.prevTexture!==t){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(this.shaderProgram.samplerUniform,0),this.prevTexture=t}return this},updateVertexBuffer:function(t){var e=this.gl;return e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,t),this},updateUVBuffer:function(t){var e=this.gl;return e.bindBuffer(e.ARRAY_BUFFER,this.vertexUVBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,t),this},setAlpha:function(t){return this.prevAlpha!==t&&(this.gl.uniform1f(this.shaderProgram.alphaUniform,t),this.prevAlpha=t),this},drawLines:function(t,e,i,n,s,r,a){var o=this.gl;this.setAlpha(r),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.linesBuffer),o.lineWidth(a),this.updateVertexBuffer(t),this.setUseColor(!0,i,n,s,1),o.drawElements(o.LINES,e,o.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(t,e,i,n,s,r,a){var o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.linesBuffer),o.lineWidth(a),this.setAlpha(r),this.updateVertexBuffer(t),this.setUseColor(!0,i,n,s,1),o.drawElements(o.LINE_STRIP,e,o.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}}),CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(t,e,i,n){return this.identifier=t,this.clientX=e,this.pageX=e,this.clientY=i,this.pageY=i,this.target=n,this.time=(new Date).getTime(),this}}}),CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){return this.touches=[],this.changedTouches=[],this},time:0,source:null,sourceEvent:null,shift:!1,control:!1,alt:!1,meta:!1,touches:null,changedTouches:null,init:function(t,e,i){return this.source=e,this.alt=t.altKey,this.control=t.ctrlKey,this.shift=t.shiftKey,this.meta=t.metaKey,this.sourceEvent=t,this.time=i,this},addTouch:function(t){return-1===this.touches.indexOf(t)&&this.touches.push(t),this},addChangedTouch:function(t){return-1===this.changedTouches.indexOf(t)&&this.changedTouches.push(t),this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){return this.point=new CAAT.Math.Point(0,0,0),this.screenPoint=new CAAT.Math.Point(0,0,0),this.touches=[],this},screenPoint:null,point:null,time:0,source:null,shift:!1,control:!1,alt:!1,meta:!1,sourceEvent:null,touches:null,init:function(t,e,i,n,s,r){return this.point.set(t,e),this.source=n,this.screenPoint=s,this.alt=i.altKey,this.control=i.ctrlKey,this.shift=i.shiftKey,this.meta=i.metaKey,this.sourceEvent=i,this.x=t,this.y=e,this.time=r,this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(t,e,i,n){this.keyCode=t,this.action=e,this.modifiers=i,this.sourceEvent=n,this.preventDefault=function(){this.sourceEvent.preventDefault()},this.getKeyCode=function(){return this.keyCode},this.getAction=function(){return this.action},this.modifiers=function(){return this.modifiers},this.isShiftPressed=function(){return this.modifiers.shift},this.isControlPressed=function(){return this.modifiers.control},this.isAltPressed=function(){return this.modifiers.alt},this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.Keys={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},CAAT.SHIFT_KEY=16,CAAT.CONTROL_KEY=17,CAAT.ALT_KEY=18,CAAT.ENTER_KEY=13,CAAT.KEY_MODIFIERS={alt:!1,control:!1,shift:!1}}}),CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){(function(){CAAT.setCursor=function(t){"iOS"!==navigator.browser&&(document.body.style.cursor=t)}})(),function(){CAAT.TOUCH_AS_MOUSE=1,CAAT.TOUCH_AS_MULTITOUCH=2,CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE}(),function(){CAAT.windowResizeListeners=[],CAAT.registerResizeListener=function(t){CAAT.windowResizeListeners.push(t)},CAAT.unregisterResizeListener=function(t){for(var e=0;CAAT.windowResizeListeners.length>e;e++)if(t===CAAT.windowResizeListeners[e])return CAAT.windowResizeListeners.splice(e,1),void 0}}(),function(){CAAT.keyListeners=[],CAAT.registerKeyListener=function(t){CAAT.keyListeners.push(t)}}(),CAAT.enableDeviceMotion=function(){function t(t){CAAT.rotationRate={alpha:0,beta:t[0],gamma:t[1]}}CAAT.prevOnDeviceMotion=null,CAAT.onDeviceMotion=null,CAAT.accelerationIncludingGravity={x:0,y:0,z:0},CAAT.rotationRate={alpha:0,beta:0,gamma:0},window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){t([e.beta,e.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(e){t([2*e.acceleration.x,2*e.acceleration.y])},!0):window.addEventListener("MozOrientation",function(e){t([45*-e.y,45*e.x])},!0)},function(){window.addEventListener("keydown",function(t){var e=t.which?t.which:t.keyCode;if(e===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!0;else if(e===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!0;else if(e===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!0;else for(var i=0;CAAT.keyListeners.length>i;i++)CAAT.keyListeners[i](new CAAT.KeyEvent(e,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},t))},!1),window.addEventListener("keyup",function(t){var e=t.which?t.which:t.keyCode;if(e===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!1;else if(e===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!1;else if(e===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!1;else for(var i=0;CAAT.keyListeners.length>i;i++)CAAT.keyListeners[i](new CAAT.KeyEvent(e,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},t))},!1),window.addEventListener("resize",function(){for(var t=0;CAAT.windowResizeListeners.length>t;t++)CAAT.windowResizeListeners[t].windowResized(window.innerWidth,window.innerHeight)},!1)}()},extendsWith:{}}),CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=!1,CAAT.INTERVAL_ID=null,CAAT.renderEnabled=!1,CAAT.FPS=60,CAAT.NO_RAF=0,CAAT.FPS_REFRESH=500,CAAT.RAF=0,CAAT.REQUEST_ANIMATION_FRAME_TIME=0,CAAT.SET_INTERVAL=0,CAAT.FRAME_TIME=0,CAAT.currentDirector=null,CAAT.director=[],CAAT.RegisterDirector=function(t){CAAT.currentDirector||(CAAT.currentDirector=t),CAAT.director.push(t)},CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()},CAAT.getCurrentSceneTime=function(){return CAAT.currentDirector.getCurrentScene().time},CAAT.endLoop=function(){CAAT.NO_RAF?null!==CAAT.INTERVAL_ID&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=!0,CAAT.renderEnabled=!1},CAAT.loop=function(t){if(!CAAT.renderEnabled){for(var e=0,i=CAAT.director.length;i>e;e++)CAAT.director[e].timeline=(new Date).getTime();CAAT.FPS=t||60,CAAT.renderEnabled=!0,CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){for(var t=(new Date).getTime(),e=0,i=CAAT.director.length;i>e;e++){var n=CAAT.director[e];(n.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||n.needsRepaint)&&n.renderFrame()}CAAT.FRAME_TIME=t-CAAT.SET_INTERVAL,CAAT.RAF&&(CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF),CAAT.RAF=(new Date).getTime(),CAAT.SET_INTERVAL=t},1e3/CAAT.FPS):CAAT.renderFrameRAF()}},CAAT.renderFrameRAF=function(){var t=CAAT;if(t.ENDRAF)return t.ENDRAF=!1,void 0;for(var e=(new Date).getTime(),i=0,n=t.director.length;n>i;i++)t.director[i].renderFrame();e=(new Date).getTime()-e,t.FRAME_TIME=e,t.RAF&&(t.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-t.RAF),t.RAF=(new Date).getTime(),window.requestAnimFrame(t.renderFrameRAF,0)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/CAAT.FPS)}}()},extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,owner:null,scene:null,taskId:0,remove:!1,create:function(t,e,i,n,s){return this.startTime=t,this.duration=e,this.callback_timeout=i,this.callback_tick=n,this.callback_cancel=s,this},checkTask:function(t){var e=t;return e-=this.startTime,e>=this.duration?(this.remove=!0,this.callback_timeout&&this.callback_timeout(t,e,this)):this.callback_tick&&this.callback_tick(t,e,this),this},remainingTime:function(){return this.duration-(this.scene.time-this.startTime)},reset:function(t){return this.remove=!1,this.startTime=t,this.owner.ensureTimerTask(this),this},cancel:function(){return this.remove=!0,null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this),this},addTime:function(t){return this.duration+=t,this}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){return this.timerList=[],this},timerList:null,timerSequence:0,checkTimers:function(t){for(var e=this.timerList,i=e.length-1;i>=0;)e[i].remove||e[i].checkTask(t),i--},ensureTimerTask:function(t){return this.hasTimer(t)||this.timerList.push(t),this},hasTimer:function(t){for(var e=this.timerList,i=e.length-1;i>=0;){if(e[i]===t)return!0;i--}return!1},createTimer:function(t,e,i,n,s,r){var a=(new CAAT.Foundation.Timer.TimerTask).create(t,e,i,n,s);return a.taskId=this.timerSequence++,a.sceneTime=r.time,a.owner=this,a.scene=r,this.timerList.push(a),a},removeExpiredTimers:function(){var t,e=this.timerList;for(t=0;e.length>t;t++)e[t].remove&&e.splice(t,1)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){return this.newChildren=[],this.padding={left:2,right:2,top:2,bottom:2},this},newElementInterpolator:(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.7),moveElementInterpolator:(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2),padding:null,invalid:!0,hgap:2,vgap:2,animated:!1,newChildren:null,setAnimated:function(t){return this.animated=t,this},setHGap:function(t){return this.hgap=t,this.invalidateLayout(),this},setVGap:function(t){return this.vgap=t,this.invalidateLayout(),this},setAllPadding:function(t){return this.padding.left=t,this.padding.right=t,this.padding.top=t,this.padding.bottom=t,this.invalidateLayout(),this},setPadding:function(t,e,i,n){return this.padding.left=t,this.padding.right=e,this.padding.top=i,this.padding.bottom=n,this.invalidateLayout(),this},addChild:function(t){this.newChildren.push(t)},removeChild:function(){},doLayout:function(){this.newChildren=[],this.invalid=!1},invalidateLayout:function(){this.invalid=!0},getMinimumLayoutSize:function(){},getPreferredLayoutSize:function(){},isValid:function(){return!this.invalid},isInvalidated:function(){return this.invalid}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(t){return this.axis=t,this.invalidateLayout(),this},setHorizontalAlignment:function(t){return this.halign=t,this.invalidateLayout(),this},setVerticalAlignment:function(t){return this.valign=t,this.invalidateLayout(),this},doLayout:function(t){this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y?this.doLayoutVertical(t):this.doLayoutHorizontal(t),CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,t)},doLayoutHorizontal:function(t){var e,i,n,s,r=0,a=0,o=0;for(i=0,n=t.getNumChildren();n>i;i+=1)s=t.getChildAt(i),!s.preventLayout&&s.isVisible()&&s.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(s.height>a&&(a=s.height),r+=s.width,i>0&&(r+=this.hgap));switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:e=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:e=t.width-r-this.padding.right;break;default:e=(t.width-r)/2}for(i=0,n=t.getNumChildren();n>i;i+=1)if(s=t.getChildAt(i),!s.preventLayout&&s.isVisible()&&s.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:o=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:o=t.height-this.padding.bottom-s.height;break;default:o=(t.height-s.height)/2}this.__setActorPosition(s,e,o),e+=s.width+this.hgap}},__setActorPosition:function(t,e,i){this.animated?-1!==this.newChildren.indexOf(t)?(t.setPosition(e,i),t.setScale(0,0),t.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):t.moveTo(e,i,500,0,this.moveElementInterpolator):t.setPosition(e,i)},doLayoutVertical:function(t){var e,i,n,s,r,a=0,o=0;for(n=0,s=t.getNumChildren();s>n;n+=1)r=t.getChildAt(n),!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(r.width>a&&(a=r.width),o+=r.height,n>0&&(o+=this.vgap));switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:e=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:e=t.height-o-this.padding.bottom;break;default:e=(t.height-o)/2}for(n=0,s=t.getNumChildren();s>n;n+=1)if(r=t.getChildAt(n),!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:i=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:i=t.width-this.padding.right-r.width;break;default:i=(t.width-r.width)/2}this.__setActorPosition(r,i,e),e+=r.height+this.vgap}},getPreferredLayoutSize:function(t){var e,i,n=new CAAT.Math.Dimension,s=0,r=0;for(e=0,i=t.getNumChildren();i>e;e+=1){var a=t.getChildAt(e);if(!a.preventLayout&&a.isVisible()&&a.isInAnimationFrame(CAAT.getCurrentSceneTime())){var o=a.getPreferredSize();o.height>r&&(r=o.height),s+=o.width}}return n.width=s,n.height=r,n},getMinimumLayoutSize:function(t){var e,i,n=new CAAT.Math.Dimension,s=0,r=0;for(e=0,i=t.getNumChildren();i>e;e+=1){var a=t.getChildAt(e);if(!a.preventLayout&&a.isVisible()&&a.isInAnimationFrame(CAAT.getCurrentSceneTime())){var o=a.getMinimumSize();o.height>r&&(r=o.height),s+=o.width}}return n.width=s,n.height=r,n}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){return this.__super(),this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(t,e){e===void 0&&(e="center"),CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,t,e),"left"===e?this.left=t:"right"===e?this.right=t:"top"===e?this.top=t:"bottom"===e?this.bottom=t:this.center=t},removeChild:function(t){this.center===t?this.center=null:this.left===t?this.left=null:this.right===t?this.right=null:this.top===t?this.top=null:this.bottom===t&&(this.bottom=null)},__getChild:function(t){return"center"===t?this.center:"left"===t?this.left:"right"===t?this.right:"top"===t?this.top:"bottom"===t?this.bottom:void 0},getMinimumLayoutSize:function(){var t,e,i=new CAAT.Math.Dimension;return null!=(t=this.__getChild("right"))&&(e=t.getMinimumSize(),i.width+=e.width+this.hgap,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("left"))&&(e=t.getMinimumSize(),i.width+=e.width+this.hgap,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("center"))&&(e=t.getMinimumSize(),i.width+=e.width,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("top"))&&(e=t.getMinimumSize(),i.width=Math.max(e.width,i.width),i.height+=e.height+this.vgap),null!=(t=this.__getChild("bottom"))&&(e=t.getMinimumSize(),i.width=Math.max(e.width,i.width),i.height+=e.height+this.vgap),i.width+=this.padding.left+this.padding.right,i.height+=this.padding.top+this.padding.bottom,i},getPreferredLayoutSize:function(){var t,e,i=new CAAT.Dimension;return null!=(t=this.__getChild("left"))&&(e=t.getPreferredSize(),i.width+=e.width+this.hgap,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("right"))&&(e=t.getPreferredSize(),i.width+=e.width+this.hgap,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("center"))&&(e=t.getPreferredSize(),i.width+=e.width,i.height=Math.max(e.height,i.height)),null!=(t=this.__getChild("top"))&&(e=t.getPreferredSize(),i.width=Math.max(e.width,i.width),i.height+=e.height+this.vgap),null!=(t=this.__getChild("bottom"))&&(e=t.getPreferredSize(),i.width=Math.max(e.width,i.width),i.height+=e.height+this.vgap),i.width+=this.padding.left+this.padding.right,i.height+=this.padding.top+this.padding.bottom,i},doLayout:function(t){var e,i,n=this.padding.top,s=t.height-this.padding.bottom,r=this.padding.left,a=t.width-this.padding.right;null!=(e=this.__getChild("top"))&&(e.setSize(a-r,e.height),i=e.getPreferredSize(),e.setBounds(r,n,a-r,i.height),n+=i.height+this.vgap),null!=(e=this.__getChild("bottom"))&&(e.setSize(a-r,e.height),i=e.getPreferredSize(),e.setBounds(r,s-i.height,a-r,i.height),s-=i.height+this.vgap),null!=(e=this.__getChild("right"))&&(e.setSize(e.width,s-n),i=e.getPreferredSize(),e.setBounds(a-i.width,n,i.width,s-n),a-=i.width+this.hgap),null!=(e=this.__getChild("left"))&&(e.setSize(e.width,s-n),i=e.getPreferredSize(),e.setBounds(r,n,i.width,s-n),r+=i.width+this.hgap),null!=(e=this.__getChild("center"))&&e.setBounds(r,n,a-r,s-n),CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,t)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(t,e){return this.__super(),this.rows=t,this.columns=e,this},rows:0,columns:2,doLayout:function(t){for(var e=[],i=0;t.getNumChildren()>i;i++){var n=t.getChildAt(i);!n.preventLayout&&n.isVisible()&&n.isInAnimationFrame(CAAT.getCurrentSceneTime())&&e.push(n)}var s=e.length;if(0!==s.length){var r=this.rows,a=this.columns;r>0?a=Math.floor((s+r-1)/r):r=Math.floor((s+a-1)/a);for(var o=(a-1)*this.hgap,h=t.width-(this.padding.left+this.padding.right),l=Math.floor((h-o)/a),u=Math.floor((h-(l*a+o))/2),c=(r-1)*this.vgap,d=t.height-(this.padding.top+this.padding.bottom),A=Math.floor((d-c)/r),f=Math.floor((d-(A*r+c))/2),g=0,p=this.padding.left+u;a>g;g++,p+=l+this.hgap)for(var m=0,v=this.padding.top+f;r>m;m++,v+=A+this.vgap){var i=m*a+g;if(e.length>i){var n=e[i];!n.preventLayout&&n.isVisible()&&n.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(this.animated?(n.width!==l||n.height!==A)&&(n.setSize(l,A),-1!==this.newChildren.indexOf(n)?(n.setPosition(p+(l-n.width)/2,v),n.setScale(.01,.01),n.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):n.moveTo(p+(l-n.width)/2,v,500,0,this.moveElementInterpolator)):n.setBounds(p+(l-n.width)/2,v,l,A))}}CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,t)}},getMinimumLayoutSize:function(t){var e,i=this.rows,n=this.columns,s=t.getNumChildren(),r=0,a=0;for(i>0?n=Math.ceil((s+i-1)/i):i=Math.ceil((s+n-1)/n),e=0;s>e;e+=1){var o=t.getChildAt(e);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var h=o.getMinimumSize();h.width>r&&(r=h.width),h.height>a&&(a=h.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*r+(n-1)*this.hgap,this.padding.top+this.padding.bottom+i*a+(i-1)*this.vgap)},getPreferredLayoutSize:function(t){var e,i=this.rows,n=this.columns,s=t.getNumChildren(),r=0,a=0;for(i>0?n=Math.ceil((s+i-1)/i):i=Math.ceil((s+n-1)/n),e=0;s>e;e+=1){var o=t.getChildAt(e);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var h=o.getPreferredSize();h.width>r&&(r=h.width),h.height>a&&(a=h.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*r+(n-1)*this.hgap,this.padding.top+this.padding.bottom+i*a+(i-1)*this.vgap)}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(t,e,i,n,s,r){return this.x=parseFloat(t),this.y=parseFloat(e),this.width=parseFloat(i),this.height=parseFloat(n),this.setGL(t/s,e/r,(t+i-1)/s,(e+n-1)/r),this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(t,e,i,n){return this.u=t,this.v=e,this.u1=i,this.v1=n,this}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(t,e,i){return this.animation=t,this.time=e,this.onEndPlayCallback=i,this},animation:null,time:0,onEndPlayCallback:null}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){return this.paint=this.paintN,this.setAnimationImageIndex([0]),this.mapInfo={},this.animationsMap={},3===arguments.length&&this.initialize.apply(this,arguments),this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1e3,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(t,e,i,n){return this.animationsMap[t]=new CAAT.Foundation.SpriteImageAnimationHelper(e,i,n),this},setAnimationEndCallback:function(t){this.callback=t},playAnimation:function(t){if(t===this.currentAnimation)return this;var e=this.animationsMap[t];return e?(this.currentAnimation=t,this.setAnimationImageIndex(e.animation),this.changeFPS=e.time,this.callback=e.onEndPlayCallback,this):this},setOwner:function(t){return this.ownerActor=t,this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){var t=this.mapInfo[this.spriteIndex];return t.width},getHeight:function(){var t=this.mapInfo[this.spriteIndex];return t.height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var t=new CAAT.Foundation.SpriteImage;return t.image=this.image,t.rows=this.rows,t.columns=this.columns,t.width=this.width,t.height=this.height,t.singleWidth=this.singleWidth,t.singleHeight=this.singleHeight,t.mapInfo=this.mapInfo,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.animationsMap=this.animationsMap,t.parentOffsetX=this.parentOffsetX,t.parentOffsetY=this.parentOffsetY,t.scaleFont=this.scaleFont,t},setOffsetX:function(t){return this.offsetX=t,this},setOffsetY:function(t){return this.offsetY=t,this},setOffset:function(t,e){return this.offsetX=t,this.offsetY=e,this},initialize:function(t,e,i){if(t||console.log("Null image for SpriteImage."),isString(t)&&(t=CAAT.currentDirector.getImage(t)),this.parentOffsetX=0,this.parentOffsetY=0,this.rows=e,this.columns=i,t instanceof CAAT.Foundation.SpriteImage||t instanceof CAAT.SpriteImage){this.image=t.image;var n=t.mapInfo[0];this.width=n.width,this.height=n.height,this.parentOffsetX=n.x,this.parentOffsetY=n.y,this.width=t.mapInfo[0].width,this.height=t.mapInfo[0].height}else this.image=t,this.width=t.width,this.height=t.height,this.mapInfo={};this.singleWidth=Math.floor(this.width/i),this.singleHeight=Math.floor(this.height/e);var s,r,a,o;if(t.__texturePage){t.__du=this.singleWidth/t.__texturePage.width,t.__dv=this.singleHeight/t.__texturePage.height;var h=this.singleWidth,l=this.singleHeight,u=this.columns;if(t.inverted){var c=h;h=l,l=c,u=this.rows}var d=this.image.__tx,A=this.image.__ty,f=this.image.__texturePage;for(s=0;e*i>s;s++){var g=s%u>>0,p=s/u>>0,m=d+g*h,v=A+p*l,C=m+h,T=v+l;o=new CAAT.Foundation.SpriteImageHelper(m,v,C-m,T-v,f.width,f.height).setGL(m/f.width,v/f.height,C/f.width,T/f.height),this.mapInfo[s]=o}}else for(s=0;e*i>s;s++)r=(0|s%this.columns)*this.singleWidth+this.parentOffsetX,a=(0|s/this.columns)*this.singleHeight+this.parentOffsetY,o=new CAAT.Foundation.SpriteImageHelper(r,a,this.singleWidth,this.singleHeight,t.width,t.height),this.mapInfo[s]=o;return this},paintTiled:function(t){var e=this.mapInfo[this.spriteIndex],i=new CAAT.Math.Rectangle;this.ownerActor.AABB.intersect(t.AABB,i);var n=this.getWidth(),s=this.getHeight(),r=(this.offsetX-this.ownerActor.x)%n;r>0&&(r-=n);var a=(this.offsetY-this.ownerActor.y)%s;a>0&&(a-=s);var o,h,l=((i.width-r)/n>>0)+1,u=((i.height-a)/s>>0)+1,c=t.ctx;for(o=0;u>o;o++)for(h=0;l>h;h++)c.drawImage(this.image,e.x,e.y,e.width,e.height,i.x-this.ownerActor.x+r+h*e.width>>0,i.y-this.ownerActor.y+a+o*e.height>>0,e.width,e.height)},paintInvertedH:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex],r=t.ctx;return r.save(),r.translate((0|i)+s.width,0|n),r.scale(-1,1),r.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX>>0,this.offsetY>>0,s.width,s.height),r.restore(),this},paintInvertedV:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex],r=t.ctx;return r.save(),r.translate(0|i,0|n+s.height),r.scale(1,-1),r.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX>>0,this.offsetY>>0,s.width,s.height),r.restore(),this},paintInvertedHV:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex],r=t.ctx;return r.save(),r.translate(0|i,0|n+s.height),r.scale(1,-1),r.translate(s.width,0),r.scale(-1,1),r.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX>>0,this.offsetY>>0,s.width,s.height),r.restore(),this},paintN:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex];return t.ctx.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX+i>>0,this.offsetY+n>>0,s.width,s.height),this},paintAtRect:function(t,e,i,n,s,r){var a=this.mapInfo[this.spriteIndex];return t.ctx.drawImage(this.image,a.x,a.y,a.width,a.height,this.offsetX+i>>0,this.offsetY+n>>0,s,r),this},paintScaledWidth:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex];return t.ctx.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX+i>>0,this.offsetY+n>>0,this.ownerActor.width,s.height),this},paintChunk:function(t,e,i,n,s,r,a){t.drawImage(this.image,n,s,r,a,e,i,r,a)},paintTile:function(t,e,i,n){var s=this.mapInfo[e];return t.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX+i>>0,this.offsetY+n>>0,s.width,s.height),this},paintScaled:function(t,e,i,n){var s=this.mapInfo[this.spriteIndex];return t.ctx.drawImage(this.image,s.x,s.y,s.width,s.height,this.offsetX+i>>0,this.offsetY+n>>0,this.ownerActor.width,this.ownerActor.height),this},getCurrentSpriteImageCSSPosition:function(){var t=this.mapInfo[this.spriteIndex],e=-(t.x+this.parentOffsetX-this.offsetX),i=-(t.y+this.parentOffsetY-this.offsetY);return""+e+"px "+i+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(t,e){var i=this.image;if(i.__texturePage){var n=e;this.spriteIndex;var s=this.mapInfo[this.spriteIndex],r=s.u,a=s.v,o=s.u1,h=s.v1;if(this.offsetX||this.offsetY){var l=this.ownerActor.width,u=this.ownerActor.height,c=i.__texturePage,d=-this.offsetX/c.width,A=-this.offsetY/c.height,f=(l-this.offsetX)/c.width,g=(u-this.offsetY)/c.height;r=d+i.__u,a=A+i.__v,o=f+i.__u,h=g+i.__v}i.inverted?(t[n++]=o,t[n++]=a,t[n++]=o,t[n++]=h,t[n++]=r,t[n++]=h,t[n++]=r,t[n++]=a):(t[n++]=r,t[n++]=a,t[n++]=o,t[n++]=a,t[n++]=o,t[n++]=h,t[n++]=r,t[n++]=h)}},setChangeFPS:function(t){return this.changeFPS=t,this},setSpriteTransformation:function(t){this.transformation=t;var e=CAAT.Foundation.SpriteImage;switch(t){case e.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case e.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case e.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case e.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case e.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case e.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}return this.ownerActor.invalidate(),this},resetAnimationTime:function(){return this.prevAnimationTime=-1,this},setAnimationImageIndex:function(t){return this.animationImageIndex=t,this.spriteIndex=t[0],this.prevAnimationTime=-1,this},setSpriteIndex:function(t){return this.spriteIndex=t,this},setSpriteIndexAtTime:function(t){if(this.animationImageIndex.length>1)if(-1===this.prevAnimationTime)this.prevAnimationTime=t,this.spriteIndex=this.animationImageIndex[0],this.prevIndex=0,this.ownerActor.invalidate();else{var e=t;e-=this.prevAnimationTime,e/=this.changeFPS,e%=this.animationImageIndex.length;var i=Math.floor(e);this.prevIndex>i&&this.callback&&this.callback(this,t),this.prevIndex=i,this.spriteIndex=this.animationImageIndex[i],this.ownerActor.invalidate()}},getMapInfo:function(t){return this.mapInfo[t]},initializeFromMap:function(t,e){this.initialize(t,1,1);var i,n,s=0;for(i in e){var r=e[i];n=new CAAT.Foundation.SpriteImageHelper(parseFloat(r.x)+this.parentOffsetX,parseFloat(r.y)+this.parentOffsetY,parseFloat(r.width),parseFloat(r.height),t.width,t.height),this.mapInfo[i]=n,s||this.setAnimationImageIndex([i]),s++}return this},addElement:function(t,e){var i=new CAAT.Foundation.SpriteImageHelper(parseFloat(e.x)+this.parentOffsetX,parseFloat(e.y)+this.parentOffsetY,parseFloat(e.width),parseFloat(e.height),this.image.width,this.image.height);return i.xoffset=e.xoffset===void 0?0:parseFloat(e.xoffset),i.yoffset=e.yoffset===void 0?0:parseFloat(e.yoffset),i.xadvance=e.xadvance===void 0?e.width:parseFloat(e.xadvance),this.mapInfo[t]=i,this},initializeAsGlyphDesigner:function(t,e){this.initialize(t,1,1);var i,n,s=0;for(i in e){var r=e[i];n=new CAAT.Foundation.SpriteImageHelper(parseFloat(r.x)+this.parentOffsetX,parseFloat(r.y)+this.parentOffsetX,parseFloat(r.width),parseFloat(r.height),t.width,t.height),n.xoffset=r.xoffset===void 0?0:r.xoffset,n.yoffset=r.yoffset===void 0?0:r.yoffset,n.xadvance=r.xadvance===void 0?r.width:r.xadvance,this.mapInfo[i]=n,s||this.setAnimationImageIndex([i]),s++}return this},initializeAsFontMap:function(t,e){this.initialize(t,1,1);for(var i,n=0,s=0;e.length>s;s++){var r=e[s];i=new CAAT.Foundation.SpriteImageHelper(parseFloat(n)+this.parentOffsetX,0+this.parentOffsetY,parseFloat(r.width),t.height,t.width,t.height),i.xoffset=0,i.yoffset=0,i.xadvance=r.width,n+=r.width,this.mapInfo[e[s].c]=i,s||this.setAnimationImageIndex([e[s].c])
}return this},initializeAsMonoTypeFontMap:function(t,e){for(var i=[],n=e.split(""),s=t.width/n.length>>0,r=0;n.length>r;r++)i.push({c:n[r],width:s});return this.initializeAsFontMap(t,i)},stringWidth:function(t){var e,i,n,s=0;for(e=0,i=t.length;i>e;e++)n=this.mapInfo[t.charAt(e)],n&&(s+=n.xadvance*this.fontScale);return s},stringHeight:function(){if(this.fontHeight)return this.fontHeight*this.fontScale;var t=0;for(var e in this.mapInfo){var i=this.mapInfo[e],n=i.height+i.yoffset;n>t&&(t=n)}return this.fontHeight=t,this.fontHeight*this.fontScale},drawText:function(t,e,i,n){var s,r,a;for(s=0;t.length>s;s++)r=this.mapInfo[t.charAt(s)],r&&(a=r.width,e.drawImage(this.image,r.x,r.y,a,r.height,i+r.xoffset*this.fontScale,n+r.yoffset*this.fontScale,a*this.fontScale,r.height*this.fontScale),i+=r.xadvance*this.fontScale)},getFontData:function(){var t=.8*this.stringHeight()>>0;return{height:this.stringHeight(),ascent:t,descent:this.stringHeight()-t}}}}}),CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:["CAAT.Event.AnimationLoop","CAAT.Foundation.SpriteImage","CAAT.Core.Constants","CAAT.Behavior.PathBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.Scale1Behavior","CAAT.PathUtil.LinearPath","CAAT.Event.AnimationLoop"],constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var t=0;return{__init:function(){return this.behaviorList=[],this.lifecycleListenerList=[],this.AABB=new CAAT.Math.Rectangle,this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)],this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.resetTransform(),this.setScale(1,1),this.setRotation(0),this.id=t++,this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:!1,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:.5,scaleTY:.5,scaleAnchor:0,rotationAngle:0,rotationY:.5,rotationX:.5,alpha:1,isGlobalAlpha:!1,frameAlpha:1,expired:!1,discardable:!1,pointed:!1,mouseEnabled:!0,visible:!0,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:!1,dirty:!0,wdirty:!0,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:!1,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:!1,invalid:!0,cached:0,collides:!1,collidesAsRect:!0,preventLayout:!1,isAA:!0,setPreventLayout:function(t){return this.preventLayout=t,this},invalidateLayout:function(){return this.parent&&!this.parent.layoutInvalidated&&this.parent.invalidateLayout(),this},__validateLayout:function(){},setPreferredSize:function(t,e){return this.preferredSize||(this.preferredSize=new CAAT.Math.Dimension),this.preferredSize.width=t,this.preferredSize.height=e,this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(t,e){return this.minimumSize||(this.minimumSize=new CAAT.Math.Dimension),this.minimumSize.width=t,this.minimumSize.height=e,this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(t,e,i,n,s,r){if(t!==this.x||e!==this.y){var a="__moveTo",o=this.getBehavior(a);return o||(o=(new CAAT.Behavior.PathBehavior).setId(a).setValues(new CAAT.PathUtil.LinearPath),this.addBehavior(o)),o.path.setInitialPosition(this.x,this.y).setFinalPosition(t,e),o.setDelayTime(n?n:0,i),s&&o.setInterpolator(s),r&&(o.lifecycleListenerList=[],o.addListener({behaviorExpired:function(t,e,i){r(t,e,i)}})),this}},rotateTo:function(t,e,i,n,s,r){if(t!==this.rotationAngle){var a="__rotateTo",o=this.getBehavior(a);return o||(o=(new CAAT.Behavior.RotateBehavior).setId(a).setValues(0,0,.5,.5),this.addBehavior(o)),o.setValues(this.rotationAngle,t,n,s).setDelayTime(i?i:0,e),r&&o.setInterpolator(r),this}},scaleTo:function(t,e,i,n,s,r,a){if(this.scaleX!==t||this.scaleY!==e){var o="__scaleTo",h=this.getBehavior(o);return h||(h=(new CAAT.Behavior.ScaleBehavior).setId(o).setValues(1,1,1,1,.5,.5),this.addBehavior(h)),h.setValues(this.scaleX,t,this.scaleY,e,s,r).setDelayTime(n?n:0,i),a&&h.setInterpolator(a),this}},scaleXTo:function(t,e,i,n,s,r){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,t,e,i,n,s,r)},scaleYTo:function(t,e,i,n,s,r){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,t,e,i,n,s,r)},__scale1To:function(t,e,i,n,s,r,a){if(!(t===CAAT.Behavior.Scale1Behavior.AXIS_X&&e===this.scaleX||t===CAAT.Behavior.Scale1Behavior.AXIS_Y&&e===this.scaleY)){var o="__scaleXTo",h=this.getBehavior(o);return h||(h=(new CAAT.Behavior.Scale1Behavior).setId(o).setValues(1,1,t===CAAT.Behavior.Scale1Behavior.AXIS_X,.5,.5),this.addBehavior(h)),h.setValues(t?this.scaleX:this.scaleY,e,s,r).setDelayTime(n?n:0,i),a&&h.setInterpolator(a),this}},touchStart:function(){},touchMove:function(){},touchEnd:function(){},gestureStart:function(){},gestureChange:function(t,e,i){return this.gestureEnabled&&(this.setRotation(t),this.setScale(e,i)),this},gestureEnd:function(){},isVisible:function(){return this.visible},setupCollission:function(t,e){this.collides=t,this.collidesAsRect=!e},invalidate:function(){return this.invalid=!0,this},setGestureEnabled:function(t){return this.gestureEnabled=!!t,this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(t){return this.id=t,this},setParent:function(t){return this.parent=t,this},setBackgroundImage:function(t,e){return t?(t=t instanceof CAAT.Foundation.SpriteImage?t.getRef():isString(t)?(new CAAT.Foundation.SpriteImage).initialize(CAAT.currentDirector.getImage(t),1,1):(new CAAT.Foundation.SpriteImage).initialize(t,1,1),t.setOwner(this),this.backgroundImage=t,(e===void 0||e)&&(this.width=t.getWidth(),this.height=t.getHeight()),this.glEnabled=!0,this.invalidate()):this.backgroundImage=null,this},setSpriteIndex:function(t){return this.backgroundImage&&(this.backgroundImage.setSpriteIndex(t),this.invalidate()),this},setBackgroundImageOffset:function(t,e){return this.backgroundImage&&this.backgroundImage.setOffset(t,e),this},setAnimationImageIndex:function(t){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.backgroundImage.setAnimationImageIndex(t),this.invalidate()),this},addAnimation:function(t,e,i,n){return this.backgroundImage&&this.backgroundImage.addAnimation(t,e,i,n),this},playAnimation:function(t){return this.backgroundImage&&this.backgroundImage.playAnimation(t),this},setAnimationEndCallback:function(t){return this.backgroundImage&&this.backgroundImage.setAnimationEndCallback(t),this},resetAnimationTime:function(){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.invalidate()),this},setChangeFPS:function(t){return this.backgroundImage&&this.backgroundImage.setChangeFPS(t),this},setImageTransformation:function(t){return this.backgroundImage&&this.backgroundImage.setSpriteTransformation(t),this},centerOn:function(t,e){return this.setPosition(t-this.width/2,e-this.height/2),this},centerAt:function(t,e){return this.setPosition(t-this.width*(.5-this.tAnchorX),e-this.height*(.5-this.tAnchorY)),this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(t){return this.invalidate(),CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!t&&this.visible&&CAAT.currentDirector.scheduleDirtyRect(this.AABB),this.visible=t,this},setOutOfFrameTime:function(){return this.setFrameTime(-1,0),this},addListener:function(t){return this.lifecycleListenerList.push(t),this},removeListener:function(t){for(var e=this.lifecycleListenerList.length;e--;)if(this.lifecycleListenerList[e]===t)return this.lifecycleListenerList.splice(e,1),void 0},setGlobalAlpha:function(t){return this.isGlobalAlpha=t,this},fireEvent:function(t,e){for(var i=0;this.lifecycleListenerList.length>i;i++)this.lifecycleListenerList[i].actorLifeCycleEvent(this,t,e)},setExpired:function(t){return this.expired=!0,this.fireEvent("expired",t),this},enableEvents:function(t){return this.mouseEnabled=t,this},emptyBehaviorList:function(){return this.behaviorList=[],this},setFillStyle:function(t){return this.fillStyle=t,this.invalidate(),this},setStrokeStyle:function(t){return this.strokeStyle=t,this.invalidate(),this},setPaint:function(t){return this.setFillStyle(t)},setAlpha:function(t){return this.alpha=t,this.invalidate(),this},resetTransform:function(){return this.rotationAngle=0,this.rotationX=.5,this.rotationY=.5,this.scaleX=1,this.scaleY=1,this.scaleTX=.5,this.scaleTY=.5,this.scaleAnchor=0,this.oldX=-1,this.oldY=-1,this.dirty=!0,this},setFrameTime:function(t,e){return this.start_time=t,this.duration=e,this.expired=!1,this.dirty=!0,this},paint:function(t,e){if(this.backgroundImage)this.backgroundImage.paint(t,e,0,0);else if(this.fillStyle){var i=t.ctx;i.fillStyle=this.fillStyle,i.fillRect(0,0,this.width,this.height)}},setScale:function(t,e){return this.scaleX=t,this.scaleY=e,this.dirty=!0,this},getAnchorPercent:function(t){var e=[.5,.5,.5,0,.5,1,0,.5,1,.5,0,0,1,0,0,1,1,1];return{x:e[2*t],y:e[2*t+1]}},getAnchor:function(t){var e=0,i=0,n=CAAT.Foundation.Actor;switch(t){case n.ANCHOR_CENTER:e=.5,i=.5;break;case n.ANCHOR_TOP:e=.5,i=0;break;case n.ANCHOR_BOTTOM:e=.5,i=1;break;case n.ANCHOR_LEFT:e=0,i=.5;break;case n.ANCHOR_RIGHT:e=1,i=.5;break;case n.ANCHOR_TOP_RIGHT:e=1,i=0;break;case n.ANCHOR_BOTTOM_LEFT:e=0,i=1;break;case n.ANCHOR_BOTTOM_RIGHT:e=1,i=1;break;case n.ANCHOR_TOP_LEFT:e=0,i=0}return{x:e,y:i}},setGlobalAnchor:function(t,e){return this.tAnchorX=t,this.rotationX=t,this.scaleTX=t,this.tAnchorY=e,this.rotationY=e,this.scaleTY=e,this.dirty=!0,this},setScaleAnchor:function(t,e){return this.scaleTX=t,this.scaleTY=e,this.dirty=!0,this},setScaleAnchored:function(t,e,i,n){return this.scaleTX=i,this.scaleTY=n,this.scaleX=t,this.scaleY=e,this.dirty=!0,this},setRotationAnchor:function(t,e){return this.rotationX=e,this.rotationY=t,this.dirty=!0,this},setRotation:function(t){return this.rotationAngle=t,this.dirty=!0,this},setRotationAnchored:function(t,e,i){return this.rotationAngle=t,this.rotationX=e,this.rotationY=i,this.dirty=!0,this},setSize:function(t,e){return this.width=t,this.height=e,this.dirty=!0,this},setBounds:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this.dirty=!0,this},setLocation:function(t,e){return this.x=t,this.y=e,this.oldX=t,this.oldY=e,this.dirty=!0,this},setPosition:function(t,e){return this.setLocation(t,e)},setPositionAnchor:function(t,e){return this.tAnchorX=t,this.tAnchorY=e,this},setPositionAnchored:function(t,e,i,n){return this.setLocation(t,e),this.tAnchorX=i,this.tAnchorY=n,this},isInAnimationFrame:function(t){return this.expired?!1:this.duration===Number.MAX_VALUE?t>=this.start_time:t>=this.start_time+this.duration?(this.expired||this.setExpired(t),!1):t>=this.start_time&&this.start_time+this.duration>t},contains:function(t,e){return t>=0&&e>=0&&this.width>t&&this.height>e},addBehavior:function(t){return this.behaviorList.push(t),this},removeBehaviour:function(t){for(var e=this.behaviorList,i=e.length-1;i;)if(e[i]===t)return e.splice(i,1),this;return this},removeBehaviorById:function(t){for(var e=this.behaviorList,i=0;e.length>i;i++)e[i].id===t&&e.splice(i,1);return this},getBehavior:function(t){for(var e=this.behaviorList,i=0;e.length>i;i++){var n=e[i];if(n.id===t)return n}return null},setDiscardable:function(t){return this.discardable=t,this},destroy:function(t){this.parent&&this.parent.removeChild(this),this.fireEvent("destroyed",t)},modelToView:function(t){var e,i,n,s;if(this.dirty&&this.setModelViewMatrix(),s=this.worldModelViewMatrix.matrix,t instanceof Array)for(var r=0;t.length>r;r++)n=t[r],e=n.x,i=n.y,n.x=e*s[0]+i*s[1]+s[2],n.y=e*s[3]+i*s[4]+s[5];else e=t.x,i=t.y,t.x=e*s[0]+i*s[1]+s[2],t.y=e*s[3]+i*s[4]+s[5];return t},modelToModel:function(t,e){return this.dirty&&this.setModelViewMatrix(),e.viewToModel(this.modelToView(t))},viewToModel:function(t){return this.dirty&&this.setModelViewMatrix(),this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse(),this.worldModelViewMatrixI.transformCoord(t),t},findActorAtPosition:function(t){return 0===this.scaleX||0===this.scaleY?null:this.visible&&this.mouseEnabled&&this.isInAnimationFrame(this.time)?(this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.modelViewMatrixI.transformCoord(t),this.contains(t.x,t.y)?this:null):null},enableDrag:function(){return this.ax=0,this.ay=0,this.asx=1,this.asy=1,this.ara=0,this.screenx=0,this.screeny=0,this.mouseEnter=function(){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!0,CAAT.setCursor("move")},this.mouseExit=function(){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!1,CAAT.setCursor("default")},this.mouseMove=function(){},this.mouseUp=function(){this.__d_ax=-1,this.__d_ay=-1},this.mouseDrag=function(t){var e;if(e=this.modelToView(new CAAT.Math.Point(t.x,t.y)),this.parent.viewToModel(e),(-1===this.__d_ax||-1===this.__d_ay)&&(this.__d_ax=e.x,this.__d_ay=e.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=t.screenPoint.x,this.__d_screeny=t.screenPoint.y),t.isShiftDown()){var i=(t.screenPoint.x-this.__d_screenx)/100,n=(t.screenPoint.y-this.__d_screeny)/100;if(!t.isAltDown()){var s=Math.max(i,n);i=s,n=s}this.setScale(i+this.__d_asx,n+this.__d_asy)}else if(t.isControlDown()){var r=t.screenPoint.x-this.__d_screenx,a=t.screenPoint.y-this.__d_screeny;this.setRotation(-Math.atan2(r,a)+this.__d_ara)}else this.x+=e.x-this.__d_ax,this.y+=e.y-this.__d_ay;this.__d_ax=e.x,this.__d_ay=e.y},this},disableDrag:function(){return this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseMove=function(){},this.mouseUp=function(){},this.mouseDrag=function(){},this},mouseClick:function(){},mouseDblClick:function(){},mouseEnter:function(){this.pointed=!0},mouseExit:function(){this.pointed=!1},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseOut:function(){},mouseOver:function(){},mouseDrag:function(){},drawScreenBoundingBox:function(t){if(null!==this.AABB&&this.inFrame){var e=this.AABB,i=t.ctx;if(i.strokeStyle=CAAT.DEBUGAABBCOLOR,i.strokeRect(.5+(0|e.x),.5+(0|e.y),0|e.width,0|e.height),CAAT.DEBUGBB){var n=this.viewVertices;i.beginPath(),i.lineTo(n[0].x,n[0].y),i.lineTo(n[1].x,n[1].y),i.lineTo(n[2].x,n[2].y),i.lineTo(n[3].x,n[3].y),i.closePath(),i.strokeStyle=CAAT.DEBUGBBCOLOR,i.stroke()}}},animate:function(t,e){if(!this.visible)return!1;var i;if(!this.isInAnimationFrame(e))return this.inFrame=!1,this.dirty=!0,!1;for((this.x!==this.oldX||this.y!==this.oldY)&&(this.dirty=!0,this.oldX=this.x,this.oldY=this.y),i=0;this.behaviorList.length>i;i++)this.behaviorList[i].apply(e,this);return this.clipPath&&this.clipPath.applyBehaviors(e),this.setModelViewMatrix(),(this.dirty||this.wdirty||this.invalid)&&(t.dirtyRectsEnabled&&t.addDirtyRect(this.AABB),this.setScreenBounds(),t.dirtyRectsEnabled&&t.addDirtyRect(this.AABB)),this.dirty=!1,this.invalid=!1,this.inFrame=!0,this.backgroundImage&&this.backgroundImage.setSpriteIndexAtTime(e),this.AABB.intersects(t.AABB)},setModelViewMatrix:function(){var t,e,i,n,s,r,a,o,h,l,u,c,d;if(this.wdirty=!1,d=this.modelViewMatrix.matrix,this.dirty){if(a=1,o=0,l=0,u=1,h=this.x-this.tAnchorX*this.width,c=this.y-this.tAnchorY*this.height,this.rotationAngle){var A=this.rotationX*this.width,f=this.rotationY*this.height;h+=a*A+o*f,c+=l*A+u*f,t=Math.cos(this.rotationAngle),e=Math.sin(this.rotationAngle),i=a,n=o,s=l,r=u,a=i*t+n*e,o=-i*e+n*t,l=s*t+r*e,u=-s*e+r*t,h+=-a*A-o*f,c+=-l*A-u*f}if(1!=this.scaleX||1!=this.scaleY){var g=this.scaleTX*this.width,p=this.scaleTY*this.height;h+=a*g+o*p,c+=l*g+u*p,a*=this.scaleX,o*=this.scaleY,l*=this.scaleX,u*=this.scaleY,h+=-a*g-o*p,c+=-l*g-u*p}d[0]=a,d[1]=o,d[2]=h,d[3]=l,d[4]=u,d[5]=c}if(this.parent){if(this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY&&this.parent.isAA,this.dirty||this.parent.wdirty){if(this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix),this.isAA){var m=this.worldModelViewMatrix.matrix;m[2]+=d[2],m[5]+=d[5]}else this.worldModelViewMatrix.multiply(this.modelViewMatrix);this.wdirty=!0}}else this.dirty&&(this.wdirty=!0),this.worldModelViewMatrix.identity(),this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY},setScreenBounds:function(){var t,e,i,n,s,r,a=this.AABB,o=this.viewVertices;if(this.isAA)return e=this.worldModelViewMatrix.matrix,i=e[2],n=e[5],s=this.width,r=this.height,a.x=i,a.y=n,a.x1=i+s,a.y1=n+r,a.width=s,a.height=r,CAAT.GLRENDER&&(t=o[0],t.x=i,t.y=n,t=o[1],t.x=i+s,t.y=n,t=o[2],t.x=i+s,t.y=n+r,t=o[3],t.x=i,t.y=n+r),this;t=o[0],t.x=0,t.y=0,t=o[1],t.x=this.width,t.y=0,t=o[2],t.x=this.width,t.y=this.height,t=o[3],t.x=0,t.y=this.height,this.modelToView(this.viewVertices);var h=Number.MAX_VALUE,l=-Number.MAX_VALUE,u=Number.MAX_VALUE,c=-Number.MAX_VALUE;return t=o[0],h>t.x&&(h=t.x),t.x>l&&(l=t.x),u>t.y&&(u=t.y),t.y>c&&(c=t.y),t=o[1],h>t.x&&(h=t.x),t.x>l&&(l=t.x),u>t.y&&(u=t.y),t.y>c&&(c=t.y),t=o[2],h>t.x&&(h=t.x),t.x>l&&(l=t.x),u>t.y&&(u=t.y),t.y>c&&(c=t.y),t=o[3],h>t.x&&(h=t.x),t.x>l&&(l=t.x),u>t.y&&(u=t.y),t.y>c&&(c=t.y),a.x=h,a.y=u,a.x1=l,a.y1=c,a.width=l-h,a.height=c-u,this},paintActor:function(t,e){if(!this.visible||!t.inDirtyRect(this))return!0;var i=t.ctx;return this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1,i.globalAlpha=this.frameAlpha,t.modelViewMatrix.transformRenderingContextSet(i),this.worldModelViewMatrix.transformRenderingContext(i),this.clip&&(i.beginPath(),this.clipPath?this.clipPath.applyAsPath(t):i.rect(0,0,this.width,this.height),i.clip()),this.paint(t,e),!0},__paintActor:function(t,e){if(!this.visible)return!0;var i=t.ctx;this.frameAlpha=this.alpha;var n=this.worldModelViewMatrix.matrix;return i.setTransform(n[0],n[3],n[1],n[4],n[2],n[5],this.frameAlpha),this.paint(t,e),!0},paintActorGL:function(t){if(this.frameAlpha=this.parent.frameAlpha*this.alpha,this.glEnabled&&this.visible){if(this.glNeedsFlush(t))return t.glFlush(),this.glSetShader(t),this.__uv||(this.__uv=new Float32Array(8)),this.__vv||(this.__vv=new Float32Array(12)),this.setGLCoords(this.__vv,0),this.setUV(this.__uv,0),t.glRender(this.__vv,12,this.__uv),void 0;var e=t.coords,i=t.coordsIndex;this.setGLCoords(e,i),t.coordsIndex=i+12,this.setUV(t.uv,t.uvIndex),t.uvIndex+=8}},setGLCoords:function(t,e){var i=this.viewVertices;t[e++]=i[0].x,t[e++]=i[0].y,t[e++]=0,t[e++]=i[1].x,t[e++]=i[1].y,t[e++]=0,t[e++]=i[2].x,t[e++]=i[2].y,t[e++]=0,t[e++]=i[3].x,t[e++]=i[3].y,t[e]=0},setUV:function(t,e){this.backgroundImage.setUV(t,e)},glNeedsFlush:function(t){return this.getTextureGLPage()!==t.currentTexturePage?!0:this.frameAlpha!==t.currentOpacity?!0:!1},glSetShader:function(t){var e=this.getTextureGLPage();e!==t.currentTexturePage&&t.setGLTexturePage(e),this.frameAlpha!==t.currentOpacity&&t.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(){return this},initialize:function(t){if(t)for(var e in t)this[e]=t[e];return this},setClip:function(t,e){return this.clip=t,this.clipPath=e,this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){this.cached&&(this.backgroundImage=null,this.cached=CAAT.Foundation.Actor.CACHE_NONE)},cacheAsBitmap:function(t,e){if(0>=this.width||0>=this.height)return this;t=t||0;var i=document.createElement("canvas");i.width=this.width,i.height=this.height;var n=i.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,t);var s={ctx:n,modelViewMatrix:new CAAT.Math.Matrix,worldModelViewMatrix:new CAAT.Math.Matrix,dirtyRectsEnabled:!1,inDirtyRect:function(){return!0},AABB:new CAAT.Math.Rectangle(0,0,this.width,this.height)},r=this.modelViewMatrix,a=this.worldModelViewMatrix;return this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.cached=CAAT.Foundation.Actor.CACHE_NONE,e===void 0&&(e=CAAT.Foundation.Actor.CACHE_SIMPLE),e===CAAT.Foundation.Actor.CACHE_DEEP?(this.animate(s,t),this.paintActor(s,t)):this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer?CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,s,t):(this.animate(s,t),this.paintActor(s,t)),this.setBackgroundImage(i),this.cached=e,this.modelViewMatrix=r,this.worldModelViewMatrix=a,this},resetAsButton:function(){return this.actionPerformed=null,this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseDown=function(){},this.mouseUp=function(){},this.mouseClick=function(){},this.mouseDrag=function(){},this},setAsButton:function(t,e,i,n,s,r){return this.setBackgroundImage(t,!0),this.iNormal=e||0,this.iOver=i||this.iNormal,this.iPress=n||this.iNormal,this.iDisabled=s||this.iNormal,this.fnOnClick=r,this.enabled=!0,this.setSpriteIndex(e),this.setEnabled=function(t){return this.enabled=t,this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled),this},this.actionPerformed=function(){this.enabled&&this.fnOnClick&&this.fnOnClick(this)},this.mouseEnter=function(){this.enabled&&(this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer"))},this.mouseExit=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),CAAT.setCursor("default"))},this.mouseDown=function(){this.enabled&&this.setSpriteIndex(this.iPress)},this.mouseUp=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),this.dragging=!1)},this.mouseClick=function(){},this.mouseDrag=function(){this.enabled&&(this.dragging=!0)},this.setButtonImageIndex=function(t,e,i,n){return this.iNormal=t||0,this.iOver=e||this.iNormal,this.iPress=i||this.iNormal,this.iDisabled=n||this.iNormal,this.setSpriteIndex(this.iNormal),this},this},findActorById:function(t){return this.id===t?this:null}}}}),CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var t=CAAT.Foundation.Actor.CACHE_DEEP,e=CAAT.Foundation.ActorContainer.superclass,i=e.drawScreenBoundingBox,n=e.paintActor,s=e.paintActorGL,r=e.animate,a=e.findActorAtPosition,o=e.destroy;return{__init:function(t){return this.__super(),this.childrenList=[],this.activeChildren=[],this.pendingChildrenList=[],t!==void 0&&(this.addHint=t,this.boundingBox=new CAAT.Math.Rectangle),this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle,layoutManager:null,layoutInvalidated:!0,setLayout:function(t){return this.layoutManager=t,this},setBounds:function(t,e,i,n){return CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,t,e,i,n),CAAT.currentDirector&&!CAAT.currentDirector.inValidation&&this.invalidateLayout(),this},__validateLayout:function(){this.__validateTree(),this.layoutInvalidated=!1},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=!0,this.layoutManager.doLayout(this);for(var t=0;this.getNumChildren()>t;t+=1)this.getChildAt(t).__validateLayout()}},invalidateLayout:function(){if(this.layoutInvalidated=!0,this.layoutManager){this.layoutManager.invalidateLayout(this);for(var t=0;this.getNumChildren()>t;t+=1)this.getChildAt(t).invalidateLayout()}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(t,e){if(this.inFrame){for(var n=this.activeChildren,s=0;n.length>s;s++)n[s].drawScreenBoundingBox(t,e);i.call(this,t,e)}},emptyChildren:function(){return this.childrenList=[],this},paintActor:function(e,i){if(!this.visible)return!1;var s=e.ctx;if(s.save(),!n.call(this,e,i))return!1;if(this.cached===t)return!1;this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var r=0,a=this.activeChildren.length;a>r;++r){var o=this.activeChildren[r];o.visible&&(s.save(),o.paintActor(e,i),s.restore())}return s.restore(),!0},__paintActor:function(t,e){if(!this.visible)return!0;var i=t.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var n=this.worldModelViewMatrix.matrix;i.setTransform(n[0],n[3],n[1],n[4],n[2],n[5],this.frameAlpha),this.paint(t,e),this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var s=0,r=this.activeChildren.length;r>s;++s){var a=this.activeChildren[s];a.paintActor(t,e)}return!0},paintActorGL:function(t,e){var i,n,r;if(!this.visible)return!0;for(s.call(this,t,e),this.isGlobalAlpha||(this.frameAlpha=this.parent.frameAlpha),i=0,n=this.activeChildren.length;n>i;++i)r=this.activeChildren[i],r.paintActorGL(t,e)},animate:function(e,i){if(!this.visible)return!1;if(this.activeChildren=[],!1===r.call(this,e,i))return!1;if(this.cached===t)return!0;this.__validateLayout(),CAAT.currentDirector.inValidation=!1;var n,s,a=this.pendingChildrenList;for(n=0;a.length>n;n++){var o=a[n];this.addChildImmediately(o.child,o.constraint)}this.pendingChildrenList=[];var h=[],l=this.childrenList;for(this.size_active=1,this.size_total=1,n=0;l.length>n;n++){var u=l[n];u.time=i,this.size_total+=u.size_total,u.animate(e,i)?(this.activeChildren.push(u),this.size_active+=u.size_active):u.expired&&u.discardable&&h.push(u)}for(n=0,s=h.length;s>n;n++){var c=h[n];c.destroy(i),e.dirtyRectsEnabled&&e.addDirtyRect(c.AABB)}return!0},endAnimate:function(){},addChildImmediately:function(t,e){return this.addChild(t,e)},addChild:function(t,e){if(null!=t.parent)throw"adding to a container an element with parent.";return t.parent=this,this.childrenList.push(t),t.dirty=!0,this.layoutManager?(this.layoutManager.addChild(t,e),this.invalidateLayout()):this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM&&this.recalcSize(),this},recalcSize:function(){var t=this.boundingBox;t.setEmpty();for(var e,i=this.childrenList,n=0;i.length>n;n++)e=i[n],this.runion.setBounds(0>e.x?0:e.x,0>e.y?0:e.y,e.width,e.height),t.unionRectangle(this.runion);return this.setSize(t.x1,t.y1),this},addChildDelayed:function(t,e){return this.pendingChildrenList.push({child:t,constraint:e}),this},addChildAt:function(t,e){return 0>=e?(t.parent=this,t.dirty=!0,this.childrenList.splice(0,0,t),this.invalidateLayout(),this):(e>=this.childrenList.length&&(e=this.childrenList.length),t.parent=this,t.dirty=!0,this.childrenList.splice(e,0,t),this.invalidateLayout(),this)},findActorById:function(t){for(var e=this.childrenList,i=0,n=e.length;n>i;i++){var s=e[i].findActorById(t);if(null!=s)return s}return null},findChild:function(t){var e,i=this.childrenList,n=i.length;for(e=0;n>e;e++)if(i[e]===t)return e;return-1},removeChildAt:function(t){var e,i=this.childrenList;return-1!==t&&t>=0&&this.childrenList.length>t?(i[t].setParent(null),e=i.splice(t,1),e[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(e[0].AABB),this.invalidateLayout(),e[0]):null},removeChild:function(t){var e=this.findChild(t),i=this.removeChildAt(e);return i},removeFirstChild:function(){var t=this.childrenList.shift();return t.parent=null,t.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(t.AABB),this.invalidateLayout(),t},removeLastChild:function(){if(this.childrenList.length){var t=this.childrenList.pop();return t.parent=null,t.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(t.AABB),this.invalidateLayout(),t}return null},findActorAtPosition:function(t){if(null===a.call(this,t))return null;for(var e=this.childrenList,i=e.length-1;i>=0;i--){var n=this.childrenList[i],s=new CAAT.Math.Point(t.x,t.y,0),r=n.findActorAtPosition(s);if(null!==r)return r}return this},destroy:function(){for(var t=this.childrenList,e=t.length-1;e>=0;e--)t[e].destroy();return o.call(this),this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(t){return this.childrenList[t]},setZOrder:function(t,e){var i=this.findChild(t);if(-1!==i){var n=this.childrenList;if(e===i)return;if(e>=n.length)n.splice(i,1),n.push(t);else{var s=n.splice(i,1);0>e?e=0:e>n.length&&(e=n.length),n.splice(e,0,s[0])}this.invalidateLayout()}}}}}),CAAT.Module({defines:"CAAT.Foundation.Scene",depends:["CAAT.Math.Point","CAAT.Math.Matrix","CAAT.PathUtil.Path","CAAT.Behavior.GenericBehavior","CAAT.Behavior.ContainerBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.AlphaBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.PathBehavior","CAAT.Foundation.ActorContainer","CAAT.Foundation.Timer.TimerManager"],aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){return this.__super(),this.timerManager=new CAAT.TimerManager,this.fillStyle=null,this.isGlobalAlpha=!0,this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:!1,paused:!1,timerManager:null,isPaused:function(){return this.paused},setPaused:function(t){this.paused=t},createTimer:function(t,e,i,n,s){return this.timerManager.createTimer(t,e,i,n,s,this)},setTimeout:function(t,e,i,n){return this.timerManager.createTimer(this.time,t,e,i,n,this)},createAlphaBehaviour:function(t,e){var i=new CAAT.Behavior.AlphaBehavior;i.setFrameTime(0,t),i.startAlpha=e?0:1,i.endAlpha=e?1:0,this.easeContainerBehaviour.addBehavior(i)},easeTranslationIn:function(t,e,i,n){this.easeTranslation(t,e,i,!0,n)},easeTranslationOut:function(t,e,i,n){this.easeTranslation(t,e,i,!1,n)},easeTranslation:function(t,e,i,n,s){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior,this.easeIn=n;var r=new CAAT.Behavior.PathBehavior;switch(s&&r.setInterpolator(s),r.setFrameTime(0,t),1>i?i=1:i>4&&(i=4),i){case CAAT.Foundation.Actor.ANCHOR_TOP:n?(r.setPath((new CAAT.PathUtil.Path).setLinear(0,-this.height+1,0,0)),this.setPosition(0,-this.height+1)):(r.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,-this.height+1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:n?(r.setPath((new CAAT.PathUtil.Path).setLinear(0,this.height-1,0,0)),this.setPosition(0,this.height-1)):(r.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,this.height-1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_LEFT:n?(r.setPath((new CAAT.PathUtil.Path).setLinear(-this.width+1,0,0,0)),this.setPosition(-this.width+1,0)):(r.setPath((new CAAT.PathUtil.Path).setLinear(0,0,-this.width+1,0)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:n?(r.setPath((new CAAT.PathUtil.Path).setLinear(this.width-1,0,0,0)),this.setPosition(this.width-1,0)):(r.setPath((new CAAT.PathUtil.Path).setLinear(0,0,this.width-1,0)),this.setPosition(0,0))}e&&this.createAlphaBehaviour(t,n),this.easeContainerBehaviour.addBehavior(r),this.easeContainerBehaviour.setFrameTime(this.time,t),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(t,e,i,n,s){this.easeScale(t,e,i,n,!0,s),this.easeIn=!0},easeScaleOut:function(t,e,i,n,s){this.easeScale(t,e,i,n,!1,s),this.easeIn=!1},easeScale:function(t,e,i,n,s,r){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var a=0,o=0,h=0,l=0;switch(n){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:h=1,l=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:a=1,h=1,o=0,l=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:o=1,l=1,a=0,h=1;break;default:alert("scale anchor ?? "+n)
}if(!s){var u;u=a,a=h,h=u,u=o,o=l,l=u}i&&this.createAlphaBehaviour(e,s);var c=this.getAnchorPercent(n),d=(new CAAT.Behavior.ScaleBehavior).setFrameTime(t,e).setValues(a,h,o,l,c.x,c.y);r&&d.setInterpolator(r),this.easeContainerBehaviour.addBehavior(d),this.easeContainerBehaviour.setFrameTime(this.time,e),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(){return this},easeRotationIn:function(t,e,i,n){this.easeRotation(t,e,i,!0,n),this.easeIn=!0},easeRotationOut:function(t,e,i,n){this.easeRotation(t,e,i,!1,n),this.easeIn=!1},easeRotation:function(t,e,i,n,s){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var r=0,a=0;switch(i==CAAT.Foundation.Actor.ANCHOR_CENTER&&(i=CAAT.Foundation.Actor.ANCHOR_TOP),i){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:r=Math.PI*(.5>Math.random()?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:r=Math.PI/2*(.5>Math.random()?1:-1);break;default:alert("rot anchor ?? "+i)}if(!1===n){var o=r;r=a,a=o}e&&this.createAlphaBehaviour(t,n);var h=this.getAnchorPercent(i),l=(new CAAT.Behavior.RotateBehavior).setFrameTime(0,t).setValues(r,a,h.x,h.y);s&&l.setInterpolator(s),this.easeContainerBehaviour.addBehavior(l),this.easeContainerBehaviour.setFrameTime(this.time,t),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(t){this.easeContainerBehaviourListener=t},behaviorExpired:function(){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(t){this.expired=t},paint:function(t){if(this.fillStyle){var e=t.ctx;e.fillStyle=this.fillStyle,e.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(t){var e,i,n=new CAAT.Math.Point;if(this.inputList){var s=this.inputList;for(e=0;s.length>e;e++){var r=s[e];for(i=0;r.length>i;i++)if(r[i].visible){n.set(t.x,t.y);var a=r[i].worldModelViewMatrix.getInverse();if(a.transformCoord(n),r[i].contains(n.x,n.y))return r[i]}}}return n.set(t.x,t.y),CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,n)},enableInputList:function(t){this.inputList=[];for(var e=0;t>e;e++)this.inputList.push([]);return this},addActorToInputList:function(t,e,i){0>e?e=0:e>=this.inputList.length&&(e=this.inputList.length-1);var n=this.inputList[e];return i===void 0||i>=n.length?n.push(t):0>=i?n.unshift(t):n.splice(i,0,t),this},emptyInputList:function(t){return 0>t?t=0:t>=this.inputList.length&&(t=this.inputList.length-1),this.inputList[t]=[],this},removeActorFromInputList:function(t,e){if(e===void 0){var i,n;for(i=0;this.inputList.length>i;i++){var s=this.inputList[i];for(n=0;s.length>n;n++)s[n]==t&&s.splice(n,1)}return this}0>e?e=0:e>=this.inputList.length&&(e=this.inputList.length-1);var s=this.inputList[e];for(n=0;s.length>n;n++)s[n]==t&&s.splice(n,1);return this},getIn:function(){},goOut:function(){}}}}),CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Core.Class","CAAT.Core.Constants","CAAT.Foundation.ActorContainer","CAAT.Module.Audio.AudioManager","CAAT.Module.Runtime.BrowserInfo","CAAT.Module.Debug.Debug","CAAT.Math.Point","CAAT.Math.Rectangle","CAAT.Math.Matrix","CAAT.Foundation.Timer.TimerManager","CAAT.Foundation.Actor","CAAT.Foundation.Scene","CAAT.Event.AnimationLoop","CAAT.Event.Input","CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent","CAAT.WebGL.Program","CAAT.WebGL.ColorProgram","CAAT.WebGL.TextureProgram","CAAT.WebGL.GLU","CAAT.Module.TexturePacker.TexturePageManager"],constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:!0,CLEAR_NONE:!1,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super(),this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this.audioManager=(new CAAT.Module.Audio.AudioManager).initialize(8),this.scenes=[],this.mousePoint=new CAAT.Math.Point(0,0,0),this.prevMousePoint=new CAAT.Math.Point(0,0,0),this.screenMousePoint=new CAAT.Math.Point(0,0,0),this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.cDirtyRects=[],this.sDirtyRects=[],this.dirtyRects=[];for(var t=0;64>t;t++)this.dirtyRects.push(new CAAT.Math.Rectangle);return this.dirtyRectsIndex=0,this.touches={},this.timerManager=new CAAT.Foundation.Timer.TimerManager,this.__map={},this},debug:!1,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:!1,lastSelectedActor:null,dragging:!1,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:!1,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:!1,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:!1,nDirtyRects:0,drDiscarded:0,stopped:!1,needsRepaint:!1,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){return this.scenes=null,this.currentScene=null,this.imagesCache=null,this.audioManager=null,this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.__gestureScale=0,this.__gestureRotation=0,this.dirty=!0,this.dirtyRects=null,this.cDirtyRects=null,this.dirtyRectsIndex=0,this.dirtyRectsEnabled=!1,this.nDirtyRects=0,this.onResizeCallback=null,this.__map={},this},cancelPlay:function(t){return this.audioManager.cancelPlay(t)},cancelPlayByChannel:function(t){return this.audioManager.cancelPlayByChannel(t)},setValueForKey:function(t,e){return this.__map[t]=e,this},getValueForKey:function(t){return this.__map[t]},createTimer:function(t,e,i,n,s){return this.timerManager.createTimer(t,e,i,n,s,this)},requestRepaint:function(){this.needsRepaint=!0},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var t=(new CAAT.Module.Debug.Debug).initialize(this.width,60);this.debugInfo=t.debugInfo.bind(t)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(t,e){var i=CAAT.Foundation.Director;switch(this.resize){case i.RESIZE_WIDTH:this.setBounds(0,0,t,this.height);break;case i.RESIZE_HEIGHT:this.setBounds(0,0,this.width,e);break;case i.RESIZE_BOTH:this.setBounds(0,0,t,e);break;case i.RESIZE_PROPORTIONAL:this.setScaleProportional(t,e)}this.glEnabled&&this.glReset(),this.onResizeCallback&&this.onResizeCallback(this,t,e)},setScaleProportional:function(t,e){var i=Math.min(t/this.referenceWidth,e/this.referenceHeight);this.canvas.width=this.referenceWidth*i,this.canvas.height=this.referenceHeight*i,this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.setScaleAnchored(i*this.scaleX,i*this.scaleY,0,0),this.glEnabled&&this.glReset()},enableResizeEvents:function(t,e){var i=CAAT.Foundation.Director;return t===i.RESIZE_BOTH||t===i.RESIZE_WIDTH||t===i.RESIZE_HEIGHT||t===i.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=t,CAAT.registerResizeListener(this),this.onResizeCallback=e,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null),this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var t=CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio,e=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,i=t/e;if(t!==e){var n=this.canvas.width,s=this.canvas.height;this.canvas.width=n*i,this.canvas.height=s*i,this.canvas.style.width=n+"px",this.canvas.style.height=s+"px",this.setScaleAnchored(i,i,0,0)}else this.setScaleAnchored(1,1,0,0);this.SCREEN_RATIO=i}else this.setScaleAnchored(1,1,0,0);for(var r=0;this.scenes.length>r;r++)this.scenes[r].setBounds(0,0,this.width,this.height)},setBounds:function(t,e,i,n){return CAAT.Foundation.Director.superclass.setBounds.call(this,t,e,i,n),this.canvas.width!==i&&(this.canvas.width=i),this.canvas.height!==n&&(this.canvas.height=n),this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.glEnabled&&this.glReset(),this},initialize:function(t,e,i,n){i!==void 0&&(isString(i)?i=document.getElementById(i):i instanceof HTMLCanvasElement||console.log("Canvas is a: "+i+" ???")),i||(i=document.createElement("canvas"),document.body.appendChild(i)),this.canvas=i,n===void 0&&(n=i),this.setBounds(0,0,t,e),this.enableEvents(n),this.timeline=(new Date).getTime(),this.transitionScene=(new CAAT.Foundation.Scene).setBounds(0,0,t,e);var s=document.createElement("canvas");s.width=t,s.height=e;var r=(new CAAT.Foundation.Actor).setBackgroundImage(s);return this.transitionScene.ctx=s.getContext("2d"),this.transitionScene.addChildImmediately(r),this.transitionScene.setEaseListener(this),this.checkDebug(),this},glReset:function(){this.pMatrix=makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.glColorProgram.setMatrixUniform(this.pMatrix),this.glTextureProgram.setMatrixUniform(this.pMatrix),this.gl.viewportWidth=this.canvas.width,this.gl.viewportHeight=this.canvas.height},initializeGL:function(t,e,i,n){i||(i=document.createElement("canvas"),document.body.appendChild(i)),i.width=t,i.height=e,n===void 0&&(n=i),this.referenceWidth=t,this.referenceHeight=e;try{this.gl=i.getContext("experimental-webgl"),this.gl.viewportWidth=t,this.gl.viewportHeight=e,CAAT.GLRENDER=!0}catch(s){}if(!this.gl)return this.initialize(t,e,i);this.canvas=i,this.setBounds(0,0,t,e),this.enableEvents(i),this.timeline=(new Date).getTime(),this.glColorProgram=new CAAT.WebGL.ColorProgram(this.gl).create().initialize(),this.glTextureProgram=new CAAT.WebGL.TextureProgram(this.gl).create().initialize(),this.glTextureProgram.useProgram(),this.glReset();var r=512;return this.coords=new Float32Array(12*r),this.uv=new Float32Array(8*r),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=!0,this.checkDebug(),this},createScene:function(){var t=new CAAT.Scene;return this.addScene(t),t},setImagesCache:function(t,e,i){var n;if(null!==this.glTextureManager&&(this.glTextureManager.deletePages(),this.glTextureManager=null),this.imagesCache){var s=[];for(n=0;this.imagesCache.length>n;n++)s.push(this.imagesCache[n].id);for(n=0;s.length>n;n++)delete this.imagesCache[s[n]]}if(this.imagesCache=t,t)for(n=0;t.length>n;n++)this.imagesCache[t[n].id]=t[n].image;return this.tpW=e||2048,this.tpH=i||2048,this.updateGLPages(),this},updateGLPages:function(){this.glEnabled&&(this.glTextureManager=new CAAT.Module.TexturePacker.TexturePageManager,this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture))},setGLTexturePage:function(t){return this.currentTexturePage=t,this.glTextureProgram.setTexture(t.texture),this},addImage:function(t,e,i){if(this.getImage(t)){for(var n=0;this.imagesCache.length>n;n++)if(this.imagesCache[n].id===t){this.imagesCache[n].image=e;break}this.imagesCache[t]=e}else this.imagesCache.push({id:t,image:e}),this.imagesCache[t]=e;i||this.updateGLPages()},deleteImage:function(t,e){for(var i=0;this.imagesCache.length>i;i++)if(this.imagesCache[i].id===t){delete this.imagesCache[t],this.imagesCache.splice(i,1);break}e||this.updateGLPages()},setGLCurrentOpacity:function(t){this.currentOpacity=t,this.glTextureProgram.setAlpha(t)},glRender:function(t,e,i){t=t||this.coords,i=i||this.uv,e=e||this.coordsIndex;var n=this.gl,s=2*(e/12);this.glTextureProgram.updateVertexBuffer(t),this.glTextureProgram.updateUVBuffer(i),n.drawElements(n.TRIANGLES,3*s,n.UNSIGNED_SHORT,0)},glFlush:function(){0!==this.coordsIndex&&this.glRender(this.coords,this.coordsIndex,this.uv),this.coordsIndex=0,this.uvIndex=0,this.statistics.draws++},findActorAtPosition:function(t){for(var e=this.childrenList,i=e.length-1;i>=0;i--){var n=this.childrenList[i],s=new CAAT.Math.Point(t.x,t.y,0),r=n.findActorAtPosition(s);if(null!==r)return r}return this},resetStats:function(){this.statistics.size_total=0,this.statistics.size_active=0,this.statistics.draws=0,this.statistics.size_discarded_by_dirty_rects=0},render:function(t){if(!this.currentScene||!this.currentScene.isPaused()){for(this.time+=t,n=0,l=this.childrenList.length;l>n;n++){var e=this.childrenList[n];if(e.isInAnimationFrame(this.time)&&!e.isPaused()){var i=e.time-e.start_time;e.timerManager.checkTimers(i),e.timerManager.removeExpiredTimers()}}this.animate(this,this.time),!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();var n,i,e,s=this.childrenList.length,r=this.ctx;if(this.glEnabled){for(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.coordsIndex=0,this.uvIndex=0,n=0;s>n;n++)e=this.childrenList[n],e.isInAnimationFrame(this.time)&&(i=e.time-e.start_time,e.onRenderStart&&e.onRenderStart(i),e.paintActorGL(this,i),e.onRenderEnd&&e.onRenderEnd(i),e.isPaused()||(e.time+=t),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=e.size_total,this.statistics.size_active+=e.size_active));this.glFlush()}else{if(r.globalAlpha=1,r.globalCompositeOperation="source-over",r.save(),this.dirtyRectsEnabled)if(this.modelViewMatrix.transformRenderingContext(r),CAAT.DEBUG_DIRTYRECTS)r.clearRect(0,0,this.canvas.width,this.canvas.height);else{r.beginPath(),this.nDirtyRects=0;var a=this.cDirtyRects;for(n=0;a.length>n;n++){var o=a[n];o.isEmpty()||(r.rect(0|o.x,0|o.y,1+(0|o.width),1+(0|o.height)),this.nDirtyRects++)}r.clip()}else this.clear===CAAT.Foundation.Director.CLEAR_ALL&&r.clearRect(0,0,this.canvas.width,this.canvas.height);for(n=0;s>n;n++)e=this.childrenList[n],e.isInAnimationFrame(this.time)&&(i=e.time-e.start_time,r.save(),e.onRenderStart&&e.onRenderStart(i),!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&e.paintActor(this,i):e.paintActor(this,i),e.onRenderEnd&&e.onRenderEnd(i),r.restore(),CAAT.DEBUGAABB&&(r.globalAlpha=1,r.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(r),e.drawScreenBoundingBox(this,i)),e.isPaused()||(e.time+=t),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=e.size_total,this.statistics.size_active+=e.size_active,this.statistics.size_dirtyRects=this.nDirtyRects));if(this.nDirtyRects>0&&!navigator.isCocoonJS&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){r.beginPath(),this.nDirtyRects=0;var a=this.cDirtyRects;for(n=0;a.length>n;n++){var o=a[n];o.isEmpty()||(r.rect(0|o.x,0|o.y,1+(0|o.width),1+(0|o.height)),this.nDirtyRects++)}r.clip(),r.fillStyle="rgba(160,255,150,.4)",r.fillRect(0,0,this.canvas.width,this.canvas.height)}r.restore()}this.frameCounter++}},inDirtyRect:function(t){if(!this.dirtyRectsEnabled||CAAT.DEBUG_DIRTYRECTS)return!0;var e,i=this.cDirtyRects,n=t.AABB;for(e=0;i.length>e;e++)if(i[e].intersects(n))return!0;return this.statistics.size_discarded_by_dirty_rects+=t.size_total,!1},animate:function(t,e){this.timerManager.checkTimers(e),this.setModelViewMatrix(this),this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.setScreenBounds(),this.dirty=!1,this.invalid=!1,this.dirtyRectsIndex=-1,this.cDirtyRects=[];var i,n,s,r=this.childrenList;if(this.dirtyRectsEnabled){var a=this.sDirtyRects;if(a.length){for(n=0,s=a.length;s>n;n++)this.addDirtyRect(a[n]);this.sDirtyRects=[]}}for(n=0;r.length>n;n++){i=r[n];var o=i.time-i.start_time;i.animate(this,o)}return this.timerManager.removeExpiredTimers(),this},scheduleDirtyRect:function(t){this.sDirtyRects.push(t)},addDirtyRect:function(t){if(!t.isEmpty()){var e,i,n,s,r=this.cDirtyRects;for(e=0;r.length>e;e++)if(i=r[e],!i.isEmpty()&&i.intersects(t)){for(var a=!0;a;){for(i.unionRectangle(t),n=0;r.length>n;n++)if(n!==e&&(s=r[n],!s.isEmpty()&&s.intersects(i))){i.unionRectangle(s),s.setEmpty();break}n==r.length&&(a=!1)}for(n=0;r.length>n;n++)r[n].isEmpty()&&r.splice(n,1);return}if(this.dirtyRectsIndex++,this.dirtyRectsIndex>=this.dirtyRects.length)for(e=0;32>e;e++)this.dirtyRects.push(new CAAT.Math.Rectangle);var o=this.dirtyRects[this.dirtyRectsIndex];o.x=t.x,o.y=t.y,o.x1=t.x1,o.y1=t.y1,o.width=t.width,o.height=t.height,this.cDirtyRects.push(o)}},renderToContext:function(t,e){if(e.isInAnimationFrame(this.time)){t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.clearRect(0,0,this.width,this.height);var i=this.ctx;this.ctx=t,t.save();var n=this.modelViewMatrix,s=this.worldModelViewMatrix;this.worldModelViewMatrix=new CAAT.Math.Matrix,this.modelViewMatrix=this.worldModelViewMatrix,this.wdirty=!0,e.animate(this,e.time),e.onRenderStart&&e.onRenderStart(e.time),e.paintActor(this,e.time),e.onRenderEnd&&e.onRenderEnd(e.time),this.worldModelViewMatrix=s,this.modelViewMatrix=n,t.restore(),this.ctx=i}},addScene:function(t){t.setBounds(0,0,this.width,this.height),this.scenes.push(t),t.setEaseListener(this),null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(t,e,i,n,s,r,a,o,h,l){if(t!==this.getCurrentSceneIndex()){var u=this.scenes[t],c=this.scenes[n];CAAT.__CSS__||this.glEnabled||(this.renderToContext(this.transitionScene.ctx,c),c=this.transitionScene),u.setExpired(!1),c.setExpired(!1),u.mouseEnabled=!1,c.mouseEnabled=!1,u.resetTransform(),c.resetTransform(),u.setLocation(0,0),c.setLocation(0,0),u.alpha=1,c.alpha=1,e===CAAT.Foundation.Scene.EASE_ROTATION?u.easeRotationIn(a,o,i,h):e===CAAT.Foundation.Scene.EASE_SCALE?u.easeScaleIn(0,a,o,i,h):u.easeTranslationIn(a,o,i,h),s===CAAT.Foundation.Scene.EASE_ROTATION?c.easeRotationOut(a,o,r,l):s===CAAT.Foundation.Scene.EASE_SCALE?c.easeScaleOut(0,a,o,r,l):c.easeTranslationOut(a,o,r,l),this.childrenList=[],c.goOut(u),u.getIn(c),this.addChild(c),this.addChild(u)}},easeInOutRandom:function(t,e,i,n){var s,r,a=Math.random(),o=Math.random();.33>a?(s=CAAT.Foundation.Scene.EASE_ROTATION,r=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):.66>a?(s=CAAT.Foundation.Scene.EASE_SCALE,r=(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4)):(s=CAAT.Foundation.Scene.EASE_TRANSLATE,r=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());var h,l;.33>o?(h=CAAT.Foundation.Scene.EASE_ROTATION,l=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):.66>o?(h=CAAT.Foundation.Scene.EASE_SCALE,l=(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4)):(h=CAAT.Foundation.Scene.EASE_TRANSLATE,l=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator()),this.easeInOut(t,s,8.99*Math.random()>>0,e,h,8.99*Math.random()>>0,i,n,r,l)},easeIn:function(t,e,i,n,s,r){var a=this.scenes[t];e===CAAT.Foundation.Scene.EASE_ROTATION?a.easeRotationIn(i,n,s,r):e===CAAT.Foundation.Scene.EASE_SCALE?a.easeScaleIn(0,i,n,s,r):a.easeTranslationIn(i,n,s,r),this.childrenList=[],this.addChild(a),a.resetTransform(),a.setLocation(0,0),a.alpha=1,a.mouseEnabled=!1,a.setExpired(!1)},setScene:function(t){var e=this.scenes[t];this.childrenList=[],this.addChild(e),this.currentScene=e,e.setExpired(!1),e.mouseEnabled=!0,e.resetTransform(),e.setLocation(0,0),e.alpha=1,e.getIn(),e.activated()},switchToScene:function(t,e,i,n){var s=this.getSceneIndex(this.currentScene);n?this.easeInOutRandom(t,s,e,i):this.setScene(t)},switchToPrevScene:function(t,e,i){var n=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||0===n||(i?this.easeInOutRandom(n-1,n,t,e):this.setScene(n-1))},switchToNextScene:function(t,e,i){var n=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||n===this.getNumScenes()-1||(i?this.easeInOutRandom(n+1,n,t,e):this.setScene(n+1))},mouseEnter:function(){},mouseExit:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseDrag:function(){},easeEnd:function(t,e){e?(this.currentScene=t,this.currentScene.activated()):t.setExpired(!0),t.mouseEnabled=!0,t.emptyBehaviorList()},getSceneIndex:function(t){for(var e=0;this.scenes.length>e;e++)if(this.scenes[e]===t)return e;return-1},getScene:function(t){return this.scenes[t]},getSceneById:function(t){for(var e=0;this.scenes.length>e;e++)if(this.scenes[e].id===t)return this.scenes[e];return null},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(t){var e=this.imagesCache[t];if(e)return e;for(var i=0;this.imagesCache.length>i;i++)if(this.imagesCache[i].id===t)return this.imagesCache[i].image;return null},musicPlay:function(t){return this.audioManager.playMusic(t)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(t,e){return this.audioManager.addAudio(t,e),this},audioPlay:function(t){return this.audioManager.play(t)},audioLoop:function(t){return this.audioManager.loop(t)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(t){return this.audioManager.setSoundEffectsEnabled(t)},setMusicEnabled:function(t){return this.audioManager.setMusicEnabled(t)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(t,e){return this.audioManager.setVolume(t,e)},emptyScenes:function(){this.scenes=[]},addChild:function(t){t.parent=this,this.childrenList.push(t)},loop:function(t,e,i){i?(this.onRenderStart=e,this.onRenderEnd=i):e&&(this.onRenderEnd=e),CAAT.loop()},renderFrame:function(){if(CAAT.currentDirector=this,!this.stopped){var t=(new Date).getTime(),e=t-this.timeline;e>500&&(e=500),this.onRenderStart&&this.onRenderStart(e),this.render(e),this.debugInfo&&this.debugInfo(this.statistics),this.timeline=t,this.onRenderEnd&&this.onRenderEnd(e),this.needsRepaint=!1}},resetTimeline:function(){this.timeline=(new Date).getTime()},endLoop:function(){},setClear:function(t){return this.clear=t,this.dirtyRectsEnabled=this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS?!0:!1,this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(t,e,i){for(var n,s=i+"Left",r=i+"Top",a=0,o=0;"iOS"!==navigator.browser&&t&&t.style&&(t.currentStyle?n=t.currentStyle.position:(n=(t.ownerDocument.defaultView||t.ownerDocument.parentWindow).getComputedStyle(t,null),n=n?n.getPropertyValue("position"):null),!/^(fixed)$/.test(n));)a+=t[s],o+=t[r],t=t[e];return{x:a,y:o,style:n}},getOffset:function(t){var e=this.cumulateOffset(t,"offsetParent","offset");if("fixed"===e.style){var i=this.cumulateOffset(t,t.parentNode?"parentNode":"parentElement","scroll");return{x:e.x+i.x,y:e.y+i.y}}return{x:e.x,y:e.y}},getCanvasCoord:function(t,e){var i=new CAAT.Math.Point,n=0,s=0;e||(e=window.event),e.pageX||e.pageY?(n=e.pageX,s=e.pageY):(e.clientX||e.clientY)&&(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var r=this.getOffset(this.canvas);n-=r.x,s-=r.y,n*=this.SCREEN_RATIO,s*=this.SCREEN_RATIO,i.x=n,i.y=s,this.modelViewMatrixI||(this.modelViewMatrixI=this.modelViewMatrix.getInverse()),this.modelViewMatrixI.transformCoord(i),n=i.x,s=i.y,t.set(n,s),this.screenMousePoint.set(n,s)},__mouseDownHandler:function(t){if(this.dragging&&this.lastSelectedActor)return this.__mouseUpHandler(t),void 0;this.getCanvasCoord(this.mousePoint,t),this.isMouseDown=!0;var e=this.findActorAtPosition(this.mousePoint);if(null!==e){var i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));e.mouseDown((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=e},__mouseUpHandler:function(t){this.isMouseDown=!1,this.getCanvasCoord(this.mousePoint,t);var e=null,i=this.lastSelectedActor;null!==i&&(e=i.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),i.actionPerformed&&i.contains(e.x,e.y)&&i.actionPerformed(t),i.mouseUp((new CAAT.Event.MouseEvent).init(e.x,e.y,t,i,this.screenMousePoint,this.currentScene.time))),this.dragging||null===i||i.contains(e.x,e.y)&&i.mouseClick((new CAAT.Event.MouseEvent).init(e.x,e.y,t,i,this.screenMousePoint,this.currentScene.time)),this.dragging=!1,this.in_=!1},__mouseMoveHandler:function(t){var e,i,n=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){if(e=this.lastSelectedActor,i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),!this.dragging&&(Math.abs(this.prevMousePoint.x-i.x)<CAAT.DRAG_THRESHOLD_X||Math.abs(this.prevMousePoint.y-i.y)<CAAT.DRAG_THRESHOLD_Y))return;this.dragging=!0;var s=e.x,r=e.y;if(e.mouseDrag((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),n)),this.prevMousePoint.x=i.x,this.prevMousePoint.y=i.y,s===e.x&&r===e.y){var a=e.contains(i.x,i.y);this.in_&&!a&&(e.mouseExit((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,n)),this.in_=!1),!this.in_&&a&&(e.mouseEnter((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,n)),this.in_=!0)}}else this.in_=!0,e=this.findActorAtPosition(this.mousePoint),e!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(i=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.Event.MouseEvent).init(i.x,i.y,t,this.lastSelectedActor,this.screenMousePoint,n))),null!==e&&(i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),e.mouseEnter((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,n)))),i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),null!==e&&e.mouseMove((new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,n)),this.prevMousePoint.x=i.x,this.prevMousePoint.y=i.y,this.lastSelectedActor=e},__mouseOutHandler:function(t){if(!this.dragging)if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,t);var e=new CAAT.Math.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(e);var i=(new CAAT.Event.MouseEvent).init(e.x,e.y,t,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);this.lastSelectedActor.mouseExit(i),this.lastSelectedActor.mouseOut(i),this.dragging||(this.lastSelectedActor=null)}else this.isMouseDown=!1,this.in_=!1},__mouseOverHandler:function(t){if(!this.dragging){var e,i,n;null==this.lastSelectedActor?(e=this.findActorAtPosition(this.mousePoint),null!==e&&(i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),n=(new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,this.currentScene?this.currentScene.time:0),e.mouseOver(n),e.mouseEnter(n)),this.lastSelectedActor=e):(e=this.lastSelectedActor,i=e.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),n=(new CAAT.Event.MouseEvent).init(i.x,i.y,t,e,this.screenMousePoint,this.currentScene.time),e.mouseOver(n),e.mouseEnter(n))}},__mouseDBLClickHandler:function(t){this.getCanvasCoord(this.mousePoint,t),null!==this.lastSelectedActor&&this.lastSelectedActor.mouseDblClick((new CAAT.Event.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,t,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(t){if(t.target===this.canvas){t.preventDefault(),t=t.targetTouches[0];var e=this.mousePoint;if(this.getCanvasCoord(e,t),0>e.x||0>e.y||e.x>=this.width||e.y>=this.height)return;this.touching=!0,this.__mouseDownHandler(t)}},__touchEndHandler:function(t){if(this.touching){t.preventDefault(),t=t.changedTouches[0];var e=this.mousePoint;this.getCanvasCoord(e,t),this.touching=!1,this.__mouseUpHandler(t)}},__touchMoveHandler:function(t){if(this.touching){if(t.preventDefault(),this.gesturing)return;for(var e=0;t.targetTouches.length>e;e++){var i=t.targetTouches[e],n=this.mousePoint;this.getCanvasCoord(n,i),this.__mouseMoveHandler(i)}}},__gestureStart:function(){this.gesturing=!0,this.__gestureRotation=this.lastSelectedActor.rotationAngle,this.__gestureSX=this.lastSelectedActor.scaleX-1,this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(t,e){void 0!==t&&void 0!==e&&null!==this.lastSelectedActor&&this.lastSelectedActor.isGestureEnabled()&&(this.lastSelectedActor.setRotation(e*Math.PI/180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+t,this.__gestureSY+t))},__gestureEnd:function(){this.gesturing=!1,this.__gestureRotation=0,this.__gestureScale=0},__touchEndHandlerMT:function(t){t.preventDefault();var e,i=[];for(e=0;t.changedTouches.length>e;e++){var n=t.changedTouches[e],s=n.identifier;i.push(s)}var r={};for(e=0;i.length>e;e++){var a=i[e];if(this.touches[a]){var o=this.touches[a].actor;r[o.id]||(r[o.id]={actor:o,touch:(new CAAT.Event.TouchEvent).init(t,o,this.currentScene.time)});var h=r[o.id].touch;h.addChangedTouch(this.touches[a].touch)}}for(e=0;t.changedTouches.length>e;e++){var l=t.changedTouches[e],s=l.identifier;delete this.touches[s]}for(var u in r){var c=r[u],o=c.actor,l=c.touch;for(var d in this.touches){var A=this.touches[d];A.actor.id===o.id&&l.addTouch(A.touch)}o.touchEnd(l)}},__touchMoveHandlerMT:function(t){t.preventDefault();var e,i=[];for(e=0;t.changedTouches.length>e;e++){var n=t.changedTouches[e],s=n.identifier;if(this.touches[s]){var r=this.mousePoint;this.getCanvasCoord(r,n);var a=this.touches[s].actor;r=a.viewToModel(r),this.touches[s]={actor:a,touch:new CAAT.Event.TouchInfo(s,r.x,r.y,a)},i.push(s)}}var o={};for(e=0;i.length>e;e++){var h=i[e],a=this.touches[h].actor;o[a.id]||(o[a.id]={actor:a,touch:(new CAAT.Event.TouchEvent).init(t,a,this.currentScene.time)});var l=o[a.id].touch;l.addTouch(this.touches[h].touch),l.addChangedTouch(this.touches[h].touch)}for(var u in o){var c=o[u],a=c.actor,n=c.touch;for(var d in this.touches){var A=this.touches[d];A.actor.id===a.id&&n.addTouch(A.touch)}a.touchMove(n)}},__touchCancelHandleMT:function(t){this.__touchEndHandlerMT(t)},__touchStartHandlerMT:function(t){t.preventDefault();var e,i=[],n=!0;for(e=0;t.changedTouches.length>e;e++){var s=t.changedTouches[e],r=s.identifier,a=this.mousePoint;if(this.getCanvasCoord(a,s),0>a.x||0>a.y||a.x>=this.width||a.y>=this.height)n=!1;else{var o=this.findActorAtPosition(a);null!==o&&(a=o.viewToModel(a),this.touches[r]||(this.touches[r]={actor:o,touch:new CAAT.Event.TouchInfo(r,a.x,a.y,o)},i.push(r)))}}var h={};for(e=0;i.length>e;e++){var l=i[e],o=this.touches[l].actor;h[o.id]||(h[o.id]={actor:o,touch:(new CAAT.Event.TouchEvent).init(t,o,this.currentScene.time)});var u=h[o.id].touch;u.addTouch(this.touches[l].touch),u.addChangedTouch(this.touches[l].touch)}for(var c in h){var d=h[c],o=d.actor,s=d.touch;for(var A in this.touches){var f=this.touches[A];f.actor.id===o.id&&s.addTouch(f.touch)}o.touchStart(s)}},__findTouchFirstActor:function(){var t=Number.MAX_VALUE,e=null;
for(var i in this.touches){var n=this.touches[i];n.touch.time&&t>n.touch.time&&n.actor.isGestureEnabled()&&(e=n.actor,t=n.touch.time)}return e},__gesturedActor:null,__touchGestureStartHandleMT:function(t){var e=this.__findTouchFirstActor();null!==e&&e.isGestureEnabled()&&(this.__gesturedActor=e,this.__gestureRotation=e.rotationAngle,this.__gestureSX=e.scaleX-1,this.__gestureSY=e.scaleY-1,e.gestureStart(t.rotation*Math.PI/180,t.scale+this.__gestureSX,t.scale+this.__gestureSY))},__touchGestureEndHandleMT:function(t){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(t.rotation*Math.PI/180,t.scale+this.__gestureSX,t.scale+this.__gestureSY),this.__gestureRotation=0,this.__gestureScale=0},__touchGestureChangeHandleMT:function(t){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(t.rotation*Math.PI/180,this.__gestureSX+t.scale,this.__gestureSY+t.scale)},addHandlers:function(t){var e=this;window.addEventListener("mouseup",function(t){if(e.touching){t.preventDefault(),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var i=e.mousePoint;e.getCanvasCoord(i,t),e.__mouseUpHandler(t),e.touching=!1}},!1),window.addEventListener("mousedown",function(i){if(i.target===t){i.preventDefault(),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation();var n=e.mousePoint;if(e.getCanvasCoord(n,i),0>n.x||0>n.y||n.x>=e.width||n.y>=e.height)return;e.touching=!0,e.__mouseDownHandler(i)}},!1),window.addEventListener("mouseover",function(i){if(i.target===t&&!e.dragging){i.preventDefault(),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation();var n=e.mousePoint;if(e.getCanvasCoord(n,i),0>n.x||0>n.y||n.x>=e.width||n.y>=e.height)return;e.__mouseOverHandler(i)}},!1),window.addEventListener("mouseout",function(i){if(i.target===t&&!e.dragging){i.preventDefault(),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation();var n=e.mousePoint;e.getCanvasCoord(n,i),e.__mouseOutHandler(i)}},!1),window.addEventListener("mousemove",function(t){t.preventDefault(),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var i=e.mousePoint;e.getCanvasCoord(i,t),(e.dragging||!(0>i.x||0>i.y||i.x>=e.width||i.y>=e.height))&&e.__mouseMoveHandler(t)},!1),window.addEventListener("dblclick",function(i){if(i.target===t){i.preventDefault(),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation();var n=e.mousePoint;if(e.getCanvasCoord(n,i),0>n.x||0>n.y||n.x>=e.width||n.y>=e.height)return;e.__mouseDBLClickHandler(i)}},!1),CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(t.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),t.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),t.addEventListener("touchend",this.__touchEndHandler.bind(this),!1),t.addEventListener("gesturestart",function(i){i.target===t&&(i.preventDefault(),e.__gestureStart(i.scale,i.rotation))},!1),t.addEventListener("gestureend",function(i){i.target===t&&(i.preventDefault(),e.__gestureEnd(i.scale,i.rotation))},!1),t.addEventListener("gesturechange",function(i){i.target===t&&(i.preventDefault(),e.__gestureChange(i.scale,i.rotation))},!1)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(t.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),!1),t.addEventListener("touchmove",this.__touchMoveHandlerMT.bind(this),!1),t.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),!1),t.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),!1),t.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),!1),t.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),!1),t.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),!1))},enableEvents:function(t){CAAT.RegisterDirector(this),this.in_=!1,this.createEventHandler(t)},createEventHandler:function(t){this.in_=!1,this.addHandlers(t)}}},onCreate:function(){CAAT.__CSS__!==void 0&&(CAAT.Foundation.Director.prototype.clip=!0,CAAT.Foundation.Director.prototype.glEnabled=!1,CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Foundation.Director.prototype.setScaleProportional=function(t,e){var i=Math.min(t/this.referenceWidth,e/this.referenceHeight);this.setScaleAnchored(i,i,0,0),this.eventHandler.style.width=""+this.referenceWidth+"px",this.eventHandler.style.height=""+this.referenceHeight+"px"},CAAT.Foundation.Director.prototype.setBounds=function(t,e,i,n){CAAT.Foundation.Director.superclass.setBounds.call(this,t,e,i,n);for(var s=0;this.scenes.length>s;s++)this.scenes[s].setBounds(0,0,i,n);return this.eventHandler.style.width=i+"px",this.eventHandler.style.height=n+"px",this},CAAT.Foundation.Director.prototype.initialize=function(t,e,i){return this.timeline=(new Date).getTime(),this.domElement=i,this.style("position","absolute"),this.style("width",""+t+"px"),this.style("height",""+e+"px"),this.style("overflow","hidden"),this.enableEvents(i),this.setBounds(0,0,t,e),this.checkDebug(),this},CAAT.Foundation.Director.prototype.render=function(t){this.time+=t,this.animate(this,t);var e,i,n;for(!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats(),e=0,i=this.childrenList.length;i>e;e++){var s=this.childrenList[e];s.isInAnimationFrame(this.time)&&!s.isPaused()&&(n=s.time-s.start_time,s.timerManager.checkTimers(n),s.timerManager.removeExpiredTimers())}for(e=0,i=this.childrenList.length;i>e;e++){var s=this.childrenList[e];s.isInAnimationFrame(this.time)&&(n=s.time-s.start_time,s.onRenderStart&&s.onRenderStart(n),s.paintActor(this,n),s.onRenderEnd&&s.onRenderEnd(n),s.isPaused()||(s.time+=t),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded,this.statistics.size_total+=s.size_total,this.statistics.size_active+=s.size_active,this.statistics.size_dirtyRects=this.nDirtyRects))}this.frameCounter++},CAAT.Foundation.Director.prototype.addScene=function(t){t.setVisible(!0),t.setBounds(0,0,this.width,this.height),this.scenes.push(t),t.setEaseListener(this),null===this.currentScene&&this.setScene(0),this.domElement.appendChild(t.domElement)},CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[],this.domElement.innerHTML="",this.createEventHandler()},CAAT.Foundation.Director.prototype.setClear=function(){return this},CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=document.createElement("div"),this.domElement.appendChild(this.eventHandler),this.eventHandler.style.position="absolute",this.eventHandler.style.left="0",this.eventHandler.style.top="0",this.eventHandler.style.zIndex=999999,this.eventHandler.style.width=""+this.width+"px",this.eventHandler.style.height=""+this.height+"px",this.canvas=this.eventHandler,this.in_=!1,this.addHandlers(this.canvas)},CAAT.Foundation.Director.prototype.inDirtyRect=function(){return!0})}}),CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(t){return this.scene=t,this},setApplicationRange:function(t){return this.range=t,this},setLayoutOp:function(t){return this.layoutOp=t,this},setSizes:function(t,e){this.minSize=t,this.maxSize=e;for(var i=0;this.childrenList.length>i;i++)this.childrenList[i].width=t,this.childrenList[i].height=t;return this},layout:function(){var t,e,i=CAAT.Foundation.UI.Dock;if(this.layoutOp===i.OP_LAYOUT_BOTTOM||this.layoutOp===i.OP_LAYOUT_TOP){var n=0,s=0;for(t=0;this.getNumChildren()>t;t++)n+=this.getChildAt(t).width;for(s=(this.width-n)/2,t=0;this.getNumChildren()>t;t++)e=this.getChildAt(t),e.x=s,s+=e.width,e.y=this.layoutOp===i.OP_LAYOUT_BOTTOM?this.maxSize-e.height:0}else{var r=0,a=0;for(t=0;this.getNumChildren()>t;t++)r+=this.getChildAt(t).height;for(a=(this.height-r)/2,t=0;this.getNumChildren()>t;t++)e=this.getChildAt(t),e.y=a,a+=e.height,e.x=this.layoutOp===i.OP_LAYOUT_LEFT?0:this.width-e.width}},mouseMove:function(){this.actorNotPointed()},mouseExit:function(){this.actorNotPointed()},actorNotPointed:function(){var t,e=this;for(t=0;this.getNumChildren()>t;t++){var i=this.getChildAt(t);i.emptyBehaviorList(),i.addBehavior((new CAAT.Behavior.GenericBehavior).setValues(i.width,this.minSize,i,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.Behavior.GenericBehavior).setValues(i.height,this.minSize,i,"height").setFrameTime(this.scene.time,250)),t===this.getNumChildren()-1&&i.behaviorList[0].addListener({behaviorApplied:function(t,e,i,n){n.parent.layout()},behaviorExpired:function(n,s,r){for(t=0;e.getNumChildren()>t;t++)i=e.getChildAt(t),i.width=e.minSize,i.height=e.minSize;r.parent.layout()}})}},actorPointed:function(t,e,i){var n=this.findChild(i),s=CAAT.Foundation.UI.Dock,r=0;r=this.layoutOp===s.OP_LAYOUT_BOTTOM||this.layoutOp===s.OP_LAYOUT_TOP?t/i.width:e/i.height;var a;for(a=0;this.childrenList.length>a;a++){var o=this.childrenList[a];o.emptyBehaviorList();var h=0;h=n-this.range>a||a>n+this.range?this.minSize:a===n?this.maxSize:n>a?this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-n-r+1)/this.range*Math.PI)+1)/2:this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-n-r)/this.range*Math.PI)+1)/2,o.height=h,o.width=h}this.layout()},actorMouseExit:function(){null!==this.ttask&&this.ttask.cancel();var t=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(){t.actorNotPointed()},null,null)},actorMouseEnter:function(){null!==this.ttask&&(this.ttask.cancel(),this.ttask=null)},addChild:function(t){var e=this;return t.__Dock_mouseEnter=t.mouseEnter,t.__Dock_mouseExit=t.mouseExit,t.__Dock_mouseMove=t.mouseMove,t.mouseEnter=function(t){e.actorMouseEnter(t),this.__Dock_mouseEnter(t)},t.mouseExit=function(t){e.actorMouseExit(t),this.__Dock_mouseExit(t)},t.mouseMove=function(t){e.actorPointed(t.point.x,t.point.y,t.source),this.__Dock_mouseMove(t)},t.width=this.minSize,t.height=this.minSize,CAAT.Foundation.UI.Dock.superclass.addChild.call(this,t)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(t){return this.gap=t,this},setInterpolator:function(t,e){return this.interpolator=t,this.contour=t.getContour(e||this.S),this},paint:function(t,e){if(CAAT.InterpolatorActor.superclass.paint.call(this,t,e),this.backgroundImage)return this;if(this.interpolator){var i=t.ctx,n=this.width-2*this.gap,s=this.height-2*this.gap;i.beginPath(),i.moveTo(this.gap+n*this.contour[0].x,-this.gap+this.height-s*this.contour[0].y);for(var r=1;this.contour.length>r;r++)i.lineTo(this.gap+n*this.contour[r].x,-this.gap+this.height-s*this.contour[r].y);i.strokeStyle=this.strokeStyle,i.stroke()}},getInterpolator:function(){return this.interpolator}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var t=0,e=.6,i=function(t){return this.ctx=t,this};i.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,setDefault:function(t){this.defaultFS=24,this.font="Arial",this.fontSize=this.defaultFS,this.fill="#000",this.stroke="#f00",this.filled=!0,this.stroked=!1,this.strokeSize=1,this.italic=!1,this.bold=!1,this.alignment="left",this.tabSize=75,this.shadow=!1,this.shadowBlur=0,this.shadowColor="#000";for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this.__setFont(),this},setStyle:function(t){if(t!==void 0)for(var e in t)this[e]=t[e];return this},applyStyle:function(){return this.__setFont(),this},clone:function(){var t,e=new i(this.ctx);for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);for(var n=this;n.chain;){n=n.chain;for(t in n)null===e[t]&&n.hasOwnProperty(t)&&(e[t]=n[t])}return e.__setFont(),e},__getProperty:function(t){var e,i=this;do{if(e=i[t],null!==e)return e;i=i.chain}while(i);return null},image:function(t){this.__setShadow(t)},text:function(t,e,i,n){this.__setShadow(t),t.font=this.__getProperty("sfont"),this.filled&&this.__fillText(t,e,i,n),this.stroked&&this.__strokeText(t,e,i,n)},__setShadow:function(t){this.__getProperty("shadow")&&(t.shadowBlur=this.__getProperty("shadowBlur"),t.shadowColor=this.__getProperty("shadowColor"))},__fillText:function(t,e,i,n){t.fillStyle=this.__getProperty("fill"),t.fillText(e,i,n)},__strokeText:function(t,e,i,n){t.strokeStyle=this.__getProperty("stroke"),t.lineWidth=this.__getProperty("strokeSize"),t.beginPath(),t.strokeText(e,i,n)},__setFont:function(){var t=this.__getProperty("italic"),e=this.__getProperty("bold"),i=this.__getProperty("fontSize"),n=this.__getProperty("font");this.sfont=(t?"italic ":"")+(e?"bold ":"")+i+"px "+n,this.ctx.font=this.__getProperty("sfont")},setBold:function(t){t!=this.bold&&(this.bold=t,this.__setFont())},setItalic:function(t){t!=this.italic&&(this.italic=t,this.__setFont())},setStroked:function(t){this.stroked=t},setFilled:function(t){this.filled=t},getTabPos:function(t){var e=this.__getProperty("tabSize");return((t/e>>0)+1)*e},setFillStyle:function(t){this.fill=t},setStrokeStyle:function(t){this.stroke=t},setStrokeSize:function(t){this.strokeSize=t},setAlignment:function(t){this.alignment=t},setFontSize:function(t){t!==this.fontSize&&(this.fontSize=t,this.__setFont())}};var n=function(){return this.text="",this};n.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0,this.currentLine=new o,this.lines.push(this.currentLine)},__image:function(t,e,i){var n;n=e&&i?t.getWidth():t.getWrappedImageWidth(),this.width&&n+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElementImage(new r(this.x,t,e,i,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=n},__text:function(){if(0!==this.text.length){var t=this.ctx.measureText(this.text).width;this.width&&t+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElement(new a(this.text,this.x,t,0,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=t,this.text=""}},fchar:function(t){" "===t?(this.__text(),this.x+=this.ctx.measureText(t).width,this.width&&this.x>this.width&&this.__nextLine()):this.text+=t},end:function(){this.text.length>0&&this.__text();for(var t=0,e=0,i=0;this.lines.length>i;i++){var n=this.lines[i].getHeight();0===n&&(n=this.styles["default"].fontSize),t+=n,i===this.lines.length-1&&(e=.25*n>>0),this.lines[i].setY(t)}this.documentHeight=t+e},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){return this.anchorStack.length?this.anchorStack[this.anchorStack.length-1]:null},__resetAppliedStyles:function(){this.rcs=[],this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=new i(this.ctx).setDefault(this.styles["default"]),this.rcs.push(this.crcs)},__pushStyle:function(t){var e=this.crcs;this.crcs=new i(this.ctx),this.crcs.chain=e,this.crcs.setStyle(t),this.crcs.applyStyle(),this.rcs.push(this.crcs)},__popStyle:function(){this.rcs.length>1&&(this.rcs.pop(),this.crcs=this.rcs[this.rcs.length-1],this.crcs.applyStyle())},__popAnchor:function(){this.anchorStack.length>0&&this.anchorStack.pop()},__pushAnchor:function(t){this.anchorStack.push(t)},start:function(t,e,i,n){this.x=0,this.y=0,this.width=n!==void 0?n:0,this.ctx=t,this.lines=[],this.styles=e,this.images=i,this.anchorStack=[],this.__resetAppliedStyles(),this.__nextLine()},setTag:function(t){var e,i;if(this.__text(),t=t.toLowerCase(),"b"===t)this.crcs.setBold(!0);else if("/b"===t)this.crcs.setBold(!1);else if("i"===t)this.crcs.setItalic(!0);else if("/i"===t)this.crcs.setItalic(!1);else if("stroked"===t)this.crcs.setStroked(!0);else if("/stroked"===t)this.crcs.setStroked(!1);else if("filled"===t)this.crcs.setFilled(!0);else if("/filled"===t)this.crcs.setFilled(!1);else if("tab"===t)this.x=this.crcs.getTabPos(this.x);else if("br"===t)this.__nextLine();else if("/a"===t)this.__popAnchor();else if("/style"===t)this.rcs.length>1&&this.__popStyle();else if(0===t.indexOf("fillcolor"))e=t.split("="),this.crcs.setFillStyle(e[1]);else if(0===t.indexOf("strokecolor"))e=t.split("="),this.crcs.setStrokeStyle(e[1]);else if(0===t.indexOf("strokesize"))e=t.split("="),this.crcs.setStrokeSize(0|e[1]);else if(0===t.indexOf("fontsize"))e=t.split("="),this.crcs.setFontSize(0|e[1]);else if(0===t.indexOf("style"))e=t.split("="),i=this.styles[e[1]],i&&this.__pushStyle(i);else if(0===t.indexOf("image")){e=t.split("=")[1].split(",");var n=e[0];if(this.images[n]){var s=0,r=0;e.length>=3&&(s=0|e[1],r=0|e[2]),this.__image(this.images[n],s,r)}}else 0===t.indexOf("a=")&&(e=t.split("="),this.__pushAnchor(e[1]))}};var s=function(t,e){return this.link=t,this.style=e,this};s.prototype={x:null,y:null,width:null,height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(t){return this.link=t,this},getLink:function(){return this.link},contains:function(){return!1}};var r=function(t,e,i,n,s,a){return r.superclass.constructor.call(this,a,s),this.x=t,this.image=e,this.row=i,this.column=n,this.width=e.getWidth(),this.height=e.getHeight(),(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage)&&(this.spriteIndex=i*e.columns+n,this.paint=this.paintSI),this};r.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(e){this.style.image(e),e.drawImage(this.image,this.x,-this.height+1),t&&e.strokeRect(this.x,-this.height+1,this.width,this.height)},paintSI:function(e){this.style.image(e),this.image.setSpriteIndex(this.spriteIndex),this.image.paint({ctx:e},0,this.x,-this.height+1),t&&e.strokeRect(this.x,-this.height+1,this.width,this.height)},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.singleHeight:this.image.height},getFontMetrics:function(){return null},contains:function(t,e){return t>=this.x&&this.x+this.width>=t&&e>=this.y&&this.y+this.height>e},setYPosition:function(t){this.y=t-this.height+1}};var a=function(t,e,i,n,s,r){return a.superclass.constructor.call(this,r,s),this.x=e,this.y=0,this.width=i,this.text=t,this.style=s,this.fm=CAAT.Module.Font.Font.getFontMetrics(s.sfont),this.height=this.fm.height,this};a.prototype={text:null,style:null,fm:null,bl:null,paint:function(e){this.style.text(e,this.text,this.x,0),t&&e.strokeRect(this.x,-this.fm.ascent,this.width,this.height)},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(t,e){return t>=this.x&&this.x+this.width>=t&&e>=this.y&&this.y+this.height>=e},setYPosition:function(t){this.bl=t,this.y=t-this.fm.ascent}},extend(r,s),extend(a,s);var o=function(){return this.elements=[],this};return o.prototype={elements:null,width:0,height:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(t){this.width=Math.max(this.width,t.x+t.width),this.height=Math.max(this.height,t.height),this.elements.push(t),this.alignment=t.style.__getProperty("alignment")},addElementImage:function(t){this.width=Math.max(this.width,t.x+t.width),this.height=Math.max(this.height,t.height),this.elements.push(t)},getHeight:function(){return this.height},setY:function(t){this.y=t},getY:function(){return this.y},paint:function(t){t.save(),t.translate(this.x,this.y+this.baselinePos);for(var e=0;this.elements.length>e;e++)this.elements[e].paint(t);t.restore()},setAlignment:function(t){var i;if("center"===this.alignment)this.x=(t-this.width)/2;else if("right"===this.alignment)this.x=t-this.width;else if("justify"===this.alignment&&this.width/t>=e&&this.elements.length>1){var n=t-this.width,s=0|n/(this.elements.length-1);for(i=1;this.elements.length>i;i++)this.elements[i].x+=i*s;for(n=t-this.width-s*(this.elements.length-1),i=0;n>i;i++)this.elements[this.elements.length-1-i].x+=n-i}},adjustHeight:function(){var t,e=null,i=null;for(t=0;this.elements.length>t;t+=1){var n=this.elements[t],s=n.getFontMetrics();null!=s?e?s.ascent>e.ascent&&(e=s):e=s:i?n.getHeight()>n.getHeight()&&(i=n):i=n}for(this.baselinePos=Math.max(e?e.ascent:0,i?i.getHeight():0),this.height=this.baselinePos+(null!=e?e.descent:0),t=0;this.elements.length>t;t++)this.elements[t].setYPosition(this.baselinePos);return this.height},__getElementAt:function(t,e){for(var i=0;this.elements.length>i;i++){var n=this.elements[i];if(n.contains(t,e))return n}return null}},{__init:function(){return this.__super(),this.rc=new n,this.lines=[],this.styles={},this.images={},this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:!0,lines:null,images:null,clickCallback:null,setStyle:function(t,e){return this.styles[t]=e,this},addImage:function(t,e){return this.images[t]=e,this},setSize:function(t,e){return CAAT.Foundation.UI.Label.superclass.setSize.call(this,t,e),this.setText(this.text,this.width),this},setBounds:function(t,e,i,n){return CAAT.Foundation.UI.Label.superclass.setBounds.call(this,t,e,i,n),this.setText(this.text,this.width),this},setText:function(t,e){if(null!==t){var i=this.cached;i&&this.stopCacheAsBitmap(),this.documentWidth=0,this.documentHeight=0,this.text=t;var n,s,r,a,o,h,l=CAAT.currentDirector.ctx;for(l.save(),r=this.text,n=0,s=r.length,this.rc.start(l,this.styles,this.images,e);s>n;)h=r.charAt(n),"\\"===h?(n+=1,this.rc.fchar(r.charAt(n)),n+=1):"<"===h?(a=r.indexOf(">",n+1),-1!==a&&(o=r.substr(n+1,a-n-1),-1!==o.indexOf("<")?(this.rc.fchar(h),n+=1):(this.rc.setTag(o),n=a+1))):(this.rc.fchar(h),n+=1);return this.rc.end(),this.lines=this.rc.lines,this.__calculateDocumentDimension(e===void 0?0:e),this.setLinesAlignment(),l.restore(),this.setPreferredSize(this.documentWidth,this.documentHeight),this.invalidateLayout(),this.setDocumentPosition(),i&&this.cacheAsBitmap(0,i),this}},setVerticalAlignment:function(t){return this.valignment=t,this.setDocumentPosition(),this},setHorizontalAlignment:function(t){return this.halignment=t,this.setDocumentPosition(),this},setDocumentPosition:function(){var t=0,e=0;this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?e=(this.height-this.documentHeight)/2:this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM&&(e=this.height-this.documentHeight),this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?t=(this.width-this.documentWidth)/2:this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT&&(t=this.width-this.documentWidth),this.documentX=t,this.documentY=e},__calculateDocumentDimension:function(t){var e,i=0;for(this.documentWidth=0,this.documentHeight=0,e=0;this.lines.length>e;e++)this.lines[e].y=i,this.documentWidth=Math.max(this.documentWidth,this.lines[e].width),this.documentHeight+=this.lines[e].adjustHeight(),i+=this.lines[e].getHeight();return this.documentWidth=Math.max(this.documentWidth,t),this},setLinesAlignment:function(){for(var t=0;this.lines.length>t;t++)this.lines[t].setAlignment(this.documentWidth)},paint:function(e,i){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var n=e.ctx;n.save(),n.textBaseline="alphabetic",n.translate(this.documentX,this.documentY);for(var s=0;this.lines.length>s;s++){var r=this.lines[s];r.paint(e.ctx),t&&n.strokeRect(r.x,r.y,r.width,r.height)}n.restore()}else this.backgroundImage&&this.backgroundImage.paint(e,i,0,0)},__getDocumentElementAt:function(t,e){t-=this.documentX,e-=this.documentY;for(var i=0;this.lines.length>i;i++){var n=this.lines[i];if(t>=n.x&&e>=n.y&&n.x+n.width>=t&&n.y+n.height>=e)return n.__getElementAt(t-n.x,e-n.y)}return null},mouseExit:function(){CAAT.setCursor("default")},mouseMove:function(t){var e=this.__getDocumentElementAt(t.x,t.y);e&&e.getLink()?CAAT.setCursor("pointer"):CAAT.setCursor("default")},mouseClick:function(t){if(this.clickCallback){var e=this.__getDocumentElementAt(t.x,t.y);e.getLink()&&this.clickCallback(e.getLink())}},setClickCallback:function(t){return this.clickCallback=t,this}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:!1,outlineColor:"black",onUpdateCallback:null,interactive:!1,showBBox:!1,getPath:function(){return this.path},setPath:function(t){return this.path=t,null!=t&&(this.pathBoundingRectangle=t.getBoundingBox(),this.setInteractive(this.interactive)),this},paint:function(t,e){if(CAAT.Foundation.UI.PathActor.superclass.paint.call(this,t,e),this.path){var i=t.ctx;i.strokeStyle="#000",this.path.paint(t,this.interactive),this.bOutline&&(i.strokeStyle=this.outlineColor,i.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height))}},showBoundingBox:function(t,e){return this.bOutline=t,t&&e&&(this.outlineColor=e),this},setInteractive:function(t){return this.interactive=t,this.path&&this.path.setInteractive(t),this},setOnUpdateCallback:function(t){return this.onUpdateCallback=t,this},mouseDrag:function(t){this.path.drag(t.point.x,t.point.y,this.onUpdateCallback)},mouseDown:function(t){this.path.press(t.point.x,t.point.y)},mouseUp:function(){this.path.release()}}}),CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE),this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(t){return this.lineWidth=t,this},setLineCap:function(t){return this.lineCap=t,this},setLineJoin:function(t){return this.lineJoin=t,this},setMiterLimit:function(t){return this.miterLimit=t,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(t){return this.shape=t,this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle,this},setCompositeOp:function(t){return this.compositeOp=t,this},paint:function(){},paintCircle:function(t,e){if(this.cached)return CAAT.Foundation.ActorContainer.prototype.paint.call(this,t,e),void 0;var i=t.ctx;i.lineWidth=this.lineWidth,i.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(i.fillStyle=this.fillStyle,i.beginPath(),i.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),i.fill()),null!==this.strokeStyle&&(i.strokeStyle=this.strokeStyle,i.beginPath(),i.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),i.stroke())},paintRectangle:function(t,e){if(this.cached)return CAAT.Foundation.ActorContainer.prototype.paint.call(this,t,e),void 0;var i=t.ctx;i.lineWidth=this.lineWidth,this.lineCap&&(i.lineCap=this.lineCap),this.lineJoin&&(i.lineJoin=this.lineJoin),this.miterLimit&&(i.miterLimit=this.miterLimit),i.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(i.fillStyle=this.fillStyle,i.beginPath(),i.fillRect(0,0,this.width,this.height),i.fill()),null!==this.strokeStyle&&(i.strokeStyle=this.strokeStyle,i.beginPath(),i.strokeRect(0,0,this.width,this.height),i.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(t){return this.lineWidth=t,this},setLineCap:function(t){return this.lineCap=t,this},setLineJoin:function(t){return this.lineJoin=t,this},setMiterLimit:function(t){return this.miterLimit=t,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(){return this},setOutlined:function(){return this},setCompositeOp:function(t){return this.compositeOp=t,this},setInitialAngle:function(t){return this.initialAngle=t,this},initialize:function(t,e,i){return this.setSize(2*e,2*e),this.nPeaks=t,this.maxRadius=e,this.minRadius=i,this},paint:function(t){var e=t.ctx,i=this.width/2,n=this.height/2,s=this.maxRadius,r=this.minRadius,a=i+s*Math.cos(this.initialAngle),o=n+s*Math.sin(this.initialAngle);e.lineWidth=this.lineWidth,this.lineCap&&(e.lineCap=this.lineCap),this.lineJoin&&(e.lineJoin=this.lineJoin),this.miterLimit&&(e.miterLimit=this.miterLimit),e.globalCompositeOperation=this.compositeOp,e.beginPath(),e.moveTo(a,o);for(var h=1;2*this.nPeaks>h;h++){var l=Math.PI/this.nPeaks*h+this.initialAngle,u=0===h%2?s:r,c=i+u*Math.cos(l),d=n+u*Math.sin(l);e.lineTo(c,d)}e.lineTo(i+s*Math.cos(this.initialAngle),n+s*Math.sin(this.initialAngle)),e.closePath(),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&(e.strokeStyle=this.strokeStyle,e.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){return this.__super(),this.font="10px sans-serif",this.textAlign="left",this.outlineColor="black",this.clip=!1,this.__calcFontData(),this},font:null,fontData:null,textAlign:null,textBaseline:"top",fill:!0,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:!1,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:1e4,sign:1,lx:0,ly:0,setFill:function(t){return this.stopCacheAsBitmap(),this.fill=t,this},setLineWidth:function(t){return this.stopCacheAsBitmap(),this.lineWidth=t,this},setTextFillStyle:function(t){return this.stopCacheAsBitmap(),this.textFillStyle=t,this},setOutline:function(t){return this.stopCacheAsBitmap(),this.outline=t,this},setPathTraverseDirection:function(t){return this.sign=t,this},setOutlineColor:function(t){return this.stopCacheAsBitmap(),this.outlineColor=t,this},setText:function(t){return this.stopCacheAsBitmap(),this.text=t,(null===this.text||""===this.text)&&(this.width=this.height=0),this.calcTextSize(CAAT.currentDirector),this.invalidate(),this},setTextAlign:function(t){return this.textAlign=t,this.__setLocation(),this},setAlign:function(t){return this.setTextAlign(t)},setTextBaseline:function(t){return this.stopCacheAsBitmap(),this.textBaseline=t,this},setBaseline:function(t){return this.stopCacheAsBitmap(),this.setTextBaseline(t)},setFont:function(t){return this.stopCacheAsBitmap(),t||(t="10px sans-serif"),t instanceof CAAT.Module.Font.Font?t.setAsSpriteImage():t instanceof CAAT.Foundation.SpriteImage,this.font=t,this.__calcFontData(),this.calcTextSize(CAAT.director[0]),this},setLocation:function(t,e){return this.lx=t,this.ly=e,this.__setLocation(),this},setPosition:function(t,e){return this.lx=t,this.ly=e,this.__setLocation(),this},setBounds:function(t,e,i,n){return this.lx=t,this.ly=e,this.setSize(i,n),this.__setLocation(),this},setSize:function(t,e){return CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,t,e),this.__setLocation(),this},__setLocation:function(){var t,e;t="center"===this.textAlign?this.lx-this.width/2:"right"===this.textAlign||"end"===this.textAlign?this.lx-this.width:this.lx,e="bottom"===this.textBaseline?this.ly-this.height:"middle"===this.textBaseline?this.ly-this.height/2:"alphabetic"===this.textBaseline?this.ly-this.fontData.ascent:this.ly,CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,t,e)
},centerAt:function(t,e){return this.textAlign="left",this.textBaseline="top",CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,t,e)},calcTextSize:function(t){if(this.text===void 0||null===this.text||""===this.text)return this.textWidth=0,this.textHeight=0,this;if(t.glEnabled)return this;if(this.font instanceof CAAT.Foundation.SpriteImage)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;if(this.font instanceof CAAT.Module.Font.Font)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;var e=t.ctx;return e.save(),e.font=this.font,this.textWidth=e.measureText(this.text).width,0===this.width&&(this.width=this.textWidth),this.textHeight=this.fontData.height,this.setSize(this.textWidth,this.textHeight),e.restore(),this},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(t,e){if(this.text&&(CAAT.Foundation.UI.TextActor.superclass.paint.call(this,t,e),!this.cached&&null!==this.text)){(0===this.textWidth||0===this.textHeight)&&this.calcTextSize(t);var i=t.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage)return this.drawSpriteText(t,e),void 0;if(null!==this.font&&(i.font=this.font),i.textBaseline="alphabetic",null===this.path){null!==this.textAlign&&(i.textAlign=this.textAlign);var n=0;"center"===this.textAlign?n=0|this.width/2:"right"===this.textAlign&&(n=this.width),this.fill&&(null!==this.textFillStyle&&(i.fillStyle=this.textFillStyle),i.fillText(this.text,n,this.fontData.ascent)),this.outline&&(null!==this.outlineColor&&(i.strokeStyle=this.outlineColor),i.lineWidth=this.lineWidth,i.beginPath(),i.strokeText(this.text,n,this.fontData.ascent))}else this.drawOnPath(t,e)}},drawOnPath:function(t,e){var i=t.ctx;this.fill&&null!==this.textFillStyle&&(i.fillStyle=this.textFillStyle),this.outline&&null!==this.outlineColor&&(i.strokeStyle=this.outlineColor);for(var n=this.sign*this.pathInterpolator.getPosition(e%this.pathDuration/this.pathDuration).y*this.path.getLength(),s=new CAAT.Math.Point(0,0,0),r=new CAAT.Math.Point(0,0,0),a=0;this.text.length>a;a++){var o=""+this.text[a],h=i.measureText(o).width,l=n;s=this.path.getPositionFromLength(l).clone(),r=this.path.getPositionFromLength(l-.1).clone();var u=Math.atan2(s.y-r.y,s.x-r.x);i.save(),i.translate(s.x>>0,s.y>>0),i.rotate(u),this.fill&&i.fillText(o,0,0),this.outline&&(i.beginPath(),i.lineWidth=this.lineWidth,i.strokeText(o,0,0)),i.restore(),n+=h}},drawSpriteText:function(t,e){null===this.path?this.font.drawText(this.text,t.ctx,0,0):this.drawSpriteTextOnPath(t,e)},drawSpriteTextOnPath:function(t,e){for(var i=t.ctx,n=this.sign*this.pathInterpolator.getPosition(e%this.pathDuration/this.pathDuration).y*this.path.getLength(),s=new CAAT.Math.Point(0,0,0),r=new CAAT.Math.Point(0,0,0),a=0;this.text.length>a;a++){var o=""+this.text[a],h=this.font.stringWidth(o),l=h/2+n;s=this.path.getPositionFromLength(l).clone(),r=this.path.getPositionFromLength(l-.1).clone();var u=Math.atan2(s.y-r.y,s.x-r.x);i.save(),i.translate(0|s.x,0|s.y),i.rotate(u);var c="bottom"===this.textBaseline?0-this.font.getHeight():0;this.font.drawText(o,i,0,c),i.restore(),n+=h}},setPath:function(t,e,i){return this.path=t,this.pathInterpolator=e||(new CAAT.Behavior.Interpolator).createLinearInterpolator(),this.pathDuration=i||1e4,this.mouseEnabled=!1,this}}}),CAAT.ModuleManager.solveAll();
=======

/*
The MIT License

Copyright (c) 2010-2011-2012 Ibon Tolosana [@hyperandroid]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Version: 0.6 build: 1

Created on:
DATE: 2013-02-27
TIME: 08:56:48
*/


(function(a){function b(b){for(var b=b.split("."),c=a,d=0;d<b.length-1;d++)c[b[d]]||(c[b[d]]={}),c=c[b[d]]}function c(b,c){for(var d=b.split("."),e=a,g=0;g<d.length-1;g++){if(!e[d[g]])return console.log("    Error assigning value to namespace :"+b+". '"+d[g]+"' does not exist."),null;e=e[d[g]]}e[d[d.length-1]]=c;return e[d[d.length-1]]}String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1};Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=Array.prototype.slice.call(arguments),
c=b.shift();return function(){return a.apply(c,b.concat(Array.prototype.slice.call(arguments)))}};a.isArray=function(a){return typeof a=="object"&&a instanceof Array};a.isString=function(a){return typeof a=="string"};a.isFunction=function(a){return typeof a=="function"};var d=false,e=function(){};e.extend=function(a,g,f,h,i){function j(){!d&&this.__init&&this.__init.apply(this,arguments)}var r=this.prototype;d=true;var t=new this;d=false;j.prototype=t;j.prototype.constructor=j;j.superclass=r;j.extend=
e.extend;c(f,j);if(g){var g=isFunction(g)?g():g,s;for(s in g)g.hasOwnProperty(s)&&(j[s]=g[s])}if(h){isArray(h)||(h=[h]);for(f=0;f<h.length;f++){b(h[f]);var u=c(h[f],j);if(g)for(s in g)g.hasOwnProperty(s)&&(u[s]=g[s])}}var a=isFunction(a)?a():a,v;for(v in a)t[v]=(v==="__init"||i&&i.decorated)&&isFunction(a[v])&&isFunction(r[v])?function(a,b){return function(){var c=this.__super;this.__super=r[a];var d=b.apply(this,arguments);this.__super=c;return d}}(v,a[v]):a[v];return j};var f=function(a){this.name=
a.defines;this.extendWith=a.extendsWith;this.callback=a.onCreate;this.callbackPreCreation=a.onPreCreate;this.dependencies=a.depends;this.baseClass=a.extendsClass;this.aliases=a.aliases;this.constants=a.constants;this.decorated=a.decorated;this.children=[];return this};f.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:false,solved:false,visited:false,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?
" unsolved_deps:["+this.dependencies+"]":" no dependencies.")+(this.solved?" solved":" ------\> NOT solved."))},removeDependency:function(a){for(var b=0;b<this.dependencies.length;b++)if(this.dependencies[b]===a){this.dependencies.splice(b,1);break}},assignDependency:function(a){var b;for(b=0;b<this.dependencies.length;b++)if(this.dependencies[b]===a.name){this.children.push(a);this.dependencies.splice(b,1);break}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited)return true;
this.visited=true;if(this.solved)return true;if(this.dependencies.length!==0)return false;for(var a=0;a<this.children.length;a++)if(!this.children[a].solveDeep())return false;this.__initModule();this.solved=true;i.solved(this);return true},__initModule:function(){var b=null;if(this.baseClass){a:{for(var b=this.baseClass.split("."),c=a,d=0;d<b.length;d++){if(!c[b[d]]){b=null;break a}c=c[b[d]]}b=c}if(!b){console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass);return}}else b=
e;b.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated});console.log("Created module: "+this.name);this.callback&&this.callback()}};var g=function(a,b){this.path=a;this.module=b;return this};g.prototype={path:null,processed:false,module:null,setProcessed:function(){this.processed=true},isProcessed:function(){return this.processed}};var h=function(){this.nodes=[];this.loadedFiles=[];this.path={};this.solveListener=[];this.orderedSolvedModules=[];this.readyListener=
[];return this};h.baseURL="";h.modulePath={};h.sortedModulePath=[];h.symbol={};h.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(a,b){this.solveListener.push({name:a,callback:b})},solved:function(a){var b;for(b=0;b<this.solveListener.length;b++)this.solveListener[b].name===a.name&&this.solveListener[b].callback();this.orderedSolvedModules.push(a);this.notifyReady()},notifyReady:function(){var a;for(a=0;a<this.nodes.length;a++)if(!this.nodes[a].isSolved())return;
for(a=0;a<this.loadedFiles.length;a++)if(!this.loadedFiles[a].isProcessed())return;var b=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var a=0;a<b.length;a++)b[a]()},0);this.readyListener=[]},status:function(){for(var a=0;a<this.nodes.length;a++)this.nodes[a].status()},module:function(a){var b,c;if(this.isModuleScheduledToSolve(a.defines))return this;if(a.onPreCreate)try{a.onPreCreate()}catch(d){console.log("  -> catched "+d+" on module "+a.defines+" preCreation.")}if(!a.depends)a.depends=
[];if((b=a.depends)&&!isArray(b))b=[b],a.depends=b;for(c=0;c<b.length;)this.alreadySolved(b[c])?b.splice(c,1):c++;b=new f(a);for(c=0;c<this.nodes.length;c++)this.nodes[c].assignDependency(b);this.nodes.push(b);for(c=0;c<a.depends.length;)if(this.isModuleScheduledToSolve(a.depends[c])){var e=this.findNode(a.depends[c]);null!==e?b.assignDependency(e):(alert("Module loaded and does not exist in loaded modules nodes. "+a.depends[c]),c++)}else c+=1;(function(a,b){setTimeout(function(){for(c=0;c<b.depends.length;c++)a.loadFile(b.depends[c])},
0)})(this,a);return this},findNode:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a)return this.nodes[b];return null},alreadySolved:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a&&this.nodes[b].isSolved())return true;return false},exists:function(b){for(var b=b.split("."),c=a,d=0;d<b.length;d++){if(!c[b[d]])return false;c=c[b[d]]}return true},loadFile:function(a){if(!this.exists(a)){for(var b=this.getPath(a),c=0;c<this.loadedFiles.length;c++)if(this.loadedFiles[c].path===
b)return;this.loadedFiles.push(new g(b,a));c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.async=true;c.addEventListener("load",this.moduleLoaded.bind(this),false);c.addEventListener("error",this.moduleErrored.bind(this),false);c.setAttribute("module-name",a);c.src=b+(!j?"?"+(new Date).getTime():"");document.getElementsByTagName("head")[0].appendChild(c)}},getPath:function(a){if(a.endsWith(".js"))return a=a.charAt(0)!=="/"?h.baseURL+a:a.substring(1);var b,c;for(c in h.symbol)if(a===
c)return h.baseURL+h.symbol[c];for(b=0;b<h.sortedModulePath.length;b++){var d=h.sortedModulePath[b];if(h.modulePath.hasOwnProperty(d)&&(c=h.modulePath[d],a.indexOf(d)===0))return a=a.substring(d.length+1),a=a.replace(/\./g,"/"),a=c+a+".js",h.baseURL+a}return h.baseURL+a.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a)return true;return false},moduleLoaded:function(a){if(a.type==="load"){for(var b=(a.currentTarget||a.srcElement||
a.target).getAttribute("module-name"),a=0;a<this.loadedFiles.length;a++)if(this.loadedFiles[a].module===b){this.loadedFiles[a].setProcessed();break}for(a=0;a<this.nodes.length;a++)this.nodes[a].removeDependency(b);for(a=0;a<this.nodes.length;a++){for(b=0;b<this.nodes.length;b++)this.nodes[b].visited=false;this.nodes[a].solveDeep()}var c=this;setTimeout(function(){c.notifyReady()},0)}},moduleErrored:function(a){console.log("Error loading module: "+(a.currentTarget||a.srcElement).getAttribute("module-name"))},
solvedInOrder:function(){for(var a=0;a<this.orderedSolvedModules.length;a++)console.log(this.orderedSolvedModules[a].name)},solveAll:function(){for(var a=0;a<this.nodes.length;a++)this.nodes[a].solveDeep()},onReady:function(a){this.readyListener.push(a)}};var i=new h,j=false;a.CAAT=a.CAAT||{};CAAT.Module=function(a){a.defines?(b(a.defines),i.module(a)):console.error("Bad module definition: "+a)};CAAT.ModuleManager={};CAAT.ModuleManager.baseURL=function(a){if(!a)return CAAT.Module;a.endsWith("/")||
(a+="/");h.baseURL=a;return CAAT.ModuleManager};CAAT.ModuleManager.setModulePath=function(a,b){b.endsWith("/")||(b+="/");h.modulePath[a]||(h.modulePath[a]=b,h.sortedModulePath.push(a),h.sortedModulePath.sort(function(a,b){return a==b?0:a<b?1:-1}));return CAAT.ModuleManager};CAAT.ModuleManager.symbol=function(a,b){h.symbol[a]||(h.symbol[a]=b);return CAAT.ModuleManager};CAAT.ModuleManager.bring=function(a){isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)i.loadFile(a[b]);return CAAT.ModuleManager};CAAT.ModuleManager.status=
function(){i.status()};CAAT.ModuleManager.addModuleSolvedListener=function(a,b){i.addSolveListener(a,b);return CAAT.ModuleManager};CAAT.ModuleManager.load=function(a,b,c){var d=document.createElement("script");d.type="text/javascript";d.charset="utf-8";d.async=true;b&&d.addEventListener("load",b,false);c&&d.addEventListener("error",c,false);d.addEventListener("load",function(){i.solveAll()},false);d.src=a+(!j?"?"+(new Date).getTime():"");document.getElementsByTagName("head")[0].appendChild(d)};CAAT.ModuleManager.solvedInOrder=
function(){i.solvedInOrder()};CAAT.ModuleManager.onReady=function(a){i.onReady(a);return CAAT.ModuleManager};CAAT.ModuleManager.solveAll=function(){i.solveAll()};CAAT.ModuleManager.debug=function(a){j=a;return CAAT.ModuleManager};CAAT.Class=e})(this);
CAAT.Module({defines:"CAAT.Core.Constants",depends:["CAAT.Math.Matrix"],extendsWith:function(){CAAT.CLAMP=false;CAAT.setCoordinateClamping=function(a){CAAT.CLAMP=a;CAAT.Math.Matrix.setCoordinateClamping(a)};CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))};CAAT.CSS_TEXT_METRICS=0;CAAT.GLRENDER=false;CAAT.DEBUG=false;CAAT.DEBUGBB=false;CAAT.DEBUGBBBCOLOR="#00f";CAAT.DEBUGAABB=false;CAAT.DEBUGAABBCOLOR="#f00";CAAT.DEBUG_DIRTYRECTS=false;CAAT.DRAG_THRESHOLD_X=
5;CAAT.DRAG_THRESHOLD_Y=5;CAAT.CACHE_SCENE_ON_CHANGE=true;return{}}});extend=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype;a.prototype=new d;a.superclass=b.prototype;a.prototype.constructor=a;if(b.prototype.constructor===Object.prototype.constructor)b.prototype.constructor=b;for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])};
extendWith=function(a,b,c){var d=function(){};d.prototype=a.prototype;b.prototype=new d;b.superclass=a.prototype;b.prototype.constructor=b;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a;if(c)for(var e in c)c.hasOwnProperty(e)&&(b.prototype[e]=c[e])};
proxy=function(a,b,c,d){if(typeof a==="function")return a.__isProxy?a:function(a){var e=function(){b&&b({fn:a,arguments:Array.prototype.slice.call(arguments)});var e=null;try{e=a.apply(a,Array.prototype.slice.call(arguments)),c&&(e=c({fn:a,arguments:Array.prototype.slice.call(arguments)}))}catch(f){if(d)e=d({fn:a,arguments:Array.prototype.slice.call(arguments),exception:f});else throw f;}return e};e.__isProxy=true;for(var f in a)a.hasOwnProperty(f)&&typeof a[f]!=="function"&&f!=="__object"&&f!=="__isProxy"&&
function(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}(e,a,f);return e}(a);if(typeof a!=="object"||isArray(a)||isString(a)||a.__isProxy)return a;var e=new function(){};e.__object=a;e.__isProxy=true;for(var f in a)a.hasOwnProperty(f)&&typeof a[f]==="function"?e[f]=function(a,e,f){return function(){b&&b({object:a.__object,method:f,arguments:Array.prototype.slice.call(arguments)});var j=null;try{j=e.apply(a.__object,arguments),c&&c({object:a.__object,
method:f,arguments:Array.prototype.slice.call(arguments)})}catch(k){if(d)j=d({object:a.__object,method:f,arguments:Array.prototype.slice.call(arguments),exception:k});else throw k;}return j}}(e,a[f],f):f!=="__object"&&f!=="__isProxy"&&function(a,b){a.__defineGetter__(b,function(){return a.__object[b]});a.__defineSetter__(b,function(c){a.__object[b]=c})}(e,f);return e};
proxify=function(a,b,c,d,e,f){for(var g="__"+a+"__",h=window,i=a.split(".");i.length>1;)h=h[i.shift()];window[g]=h[i];(function(a,g,h,i,n){var q=function(){console.log("Creating object of type proxy["+n+"]");var g=new a[i](Array.prototype.slice.call(arguments));g.____name=n;return proxyObject(g,b,c,d,e,f)};q.prototype=a[i].prototype;for(var p in g[h])g[h].hasOwnProperty(p)&&typeof g[h][p]!=="function"&&p!=="__object"&&p!=="__isProxy"&&function(a,b,c){c.__defineGetter__(b,function(){return a[b]});
c.__defineSetter__(b,function(c){a[b]=c})}(g[h],p,q);g[h]=q})(window,h,i,g,a)};
proxyObject=function(a,b,c,d,e,f){if(typeof a!=="object"||isArray(a)||isString(a)||a.__isProxy)return a;a.$proxy__isProxy=true;for(var g in a)if(a.hasOwnProperty(g)&&g!=="constructor")if(typeof a[g]==="function"){var h=a[g];a["$proxy__"+g]=h;a[g]=function(a,e,g){return function(){var f=Array.prototype.slice.call(arguments);b&&b({object:a,objectName:a.____name,method:g,arguments:f});var h=null;try{h=e.apply(a,f),c&&c({object:a,objectName:a.____name,method:g,arguments:f})}catch(n){if(d)h=d({object:a,
objectName:a.____name,method:g,arguments:f,exception:n});else throw n;}return h}}(a,h,g)}else g!=="____name"&&function(a,b,c,d){a["$proxy__"+b]=a[b];a.__defineGetter__(b,function(){c&&c(a.____name,b);return a["$proxy__"+b]});a.__defineSetter__(b,function(c){a["$proxy__"+b]=c;d&&d(a.____name,b,c)})}(a,g,e,f);return a};CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}});
CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:false,applyAsPath:function(a){var b=this.coordlist;this.cubic?a.ctx.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y):a.ctx.quadraticCurveTo(b[1].x,b[1].y,b[2].x,b[2].y);return this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(a,b,c,d,e,f,g,h){this.coordlist=[];this.coordlist.push((new CAAT.Math.Point).set(a,
b));this.coordlist.push((new CAAT.Math.Point).set(c,d));this.coordlist.push((new CAAT.Math.Point).set(e,f));this.coordlist.push((new CAAT.Math.Point).set(g,h));this.cubic=true;this.update();return this},setQuadric:function(a,b,c,d,e,f){this.coordlist=[];this.coordlist.push((new CAAT.Math.Point).set(a,b));this.coordlist.push((new CAAT.Math.Point).set(c,d));this.coordlist.push((new CAAT.Math.Point).set(e,f));this.cubic=false;this.update();return this},setPoints:function(a){if(a.length===3)this.coordlist=
a,this.cubic=false,this.update();else if(a.length===4)this.coordlist=a,this.cubic=true,this.update();else throw"points must be an array of 3 or 4 CAAT.Point instances.";return this},paint:function(a){this.cubic?this.paintCubic(a):this.paintCuadric(a);CAAT.Math.Bezier.superclass.paint.call(this,a)},paintCuadric:function(a){var b,c;b=this.coordlist[0].x;c=this.coordlist[0].y;a=a.ctx;a.save();a.beginPath();a.moveTo(b,c);b=new CAAT.Math.Point;for(c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,
b.y);a.stroke();a.restore()},paintCubic:function(a){var b,c;b=this.coordlist[0].x;c=this.coordlist[0].y;a=a.ctx;a.save();a.beginPath();a.moveTo(b,c);b=new CAAT.Math.Point;for(c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,b.y);a.stroke();a.restore()},solve:function(a,b){return this.cubic?this.solveCubic(a,b):this.solveQuadric(a,b)},solveCubic:function(a,b){var c=b*b,d=b*c,e=this.coordlist,f=e[0],g=e[1],h=e[2],e=e[3];a.x=f.x+b*(-f.x*3+b*(3*f.x-f.x*b))+b*(3*g.x+b*(-6*g.x+g.x*3*b))+c*(h.x*
3-h.x*3*b)+e.x*d;a.y=f.y+b*(-f.y*3+b*(3*f.y-f.y*b))+b*(3*g.y+b*(-6*g.y+g.y*3*b))+c*(h.y*3-h.y*3*b)+e.y*d;return a},solveQuadric:function(a,b){var c=this.coordlist,d=c[0],e=c[1],c=c[2],f=1-b;a.x=f*f*d.x+2*f*b*e.x+b*b*c.x;a.y=f*f*d.y+2*f*b*e.y+b*b*c.y;return a}}}});
CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(a,b,c,d){this.coordlist=[];this.coordlist.push(a);this.coordlist.push(b);this.coordlist.push(c);this.coordlist.push(d);this.update();return this},paint:function(a){var b,c;b=this.coordlist[1].x;c=this.coordlist[1].y;var d=a.ctx;d.save();d.beginPath();d.moveTo(b,c);b=new CAAT.Point;for(c=this.k;c<=1+this.k;c+=this.k)this.solve(b,
c),d.lineTo(b.x,b.y);d.stroke();d.restore();CAAT.Math.CatmullRom.superclass.paint.call(this,a)},solve:function(a,b){var c=this.coordlist,d=((-b+2)*b-1)*b*0.5,e=((3*b-5)*b*b+2)*0.5,f=((-3*b+4)*b+1)*b*0.5,g=(b-1)*b*b*0.5;a.x=c[0].x*d+c[1].x*e+c[2].x*f+c[3].x*g;a.y=c[0].y*d+c[1].y*e+c[2].y*f+c[3].y*g;return a},applyAsPath:function(a){for(var a=a.ctx,b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,b.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-
2]},startCurvePosition:function(){return this.coordlist[1]}}}});
CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:0.05,length:-1,HANDLE_SIZE:20,drawHandles:true,paint:function(a){if(false!==this.drawHandles){var b=this.coordlist,a=a.ctx;a.save();a.beginPath();a.strokeStyle="#a0a0a0";a.moveTo(b[0].x,b[0].y);a.lineTo(b[1].x,b[1].y);a.stroke();this.cubic&&(a.moveTo(b[2].x,b[2].y),a.lineTo(b[3].x,b[3].y),a.stroke());a.globalAlpha=0.5;for(var c=0;c<this.coordlist.length;c++){a.fillStyle="#7f7f00";var d=
this.HANDLE_SIZE/2;a.beginPath();a.arc(b[c].x,b[c].y,d,0,2*Math.PI,false);a.fill()}a.restore()}},update:function(){this.calcLength()},solve:function(){},getContour:function(a){var b=[],c;for(c=0;c<=a;c++){var d=new CAAT.Math.Point;this.solve(d,c/a);b.push(d)}return b},getBoundingBox:function(a){a||(a=new CAAT.Math.Rectangle);a.setEmpty();a.union(this.coordlist[0].x,this.coordlist[0].y);for(var b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.union(b.x,b.y);return a},calcLength:function(){var a,
b;a=this.coordlist[0].x;b=this.coordlist[0].y;for(var c=0,d=new CAAT.Math.Point,e=this.k;e<=1+this.k;e+=this.k)this.solve(d,e),c+=Math.sqrt((d.x-a)*(d.x-a)+(d.y-b)*(d.y-b)),a=d.x,b=d.y;return this.length=c},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(){},setPoint:function(a,b){b>=0&&b<this.coordlist.length&&(this.coordlist[b]=a)},applyAsPath:function(){}}}});
CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(a,b){this.width=a;this.height=b;return this}}}});
CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp;CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},constants:{setCoordinateClamping:function(a){a?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=
CAAT.Matrix.prototype.transformRenderingContextSet_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContext=
CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)}},extendsWith:function(){return{matrix:null,__init:function(){this.matrix=[1,0,0,0,1,0,0,0,1];if(typeof Float32Array!=="undefined")this.matrix=new Float32Array(this.matrix);return this},transformCoord:function(a){var b=a.x,c=a.y,d=this.matrix;a.x=b*d[0]+c*d[1]+d[2];a.y=b*d[3]+c*d[4]+d[5];return a},rotate:function(a){var b=new CAAT.Math.Matrix;
b.setRotation(a);return b},setRotation:function(a){this.identity();var b=this.matrix,c=Math.cos(a),a=Math.sin(a);b[0]=c;b[1]=-a;b[3]=a;b[4]=c;return this},scale:function(a,b){var c=new CAAT.Math.Matrix;c.matrix[0]=a;c.matrix[4]=b;return c},setScale:function(a,b){this.identity();this.matrix[0]=a;this.matrix[4]=b;return this},translate:function(a,b){var c=new CAAT.Math.Matrix;c.matrix[2]=a;c.matrix[5]=b;return c},setTranslate:function(a,b){this.identity();this.matrix[2]=a;this.matrix[5]=b;return this},
copy:function(a){var a=a.matrix,b=this.matrix;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this},identity:function(){var a=this.matrix;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this},multiply:function(a){var b=this.matrix,c=a.matrix,a=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],m=c[0],o=c[1],n=c[2],q=c[3],p=c[4],r=c[5],t=c[6],s=c[7],c=c[8];b[0]=a*m+d*q+e*t;b[1]=a*o+d*p+e*s;b[2]=a*n+d*r+e*c;b[3]=f*m+g*
q+h*t;b[4]=f*o+g*p+h*s;b[5]=f*n+g*r+h*c;b[6]=i*m+j*q+k*t;b[7]=i*o+j*p+k*s;b[8]=i*n+j*r+k*c;return this},premultiply:function(a){var b=a.matrix[0]*this.matrix[1]+a.matrix[1]*this.matrix[4]+a.matrix[2]*this.matrix[7],c=a.matrix[0]*this.matrix[2]+a.matrix[1]*this.matrix[5]+a.matrix[2]*this.matrix[8],d=a.matrix[3]*this.matrix[0]+a.matrix[4]*this.matrix[3]+a.matrix[5]*this.matrix[6],e=a.matrix[3]*this.matrix[1]+a.matrix[4]*this.matrix[4]+a.matrix[5]*this.matrix[7],f=a.matrix[3]*this.matrix[2]+a.matrix[4]*
this.matrix[5]+a.matrix[5]*this.matrix[8],g=a.matrix[6]*this.matrix[0]+a.matrix[7]*this.matrix[3]+a.matrix[8]*this.matrix[6],h=a.matrix[6]*this.matrix[1]+a.matrix[7]*this.matrix[4]+a.matrix[8]*this.matrix[7],i=a.matrix[6]*this.matrix[2]+a.matrix[7]*this.matrix[5]+a.matrix[8]*this.matrix[8];this.matrix[0]=a.matrix[0]*this.matrix[0]+a.matrix[1]*this.matrix[3]+a.matrix[2]*this.matrix[6];this.matrix[1]=b;this.matrix[2]=c;this.matrix[3]=d;this.matrix[4]=e;this.matrix[5]=f;this.matrix[6]=g;this.matrix[7]=
h;this.matrix[8]=i;return this},getInverse:function(){var a=this.matrix,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],a=a[8],j=new CAAT.Math.Matrix,k=b*(f*a-i*g)-e*(c*a-i*d)+h*(c*g-f*d);if(k===0)return null;var m=j.matrix;m[0]=f*a-g*i;m[1]=d*i-c*a;m[2]=c*g-d*f;m[3]=g*h-e*a;m[4]=b*a-d*h;m[5]=d*e-b*g;m[6]=e*i-f*h;m[7]=c*h-b*i;m[8]=b*f-c*e;j.multiplyScalar(1/k);return j},multiplyScalar:function(a){var b;for(b=0;b<9;b++)this.matrix[b]*=a;return this},transformRenderingContextSet_NoClamp:function(a){var b=
this.matrix;a.setTransform(b[0],b[3],b[1],b[4],b[2],b[5]);return this},transformRenderingContext_NoClamp:function(a){var b=this.matrix;a.transform(b[0],b[3],b[1],b[4],b[2],b[5]);return this},transformRenderingContextSet_Clamp:function(a){var b=this.matrix;a.setTransform(b[0],b[3],b[1],b[4],b[2]>>0,b[5]>>0);return this},transformRenderingContext_Clamp:function(a){var b=this.matrix;a.transform(b[0],b[3],b[1],b[4],b[2]>>0,b[5]>>0);return this},setModelViewMatrix:function(a,b,c,d,e){var f,g,h,i,j,k;k=
this.matrix;d=1;j=g=0;i=1;c=Math.cos(e);e=Math.sin(e);f=d;h=j;d=f*c+g*e;g=-f*e+g*c;j=h*c+i*e;i=-h*e+i*c;d*=this.scaleX;g*=this.scaleY;j*=this.scaleX;i*=this.scaleY;k[0]=d;k[1]=g;k[2]=a;k[3]=j;k[4]=i;k[5]=b}}}});
CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this},transformCoord:function(a){var b=a.x,c=a.y,d=a.z;a.x=b*this.matrix[0][0]+c*this.matrix[0][1]+d*this.matrix[0][2]+this.matrix[0][3];a.y=b*this.matrix[1][0]+c*this.matrix[1][1]+d*this.matrix[1][2]+this.matrix[1][3];a.z=b*this.matrix[2][0]+c*this.matrix[2][1]+
d*this.matrix[2][2]+this.matrix[2][3];return a},initialize:function(a,b,c,d,e,f,g,h,i){this.identity();this.matrix[0][0]=a;this.matrix[0][1]=b;this.matrix[0][2]=c;this.matrix[1][0]=d;this.matrix[1][1]=e;this.matrix[1][2]=f;this.matrix[2][0]=g;this.matrix[2][1]=h;this.matrix[2][2]=i;return this},initWithMatrix:function(a){this.matrix=a;return this},flatten:function(){var a=this.fmatrix,b=this.matrix;a[0]=b[0][0];a[1]=b[1][0];a[2]=b[2][0];a[3]=b[3][0];a[4]=b[0][1];a[5]=b[1][1];a[6]=b[2][1];a[7]=b[2][1];
a[8]=b[0][2];a[9]=b[1][2];a[10]=b[2][2];a[11]=b[3][2];a[12]=b[0][3];a[13]=b[1][3];a[14]=b[2][3];a[15]=b[3][3];return this.fmatrix},identity:function(){for(var a=0;a<4;a++)for(var b=0;b<4;b++)this.matrix[a][b]=a===b?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(a){return this.rotate(a,0,0)},rotateXZ:function(a){return this.rotate(0,a,0)},rotateYZ:function(a){return this.rotate(0,0,a)},setRotate:function(a,b,c){this.copy(this.rotate(a,b,c));return this},rotate:function(a,
b,c){var d=new CAAT.Math.Matrix3,e,f;a!==0&&(f=new CAAT.Math.Math.Matrix3,e=Math.sin(a),a=Math.cos(a),f.matrix[1][1]=a,f.matrix[1][2]=-e,f.matrix[2][1]=e,f.matrix[2][2]=a,d.multiply(f));b!==0&&(f=new CAAT.Math.Matrix3,e=Math.sin(b),a=Math.cos(b),f.matrix[0][0]=a,f.matrix[0][2]=-e,f.matrix[2][0]=e,f.matrix[2][2]=a,d.multiply(f));c!==0&&(f=new CAAT.Math.Matrix3,e=Math.sin(c),a=Math.cos(c),f.matrix[0][0]=a,f.matrix[0][1]=-e,f.matrix[1][0]=e,f.matrix[1][1]=a,d.multiply(f));return d},getClone:function(){var a=
new CAAT.Math.Matrix3;a.copy(this);return a},multiply:function(a){var b=this.getClone().matrix,c=b[0][0],d=b[0][1],e=b[0][2],f=b[0][3],g=b[1][0],h=b[1][1],i=b[1][2],j=b[1][3],k=b[2][0],m=b[2][1],o=b[2][2],b=b[2][3],n=a.matrix,a=n[0][0],q=n[0][1],p=n[0][2],r=n[0][3],t=n[1][0],s=n[1][1],u=n[1][2],v=n[1][3],w=n[2][0],x=n[2][1],y=n[2][2],z=n[2][3],A=n[3][0],B=n[3][1],C=n[3][2],n=n[3][3];this.matrix[0][0]=c*a+d*t+e*w+f*A;this.matrix[0][1]=c*q+d*s+e*x+f*B;this.matrix[0][2]=c*p+d*u+e*y+f*C;this.matrix[0][3]=
c*r+d*v+e*z+f*n;this.matrix[1][0]=g*a+h*t+i*w+j*A;this.matrix[1][1]=g*q+h*s+i*x+j*B;this.matrix[1][2]=g*p+h*u+i*y+j*C;this.matrix[1][3]=g*r+h*v+i*z+j*n;this.matrix[2][0]=k*a+m*t+o*w+b*A;this.matrix[2][1]=k*q+m*s+o*x+b*B;this.matrix[2][2]=k*p+m*u+o*y+b*C;this.matrix[2][3]=k*r+m*v+o*z+b*n;return this},premultiply:function(a){var b=this.getClone().matrix,c=b[0][0],d=b[0][1],e=b[0][2],f=b[0][3],g=b[1][0],h=b[1][1],i=b[1][2],j=b[1][3],k=b[2][0],m=b[2][1],o=b[2][2],b=b[2][3],n=a.matrix,a=n[0][0],q=n[0][1],
p=n[0][2],r=n[0][3],t=n[1][0],s=n[1][1],u=n[1][2],v=n[1][3],w=n[2][0],x=n[2][1],y=n[2][2],n=n[2][3];this.matrix[0][0]=c*a+d*t+e*w;this.matrix[0][1]=c*q+d*s+e*x;this.matrix[0][2]=c*p+d*u+e*y;this.matrix[0][3]=c*r+d*v+e*n+f;this.matrix[1][0]=g*a+h*t+i*w;this.matrix[1][1]=g*q+h*s+i*x;this.matrix[1][2]=g*p+h*u+i*y;this.matrix[1][3]=g*r+h*v+i*n+j;this.matrix[2][0]=k*a+m*t+o*w;this.matrix[2][1]=k*q+m*s+o*x;this.matrix[2][2]=k*p+m*u+o*y;this.matrix[2][3]=k*r+m*v+o*n+b;return this},setTranslate:function(a,
b,c){this.identity();this.matrix[0][3]=a;this.matrix[1][3]=b;this.matrix[2][3]=c;return this},translate:function(a,b,c){var d=new CAAT.Math.Matrix3;d.setTranslate(a,b,c);return d},setScale:function(a,b,c){this.identity();this.matrix[0][0]=a;this.matrix[1][1]=b;this.matrix[2][2]=c;return this},scale:function(a,b,c){var d=new CAAT.Math.Matrix3;d.setScale(a,b,c);return d},rotateModelView:function(a,b,c){var d=Math.sin(a),e=Math.sin(b),f=Math.sin(c),a=Math.cos(a),b=Math.cos(b),c=Math.cos(c);this.matrix[0][0]=
b*a;this.matrix[0][1]=-b*d;this.matrix[0][2]=e;this.matrix[0][3]=0;this.matrix[1][0]=f*e*a+d*c;this.matrix[1][1]=c*a-f*e*d;this.matrix[1][2]=-f*b;this.matrix[1][3]=0;this.matrix[2][0]=f*d-c*e*a;this.matrix[2][1]=c*e*d+f*a;this.matrix[2][2]=c*b;this.matrix[2][3]=0;this.matrix[3][0]=0;this.matrix[3][1]=0;this.matrix[3][2]=0;this.matrix[3][3]=1;return this},copy:function(a){for(var b=0;b<4;b++)for(var c=0;c<4;c++)this.matrix[b][c]=a.matrix[b][c];return this},calculateDeterminant:function(){var a=this.matrix,
b=a[0][0],c=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],m=a[2][2],o=a[2][3],n=a[3][0],q=a[3][1],p=a[3][2],a=a[3][3];return e*g*m*n+c*i*m*n+e*h*j*q+d*i*j*q+d*f*o*q+b*h*o*q+e*f*k*p+b*i*k*p+d*g*j*a+c*h*j*a+c*f*m*a+b*g*m*a+e*h*k*n-d*i*k*n-d*g*o*n-c*h*o*n-e*f*m*q-b*i*m*q-e*g*j*p-c*i*j*p-c*f*o*p-b*g*o*p-d*f*k*a-b*h*k*a},getInverse:function(){var a=this.matrix,b=a[0][0],c=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],m=
a[2][2],o=a[2][3],n=a[3][0],q=a[3][1],p=a[3][2],a=a[3][3],r=new CAAT.Math.Matrix3;r.matrix[0][0]=h*o*q+i*k*p+g*m*a-i*m*q-g*o*p-h*k*a;r.matrix[0][1]=e*m*q+c*o*p+d*k*a-c*m*a-d*o*q-e*k*p;r.matrix[0][2]=d*i*q+c*h*a+e*g*p-c*i*p-d*g*a-e*h*q;r.matrix[0][3]=e*h*k+c*i*m+d*g*o-d*i*k-e*g*m-c*h*o;r.matrix[1][0]=i*m*n+f*o*p+h*j*a-h*o*n-i*j*p-f*m*a;r.matrix[1][1]=d*o*n+e*j*p+b*m*a-e*m*n-b*o*p-d*j*a;r.matrix[1][2]=e*h*n+b*i*p+d*f*a-d*i*n-e*f*p-b*h*a;r.matrix[1][3]=d*i*j+e*f*m+b*h*o-e*h*j-b*i*m-d*f*o;r.matrix[2][0]=
g*o*n+i*j*q+f*k*a-i*k*n-f*o*q-g*j*a;r.matrix[2][1]=e*k*n+b*o*q+c*j*a-b*k*a-c*o*n-e*j*q;r.matrix[2][2]=d*i*n+e*f*q+b*g*a-e*g*n-b*i*q-c*f*a;r.matrix[2][3]=e*g*j+b*i*k+c*f*o-b*g*o-c*i*j-e*f*k;r.matrix[3][0]=h*k*n+f*m*q+g*j*p-g*m*n-h*j*q-f*k*p;r.matrix[3][1]=c*m*n+d*j*q+b*k*p-d*k*n-b*m*q-c*j*p;r.matrix[3][2]=d*g*n+b*h*q+c*f*p-b*g*p-c*h*n-d*f*q;r.matrix[3][3]=c*h*j+d*f*k+b*g*m-d*g*j-b*h*k-c*f*m;return r.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(a){var b,c;for(b=0;b<4;b++)for(c=
0;c<4;c++)this.matrix[b][c]*=a;return this}}}});
CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(a,b,c){this.x=a;this.y=b;this.z=c||0;return this},set:function(a,b,c){this.x=a;this.y=b;this.z=c||0;return this},clone:function(){return new CAAT.Math.Point(this.x,this.y,this.z)},translate:function(a,b,c){this.x+=a;this.y+=b;this.z+=c;return this},translatePoint:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},multiply:function(a){this.x*=a;this.y*=a;this.z*=a;return this},rotate:function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-Math.sin(a)*c;this.y=b*Math.sin(a)+Math.cos(a)*c;this.z=0;return this},setAngle:function(a){var b=this.getLength();this.x=Math.cos(a)*b;this.y=Math.sin(a)*b;this.z=0;return this},setLength:function(a){var b=this.getLength();b?this.multiply(a/b):this.x=this.y=this.z=a;return this},normalize:function(){var a=this.getLength();this.x/=a;this.y/=a;this.z/=a;return this},
getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(a){var b=this.getLengthSquared();if(b+0.01>a*a)b=Math.sqrt(b),this.x=this.x/b*a,this.y=this.y/b*a,this.z=this.z/b*a;return this},getLength:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a<0.0050&&a>-0.0050?1.0E-6:a},getLengthSquared:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;return a<0.0050&&a>-0.0050?0:a},getDistance:function(a){var b=this.x-a.x,c=this.y-a.y,a=this.z-a.z;return Math.sqrt(b*
b+c*c+a*a)},getDistanceSquared:function(a){var b=this.x-a.x,c=this.y-a.y,a=this.z-a.z;return b*b+c*c+a*a},toString:function(){return"(CAAT.Math.Point) x:"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)+" z:"+String(Math.round(Math.floor(this.z*10))/10)}}}});
CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(a,b,c,d){this.setLocation(a,b);this.setDimension(c,d)},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){this.height=this.width=-1;this.y1=this.x1=this.y=this.x=0;return this},setLocation:function(a,b){this.x=a;this.y=b;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setDimension:function(a,b){this.width=a;this.height=b;this.x1=this.x+this.width;this.y1=this.y+
this.height;return this},setBounds:function(a,b,c,d){this.setLocation(a,b);this.setDimension(c,d);return this},contains:function(a,b){return a>=this.x&&a<this.x1&&b>=this.y&&b<this.y1},isEmpty:function(){return this.width===-1&&this.height===-1},union:function(a,b){if(this.isEmpty())this.x1=this.x=a,this.y1=this.y=b,this.height=this.width=0;else{this.x1=this.x+this.width;this.y1=this.y+this.height;if(b<this.y)this.y=b;if(a<this.x)this.x=a;if(b>this.y1)this.y1=b;if(a>this.x1)this.x1=a;this.width=this.x1-
this.x;this.height=this.y1-this.y}},unionRectangle:function(a){this.union(a.x,a.y);this.union(a.x1,a.y);this.union(a.x,a.y1);this.union(a.x1,a.y1);return this},intersects:function(a){return a.isEmpty()||this.isEmpty()?false:a.x1<=this.x?false:a.x>=this.x1?false:a.y1<=this.y?false:a.y<this.y1},intersectsRect:function(a,b,c,d){return-1===c||-1===d?false:a+c-1<this.x?false:a>this.x1?false:b+d-1<this.y?false:b<=this.y1},intersect:function(a,b){typeof b==="undefined"&&(b=new CAAT.Math.Rectangle);b.x=Math.max(this.x,
a.x);b.y=Math.max(this.y,a.y);b.x1=Math.min(this.x1,a.x1);b.y1=Math.min(this.y1,a.y1);b.width=b.x1-b.x;b.height=b.y1-b.y;return b}}}});
CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[(new CAAT.Behavior.Interpolator).createLinearInterpolator(false,false),"Linear pingpong=false, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(true,false),"Linear pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(false,true),"Linear pingpong=false, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(true,
true),"Linear pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,false),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,false),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,false),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,true),"ExponentialIn pingpong=true, exponent=2",
(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,true),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,true),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,false),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,false),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,
false),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,true),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,true),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,true),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,false),"ExponentialIn pingpong=false, exponent=6",
(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,false),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,false),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,true),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,true),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,
true),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(false),"BounceIn pingpong=false",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(false),"BounceOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(false),"BounceInOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(true),"BounceIn pingpong=true",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(true),"BounceOut pingpong=true",
(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(true),"BounceInOut pingpong=true",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,0.4,false),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,0.4,false),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,0.4,false),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,
0.4,true),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,0.4,true),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,0.4,true),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,0.2,false),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,0.2,false),"ElasticOut pingpong=false, amp=1.0, d=.2",
(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,0.2,false),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,0.2,true),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,0.2,true),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,0.2,true),"ElasticInOut pingpong=true, amp=1.0, d=.2"]},parse:function(a){var b="create"+
a.type+"Interpolator",c=new CAAT.Behavior.Interpolator;try{c[b].apply(c,a.params||[])}catch(d){c.createLinearInterpolator(false,false)}return c}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){this.interpolated=new CAAT.Math.Point(0,0,0);return this},createLinearInterpolator:function(a,b){this.getPosition=function(c){var d=c;a&&(c<0.5?c*=2:c=1-(c-0.5)*2);b!==null&&b&&(c=1-c);return this.interpolated.set(d,c)};return this},createBackOutInterpolator:function(a){this.getPosition=
function(b){var c=b;a&&(b<0.5?b*=2:b=1-(b-0.5)*2);b-=1;return this.interpolated.set(c,b*b*(2.70158*b+1.70158)+1)};return this},createExponentialInInterpolator:function(a,b){this.getPosition=function(c){var d=c;b&&(c<0.5?c*=2:c=1-(c-0.5)*2);return this.interpolated.set(d,Math.pow(c,a))};return this},createExponentialOutInterpolator:function(a,b){this.getPosition=function(c){var d=c;b&&(c<0.5?c*=2:c=1-(c-0.5)*2);return this.interpolated.set(d,1-Math.pow(1-c,a))};return this},createExponentialInOutInterpolator:function(a,
b){this.getPosition=function(c){var d=c;b&&(c<0.5?c*=2:c=1-(c-0.5)*2);return c*2<1?this.interpolated.set(d,Math.pow(c*2,a)/2):this.interpolated.set(d,1-Math.abs(Math.pow(c*2-2,a))/2)};return this},createQuadricBezierInterpolator:function(a,b,c,d){this.getPosition=function(e){var f=e;d&&(e<0.5?e*=2:e=1-(e-0.5)*2);e=(1-e)*(1-e)*a.y+2*(1-e)*e*b.y+e*e*c.y;return this.interpolated.set(f,e)};return this},createCubicBezierInterpolator:function(a,b,c,d,e){this.getPosition=function(f){var g=f;e&&(f<0.5?f*=
2:f=1-(f-0.5)*2);var h=f*f,f=a.y+f*(-a.y*3+f*(3*a.y-a.y*f))+f*(3*b.y+f*(-6*b.y+b.y*3*f))+h*(c.y*3-c.y*3*f)+d.y*f*h;return this.interpolated.set(g,f)};return this},createElasticOutInterpolator:function(a,b,c){this.getPosition=function(d){c&&(d<0.5?d*=2:d=1-(d-0.5)*2);if(d===0)return{x:0,y:0};if(d===1)return{x:1,y:1};var e=b/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(d,a*Math.pow(2,-10*d)*Math.sin((d-e)*2*Math.PI/b)+1)};return this},createElasticInInterpolator:function(a,b,c){this.getPosition=
function(d){c&&(d<0.5?d*=2:d=1-(d-0.5)*2);if(d===0)return{x:0,y:0};if(d===1)return{x:1,y:1};var e=b/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(d,-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*2*Math.PI/b)))};return this},createElasticInOutInterpolator:function(a,b,c){this.getPosition=function(d){c&&(d<0.5?d*=2:d=1-(d-0.5)*2);var e=b/(2*Math.PI)*Math.asin(1/a);d*=2;return d<=1?this.interpolated.set(d,-0.5*a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*2*Math.PI/b)):this.interpolated.set(d,1+0.5*a*Math.pow(2,
-10*(d-=1))*Math.sin((d-e)*2*Math.PI/b))};return this},bounce:function(a){return(a/=1)<1/2.75?{x:a,y:7.5625*a*a}:a<2/2.75?{x:a,y:7.5625*(a-=1.5/2.75)*a+0.75}:a<2.5/2.75?{x:a,y:7.5625*(a-=2.25/2.75)*a+0.9375}:{x:a,y:7.5625*(a-=2.625/2.75)*a+0.984375}},createBounceOutInterpolator:function(a){this.getPosition=function(b){a&&(b<0.5?b*=2:b=1-(b-0.5)*2);return this.bounce(b)};return this},createBounceInInterpolator:function(a){this.getPosition=function(b){a&&(b<0.5?b*=2:b=1-(b-0.5)*2);b=this.bounce(1-b);
b.y=1-b.y;return b};return this},createBounceInOutInterpolator:function(a){this.getPosition=function(b){a&&(b<0.5?b*=2:b=1-(b-0.5)*2);if(b<0.5)return b=this.bounce(1-b*2),b.y=(1-b.y)*0.5,b;b=this.bounce(b*2-1,a);b.y=b.y*0.5+0.5;return b};return this},paint:function(a){a.save();a.beginPath();a.moveTo(0,this.getPosition(0).y*this.paintScale);for(var b=0;b<=this.paintScale;b++)a.lineTo(b,this.getPosition(b/this.paintScale).y*this.paintScale);a.strokeStyle="black";a.stroke();a.restore()},getContour:function(a){for(var b=
[],c=0;c<=a;c++)b.push({x:c/a,y:this.getPosition(c/a).y});return b}}}});
CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2},parse:function(a){function b(a){for(var a=a.split("."),b=window,c=0;c<a.length;c++){if(!b[a[c]])return null;b=b[a[c]]}return b}try{var c=a.type.toLowerCase(),c="CAAT.Behavior."+c.substr(0,1).toUpperCase()+c.substr(1)+"Behavior",d=new new b(c);d.parse(a);return d}catch(e){console.log("Error parsing behavior: "+e)}return null}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var a=(new CAAT.Behavior.Interpolator).createLinearInterpolator(false),
b=(new CAAT.Behavior.Interpolator).createLinearInterpolator(true);return{__init:function(){this.lifecycleListenerList=[];this.setDefaultInterpolator();return this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:false,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:true,solved:true,discardable:false,parse:function(a){a.pingpong&&this.setPingPong();a.cycle&&this.setCycle(true);this.setDelayTime(a.delay||
0,a.duration||1E3);a.interpolator&&this.setInterpolator(CAAT.Behavior.Interpolator.parse(a.interpolator))},setValueApplication:function(a){this.doValueApplication=a;return this},setTimeOffset:function(a){this.timeOffset=a;return this},setStatus:function(a){this.status=a;return this},setId:function(a){this.id=a;return this},setDefaultInterpolator:function(){this.interpolator=a;return this},setPingPong:function(){this.interpolator=b;return this},setFrameTime:function(a,b){this.behaviorStartTime=a;this.behaviorDuration=
b;this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED;return this},setDelayTime:function(a,b){this.behaviorStartTime=a;this.behaviorDuration=b;this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED;this.expired=this.solved=false;return this},setOutOfFrameTime:function(){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED;this.behaviorStartTime=Number.MAX_VALUE;this.behaviorDuration=0;return this},setInterpolator:function(a){this.interpolator=a;return this},apply:function(a,b){if(!this.solved)this.behaviorStartTime+=
a,this.solved=true;a+=this.timeOffset*this.behaviorDuration;var e=a;this.isBehaviorInTime(a,b)&&(a=this.normalizeTime(a),this.fireBehaviorAppliedEvent(b,e,a,this.setForTime(a,b)))},setCycle:function(a){this.cycleBehavior=a;return this},addListener:function(a){this.lifecycleListenerList.push(a);return this},emptyListenerList:function(){this.lifecycleListenerList=[];return this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(a,
b){var e=CAAT.Behavior.BaseBehavior.Status;if(this.status===e.EXPIRED||this.behaviorStartTime<0)return false;this.cycleBehavior&&a>=this.behaviorStartTime&&(a=(a-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime);if(a>this.behaviorStartTime+this.behaviorDuration)return this.status!==e.EXPIRED&&this.setExpired(b,a),false;if(this.status===e.NOT_STARTED)this.status=e.STARTED,this.fireBehaviorStartedEvent(b,a);return this.behaviorStartTime<=a},fireBehaviorStartedEvent:function(a,b){for(var e=
0,f=this.lifecycleListenerList.length;e<f;e++){var g=this.lifecycleListenerList[e];g.behaviorStarted&&g.behaviorStarted(this,b,a)}},fireBehaviorExpiredEvent:function(a,b){for(var e=0,f=this.lifecycleListenerList.length;e<f;e++){var g=this.lifecycleListenerList[e];g.behaviorExpired&&g.behaviorExpired(this,b,a)}},fireBehaviorAppliedEvent:function(a,b,e,f){for(var g=0,h=this.lifecycleListenerList.length;g<h;g++){var i=this.lifecycleListenerList[g];i.behaviorApplied&&i.behaviorApplied(this,b,e,a,f)}},
normalizeTime:function(a){a-=this.behaviorStartTime;this.cycleBehavior&&(a%=this.behaviorDuration);return this.interpolator.getPosition(a/this.behaviorDuration).y},setExpired:function(a,b){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED;this.setForTime(this.interpolator.getPosition(1).y,a);this.fireBehaviorExpiredEvent(a,b);this.discardable&&this.actor.removeBehavior(this)},setForTime:function(){},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this},getPropertyName:function(){return""},
calculateKeyFrameData:function(){},getKeyFrameDataValues:function(){},calculateKeyFramesData:function(){}}}});
CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,parse:function(a){CAAT.Behavior.AlphaBehavior.superclass.parse.call(this,a);this.startAlpha=a.start||0;this.endAlpha=a.end||0},getPropertyName:function(){return"opacity"},setForTime:function(a,b){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,a,b);var c=this.startAlpha+a*
(this.endAlpha-this.startAlpha);this.doValueApplication&&b.setAlpha(c);return c},setValues:function(a,b){this.startAlpha=a;this.endAlpha=b;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return this.startAlpha+a*(this.endAlpha-this.startAlpha)},getKeyFrameDataValues:function(a){a=this.interpolator.getPosition(a).y;return{alpha:this.startAlpha+a*(this.endAlpha-this.startAlpha)}},calculateKeyFramesData:function(a,b,c){typeof c==="undefined"&&(c=100);c>>=0;for(var d=
"@-"+a+"-keyframes "+b+" {",a=0;a<=c;a++)b=""+a/c*100+"%{opacity: "+this.calculateKeyFrameData(a/c)+"}",d+=b;d+="}";return d}}}});
CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(a){if(a.behaviors&&a.behaviors.length)for(var b=0;b<a.behaviors.length;b+=1)this.addBehavior(CAAT.Behavior.BaseBehavior.parse(a.behaviors[b]));CAAT.Behavior.ContainerBehavior.superclass.parse.call(this,a)},behaviors:null,__init:function(){this.__super();
this.behaviors=[];return this},conformToDuration:function(a){this.duration=a;a/=this.duration;for(var b,c=0;c<this.behaviors.length;c++)b=this.behaviors[c],b.setFrameTime(b.getStartTime()*a,b.getDuration()*a);return this},getBehaviorById:function(a){for(var b=0;b<this.behaviors.length;b++)if(this.behaviors[b].id===a)return this.behaviors[b];return null},addBehavior:function(a){this.behaviors.push(a);a.addListener(this);return this},apply:function(a,b){if(!this.solved)this.behaviorStartTime+=a,this.solved=
true;a+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(a,b)){a-=this.getStartTime();this.cycleBehavior&&(a%=this.getDuration());for(var c=this.behaviors,d=0;d<c.length;d++)c[d].apply(a,b)}},behaviorExpired:function(a){this.cycleBehavior&&a.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)},setForTime:function(a,b){for(var c=this.behaviors,d=0;d<c.length;d++)c[d].setForTime(a,b);return null},setExpired:function(a,b){for(var c=this.behaviors,d=0;d<c.length;d++){var e=c[d];e.status!==
CAAT.Behavior.BaseBehavior.Status.EXPIRED&&e.setExpired(a,b-this.behaviorStartTime)}CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,a,b);return this},setFrameTime:function(a,b){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,a,b);for(var c=this.behaviors,d=0;d<c.length;d++)c[d].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},setDelayTime:function(a,b){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,a,b);for(var c=this.behaviors,
d=0;d<c.length;d++)c[d].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},getKeyFrameDataValues:function(a){var b,c,d,e={angle:0,scaleX:1,scaleY:1,x:0,y:0};for(b=0;b<this.behaviors.length;b++)if(c=this.behaviors[b],c.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(c instanceof CAAT.Behavior.GenericBehavior)&&(d=a*this.behaviorDuration,c.behaviorStartTime<=d&&c.behaviorStartTime+c.behaviorDuration>=d)){d=(d-c.behaviorStartTime)/c.behaviorDuration;c=c.getKeyFrameDataValues(d);
for(var f in c)e[f]=c[f]}return e},calculateKeyFrameData:function(a,b){function c(a){if(f[a])h+=f[a];else if(prevValues&&(i=prevValues[a]))h+=i,f[a]=i}var d,e,f={},g;for(d=0;d<this.behaviors.length;d++)e=this.behaviors[d],e.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(e instanceof CAAT.Behavior.GenericBehavior)&&(g=a*this.behaviorDuration,e.behaviorStartTime<=g&&e.behaviorStartTime+e.behaviorDuration>=g&&(g=(g-e.behaviorStartTime)/e.behaviorDuration,g=e.calculateKeyFrameData(g),e=e.getPropertyName(b),
typeof f[e]==="undefined"&&(f[e]=""),f[e]+=g+" "));var h="",i;c("translate");c("rotate");c("scale");d="";h&&(d="-"+b+"-transform: "+h+";");h="";c("opacity");h&&(d+=" opacity: "+h+";");d+=" -webkit-transform-origin: 0% 0%";return{rules:d,ret:f}},calculateKeyFramesData:function(a,b,c,d,e){if(this.duration===Number.MAX_VALUE)return"";typeof d==="undefined"&&(d=0.5);typeof e==="undefined"&&(e=0.5);typeof c==="undefined"&&(c=100);for(var f="@-"+a+"-keyframes "+b+" {",g,h={},b=0;b<=c;b++){g=this.interpolator.getPosition(b/
c).y;g=this.getKeyFrameDataValues(g);var i=""+b/c*100+"%{",j=g,k=void 0;for(k in h)j[k]||(j[k]=h[k]);h="-"+a+"-transform:";if(j.x||j.y)h+="translate("+(j.x||0)+"px,"+(j.y||0)+"px)";j.angle&&(h+=" rotate("+j.angle+"rad)");if(j.scaleX!==1||j.scaleY!==1)h+=" scale("+j.scaleX+","+j.scaleY+")";h+=";";j.alpha&&(h+=" opacity: "+j.alpha+";");if(d!==0.5||e!==0.5)h+=" -"+a+"-transform-origin:"+d*100+"% "+e*100+"%;";f+=i+h+"}\n";h=g}f+="}\n";return f}}}});
CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(a,b){var c=this.start+a*(this.end-this.start);this.callback&&this.callback(c,this.target,b);this.property&&(this.target[this.property]=c)},setValues:function(a,b,c,d,e){this.start=a;this.end=b;this.target=c;this.property=d;this.callback=
e;return this}}}});
CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(a){CAAT.Behavior.PathBehavior.superclass.parse.call(this,a);a.SVG&&this.setValues((new CAAT.PathUtil.SVGPath).parsePath(a.SVG));if(a.autoRotate)this.autoRotate=a.autoRotate},path:null,autoRotate:false,
prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,getPropertyName:function(){return"translate"},setAutoRotate:function(a,b){this.autoRotate=a;if(b!==void 0)this.autoRotateOp=b;return this},setPath:function(a){this.path=a;return this},setValues:function(a){return this.setPath(a)},setTranslation:function(){return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;a=this.path.getPosition(a);return"translateX("+a.x+"px) translateY("+a.y+"px)"},getKeyFrameDataValues:function(a){var a=
this.interpolator.getPosition(a).y,b=this.path.getPosition(a),c={x:b.x,y:b.y};if(this.autoRotate)a=a===0?b:this.path.getPosition(a-0.0010),b=Math.atan2(b.y-a.y,b.x-a.x),c.angle=b;return c},calculateKeyFramesData:function(a,b,c){typeof c==="undefined"&&(c=100);c>>=0;for(var d,e="@-"+a+"-keyframes "+b+" {",b=0;b<=c;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"}",e+=d;e+="}";return e},setForTime:function(a,b){if(!this.path)return{x:b.x,y:b.y};var c=this.path.getPosition(a);
if(this.autoRotate){if(-1===this.prevX&&-1===this.prevY)this.prevX=c.x,this.prevY=c.y;var d=c.x-this.prevX,e=c.y-this.prevY;if(d===0&&e===0)return b.setLocation(c.x,c.y),{x:b.x,y:b.y};var f=Math.atan2(e,d),g=CAAT.Foundation.SpriteImage,h=CAAT.Behavior.PathBehavior.autorotate;this.autoRotateOp===h.LEFT_TO_RIGHT?this.prevX<=c.x?b.setImageTransformation(g.TR_NONE):(b.setImageTransformation(g.TR_FLIP_HORIZONTAL),f+=Math.PI):this.autoRotateOp===h.RIGHT_TO_LEFT&&(this.prevX<=c.x?b.setImageTransformation(g.TR_FLIP_HORIZONTAL):
(b.setImageTransformation(g.TR_NONE),f-=Math.PI));b.setRotation(f);this.prevX=c.x;this.prevY=c.y;Math.sqrt(d*d+e*e)}return this.doValueApplication?(b.setLocation(c.x,c.y),{x:b.x,y:b.y}):{x:c.x,y:c.y}},positionOnTime:function(a){return this.isBehaviorInTime(a,null)?(a=this.normalizeTime(a),this.path.getPosition(a)):{x:-1,y:-1}}}}});
CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},parse:function(a){CAAT.Behavior.RotateBehavior.superclass.parse.call(this,a);this.startAngle=a.start||0;this.endAngle=a.end||0;this.anchorX=typeof a.anchorX!=="undefined"?parseInt(a.anchorX):
0.5;this.anchorY=typeof a.anchorY!=="undefined"?parseInt(a.anchorY):0.5},startAngle:0,endAngle:0,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"rotate"},setForTime:function(a,b){var c=this.startAngle+a*(this.endAngle-this.startAngle);this.doValueApplication&&b.setRotationAnchored(c,this.anchorX,this.anchorY);return c},setValues:function(a,b,c,d){this.startAngle=a;this.endAngle=b;if(typeof c!=="undefined"&&typeof d!=="undefined")this.anchorX=c,this.anchorY=d;return this},setAngles:function(a,
b){return this.setValues(a,b)},setAnchor:function(a,b,c){this.anchorX=b/a.width;this.anchorY=c/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return"rotate("+(this.startAngle+a*(this.endAngle-this.startAngle))+"rad)"},getKeyFrameDataValues:function(a){a=this.interpolator.getPosition(a).y;return{angle:this.startAngle+a*(this.endAngle-this.startAngle)}},calculateKeyFramesData:function(a,b,c){typeof c==="undefined"&&(c=100);c>>=0;for(var d,e="@-"+a+"-keyframes "+
b+" {",b=0;b<=c;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% }\n",e+=d;e+="}\n";return e}}}});
CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},startScale:1,endScale:1,anchorX:0.5,anchorY:0.5,applyOnX:true,parse:function(a){CAAT.Behavior.Scale1Behavior.superclass.parse.call(this,a);this.startScale=a.start||
0;this.endScale=a.end||0;this.anchorX=typeof a.anchorX!=="undefined"?parseInt(a.anchorX):0.5;this.anchorY=typeof a.anchorY!=="undefined"?parseInt(a.anchorY):0.5;this.applyOnX=a.axis?a.axis.toLowerCase()==="x":true},applyOnAxis:function(a){this.applyOnX=a===CAAT.Behavior.Scale1Behavior.Axis.X?false:true},getPropertyName:function(){return"scale"},setForTime:function(a,b){var c=this.startScale+a*(this.endScale-this.startScale);0===c&&(c=0.01);this.doValueApplication&&(this.applyOnX?b.setScaleAnchored(c,
b.scaleY,this.anchorX,this.anchorY):b.setScaleAnchored(b.scaleX,c,this.anchorX,this.anchorY));return c},setValues:function(a,b,c,d,e){this.startScale=a;this.endScale=b;this.applyOnX=!!c;if(typeof d!=="undefined"&&typeof e!=="undefined")this.anchorX=d,this.anchorY=e;return this},setAnchor:function(a,b,c){this.anchorX=b/a.width;this.anchorY=c/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;a=this.startScale+a*(this.endScale-this.startScale);return this.applyOnX?
"scaleX("+a+")":"scaleY("+a+")"},getKeyFrameDataValues:function(a){var a=this.interpolator.getPosition(a).y,b={};b[this.applyOnX?"scaleX":"scaleY"]=this.startScale+a*(this.endScale-this.startScale);return b},calculateKeyFramesData:function(a,b,c){typeof c==="undefined"&&(c=100);c>>=0;for(var d,e="@-"+a+"-keyframes "+b+" {",b=0;b<=c;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% }\n",e+=d;e+="}\n";return e}}}});
CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:0.5,anchorY:0.5,parse:function(a){CAAT.Behavior.ScaleBehavior.superclass.parse.call(this,a);this.startScaleX=a.scaleX&&a.scaleX.start||
0;this.endScaleX=a.scaleX&&a.scaleX.end||0;this.startScaleY=a.scaleY&&a.scaleY.start||0;this.endScaleY=a.scaleY&&a.scaleY.end||0;this.anchorX=typeof a.anchorX!=="undefined"?parseInt(a.anchorX):0.5;this.anchorY=typeof a.anchorY!=="undefined"?parseInt(a.anchorY):0.5},getPropertyName:function(){return"scale"},setForTime:function(a,b){var c=this.startScaleX+a*(this.endScaleX-this.startScaleX),d=this.startScaleY+a*(this.endScaleY-this.startScaleY);0===c&&(c=0.01);0===d&&(d=0.01);this.doValueApplication&&
b.setScaleAnchored(c,d,this.anchorX,this.anchorY);return{scaleX:c,scaleY:d}},setValues:function(a,b,c,d,e,f){this.startScaleX=a;this.endScaleX=b;this.startScaleY=c;this.endScaleY=d;if(typeof e!=="undefined"&&typeof f!=="undefined")this.anchorX=e,this.anchorY=f;return this},setAnchor:function(a,b,c){this.anchorX=b/a.width;this.anchorY=c/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return"scale("+(this.startScaleX+a*(this.endScaleX-this.startScaleX))+
","+(this.startScaleY+a*(this.endScaleY-this.startScaleY))+")"},getKeyFrameDataValues:function(a){a=this.interpolator.getPosition(a).y;return{scaleX:this.startScaleX+a*(this.endScaleX-this.startScaleX),scaleY:this.startScaleY+a*(this.endScaleY-this.startScaleY)}},calculateKeyFramesData:function(a,b,c){typeof c==="undefined"&&(c=100);c>>=0;for(var d,e="@-"+a+"-keyframes "+b+" {",b=0;b<=c;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+this.anchorX*
100+"% "+this.anchorY*100+"% }\n",e+=d;e+="}\n";return e}}}});
CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function a(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!==-1)return a[b].identity}else if(d)return a[b].identity}}function b(a){var b=a.indexOf(this.versionSearchString);return b===-1?void 0:parseFloat(a.substring(b+this.versionSearchString.length+1))}var c=[{string:navigator.platform,subString:"Win",identity:"Windows"},
{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],d=a([{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,
subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,
subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}])||"An unknown browser",e=b(navigator.userAgent)||b(navigator.appVersion)||"an unknown version",c=a(c)||"an unknown OS";return{browser:d,version:e,OS:c,DevicePixelRatio:window.devicePixelRatio||1}}});
CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",depends:["CAAT.Module.Runtime.BrowserInfo"],extendsWith:function(){return{__init:function(){this.browserInfo=CAAT.Module.Runtime.BrowserInfo;return this},musicChannel:null,browserInfo:null,musicEnabled:true,fxEnabled:true,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(a){this.audioCache=
[];this.channels=[];this.workingChannels=[];for(var b=0;b<=a;b++){var c=document.createElement("audio");if(null!==c){c.finished=-1;this.channels.push(c);var d=this;c.addEventListener("ended",function(a){var a=a.target,b;for(b=0;b<d.workingChannels.length;b++)if(d.workingChannels[b]===a){d.workingChannels.splice(b,1);break}a.caat_callback&&a.caat_callback(a.caat_id);d.channels.push(a)},false)}}this.musicChannel=this.channels.pop();return this},addAudioFromURL:function(a,b,c){var d=null,e=document.createElement("audio");
if(null!==e){if(!e.canPlayType)return false;d=b.substr(b.lastIndexOf(".")+1);d=e.canPlayType(this.audioTypes[d]);if(d!==""&&d!=="no"){e.src=b;e.preload="auto";e.load();if(c)e.caat_callback=c,e.caat_id=a;this.audioCache.push({id:a,audio:e});return true}}return false},addAudioFromDomNode:function(a,b,c){var d=b.src.substr(b.src.lastIndexOf(".")+1);if(b.canPlayType(this.audioTypes[d])){if(c)b.caat_callback=c,b.caat_id=a;this.audioCache.push({id:a,audio:b});return true}return false},addAudioElement:function(a,
b,c){if(typeof b==="string")return this.addAudioFromURL(a,b,c);else try{if(b instanceof HTMLAudioElement)return this.addAudioFromDomNode(a,b,c)}catch(d){}return false},addAudio:function(a,b,c){if(b instanceof Array)for(var d=0;d<b.length;d++){if(this.addAudioElement(a,b[d],c))break}else this.addAudioElement(a,b,c);return this},getAudio:function(a){for(var b=0;b<this.audioCache.length;b++)if(this.audioCache[b].id===a)return this.audioCache[b].audio;return null},stopMusic:function(){this.musicChannel.pause()},
playMusic:function(a){if(!this.musicEnabled)return null;a=this.getAudio(a);if(null!==a){var b=this.musicChannel;if(null!==b)return b.src=a.src,b.preload="auto",this.browserInfo.browser==="Firefox"?b.addEventListener("ended",function(a){a.target.currentTime=0},false):b.loop=true,b.load(),b.play(),b}return null},setVolume:function(a,b){var c=this.getAudio(a);if(null!=c)c.volume=b;return this},play:function(a){if(!this.fxEnabled)return null;a=this.getAudio(a);if(null!==a&&this.channels.length>0){var b=
this.channels.shift();b.src=a.src;b.volume=a.volume;b.play();this.workingChannels.push(b)}return a},cancelPlay:function(a){for(var b=0;this.workingChannels.length;b++){var c=this.workingChannels[b];c.caat_id===a&&(c.pause(),this.channels.push(c),this.workingChannels.splice(b,1))}return this},cancelPlayByChannel:function(a){for(var b=0;this.workingChannels.length;b++)if(this.workingChannels[b]===a){this.channels.push(a);this.workingChannels.splice(b,1);break}return this},loop:function(a){if(!this.musicEnabled)return null;
a=this.getAudio(a);if(null!==a){var b=document.createElement("audio");if(null!==b)return b.src=a.src,b.preload="auto",this.browserInfo.browser==="Firefox"?b.addEventListener("ended",function(a){a.target.currentTime=0},false):b.loop=true,b.load(),b.play(),this.loopingChannels.push(b),b}return null},endSound:function(){var a;for(a=0;a<this.workingChannels.length;a++)this.workingChannels[a].pause(),this.channels.push(this.workingChannels[a]);for(a=0;a<this.loopingChannels.length;a++)this.loopingChannels[a].pause();
this.workingChannels=[];this.loopingChannels=[];this.stopMusic();return this},setSoundEffectsEnabled:function(a){this.fxEnabled=a;for(var b=0;b<this.loopingChannels.length;b++)a?this.loopingChannels[b].play():this.loopingChannels[b].pause();return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(a){this.musicEnabled=a;this.stopMusic();return this},isMusicEnabled:function(){return this.musicEnabled}}}});
CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(a,b){try{localStorage.setItem(a,JSON.stringify(b))}catch(c){}return this},load:function(a,b){try{var c=localStorage.getItem(a);return null===c?b:JSON.parse(c)}catch(d){return null}},remove:function(a){try{localStorage.removeItem(a)}catch(b){}return this}},extendsWith:{}});
CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(a,b,c){var d,e,f,a=Math.max(0,Math.min(360,a)),b=Math.max(0,Math.min(100,b)),c=Math.max(0,Math.min(100,c));b/=100;c/=100;if(b===0)return d=b=c,[Math.round(d*255),Math.round(b*255),Math.round(c*255)];a/=60;d=Math.floor(a);e=a-d;a=c*(1-b);f=c*(1-b*e);e=c*(1-b*(1-e));switch(d){case 0:d=
c;b=e;c=a;break;case 1:d=f;b=c;c=a;break;case 2:d=a;b=c;c=e;break;case 3:d=a;b=f;break;case 4:d=e;b=a;break;default:d=c,b=a,c=f}return new CAAT.Module.ColorUtil.Color(Math.round(d*255),Math.round(b*255),Math.round(c*255))},interpolate:function(a,b,c,d,e,f,g,h){if(h<=0)return{r:a,g:b,b:c};else if(h>=g)return{r:d,g:e,b:f};a=a+(d-a)/g*h>>0;b=b+(e-b)/g*h>>0;c=c+(f-c)/g*h>>0;a>255?a=255:a<0&&(a=0);b>255?b=255:b<0&&(b=0);c>255?c=255:c<0&&(c=0);return{r:a,g:b,b:c}},makeRGBColorRamp:function(a,b,c){var d=
[],e=a.length-1;b/=e;var f,g,h,i,j,k,m,o,n,q,p,r,t,s;for(f=0;f<e;f+=1){m=a[f];o=m>>24&255;n=(m&16711680)>>16;q=(m&65280)>>8;m&=255;g=a[f+1];p=g>>24&255;r=(g&16711680)>>16;t=(g&65280)>>8;g&=255;p=(p-o)/b;r=(r-n)/b;t=(t-q)/b;s=(g-m)/b;for(g=0;g<b;g+=1){h=o+p*g>>0;i=n+r*g>>0;j=q+t*g>>0;k=m+s*g>>0;var u=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(c){case u.RAMP_RGBA:d.push("argb("+h+","+i+","+j+","+k+")");break;case u.RAMP_RGB:d.push("rgb("+i+","+j+","+k+")");break;case u.RAMP_CHANNEL_RGB:d.push(4278190080|
i<<16|j<<8|k);break;case u.RAMP_CHANNEL_RGBA:d.push(h<<24|i<<16|j<<8|k);break;case u.RAMP_CHANNEL_RGBA_ARRAY:d.push([i,j,k,h]);break;case u.RAMP_CHANNEL_RGB_ARRAY:d.push([i,j,k])}}}return d},random:function(){for(var a="#",b=0;b<3;b++)a+="0123456789abcdef"[Math.random()*16>>0];return a}},extendsWith:{__init:function(a,b,c){this.r=a||255;this.g=b||255;this.b=c||255;return this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}});
CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:false,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',
setScale:function(a){this.scale=a;return this},initialize:function(a,b){this.width=a=window.innerWidth;this.height=b;this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1E3,fpsMax:0};if(!document.getElementById("caat-debug")){var c=document.createElement("div");c.innerHTML=this.debugTpl;document.body.appendChild(c);eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}this.canvas=
document.getElementById("caat-debug-canvas");if(null===this.canvas)this.canDebug=false;else return this.canvas.width=a,this.canvas.height=b,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=
document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.textDiscardDR=document.getElementById("textDiscardDR"),this.canDebug=true,this},debugInfo:function(a){this.statistics=a;a=CAAT;this.frameTimeAcc+=a.FRAME_TIME;this.frameRAFAcc+=a.REQUEST_ANIMATION_FRAME_TIME;this.framerate.frames++;if(a.RAF>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=this.framerate.frames*
1E3/(a.RAF-this.framerate.timeLastRefresh)|0;this.framerate.fpsMin=this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin;this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps);this.textFPS.innerHTML=this.framerate.fps;var b=(this.frameTimeAcc*100/this.framerate.frames|0)/100;this.frameTimeAcc=0;this.textDrawTime.innerHTML=b;b=(this.frameRAFAcc*100/this.framerate.frames|0)/100;this.frameRAFAcc=0;this.textRAFTime.innerHTML=b;this.framerate.timeLastRefresh=
a.RAF;this.framerate.frames=0;this.paint(b)}this.textEntitiesTotal.innerHTML=this.statistics.size_total;this.textEntitiesActive.innerHTML=this.statistics.size_active;this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects;this.textDraws.innerHTML=this.statistics.draws;this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(a){var b=this.ctx,c=0;b.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height);b.strokeStyle="black";b.beginPath();
b.moveTo(this.width-0.5,0);b.lineTo(this.width-0.5,this.height);b.stroke();b.strokeStyle="#a22";b.beginPath();c=this.height-(20/this.SCALE*this.height>>0)-0.5;b.moveTo(0.5,c);b.lineTo(this.width+0.5,c);b.stroke();b.strokeStyle="#aa2";b.beginPath();c=this.height-(30/this.SCALE*this.height>>0)-0.5;b.moveTo(0.5,c);b.lineTo(this.width+0.5,c);b.stroke();c=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);if(-1===this.framerate.prevFps)this.framerate.prevFps=c|0;b.strokeStyle="#0ff";b.beginPath();
b.moveTo(this.width,(c|0)-0.5);b.lineTo(this.width,this.framerate.prevFps-0.5);b.stroke();this.framerate.prevFps=c;a=(this.height-a/this.SCALE*this.height>>0)-0.5;b.strokeStyle="#ff0";b.beginPath();b.moveTo(this.width,a);b.lineTo(this.width,a);b.stroke()}}});
CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(a){var b;if(CAAT.CSS_TEXT_METRICS)try{return b=CAAT.Module.Font.Font.getFontMetricsCSS(a)}catch(c){}return CAAT.Module.Font.Font.getFontMetricsNoCSS(a)},getFontMetricsNoCSS:function(a){var a=/(\d+)p[x|t]/i.exec(a),b;b=a?a[1]|0:32;a=b-1;b=b+b*0.2|0;return{height:b,ascent:a,descent:b-a}},getFontMetricsCSS:function(a){function b(a){var b,c,d;d=a&&a.ownerDocument;
b=d.documentElement;a=a.getBoundingClientRect();c=document.body;d=d.nodeType===9?d.defaultView||d.parentWindow:false;return{top:a.top+(d.pageYOffset||b.scrollTop)-(b.clientTop||c.clientTop||0),left:a.left+(d.pageXOffset||b.scrollLeft)-(b.clientLeft||c.clientLeft||0)}}try{var c=document.createElement("span");c.style.font=a;c.innerHTML="Hg";var d=document.createElement("div");d.style.display="inline-block";d.style.width="1px";d.style.heigh="0px";var e=document.createElement("div");e.appendChild(c);
e.appendChild(d);var f=document.body;f.appendChild(e);try{return a={},d.style.verticalAlign="baseline",a.ascent=b(d).top-b(c).top,d.style.verticalAlign="bottom",a.height=b(d).top-b(c).top,a.ascent=Math.ceil(a.ascent),a.height=Math.ceil(a.height),a.descent=a.height-a.ascent,a}finally{f.removeChild(e)}}catch(g){return null}}},extendsWith:function(){return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,
ascent:0,descent:0,setPadding:function(a){this.padding=a;return this},setFontStyle:function(a){this.fontStyle=a;return this},setStrokeSize:function(a){this.strokeSize=a;return this},setFontSize:function(a){this.fontSize=a;this.fontSizeUnit="px";return this},setFont:function(a){this.font=a;return this},setFillStyle:function(a){this.fillStyle=a;return this},setStrokeStyle:function(a){this.strokeStyle=a;return this},createDefault:function(a){for(var b="",c=32;c<128;c++)b+=String.fromCharCode(c);return this.create(b,
a)},create:function(a,b){b|=0;this.padding=b;var c=document.createElement("canvas"),d=c.getContext("2d");d.textBaseline="bottom";d.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var e=0,f=[],g,h;for(g=0;g<a.length;g++){var i=Math.max(1,(d.measureText(a.charAt(g)).width>>0)+1)+2*b;f.push(i);e+=i}g=CAAT.Font.getFontMetrics(d.font);d=g.height;this.ascent=g.ascent;this.descent=g.descent;this.height=g.height;i=g.ascent;c.width=e;c.height=d;d=c.getContext("2d");d.textBaseline=
"alphabetic";d.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;d.fillStyle=this.fillStyle;d.strokeStyle=this.strokeStyle;this.charMap={};for(g=e=0;g<a.length;g++){h=a.charAt(g);d.fillText(h,e+b,i);if(this.strokeStyle)d.beginPath(),d.lineWidth=this.strokeSize,d.strokeText(h,e+b,i);this.charMap[h]={x:e+b,width:f[g]-2*b};e+=f[g]}this.image=c;return this},setAsSpriteImage:function(){var a=[],b=0,c;for(c in this.charMap){var d=c,e=this.charMap[c];a[c]={id:b++,height:this.height,
xoffset:0,letter:d,yoffset:0,width:e.width,xadvance:e.width,x:e.x,y:0}}this.spriteImage=(new CAAT.Foundation.SpriteImage).initializeAsGlyphDesigner(this.image,a);return this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(a){var b,c,d=0,e;for(b=0,c=a.length;b<c;b++)e=this.charMap[a.charAt(b)],d+=e?e.width:10;
return d},drawText:function(a,b,c,d){var e,f,g,h,i=this.image.height;for(e=0,f=a.length;e<f;e++)(g=this.charMap[a.charAt(e)])?(h=g.width,h>0&&g.height>0&&b.drawImage(this.image,g.x,0,h,i,c,d,h,i),c+=h):(b.strokeStyle="#f00",b.strokeRect(c,d,10,i),c+=10)},save:function(){var a=this.image.toDataURL("image/png");document.location.href=a.replace("image/png","image/octet-stream")},drawSpriteText:function(a,b){this.spriteImage.drawSpriteText(a,b)}}}});
CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE;this.position=new CAAT.Math.Point(0,0,0);this.offset=new CAAT.Math.Point(0,0,0);this.targetPosition=new CAAT.Math.Point(0,0,0);return this},id:0,delegate:null,position:null,
offset:null,targetPosition:null,targetChaseSpeed:0.02,isFixed:false,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},getDistanceSquaredFromPosition:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},intersects:function(a){var b=this.position.getDistanceSquared(a.position);return b<this.radiusSquared||b<a.radiusSquared},setPosition:function(a){this.position=a;return this},setDelegate:function(a){this.delegate=
a;return this},setOffset:function(a){this.offset=a;return this},setTargetPosition:function(a){this.targetPosition=a;return this},setTargetChaseSpeed:function(a){this.targetChaseSpeed=a;return this},setIsFixed:function(a){this.isFixed=a;return this},setCollisionMask:function(a){this.collisionMask=a;return this},setCollisionGroup:function(a){this.collisionGroup=a;return this},setRadius:function(a){this.radius=a;this.radiusSquared=this.radius*this.radius;return this},initialize:function(a){if(a)for(var b in a)this[b]=
a[b];return this},dealloc:function(){this.targetPosition=this.delegate=this.offset=this.position=null}}});
CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(a){a.id=this.allCircles.length;this.allCircles.push(a);return this},removeCircle:function(a){var b=0,c=false,d=this.allCircles.length;if(d===0)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";
for(;d--;)if(this.allCircles[d]===a){c=true;b=d;break}if(!c)throw"Could not locate circle in allCircles array!";this.allCircles[b].dealloc();this.allCircles[b]=null;return this},forceCirclesToMatchDelegatePositions:function(){for(var a=this.allCircles.length,b=0;b<a;b++){var c=this.allCircles[b];c&&c.delegate&&c.position.set(c.delegate.x+c.offset.x,c.delegate.y+c.offset.y)}},pushAllCirclesTowardTarget:function(){for(var a=new CAAT.Math.Point(0,0,0),b=this.allCircles,c=b.length,d=0;d<this.numberOfTargetingPasses;d++)for(var e=
0;e<c;e++){var f=b[e];if(!f.isFixed)a.x=f.position.x-(f.targetPosition.x+f.offset.x),a.y=f.position.y-(f.targetPosition.y+f.offset.y),a.multiply(f.targetChaseSpeed),f.position.x-=a.x,f.position.y-=a.y}},handleCollisions:function(){this.removeExpiredElements();for(var a=new CAAT.Math.Point(0,0,0),b=this.allCircles,c=b.length,d=0;d<this.numberOfCollisionPasses;d++)for(var e=0;e<c;e++)for(var f=b[e],g=e+1;g<c;g++){var h=b[g];if(this.circlesCanCollide(f,h)){var i=h.position.x-f.position.x,j=h.position.y-
f.position.y,k=(f.radius+h.radius)*1.08,m=f.position.getDistanceSquared(h.position);if(m<k*k-0.02)a.x=i,a.y=j,a.normalize(),i=(k-Math.sqrt(m))*0.5,a.multiply(i),h.isFixed||(f.isFixed&&a.multiply(2.2),h.position.translatePoint(a)),f.isFixed||(h.isFixed&&a.multiply(2.2),f.position.subtract(a))}}},handleBoundaryForCircle:function(a,b){var c=a.position.x,d=a.position.y,e=a.radius,f=e*2,b=12;if(b&1&&c-f>this.bounds.right)a.position.x=this.bounds.left+e;else if(b&1&&c+f<this.bounds.left)a.position.x=this.bounds.right-
e;if(b&4&&d-f>this.bounds.bottom)a.position.y=this.bounds.top-e;else if(b&4&&d+f<this.bounds.top)a.position.y=this.bounds.bottom+e;if(b&8&&c+e>=this.bounds.right)a.position.x=a.position.x=this.bounds.right-e;else if(b&8&&c-e<this.bounds.left)a.position.x=this.bounds.left+e;if(b&16&&d+e>this.bounds.bottom)a.position.y=this.bounds.bottom-e;else if(b&16&&d-e<this.bounds.top)a.position.y=this.bounds.top+e},getCircleAt:function(a,b,c){for(var d=this.allCircles,e=d.length,a=new CAAT.Math.Point(a,b,0),b=
null,f=Number.MAX_VALUE,g=0;g<e;g++){var h=d[g];if(h){var i=h.position.getDistanceSquared(a);i<f&&i<h.radiusSquared+c&&(f=i,b=h)}}return b},circlesCanCollide:function(a,b){return!a||!b||a===b?false:true},setBounds:function(a,b,c,d){this.bounds.x=a;this.bounds.y=b;this.bounds.width=c;this.bounds.height=d},setNumberOfCollisionPasses:function(a){this.numberOfCollisionPasses=a;return this},setNumberOfTargetingPasses:function(a){this.numberOfTargetingPasses=a;return this},sortOnDistanceToTarget:function(a,
b){var c=a.getDistanceSquaredFromPosition(a.targetPosition),d=b.getDistanceSquaredFromPosition(a.targetPosition),e=0;c>d?e=-1:c<d&&(e=1);return e},removeExpiredElements:function(){for(var a=this.allCircles.length;a>=0;a--)this.allCircles[a]===null&&this.allCircles.splice(a,1)},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this}}});
CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var a=function(a,c,d){var e=this;this.id=a;this.path=c;this.image=new Image;this.image.onload=function(){d.__onload(e)};this.image.onerror=function(){d.__onerror(e)};this.load=function(){e.image.src=e.path};return this};return{__init:function(){this.elements=[];return this},elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,addElement:function(b,c){this.elements.push(new a(b,c,this));return this},
__onload:function(a){this.cloaded&&this.cloaded(a.id);this.loadedCount++;this.loadedCount===this.elements.length&&this.cfinished&&this.cfinished(this.elements)},__onerror:function(a){this.cerrored&&this.cerrored(a.id)},load:function(a,c,d){this.cfinished=a;this.cloaded=c;this.cerroed=d;for(a=0;a<this.elements.length;a++)this.elements[a].load();return this}}}});
CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){this.images=[];return this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(a,b,c){a||b&&b(0,[]);var d=this,e;this.notificationCallback=b;this.images=[];for(e=0;e<a.length;e++)this.images.push({id:a[e].id,image:new Image});for(e=0;e<a.length;e++)this.images[e].image.onload=function(){d.imageCounter++;d.notificationCallback(d.imageCounter,d.images)},this.images[e].image.onerror=
function(a){return function(b){c&&c(b,a)}}(e),this.images[e].image.src=a[e].url;a.length===0&&b(0,[])}}});
CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(a,b,c,d,e){if(a<b)var f=a,a=b,b=f;f=document.createElement("canvas");f.width=d.width;f.height=d.height*c;var g=f.getContext("2d");g.fillStyle=e?e:"rgba(255,255,255,0)";g.fillRect(0,0,d.width,d.height*c);for(e=0;e<c;e++)g.globalAlpha=1-(a-b)/c*(e+1),g.drawImage(d,0,e*d.height);return f},rotate:function(a,b){b=b||0;if(!b)return a;var c=document.createElement("canvas");
c.width=a.height;c.height=a.width;var d=c.getContext("2d");d.globalAlpha=1;d.fillStyle="rgba(0,0,0,0)";d.clearRect(0,0,c.width,c.height);var e=new CAAT.Math.Matrix;e.multiply((new CAAT.Math.Matrix).setTranslate(c.width/2,c.width/2));e.multiply((new CAAT.Math.Matrix).setRotation(b*Math.PI/180));e.multiply((new CAAT.Math.Matrix).setTranslate(-c.width/2,-c.width/2));e.transformRenderingContext(d);d.drawImage(a,0,0);return c},optimize:function(a,b,c){b>>=0;var d=true,e=true,f=true,g=true;if(typeof c!==
"undefined"){if(typeof c.top!=="undefined")d=c.top;if(typeof c.bottom!=="undefined")e=c.bottom;if(typeof c.left!=="undefined")f=c.left;if(typeof c.right!=="undefined")g=c.right}c=document.createElement("canvas");c.width=a.width;c.height=a.height;var h=c.getContext("2d");h.fillStyle="rgba(0,0,0,0)";h.fillRect(0,0,a.width,a.height);h.drawImage(a,0,0);var i=h.getImageData(0,0,a.width,a.height).data,j,a=0,k=c.height-1,m=0,o=c.width-1,n=false;if(d){for(d=0;d<c.height;d++){for(j=0;j<c.width;j++)if(i[d*
c.width*4+3+j*4]>b){n=true;break}if(n)break}a=d}if(e){n=false;for(d=c.height-1;d>=a;d--){for(j=0;j<c.width;j++)if(i[d*c.width*4+3+j*4]>b){n=true;break}if(n)break}k=d}if(f){n=false;for(j=0;j<c.width;j++){for(d=a;d<=k;d++)if(i[d*c.width*4+3+j*4]>b){n=true;break}if(n)break}m=j}if(g){n=false;for(j=c.width-1;j>=m;j--){for(d=a;d<=k;d++)if(i[d*c.width*4+3+j*4]>b){n=true;break}if(n)break}o=j}if(0===m&&0===a&&c.width-1===o&&c.height-1===k)return c;b=o-m+1;e=k-a+1;f=h.getImageData(m,a,b,e);c.width=b;c.height=
e;h=c.getContext("2d");h.putImageData(f,0,0);return c},createThumb:function(a,b,c,d){var b=b||24,c=c||24,e=document.createElement("canvas");e.width=b;e.height=c;var f=e.getContext("2d");if(d){var g=Math.max(a.width,a.height),d=a.width/g*b,g=a.height/g*c;f.drawImage(a,(b-d)/2,(c-g)/2,d,g)}else f.drawImage(a,0,0,b,c);return e}}});
CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){return{bgActors:null,quadData:null,create:function(a,b,c,d,e,f,g){typeof f==="undefined"&&(f=32);typeof g==="undefined"&&(g=1);var h=(a+c)/2,i=(b+d)/2;this.x=a;this.y=b;this.x1=c;this.y1=d;this.width=c-a;this.height=d-b;this.bgActors=this.__getOverlappingActorList(e);if(this.bgActors.length<=g||this.width<=f)return this;this.quadData=Array(4);this.quadData[0]=
(new CAAT.Module.Collision.QuadTree).create(a,b,h,i,this.bgActors);this.quadData[1]=(new CAAT.Module.Collision.QuadTree).create(h,b,c,i,this.bgActors);this.quadData[2]=(new CAAT.Module.Collision.QuadTree).create(a,i,h,d,this.bgActors);this.quadData[3]=(new CAAT.Module.Collision.QuadTree).create(h,i,c,d,this.bgActors);return this},__getOverlappingActorList:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];this.intersects(e.AABB)&&b.push(e)}return b},getOverlappingActors:function(a){var b,
c,d,e=[],f;c=this.bgActors;if(this.quadData)for(b=0;b<4;b++){if(this.quadData[b].intersects(a)){f=this.quadData[b].getOverlappingActors(a);for(c=0,d=f.length;c<d;c++)e.push(f[c])}}else for(b=0,d=c.length;b<d;b++)f=c[b],a.intersects(f.AABB)&&e.push(f);return e}}}});
CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(a,b,c,d){var e;this.elements=[];for(e=0;e<c*d;e++)this.elements.push([]);this.width=a;this.height=b;this.rows=c;this.columns=d;this.xcache=[];for(e=0;e<a;e++)this.xcache.push(e/(a/d)>>0);this.ycache=[];for(e=0;e<b;e++)this.ycache.push(e/
(b/c)>>0);this.xycache=[];for(e=0;e<this.rows;e++){this.xycache.push([]);for(c=0;c<this.columns;c++)this.xycache[e].push(c+e*d)}this.rectangle=(new CAAT.Math.Rectangle).setBounds(0,0,a,b);this.r0=new CAAT.Math.Rectangle;this.r1=new CAAT.Math.Rectangle;return this},clearObject:function(){var a;for(a=0;a<this.rows*this.columns;a++)this.elements[a]=[];return this},addObject:function(a){for(var b=this.__getCells(a.x|0,a.y|0,a.width|0,a.height|0),c=0;c<b.length;c++)this.elements[b[c]].push(a)},__getCells:function(a,
b,c,d){var e=[];this.rectangle.contains(a,b)&&e.push(this.xycache[this.ycache[b]][this.xcache[a]]);if(this.rectangle.contains(a+c-1,b+d-1)){var f=this.xycache[this.ycache[b+d-1]][this.xcache[a+c-1]];if(f===e[0])return e;e.push(f)}if(this.rectangle.contains(a+c-1,b)){f=this.xycache[this.ycache[b]][this.xcache[a+c-1]];if(f===e[0]||f===e[1])return e;e.push(f)}this.rectangle.contains(a+c-1,b+d-1)&&(f=this.xycache[this.ycache[b+d-1]][this.xcache[a]],e.push(f));return e},solveCollision:function(a){var b;
for(b=0;b<this.elements.length;b++){var c=this.elements[b];c.length>1&&this._solveCollisionCell(c,a)}},_solveCollisionCell:function(a,b){var c,d;for(c=0;c<a.length;c++){var e=a[c];this.r0.setBounds(e.x,e.y,e.width,e.height);for(d=c+1;d<a.length;d++){var f=a[d];this.r0.intersects(this.r1.setBounds(f.x,f.y,f.width,f.height))&&b(e,f)}}},collide:function(a,b,c,d,e){a|=0;b|=0;c|=0;d|=0;var f=this.__getCells(a,b,c,d),g=this.elements;this.r0.setBounds(a,b,c,d);for(a=0;a<f.length;a++){d=g[f[a]];for(b=0,c=
d.length;b<c;b++){var h=d[b];this.r1.setBounds(h.x,h.y,h.width,h.height);if(this.r0.intersects(this.r1)&&e(h))return}}}}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:false,image:null,u:0,v:0,glTexture:null}});
CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(a){this.freeChunks=[{position:0,size:a||1024}];return this},freeChunks:null,findWhereFits:function(a){if(this.freeChunks.length===0)return[];var b=[],c;for(c=0;c<this.freeChunks.length;c++)for(var d=0;d+a<=this.freeChunks[c].size;)b.push(d+this.freeChunks[c].position),d+=a;return b},fits:function(a,b){for(var c=0,c=0;c<this.freeChunks.length;c++){var d=this.freeChunks[c];
if(d.position<=a&&a+b<=d.position+d.size)return true}return false},substract:function(a,b){for(var c=0,c=0;c<this.freeChunks.length;c++){var d=this.freeChunks[c];if(d.position<=a&&a+b<=d.position+d.size){var e=0,f=0,g=0,h=0,e=d.position,f=a-d.position,g=a+b,h=d.position+d.size-g;this.freeChunks.splice(c,1);f>0&&this.freeChunks.splice(c++,0,{position:e,size:f});h>0&&this.freeChunks.splice(c,0,{position:g,size:h});return true}}return false},log:function(a){if(0===this.freeChunks.length)CAAT.log("index "+
a+" empty");else{for(var a="index "+a,b=0;b<this.freeChunks.length;b++){var c=this.freeChunks[b];a+="["+c.position+","+c.size+"]"}CAAT.log(a)}}}});
CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(a,b){this.scanMapHeight=b;this.scanMapWidth=a;this.scanMap=[];for(var c=0;c<this.scanMapHeight;c++)this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth));return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(a,b){if(a>this.width||b>this.height)return null;for(var c,d,e=0;e<=this.scanMapHeight-b;){var f=null;
for(c=false;e<=this.scanMapHeight-b;e++)if(f=this.scanMap[e].findWhereFits(a),null!==f&&f.length>0){c=true;break}if(c){for(d=0;d<f.length;d++){var g=true;for(c=e;c<e+b;c++)if(!this.scanMap[c].fits(f[d],a)){g=false;break}if(g)return{x:f[d],y:e}}e++}else break}return null},substract:function(a,b,c,d){for(var e=0;e<d;e++)this.scanMap[e+b].substract(a,c)||CAAT.log("Error: removing chunk ",c,d," at ",a,b)},log:function(){for(var a=0;a<this.scanMapHeight;a++)this.scanMap[a].log(a)}}});
CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(a,b){this.width=a||1024;this.height=b||1024;this.images=[];return this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:false,padding:4,scan:null,images:null,criteria:"area",initialize:function(a){this.gl=a;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);this.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.texture);a.enable(a.BLEND);
a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var b=new Uint8Array(this.width*this.height*4),c=0;c<4*this.width*this.height;)b[c++]=0,b[c++]=0,b[c++]=0,b[c++]=0;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,b);a.enable(a.BLEND);for(b=0;b<this.images.length;b++)c=this.images[b],c.inverted&&(c=CAAT.Module.Image.ImageUtil.rotate(c,-90)),a.texSubImage2D(a.TEXTURE_2D,0,this.images[b].__tx,this.images[b].__ty,a.RGBA,a.UNSIGNED_BYTE,c)},create:function(a){for(var b=[],
c=0;c<a.length;c++){var d=a[c].image;d.__texturePage||b.push(d)}this.createFromImages(b)},clear:function(){this.createFromImages([])},update:function(a,b,c,d){this.allowImagesInvertion=a;this.padding=b;c<100&&(c=100);d<100&&(d=100);this.width=c;this.height=d;this.createFromImages(this.images)},createFromImages:function(a){var b;this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height);this.images=[];if(this.allowImagesInvertion)for(b=0;b<a.length;b++)a[b].inverted=this.allowImagesInvertion&&
a[b].height<a[b].width;var c=this;a.sort(function(a,b){var f=a.width*a.height,g=b.width*b.height;if(c.criteria==="width")return a.width<b.width?1:a.width>b.width?-1:0;else if(c.criteria==="height")return a.height<b.height?1:a.height>b.height?-1:0;return f<g?1:f>g?-1:0});for(b=0;b<a.length;b++)this.packImage(a[b])},addImage:function(a,b,c){this.allowImagesInvertion=b;this.padding=c;this.images.push(a);this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var a=this.gl;
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST);a.generateMipmap(a.TEXTURE_2D)},deletePage:function(){for(var a=0;a<this.images.length;a++)delete this.images[a].__texturePage,delete this.images[a].__u,delete this.images[a].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(a,b){a=a||document.createElement("canvas");a.width=this.width;a.height=this.height;var c=a.getContext("2d");c.fillStyle="rgba(0,0,0,0)";
c.fillRect(0,0,this.width,this.height);for(var d=0;d<this.images.length;d++)if(c.drawImage(!this.images[d].inverted?this.images[d]:CAAT.Modules.Image.ImageUtil.rotate(this.images[d],90),this.images[d].__tx,this.images[d].__ty),b)c.strokeStyle="red",c.strokeRect(this.images[d].__tx,this.images[d].__ty,this.images[d].__w,this.images[d].__h);if(b)c.strokeStyle="red",c.strokeRect(0,0,this.width,this.height);return a},packImage:function(a){var b,c;a.inverted?(b=a.height,c=a.width):(b=a.width,c=a.height);
var d=b,e=c,f;if(d&&this.padding)f=this.padding,d+f<=this.width&&(d+=f);if(e&&this.padding)f=this.padding,e+f<=this.height&&(e+=f);f=this.scan.whereFitsChunk(d,e);null!==f?(this.images.push(a),a.__tx=f.x,a.__ty=f.y,a.__u=f.x/this.width,a.__v=f.y/this.height,a.__u1=(f.x+b)/this.width,a.__v1=(f.y+c)/this.height,a.__texturePage=this,a.__w=b,a.__h=c,this.scan.substract(f.x,f.y,d,e)):CAAT.log("Imagen ",a.src," de tamano ",a.width,a.height," no cabe.")},changeHeuristic:function(a){this.criteria=a}}});
CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){this.pages=[];return this},pages:null,createPages:function(a,b,c,d){for(var e=false;!e;){e=new CAAT.Module.TexturePacker.TexturePage(b,c);e.create(d);e.initialize(a);e.endCreation();this.pages.push(e);for(var e=true,f=0;f<d.length;f++)if(!d[f].image.__texturePage){d[f].image.width<=b&&d[f].image.height<=c&&(e=false);break}}},deletePages:function(){for(var a=
0;a<this.pages.length;a++)this.pages[a].deletePage();this.pages=null}}});
CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(a,b,c){for(var d=a.width,e=0,f=0,g=0,h=0,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,g=b.length-1;g;g-=1){if(i<b[g].width)i=b[g].width;if(h<b[g].height)h=b[g].height}if(c.padding_left)e=c.padding_left,d-=e;c.padding_right&&(d-=c.padding_right);if(c.top&&(f=parseInt(c.top,10),isNaN(f)))switch(c.top){case "center":f=(a.height-h)/2;break;case "top":f=0;break;case "bottom":f=a.height-h;break;default:f=0}a=d/b.length;for(g=0,h=
b.length;g<h;g++)b[g].setLocation(e+g*a+(a-b[g].width)/2,f)}}});
CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(a,b,c,d,e){var c=document.getElementById(c),f;if(CAAT.__CSS__)c&&false===c instanceof HTMLDivElement&&(c=null),c===null&&(c=document.createElement("div"),document.body.appendChild(c));else if(c)if(c instanceof HTMLDivElement){var g=document.createElement("canvas");c.appendChild(g);c=g}else false==c instanceof HTMLCanvasElement&&(g=document.createElement("canvas"),
document.body.appendChild(g),c=g);else c=document.createElement("canvas"),document.body.appendChild(c);f=(new CAAT.Foundation.Director).initialize(a||800,b||600,c);(new CAAT.Module.Preloader.ImagePreloader).loadImages(d,function(a,b){a===b.length&&(f.emptyScenes(),f.setImagesCache(b),e(f),f.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2E3,false,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,0.4)),CAAT.loop(60))})}}});
CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=a.getImage("spinner"),e=a.getImage("splash"),g=a.createScene(),f=(new Date).getTime();e&&g.addChild((new CAAT.Foundation.Actor).setBackgroundImage(e,false).setBounds(0,0,a.width,a.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE));d&&g.addChild((new CAAT.Foundation.Actor).setBackgroundImage(d).centerAt(g.width/
2,g.height/2).addBehavior((new CAAT.Behavior.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1E3).setCycle(true)));g.loadedImage=function(d,e){if(!e||d===e.length){var g=(new Date).getTime()-f;g<b?(g=Math.abs(b-g),g>b&&(g=b),setTimeout(function(){j(a,e,c)},g)):j(a,e,c)}};return g}function j(a,b,c){a.emptyScenes();a.setImagesCache(b);a.setClear(true);c(a);a.setClear(CAAT.Foundation.Director.CLEAR_ALL);a.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2E3,false,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,
0.4))}var c=document.getElementById(c),k;if(CAAT.__CSS__)c&&false===c instanceof HTMLDivElement&&(c=null),c===null&&(c=document.createElement("div"),document.body.appendChild(c));else if(c)if(c instanceof HTMLDivElement){var m=document.createElement("canvas");c.appendChild(m);c=m}else false==c instanceof HTMLCanvasElement&&(m=document.createElement("canvas"),document.body.appendChild(m),c=m);else c=document.createElement("canvas"),document.body.appendChild(c);k=(new CAAT.Foundation.Director).initialize(a||
800,b||600,c);a=[];g&&a.push({id:"splash",url:g});h&&a.push({id:"spinner",url:h});k.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS);(new CAAT.Module.Preloader.ImagePreloader).loadImages(a,function(a,b){if(a===b.length){k.setImagesCache(b);var c=i(k,d||5E3,f);CAAT.loop(60);e&&e.length>0?(new CAAT.Module.Preloader.ImagePreloader).loadImages(e,c.loadedImage):c.loadedImage(0,null)}})}}});
(function(){CAAT.CSS={};CAAT.CSS.PREFIX=function(){for(var a="",b=["WebKit","Moz","O"],c=0;c<b.length;c++)if(window[b[c]+"CSSKeyframeRule"]){a=b[c].toLowerCase();break}CAAT.CSS.PROP_ANIMATION="-"+a+"-animation";return a}();CAAT.CSS.applyKeyframe=function(a,b,c,d,e){a.style[CAAT.CSS.PROP_ANIMATION]=b+" "+c/1E3+"s "+d/1E3+"s linear both "+(e?"infinite":"")};CAAT.CSS.unregisterKeyframes=function(a){a=CAAT.CSS.getCSSKeyframesIndex(a);-1!==a&&document.styleSheets[0].deleteRule(a)};CAAT.CSS.registerKeyframes=
function(a){var b=a.name,c=a.behavior,d=a.size,e=a.overwrite;if(typeof b==="undefined"||typeof c==="undefined")throw"Keyframes must be defined by a name and a CAAT.Behavior instance.";typeof d==="undefined"&&(d=100);typeof e==="undefined"&&(e=false);var f=CAAT.CSS.getCSSKeyframesIndex(b);if(-1===f||e){a=c.calculateKeyFramesData(CAAT.CSS.PREFIX,b,d,a.anchorX,a.anchorY);if(document.styleSheets){if(!document.styleSheets.length)b=document.createElement("style"),b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b);
-1!==f&&document.styleSheets[0].deleteRule(f);document.styleSheets[0].insertRule(a,0)}return a}};CAAT.CSS.getCSSKeyframesIndex=function(a){for(var b=document.styleSheets,c=b.length-1;c>=0;c--)try{for(var d=b[c],e=d.cssRules?d.cssRules:d.rules?d.rules:[],f=e.length-1;f>=0;f--)if((e[f].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||e[f].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&e[f].name===a)return f}catch(g){}return-1};CAAT.CSS.getCSSKeyframes=function(a){for(var b=document.styleSheets,c=b.length-1;c>=
0;c--)try{for(var d=b[c],e=d.cssRules?d.cssRules:d.rules?d.rules:[],f=e.length-1;f>=0;f--)if((e[f].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||e[f].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&e[f].name===a)return e[f]}catch(g){}return null}})();
CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){this.bbox=new CAAT.Math.Rectangle;return this},color:"#000",length:0,bbox:null,parent:null,setParent:function(a){this.parent=a;return this},setColor:function(a){if(a)this.color=a;return this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(){},setPoint:function(){},getPosition:function(){},
getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(){},endPath:function(){},getContour:function(){},updatePath:function(){},applyAsPath:function(){},transform:function(){},drawHandle:function(a,b,c){a.beginPath();a.arc(b,c,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,false);a.fill()}}}});
CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.newPosition=new CAAT.Math.Point;return this},points:null,cw:true,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:false,setRadius:function(a){this.radius=
a;return this},isArcTo:function(){return this.arcTo},setArcTo:function(a){this.arcTo=a;return this},initialize:function(a,b,c,d){this.setInitialPosition(a,b);this.setFinalPosition(a+c,b);this.angle=d||2*Math.PI;return this},applyAsPath:function(a){a=a.ctx;this.arcTo?a.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):a.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw);return this},setPoint:function(a,b){b>=0&&
b<this.points.length&&(this.points[b]=a)},setPoints:function(a){this.points=[];this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setClockWise:function(a){this.cw=a!==void 0?a:true;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,b){for(var c=0,d=this.points.length;c<d;c++)this.points[0].x=a,this.points[0].y=b;return this},setFinalPosition:function(a,b){this.points[1].x=a;this.points[1].y=b;this.updatePath(this.points[1]);return this},endCurvePosition:function(){return this.points[0]},
startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(a>1||a<0)a%=1;a<0&&(a=1+a);-1===this.length?this.newPosition.set(this.points[0].x,this.points[0].y):(a=this.angle*a*(this.cw?1:-1)+this.startAngle,this.newPosition.set(this.points[0].x+this.radius*Math.cos(a),this.points[0].y+this.radius*Math.sin(a)));return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(a,b){var c=a.ctx;c.save();
c.strokeStyle=this.color;c.beginPath();this.arcTo?c.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):c.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw);c.stroke();if(b){c.globalAlpha=0.5;c.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(c,this.points[d].x,this.points[d].y)}c.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},
getContour:function(a){for(var b=[],c=0;c<a;c++)b.push({x:this.points[0].x+this.radius*Math.cos(c*Math.PI/(a/2)),y:this.points[0].y+this.radius*Math.sin(c*Math.PI/(a/2))});return b},getPositionFromLength:function(a){return this.getPosition(a/this.length*(this.cw?1:-1))},updatePath:function(a){if(this.points[1]===a){if(!this.arcTo)this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y));this.length=
this.angle*this.radius;this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)}else this.points[0]===a&&this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle));this.bbox.setEmpty();this.bbox.x=this.points[0].x-this.radius;this.bbox.y=this.points[0].y-this.radius;this.bbox.x1=this.points[0].x+this.radius;this.bbox.y1=this.points[0].y+this.radius;this.bbox.width=2*this.radius;this.bbox.height=
2*this.radius;return this}}}});
CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.newPosition=new CAAT.Math.Point(0,0,0);return this},curve:null,newPosition:null,applyAsPath:function(a){this.curve.applyAsPath(a);return this},setPoint:function(a,b){this.curve&&this.curve.setPoint(a,b)},setPoints:function(a){var b=new CAAT.Math.Bezier;
b.setPoints(a);this.curve=b;return this},setQuadric:function(a,b,c,d,e,f){var g=new CAAT.Math.Bezier;g.setQuadric(a,b,c,d,e,f);this.curve=g;this.updatePath();return this},setCubic:function(a,b,c,d,e,f,g,h){var i=new CAAT.Math.Bezier;i.setCubic(a,b,c,d,e,f,g,h);this.curve=i;this.updatePath();return this},updatePath:function(){this.curve.update();this.length=this.curve.getLength();this.curve.getBoundingBox(this.bbox);return this},getPosition:function(a){if(a>1||a<0)a%=1;a<0&&(a=1+a);this.curve.solve(this.newPosition,
a);return this.newPosition},getPositionFromLength:function(a){this.curve.solve(this.newPosition,a/this.length);return this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(a,b){this.curve.drawHandles=b;a.ctx.strokeStyle=this.color;this.curve.paint(a,b)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(a){return this.curve.coordlist[a]},
endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(a){for(var b=[],c=0;c<=a;c++)b.push({x:c/a,y:this.getPosition(c/a).y});return b}}}});
CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.newPosition=new CAAT.Math.Point(0,0,0);return this},points:null,newPosition:null,applyAsPath:function(a){a.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(a,
b){b===0?this.points[0]=a:b===1&&(this.points[1]=a)},updatePath:function(){var a=this.points[1].x-this.points[0].x,b=this.points[1].y-this.points[0].y;this.length=Math.sqrt(a*a+b*b);this.bbox.setEmpty();this.bbox.union(this.points[0].x,this.points[0].y);this.bbox.union(this.points[1].x,this.points[1].y);return this},setPoints:function(a){this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setInitialPosition:function(a,b){this.points[0].x=a;this.points[0].y=b;this.newPosition.set(a,
b);return this},setFinalPosition:function(a,b){this.points[1].x=a;this.points[1].y=b;return this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(a>1||a<0)a%=1;a<0&&(a=1+a);this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*a,this.points[0].y+(this.points[1].y-this.points[0].y)*a);return this.newPosition},getPositionFromLength:function(a){return this.getPosition(a/this.length)},initialPositionX:function(){return this.points[0].x},
finalPositionX:function(){return this.points[1].x},paint:function(a,b){var c=a.ctx;c.save();c.strokeStyle=this.color;c.beginPath();c.moveTo(this.points[0].x,this.points[0].y);c.lineTo(this.points[1].x,this.points[1].y);c.stroke();if(b)c.globalAlpha=0.5,c.fillStyle="#7f7f00",c.beginPath(),this.drawHandle(c,this.points[0].x,this.points[0].y),this.drawHandle(c,this.points[1].x,this.points[1].y);c.restore()},numControlPoints:function(){return 2},getControlPoint:function(a){if(0===a)return this.points[0];
else if(1===a)return this.points[1]},getContour:function(){var a=[];a.push(this.getPosition(0).clone());a.push(this.getPosition(1).clone());return a}}}});
CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.points.push(new CAAT.Math.Point);this.newPosition=new CAAT.Math.Point;
return this},points:null,cw:true,newPosition:null,applyAsPath:function(a){a=a.ctx;this.cw?(a.lineTo(this.points[0].x,this.points[0].y),a.lineTo(this.points[1].x,this.points[1].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[4].x,this.points[4].y)):(a.lineTo(this.points[4].x,this.points[4].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[1].x,this.points[1].y),a.lineTo(this.points[0].x,
this.points[0].y));return this},setPoint:function(a,b){b>=0&&b<this.points.length&&(this.points[b]=a)},setPoints:function(a){this.points=[];this.points.push(a[0]);this.points.push((new CAAT.Math.Point).set(a[1].x,a[0].y));this.points.push(a[1]);this.points.push((new CAAT.Math.Point).set(a[0].x,a[1].y));this.points.push(a[0].clone());this.updatePath();return this},setClockWise:function(a){this.cw=a!==void 0?a:true;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,b){for(var c=
0,d=this.points.length;c<d;c++)this.points[c].x=a,this.points[c].y=b;return this},setFinalPosition:function(a,b){this.points[2].x=a;this.points[2].y=b;this.points[1].x=a;this.points[1].y=this.points[0].y;this.points[3].x=this.points[0].x;this.points[3].y=b;this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y;this.updatePath();return this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(a>1||a<0)a%=1;
a<0&&(a=1+a);if(-1===this.length)this.newPosition.set(0,0);else{var b=this.bbox.width/this.length,c=this.bbox.height/this.length,d=0,e,f=0;this.cw?(e=[0,1,2,3,4],b=[b,c,b,c]):(e=[4,3,2,1,0],b=[c,b,c,b]);for(;f<b.length;)if(d+b[f]<a)d+=b[f],f++;else break;a-=d;d=e[f];e=e[f+1];this.newPosition.set(this.points[d].x+(this.points[e].x-this.points[d].x)*a/b[f],this.points[d].y+(this.points[e].y-this.points[d].y)*a/b[f])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},
paint:function(a,b){var c=a.ctx;c.save();c.strokeStyle=this.color;c.beginPath();c.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height);if(b){c.globalAlpha=0.5;c.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(c,this.points[d].x,this.points[d].y)}c.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b]);return a},
updatePath:function(a){if(a){if(a===this.points[0])this.points[1].y=a.y,this.points[3].x=a.x;else if(a===this.points[1])this.points[0].y=a.y,this.points[2].x=a.x;else if(a===this.points[2])this.points[3].y=a.y,this.points[1].x=a.x;else if(a===this.points[3])this.points[0].x=a.x,this.points[2].y=a.y;this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y}this.bbox.setEmpty();for(a=0;a<4;a++)this.bbox.union(this.points[a].x,this.points[a].y);this.length=2*this.bbox.width+2*this.bbox.height;
this.points[0].x=this.bbox.x;this.points[0].y=this.bbox.y;this.points[1].x=this.bbox.x+this.bbox.width;this.points[1].y=this.bbox.y;this.points[2].x=this.bbox.x+this.bbox.width;this.points[2].y=this.bbox.y+this.bbox.height;this.points[3].x=this.bbox.x;this.points[3].y=this.bbox.y+this.bbox.height;this.points[4].x=this.bbox.x;this.points[4].y=this.bbox.y;return this},getPositionFromLength:function(a){return this.getPosition(a/(this.bbox.width*2+this.bbox.height*2))}}}});
CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:"CAAT.PathUtil.PathSegment,CAAT.PathUtil.ArcPath,CAAT.PathUtil.CurvePath,CAAT.PathUtil.LinearPath,CAAT.PathUtil.RectPath,CAAT.Math.Bezier,CAAT.Math.CatmullRom,CAAT.Math.Point,CAAT.Math.Matrix".split(","),extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){this.__super();this.newPosition=new CAAT.Math.Point(0,0,0);this.pathSegments=[];this.behaviorList=[];this.matrix=new CAAT.Math.Matrix;this.tmpMatrix=new CAAT.Math.Matrix;
return this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:true,behaviorList:null,rb_angle:0,rb_rotateAnchorX:0.5,rb_rotateAnchorY:0.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:0.5,sb_scaleAnchorY:0.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,closed:false,applyAsPath:function(a){var b=
a.ctx;a.modelViewMatrix.transformRenderingContext(b);b.globalCompositeOperation="source-out";b.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var c=0;c<this.pathSegments.length;c++)this.pathSegments[c].applyAsPath(a);b.globalCompositeOperation="source-over";return this},setInteractive:function(a){this.interactive=a;return this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?
this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Math.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(a,b,c,d){this.pathSegments=[];this.beginPath(a,b);this.addLineTo(c,d);this.endPath();
return this},setQuadric:function(a,b,c,d,e,f){this.beginPath(a,b);this.addQuadricTo(c,d,e,f);this.endPath();return this},setCubic:function(a,b,c,d,e,f,g,h){this.beginPath(a,b);this.addCubicTo(c,d,e,f,g,h);this.endPath();return this},setRectangle:function(a,b,c,d){this.beginPath(a,b);this.addRectangleTo(c,d);this.endPath();return this},setCatmullRom:function(a,b){b&&(a=a.slice(0),a.unshift(a[a.length-1]),a.push(a[1]),a.push(a[2]));for(var c=1;c<a.length-2;c++){var d=(new CAAT.PathUtil.CurvePath).setColor("#000").setParent(this),
e=(new CAAT.Math.CatmullRom).setCurve(a[c-1],a[c],a[c+1],a[c+2]);d.curve=e;this.pathSegments.push(d)}return this},addSegment:function(a){a.setParent(this);this.pathSegments.push(a);return this},addArcTo:function(a,b,c,d,e,f,g){f=new CAAT.PathUtil.ArcPath;f.setArcTo(true);f.setRadius(e);f.setInitialPosition(a,b).setFinalPosition(c,d);f.setParent(this);f.setColor(g);this.pathSegments.push(f);return this},addRectangleTo:function(a,b,c,d){var e=new CAAT.PathUtil.RectPath;e.setPoints([this.endCurvePosition(),
(new CAAT.Math.Point).set(a,b)]);e.setClockWise(c);e.setColor(d);e.setParent(this);this.pathSegments.push(e);return this},addQuadricTo:function(a,b,c,d,e){var f=new CAAT.Math.Bezier;f.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b),(new CAAT.Math.Point).set(c,d)]);this.trackPathX=c;this.trackPathY=d;a=(new CAAT.PathUtil.CurvePath).setColor(e).setParent(this);a.curve=f;this.pathSegments.push(a);return this},addCubicTo:function(a,b,c,d,e,f,g){var h=new CAAT.Math.Bezier;h.setPoints([this.endCurvePosition(),
(new CAAT.Math.Point).set(a,b),(new CAAT.Math.Point).set(c,d),(new CAAT.Math.Point).set(e,f)]);this.trackPathX=e;this.trackPathY=f;a=(new CAAT.PathUtil.CurvePath).setColor(g).setParent(this);a.curve=h;this.pathSegments.push(a);return this},addCatmullTo:function(a,b,c,d,e,f,g){g=(new CAAT.Math.CatmullRom).setColor(g);g.setCurve(this.trackPathX,this.trackPathY,a,b,c,d,e,f);this.trackPathX=e;this.trackPathY=f;a=(new CAAT.PathUtil.CurvePath).setParent(this);a.curve=g;this.pathSegments.push(a);return this},
addLineTo:function(a,b,c){c=(new CAAT.PathUtil.LinearPath).setColor(c);c.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b)]);c.setParent(this);this.trackPathX=a;this.trackPathY=b;this.pathSegments.push(c);return this},beginPath:function(a,b){this.trackPathX=a;this.trackPathY=b;this.beginPathX=a;this.beginPathY=b;return this},closePath:function(){this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1);this.trackPathX=
this.beginPathX;this.trackPathY=this.beginPathY;this.closed=true;this.endPath();return this},endPath:function(){this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];this.updatePath();return this},getPosition:function(a){if(a>1||a<0)a%=1;a<0&&(a=1+a);for(var b=this.pathSegments,c=this.pathSegmentStartTime,d=this.pathSegmentDurationTime,e=0,f=b.length,g,h=this.newPosition,i;e!==f;)if(g=(f+e)/2|0,i=c[g],i<=a&&a<=i+d[g])return a=d[g]?(a-i)/d[g]:0,a>1?a=1:a<0&&(a=0),a=b[g].getPosition(a),h.x=a.x,
h.y=a.y,h;else a<i?f=g:e=g+1;return this.endCurvePosition()},getPositionFromLength:function(a){a%=this.getLength();a<0&&(a+=this.getLength());for(var b=0,c=0;c<this.pathSegments.length;c++){if(b<=a&&a<=this.pathSegments[c].getLength()+b){a-=b;a=this.pathSegments[c].getPositionFromLength(a);this.newPosition.x=a.x;this.newPosition.y=a.y;break}b+=this.pathSegments[c].getLength()}return this.newPosition},paint:function(a){for(var b=0;b<this.pathSegments.length;b++)this.pathSegments[b].paint(a,this.interactive)},
release:function(){this.ay=this.ax=-1},isEmpty:function(){return!this.pathSegments.length},getNumSegments:function(){return this.pathSegments.length},getSegment:function(a){return this.pathSegments[a]},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},updatePath:function(a,b){var c,d;this.length=0;this.bbox.setEmpty();this.points=[];var e=Number.MAX_VALUE,f=Number.MAX_VALUE;for(c=0;c<this.pathSegments.length;c++){this.pathSegments[c].updatePath(a);
this.length+=this.pathSegments[c].getLength();this.bbox.unionRectangle(this.pathSegments[c].bbox);for(d=0;d<this.pathSegments[c].numControlPoints();d++){var g=this.pathSegments[c].getControlPoint(d);this.points.push(g);if(g.x<e)e=g.x;if(g.y<f)f=g.y}}this.clipOffsetX=-e;this.clipOffsetY=-f;this.width=this.bbox.width;this.height=this.bbox.height;this.setLocation(this.bbox.x,this.bbox.y);this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];for(c=0;c<this.pathSegments.length;c++)this.pathSegmentStartTime.push(0),
this.pathSegmentDurationTime.push(0);for(c=0;c<this.pathSegments.length;c++)this.pathSegmentDurationTime[c]=this.getLength()?this.pathSegments[c].getLength()/this.getLength():0,c>0?this.pathSegmentStartTime[c]=this.pathSegmentStartTime[c-1]+this.pathSegmentDurationTime[c-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[c].endPath();this.extractPathPoints();b&&b(this);return this},press:function(a,b){if(this.interactive){for(var c=CAAT.Math.Curve.prototype.HANDLE_SIZE/2,d=0;d<this.pathSegments.length;d++)for(var e=
0;e<this.pathSegments[d].numControlPoints();e++){var f=this.pathSegments[d].getControlPoint(e);if(a>=f.x-c&&b>=f.y-c&&a<f.x+c&&b<f.y+c){this.point=f;return}}this.point=null}},drag:function(a,b,c){if(this.interactive&&null!==this.point){if(-1===this.ax||-1===this.ay)this.ax=a,this.ay=b;this.point.x+=a-this.ax;this.point.y+=b-this.ay;this.ax=a;this.ay=b;this.updatePath(this.point,c)}},getContour:function(a){for(var b=[],c=0;c<=a;c++)b.push((new CAAT.Math.Point).set(c/a,this.getPosition(c/a).y,0));return b},
setPoints:function(a){if(this.points.length===a.length)for(var b=0;b<a.length;b++)this.points[b].x=a[b].x,this.points[b].y=a[b].y;return this},setPoint:function(a,b){if(b>=0&&b<this.points.length)this.points[b].x=a.x,this.points[b].y=a.y;return this},emptyBehaviorList:function(){this.behaviorList=[];return this},extractPathPoints:function(){if(!this.pathPoints){var a;this.pathPoints=[];for(a=0;a<this.numControlPoints();a++)this.pathPoints.push(this.getControlPoint(a).clone())}return this},addBehavior:function(a){this.behaviorList.push(a);
return this},removeBehaviour:function(a){for(var b=this.behaviorList.length-1;b;)if(this.behaviorList[b]===a){this.behaviorList.splice(b,1);break}return this},removeBehaviorById:function(a){for(var b=0;b<this.behaviorList.length;b++)this.behaviorList[b].id===a&&this.behaviorList.splice(b,1);return this},applyBehaviors:function(a){for(var b=0;b<this.behaviorList.length;b++)this.behaviorList[b].apply(a,this);this.setATMatrix();for(b=0;b<this.numControlPoints();b++)this.setPoint(this.matrix.transformCoord(this.pathPoints[b].clone().translate(this.clipOffsetX,
this.clipOffsetY)),b);return this},setATMatrix:function(){this.matrix.identity();this.tmpMatrix.identity();var a=this.matrix.matrix,b,c,d,e,f,g,h,i,j,k;h=this.bbox;var m=h.width,o=h.height,n=h.x,q=h.y;h=1;j=e=0;g=1;i=this.tb_x-n-this.tAnchorX*m;k=this.tb_y-q-this.tAnchorY*o;if(this.rb_angle){var p=this.rb_rotateAnchorX*m+n,r=this.rb_rotateAnchorY*o+q;i+=h*p+e*r;k+=j*p+g*r;b=Math.cos(this.rb_angle);c=Math.sin(this.rb_angle);d=h;f=j;h=d*b+e*c;e=-d*c+e*b;j=f*b+g*c;g=-f*c+g*b;i+=-h*p-e*r;k+=-j*p-g*r}if(this.sb_scaleX!=
1||this.sb_scaleY!=1)m=this.sb_scaleAnchorX*m+n,o=this.sb_scaleAnchorY*o+q,i+=h*m+e*o,k+=j*m+g*o,h*=this.sb_scaleX,e*=this.sb_scaleY,j*=this.sb_scaleX,g*=this.sb_scaleY,i+=-h*m-e*o,k+=-j*m-g*o;a[0]=h;a[1]=e;a[2]=i;a[3]=j;a[4]=g;a[5]=k;return this},setRotationAnchored:function(a,b,c){this.rb_angle=a;this.rb_rotateAnchorX=b;this.rb_rotateAnchorY=c;return this},setRotationAnchor:function(a,b){this.rb_rotateAnchorX=a;this.rb_rotateAnchorY=b},setRotation:function(a){this.rb_angle=a},setScaleAnchored:function(a,
b,c,d){this.sb_scaleX=a;this.sb_scaleAnchorX=c;this.sb_scaleY=b;this.sb_scaleAnchorY=d;return this},setScale:function(a,b){this.sb_scaleX=a;this.sb_scaleY=b;return this},setScaleAnchor:function(a,b){this.sb_scaleAnchorX=a;this.sb_scaleAnchorY=b;return this},setPositionAnchor:function(a,b){this.tAnchorX=a;this.tAnchorY=b;return this},setPositionAnchored:function(a,b,c,d){this.tb_x=a;this.tb_y=b;this.tAnchorX=c;this.tAnchorY=d;return this},setPosition:function(a,b){this.tb_x=a;this.tb_y=b;return this},
setLocation:function(a,b){this.tb_x=a;this.tb_y=b;return this},flatten:function(a,b){for(var c=this.getPositionFromLength(0),d=(new CAAT.PathUtil.Path).beginPath(c.x,c.y),e=0;e<a;e++)c=this.getPositionFromLength(e/a*this.length),d.addLineTo(c.x,c.y);b?d.closePath():d.endPath();return d}}});
CAAT.Module({defines:"CAAT.PathUtil.SVGPath",depends:["CAAT.PathUtil.Path"],extendsWith:function(){function a(a,c){var d=c;d<0&&(d=0);console.log("parse error near ..."+a.substr(d,20))}return{__init:function(){},c:0,bezierInfo:null,__skipBlank:function(a,c){for(var d=a.charAt(c);c<a.length&&(d==" "||d=="\n"||d=="\t"||d==",");)++c,d=a.charAt(c);return c},__maybeNumber:function(a,c){if(c<a.length-2){var d=a.charAt(c),e=a.charAt(c+1);return d=="-"||this.__isDigit(d)||d==="."&&this.__isDigit(e)}return false},
__isDigit:function(a){return a>="0"&&a<="9"},__getNumber:function(a,c,d,e){c=this.__skipBlank(a,c);if(c<a.length){var f=this.__findNumber(a,c);f!==-1?(d.push(parseFloat(a.substr(c,f))),c=this.__skipBlank(a,f),e.pos=c,e.result=0):e.result=2}else e.result=1},____getNumbers:function(a,c,d,e,f){for(var g=0;g<e;g++)if(this.__getNumber(a,c,d,f),f.result!=0)break;else c=f.pos;return c},__findNumber:function(a,c){a.charAt(c)=="-"&&++c;if(!this.__isDigit(a.charAt(c))&&(a.charAt(c)!="."||!this.__isDigit(a.charAt(c+
1))))return-1;for(;this.__isDigit(a.charAt(c));)++c;if(a.charAt(c)=="."){++c;if(!this.__isDigit(a.charAt(c)))return c;for(;this.__isDigit(a.charAt(c));)++c}return c},__parseMoveTo:function(a,c,d,e,f){var g=[],c=this.____getNumbers(a,c,g,2,f);if(f.result===0)d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY),e.beginPath(g[0],g[1]),this.__maybeNumber(a,c)&&(c=this.parseLine(a,c,d,e,f)),f.pos=c},__parseLine:function(a,c,d,e,f){var g=[];do c=this.____getNumbers(a,c,g,2,f),d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY),
e.addLineTo(g[0],g[1]);while(this.__maybeNumber(a,c));f.pos=c},__parseLineH:function(a,c,d,e,f){var g=[];do c=this.____getNumbers(a,c,g,1,f),d||(g[0]+=e.trackPathX),g[1].push(e.trackPathY),e.addLineTo(g[0],g[1]);while(this.__maybeNumber(a,c));f.pos=c},__parseLineV:function(a,c,d,e,f){var g=[e.trackPathX];do c=this.____getNumbers(a,c,g,1,f),d||(g[1]+=e.trackPathY),e.addLineTo(g[0],g[1]);while(this.__maybeNumber(a,c));f.pos=c},__parseCubic:function(a,c,d,e,f){var g=[];do if(c=this.____getNumbers(a,
c,g,6,f),f.result===0)d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY,g[2]+=e.trackPathX,g[3]+=e.trackPathY,g[4]+=e.trackPathX,g[5]+=e.trackPathY),e.addCubicTo(g[0],g[1],g[2],g[3],g[4],g[5]),g.shift(),g.shift(),this.bezierInfo=g;else return;while(this.__maybeNumber(a,c));f.pos=c},__parseCubicS:function(a,c,d,e,f){var g=[];do if(c=this.____getNumbers(a,c,g,4,f),f.result==0)d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY,g[2]+=e.trackPathX,g[3]+=e.trackPathY),e.addCubicTo(this.bezierInfo[2]+(this.bezierInfo[2]-
this.bezierInfo[0]),this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),g[0],g[1],g[2],g[3]),this.bezierInfo=g;else return;while(this.__maybeNumber(c));f.pos=c},__parseQuadricS:function(a,c,d,e,f){var g=[];do if(c=this.____getNumbers(a,c,g,4,f),f.result===0){d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY);var h,i;h=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]);i=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]);e.addQuadricTo(h,i,g[0],g[1]);this.bezierInfo=[];bezierInfo.push(h);
bezierInfo.push(i);bezierInfo.push(g[0]);bezierInfo.push(g[1])}else return;while(this.__maybeNumber(c));f.pos=c},__parseQuadric:function(a,c,d,e,f){var g=[];do if(c=this.____getNumbers(a,c,g,4,f),f.result===0)d||(g[0]+=e.trackPathX,g[1]+=e.trackPathY,g[2]+=e.trackPathX,g[3]+=e.trackPathY),e.addQuadricTo(g[0],g[1],g[2],g[3]),this.bezierInfo=g;else return;while(this.__maybeNumber(c));f.pos=c},__parseClosePath:function(a,c,d,e){d.closePath();e.pos=c},parsePath:function(b){this.c=0;this.contours=[];var c=
new CAAT.PathUtil.Path;this.contours.push(c);this.c=this.__skipBlank(b,this.c);if(this.c===b.length)return c;for(var d={pos:0,result:0};this.c!=b.length;){switch(b.charAt(this.c)){case "m":this.__parseMoveTo(b,this.c+1,false,c,d);break;case "M":this.__parseMoveTo(b,this.c+1,true,c,d);break;case "c":this.__parseCubic(b,this.c+1,false,c,d);break;case "C":this.__parseCubic(b,this.c+1,true,c,d);break;case "s":this.__parseCubicS(b,this.c+1,false,c,d);break;case "S":this.__parseCubicS(b,this.c+1,true,c,
d);break;case "q":this.__parseQuadric(b,this.c+1,false,c,d);break;case "Q":this.__parseQuadricS(b,this.c+1,true,c,d);break;case "t":this.__parseQuadricS(b,this.c+1,false,c,d);break;case "T":this.__parseQuadric(b,this.c+1,true,c,d);break;case "l":this.__parseLine(b,this.c+1,false,c,d);break;case "L":this.__parseLine(b,this.c+1,true,c,d);break;case "h":this.__parseLineH(b,this.c+1,false,c,d);break;case "H":this.__parseLineH(b,this.c+1,true,c,d);break;case "v":this.__parseLineV(b,this.c+1,false,c,d);
break;case "V":this.__parseLineV(b,this.c+1,true,c,d);break;case "z":case "Z":this.__parseClosePath(b,this.c+1,c,d);c=new CAAT.PathUtil.Path;this.contours.push(c);break;case 0:break;default:a(b,this.c)}if(d.result!=0){a(b,this.c);break}else this.c=d.pos}c=0;d=null;for(b=0;b<this.contours.length;b++)this.contours[b].isEmpty()||(d=this.contours[b],d.closed||d.endPath(),c++);if(c===1)return d;c=new CAAT.PathUtil.Path;for(b=0;b<this.contours.length;b++)this.contours[b].isEmpty()||c.addSegment(this.contours[b]);
return c.endPath()}}}});
CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],constants:{makePerspective:function(a,b,c,d,e){var a=c*Math.tan(a*Math.PI/360),f=-a;return makeFrustum(f*b,a*b,f,a,c,d,e)},makeFrustum:function(a,b,c,d,e,f,g){var h=2*e/(b-a),i=2*e/(d-c),a=(b+a)/(b-a),c=(d+c)/(d-c),d=-(f+e)/(f-e),e=-2*f*e/(f-e);return(new CAAT.Math.Matrix3).initWithMatrix([[h,0,a,-g/2],[0,-i,c,g/2],[0,0,d,e],[0,0,-1,0]])},makeOrtho:function(a,b,c,d,e,f){var g=-(b+a)/(b-a),h=-(d+c)/(d-c),i=-(f+e)/(f-e);return(new CAAT.Math.Matrix3).initWithMatrix([[2/
(b-a),0,0,g],[0,2/(d-c),0,h],[0,0,-2/(f-e),i],[0,0,0,1]])}}});
CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(a){this.gl=a;return this},shaderProgram:null,gl:null,setAlpha:function(){},getShader:function(a,b,c){if(b==="x-shader/x-fragment")b=a.createShader(a.FRAGMENT_SHADER);else if(b==="x-shader/x-vertex")b=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(b,c);a.compileShader(b);return!a.getShaderParameter(b,a.COMPILE_STATUS)?(alert(a.getShaderInfoLog(b)),null):b},getDomShader:function(a,b){var c=document.getElementById(b);
if(!c)return null;for(var d="",e=c.firstChild;e;)e.nodeType===3&&(d+=e.textContent),e=e.nextSibling;if(c.type==="x-shader/x-fragment")c=a.createShader(a.FRAGMENT_SHADER);else if(c.type==="x-shader/x-vertex")c=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(c,d);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?(alert(a.getShaderInfoLog(c)),null):c},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},
create:function(){var a=this.gl;this.shaderProgram=a.createProgram();a.attachShader(this.shaderProgram,this.getVertexShader());a.attachShader(this.shaderProgram,this.getFragmentShader());a.linkProgram(this.shaderProgram);a.useProgram(this.shaderProgram);return this},setMatrixUniform:function(a){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,false,new Float32Array(a.flatten()))},useProgram:function(){this.gl.useProgram(this.shaderProgram);return this}}});
CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){this.__super(a);return this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,
"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,
"aColor");this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.useProgram();this.colorBuffer=this.gl.createBuffer();this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(6144);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,
this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,0,0);return CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(a){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,false,0,0)}}});
CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){this.__super(a);return this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},
getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);
this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var a;this.linesBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var b=[];for(a=0;a<1024;a++)b[a]=a;this.linesBufferArray=new Uint16Array(b);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW);this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);
this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord");this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler");this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha");this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,
"uUseColor");this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor");this.setAlpha(1);this.setUseColor(false);this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(49152);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,0,0);this.vertexUVBuffer=
this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.vertexUVArray=new Float32Array(32768);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,false,0,0);this.vertexIndexBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);b=[];for(a=0;a<4096;a++)b.push(0+a*4),b.push(1+a*4),b.push(2+a*4),b.push(0+a*4),
b.push(2+a*4),b.push(3+a*4);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),this.gl.DYNAMIC_DRAW);return CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(a,b,c,d,e){this.gl.uniform1i(this.shaderProgram.useColor,a?1:0);if(a&&(this.prevA!==e||this.prevR!==b||this.prevG!==c||this.prevB!==d))this.gl.uniform4f(this.shaderProgram.color,b,c,d,e),this.prevA=e,this.prevR=b,this.prevG=c,this.prevB=d},setTexture:function(a){if(this.prevTexture!==a){var b=this.gl;
b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(this.shaderProgram.samplerUniform,0);this.prevTexture=a}return this},updateVertexBuffer:function(a){var b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,this.vertexPositionBuffer);b.bufferSubData(b.ARRAY_BUFFER,0,a);return this},updateUVBuffer:function(a){var b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,this.vertexUVBuffer);b.bufferSubData(b.ARRAY_BUFFER,0,a);return this},setAlpha:function(a){if(this.prevAlpha!==a)this.gl.uniform1f(this.shaderProgram.alphaUniform,
a),this.prevAlpha=a;return this},drawLines:function(a,b,c,d,e,f,g){var h=this.gl;this.setAlpha(f);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer);h.lineWidth(g);this.updateVertexBuffer(a);this.setUseColor(true,c,d,e,1);h.drawElements(h.LINES,b,h.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(a,b,c,d,e,f,g){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer);h.lineWidth(g);this.setAlpha(f);
this.updateVertexBuffer(a);this.setUseColor(true,c,d,e,1);h.drawElements(h.LINE_STRIP,b,h.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}});CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(a,b,c,d){this.identifier=a;this.pageX=this.clientX=b;this.pageY=this.clientY=c;this.target=d;this.time=(new Date).getTime();return this}}});
CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){this.touches=[];this.changedTouches=[];return this},time:0,source:null,sourceEvent:null,shift:false,control:false,alt:false,meta:false,touches:null,changedTouches:null,init:function(a,b,c){this.source=b;this.alt=a.altKey;this.control=a.ctrlKey;this.shift=a.shiftKey;this.meta=a.metaKey;this.sourceEvent=a;this.time=c;return this},addTouch:function(a){-1===this.touches.indexOf(a)&&
this.touches.push(a);return this},addChangedTouch:function(a){-1===this.changedTouches.indexOf(a)&&this.changedTouches.push(a);return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}});
CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){this.point=new CAAT.Math.Point(0,0,0);this.screenPoint=new CAAT.Math.Point(0,0,0);this.touches=[];return this},screenPoint:null,point:null,time:0,source:null,shift:false,control:false,alt:false,meta:false,sourceEvent:null,touches:null,init:function(a,b,c,d,e,f){this.point.set(a,b);this.source=d;this.screenPoint=e;this.alt=c.altKey;this.control=c.ctrlKey;this.shift=c.shiftKey;
this.meta=c.metaKey;this.sourceEvent=c;this.x=a;this.y=b;this.time=f;return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}});
CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(a,b,c,d){this.keyCode=a;this.action=b;this.modifiers=c;this.sourceEvent=d;this.preventDefault=function(){this.sourceEvent.preventDefault()};this.getKeyCode=function(){return this.keyCode};this.getAction=function(){return this.action};this.modifiers=function(){return this.modifiers};this.isShiftPressed=function(){return this.modifiers.shift};this.isControlPressed=function(){return this.modifiers.control};
this.isAltPressed=function(){return this.modifiers.alt};this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.Keys={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,
NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};CAAT.SHIFT_KEY=16;CAAT.CONTROL_KEY=17;CAAT.ALT_KEY=18;CAAT.ENTER_KEY=
13;CAAT.KEY_MODIFIERS={alt:false,control:false,shift:false}}});
CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){CAAT.setCursor=function(a){if(navigator.browser!=="iOS")document.body.style.cursor=a};CAAT.TOUCH_AS_MOUSE=1;CAAT.TOUCH_AS_MULTITOUCH=2;CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE;CAAT.windowResizeListeners=[];CAAT.registerResizeListener=function(a){CAAT.windowResizeListeners.push(a)};CAAT.unregisterResizeListener=function(a){for(var b=0;b<CAAT.windowResizeListeners.length;b++)if(a===
CAAT.windowResizeListeners[b]){CAAT.windowResizeListeners.splice(b,1);break}};CAAT.keyListeners=[];CAAT.registerKeyListener=function(a){CAAT.keyListeners.push(a)};CAAT.accelerationIncludingGravity={x:0,y:0,z:0};CAAT.rotationRate={alpha:0,beta:0,gamma:0};CAAT.enableDeviceMotion=function(){function a(a){CAAT.rotationRate={alpha:0,beta:a[0],gamma:a[1]}}CAAT.prevOnDeviceMotion=null;CAAT.onDeviceMotion=null;window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(b){a([b.beta,
b.gamma])},true):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(b){a([b.acceleration.x*2,b.acceleration.y*2])},true):window.addEventListener("MozOrientation",function(b){a([-b.y*45,b.x*45])},true)};window.addEventListener("keydown",function(a){var b=a.which?a.which:a.keyCode;if(b===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=true;else if(b===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=true;else if(b===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=true;else for(var c=0;c<CAAT.keyListeners.length;c++)CAAT.keyListeners[c](new CAAT.KeyEvent(b,
"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))},false);window.addEventListener("keyup",function(a){var b=a.which?a.which:a.keyCode;if(b===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=false;else if(b===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=false;else if(b===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=false;else for(var c=0;c<CAAT.keyListeners.length;c++)CAAT.keyListeners[c](new CAAT.KeyEvent(b,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,
shift:CAAT.KEY_MODIFIERS.shift},a))},false);window.addEventListener("resize",function(){for(var a=0;a<CAAT.windowResizeListeners.length;a++)CAAT.windowResizeListeners[a].windowResized(window.innerWidth,window.innerHeight)},false)},extendsWith:{}});
CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=false;CAAT.INTERVAL_ID=null;CAAT.renderEnabled=false;CAAT.FPS=60;CAAT.NO_RAF=0;CAAT.FPS_REFRESH=500;CAAT.RAF=0;CAAT.REQUEST_ANIMATION_FRAME_TIME=0;CAAT.SET_INTERVAL=0;CAAT.FRAME_TIME=0;CAAT.currentDirector=null;CAAT.director=[];CAAT.RegisterDirector=function(a){if(!CAAT.currentDirector)CAAT.currentDirector=a;CAAT.director.push(a)};CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()};CAAT.getCurrentSceneTime=
function(){return CAAT.currentDirector.getCurrentScene().time};CAAT.endLoop=function(){CAAT.NO_RAF?CAAT.INTERVAL_ID!==null&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=true;CAAT.renderEnabled=false};CAAT.loop=function(a){if(!CAAT.renderEnabled){for(var b=0,c=CAAT.director.length;b<c;b++)CAAT.director[b].timeline=(new Date).getTime();CAAT.FPS=a||60;CAAT.renderEnabled=true;CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){for(var a=(new Date).getTime(),b=0,c=CAAT.director.length;b<c;b++){var g=CAAT.director[b];
(g.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||g.needsRepaint)&&g.renderFrame()}CAAT.FRAME_TIME=a-CAAT.SET_INTERVAL;if(CAAT.RAF)CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF;CAAT.RAF=(new Date).getTime();CAAT.SET_INTERVAL=a},1E3/CAAT.FPS):CAAT.renderFrameRAF()}};CAAT.renderFrameRAF=function(a){var b=CAAT;if(b.ENDRAF)b.ENDRAF=false;else{a||(a=(new Date).getTime());b.REQUEST_ANIMATION_FRAME_TIME=b.RAF?a-b.RAF:0.16;for(var c=0,d=b.director.length;c<d;c++)b.director[c].renderFrame();
b.RAF=a;window.requestAnimFrame(b.renderFrameRAF,0)}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/CAAT.FPS)}}()},extendsWith:function(){return{}}});
CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,owner:null,scene:null,taskId:0,remove:false,create:function(a,b,c,d,e){this.startTime=a;this.duration=b;this.callback_timeout=c;this.callback_tick=d;this.callback_cancel=e;return this},checkTask:function(a){var b=a;b-=this.startTime;b>=this.duration?(this.remove=true,this.callback_timeout&&this.callback_timeout(a,b,this)):
this.callback_tick&&this.callback_tick(a,b,this);return this},remainingTime:function(){return this.duration-(this.scene.time-this.startTime)},reset:function(a){this.remove=false;this.startTime=a;this.owner.ensureTimerTask(this);return this},cancel:function(){this.remove=true;null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this);return this},addTime:function(a){this.duration+=a;return this}}});
CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){this.timerList=[];return this},timerList:null,timerSequence:0,checkTimers:function(a){for(var b=this.timerList,c=b.length-1;c>=0;)b[c].remove||b[c].checkTask(a),c--},ensureTimerTask:function(a){this.hasTimer(a)||this.timerList.push(a);return this},hasTimer:function(a){for(var b=this.timerList,c=b.length-1;c>=0;){if(b[c]===a)return true;
c--}return false},createTimer:function(a,b,c,d,e,f){a=(new CAAT.Foundation.Timer.TimerTask).create(a,b,c,d,e);a.taskId=this.timerSequence++;a.sceneTime=f.time;a.owner=this;a.scene=f;this.timerList.push(a);return a},removeExpiredTimers:function(){var a,b=this.timerList;for(a=0;a<b.length;a++)b[a].remove&&b.splice(a,1)}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){this.newChildren=[];this.padding={left:2,right:2,top:2,bottom:2};return this},newElementInterpolator:(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,0.7),moveElementInterpolator:(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2),
padding:null,invalid:true,hgap:2,vgap:2,animated:false,newChildren:null,setAnimated:function(a){this.animated=a;return this},setHGap:function(a){this.hgap=a;this.invalidateLayout();return this},setVGap:function(a){this.vgap=a;this.invalidateLayout();return this},setAllPadding:function(a){this.padding.left=a;this.padding.right=a;this.padding.top=a;this.padding.bottom=a;this.invalidateLayout();return this},setPadding:function(a,b,c,d){this.padding.left=a;this.padding.right=b;this.padding.top=c;this.padding.bottom=
d;this.invalidateLayout();return this},addChild:function(a){this.newChildren.push(a)},removeChild:function(){},doLayout:function(){this.newChildren=[];this.invalid=false},invalidateLayout:function(){this.invalid=true},getMinimumLayoutSize:function(){},getPreferredLayoutSize:function(){},isValid:function(){return!this.invalid},isInvalidated:function(){return this.invalid}}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(a){this.axis=a;this.invalidateLayout();return this},setHorizontalAlignment:function(a){this.halign=
a;this.invalidateLayout();return this},setVerticalAlignment:function(a){this.valign=a;this.invalidateLayout();return this},doLayout:function(a){this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y?this.doLayoutVertical(a):this.doLayoutHorizontal(a);CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,a)},doLayoutHorizontal:function(a){var b=0,c=0,d=0,e,f,g;for(e=0,f=a.getNumChildren();e<f;e+=1)if(g=a.getChildAt(e),!g.preventLayout&&g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())){if(c<
g.height)c=g.height;b+=g.width;e>0&&(b+=this.hgap)}switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:b=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:b=a.width-b-this.padding.right;break;default:b=(a.width-b)/2}for(e=0,f=a.getNumChildren();e<f;e+=1)if(g=a.getChildAt(e),!g.preventLayout&&g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:d=
this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:d=a.height-this.padding.bottom-g.height;break;default:d=(a.height-g.height)/2}this.__setActorPosition(g,b,d);b+=g.width+this.hgap}},__setActorPosition:function(a,b,c){this.animated?this.newChildren.indexOf(a)!==-1?(a.setPosition(b,c),a.setScale(0,0),a.scaleTo(1,1,500,0,0.5,0.5,this.newElementInterpolator)):a.moveTo(b,c,500,0,this.moveElementInterpolator):a.setPosition(b,c)},doLayoutVertical:function(a){var b=0,c=
0,d,e,f;for(d=0,e=a.getNumChildren();d<e;d+=1)if(f=a.getChildAt(d),!f.preventLayout&&f.isVisible()&&f.isInAnimationFrame(CAAT.getCurrentSceneTime())){if(b<f.width)b=f.width;c+=f.height;d>0&&(c+=this.vgap)}switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:b=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:b=a.height-c-this.padding.bottom;break;default:b=(a.height-c)/2}for(d=0,e=a.getNumChildren();d<e;d+=1)if(f=a.getChildAt(d),!f.preventLayout&&
f.isVisible()&&f.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:c=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:c=a.width-this.padding.right-f.width;break;default:c=(a.width-f.width)/2}this.__setActorPosition(f,c,b);b+=f.height+this.vgap}},getPreferredLayoutSize:function(a){var b=new CAAT.Math.Dimension,c=0,d=0,e,f;for(e=0,f=a.getNumChildren();e<f;e+=1){var g=a.getChildAt(e);if(!g.preventLayout&&
g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())){g=g.getPreferredSize();if(d<g.height)d=g.height;c+=g.width}}b.width=c;b.height=d;return b},getMinimumLayoutSize:function(a){var b=new CAAT.Math.Dimension,c=0,d=0,e,f;for(e=0,f=a.getNumChildren();e<f;e+=1){var g=a.getChildAt(e);if(!g.preventLayout&&g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())){g=g.getMinimumSize();if(d<g.height)d=g.height;c+=g.width}}b.width=c;b.height=d;return b}}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){this.__super();return this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(a,b){typeof b==="undefined"&&(b="center");CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,a,b);b==="left"?this.left=a:b==="right"?
this.right=a:b==="top"?this.top=a:b==="bottom"?this.bottom=a:this.center=a},removeChild:function(a){if(this.center===a)this.center=null;else if(this.left===a)this.left=null;else if(this.right===a)this.right=null;else if(this.top===a)this.top=null;else if(this.bottom===a)this.bottom=null},__getChild:function(a){if(a==="center")return this.center;else if(a==="left")return this.left;else if(a==="right")return this.right;else if(a==="top")return this.top;else if(a==="bottom")return this.bottom},getMinimumLayoutSize:function(){var a,
b=new CAAT.Math.Dimension;if((a=this.__getChild("right"))!=null)a=a.getMinimumSize(),b.width+=a.width+this.hgap,b.height=Math.max(a.height,b.height);if((a=this.__getChild("left"))!=null)a=a.getMinimumSize(),b.width+=a.width+this.hgap,b.height=Math.max(a.height,b.height);if((a=this.__getChild("center"))!=null)a=a.getMinimumSize(),b.width+=a.width,b.height=Math.max(a.height,b.height);if((a=this.__getChild("top"))!=null)a=a.getMinimumSize(),b.width=Math.max(a.width,b.width),b.height+=a.height+this.vgap;
if((a=this.__getChild("bottom"))!=null)a=a.getMinimumSize(),b.width=Math.max(a.width,b.width),b.height+=a.height+this.vgap;b.width+=this.padding.left+this.padding.right;b.height+=this.padding.top+this.padding.bottom;return b},getPreferredLayoutSize:function(){var a,b=new CAAT.Dimension;if((a=this.__getChild("left"))!=null)a=a.getPreferredSize(),b.width+=a.width+this.hgap,b.height=Math.max(a.height,b.height);if((a=this.__getChild("right"))!=null)a=a.getPreferredSize(),b.width+=a.width+this.hgap,b.height=
Math.max(a.height,b.height);if((a=this.__getChild("center"))!=null)a=a.getPreferredSize(),b.width+=a.width,b.height=Math.max(a.height,b.height);if((a=this.__getChild("top"))!=null)a=a.getPreferredSize(),b.width=Math.max(a.width,b.width),b.height+=a.height+this.vgap;if((a=this.__getChild("bottom"))!=null)a=a.getPreferredSize(),b.width=Math.max(a.width,b.width),b.height+=a.height+this.vgap;b.width+=this.padding.left+this.padding.right;b.height+=this.padding.top+this.padding.bottom;return b},doLayout:function(a){var b=
this.padding.top,c=a.height-this.padding.bottom,d=this.padding.left,e=a.width-this.padding.right,f,g;if((f=this.__getChild("top"))!=null)f.setSize(e-d,f.height),g=f.getPreferredSize(),f.setBounds(d,b,e-d,g.height),b+=g.height+this.vgap;if((f=this.__getChild("bottom"))!=null)f.setSize(e-d,f.height),g=f.getPreferredSize(),f.setBounds(d,c-g.height,e-d,g.height),c-=g.height+this.vgap;if((f=this.__getChild("right"))!=null)f.setSize(f.width,c-b),g=f.getPreferredSize(),f.setBounds(e-g.width,b,g.width,c-
b),e-=g.width+this.hgap;if((f=this.__getChild("left"))!=null)f.setSize(f.width,c-b),g=f.getPreferredSize(),f.setBounds(d,b,g.width,c-b),d+=g.width+this.hgap;(f=this.__getChild("center"))!=null&&f.setBounds(d,b,e-d,c-b);CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,a)}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(a,b){this.__super();this.rows=a;this.columns=b;return this},rows:0,columns:2,doLayout:function(a){for(var b=[],c=0;c<a.getNumChildren();c++){var d=a.getChildAt(c);!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())&&b.push(d)}var e=
b.length;if(e.length!==0){var f=this.rows,g=this.columns;f>0?g=Math.floor((e+f-1)/f):f=Math.floor((e+g-1)/g);for(var c=(g-1)*this.hgap,d=a.width-(this.padding.left+this.padding.right),e=Math.floor((d-c)/g),h=(f-1)*this.vgap,i=a.height-(this.padding.top+this.padding.bottom),j=Math.floor((i-h)/f),h=Math.floor((i-(j*f+h))/2),i=0,k=this.padding.left+Math.floor((d-(e*g+c))/2);i<g;i++,k+=e+this.hgap)for(var m=0,o=this.padding.top+h;m<f;m++,o+=j+this.vgap)if(c=m*g+i,c<b.length&&(d=b[c],!d.preventLayout&&
d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())))if(this.animated){if(d.width!==e||d.height!==j)d.setSize(e,j),this.newChildren.indexOf(d)!==-1?(d.setPosition(k+(e-d.width)/2,o),d.setScale(0.01,0.01),d.scaleTo(1,1,500,0,0.5,0.5,this.newElementInterpolator)):d.moveTo(k+(e-d.width)/2,o,500,0,this.moveElementInterpolator)}else d.setBounds(k+(e-d.width)/2,o,e,j);CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,a)}},getMinimumLayoutSize:function(a){var b=this.rows,c=this.columns,
d=a.getNumChildren(),e=0,f=0,g;b>0?c=Math.ceil((d+b-1)/b):b=Math.ceil((d+c-1)/c);for(g=0;g<d;g+=1){var h=a.getChildAt(g);if(!h.preventLayout&&h.isVisible()&&h.isInAnimationFrame(CAAT.getCurrentSceneTime())){h=h.getMinimumSize();if(e<h.width)e=h.width;if(f<h.height)f=h.height}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+c*e+(c-1)*this.hgap,this.padding.top+this.padding.bottom+b*f+(b-1)*this.vgap)},getPreferredLayoutSize:function(a){var b=this.rows,c=this.columns,d=a.getNumChildren(),
e=0,f=0,g;b>0?c=Math.ceil((d+b-1)/b):b=Math.ceil((d+c-1)/c);for(g=0;g<d;g+=1){var h=a.getChildAt(g);if(!h.preventLayout&&h.isVisible()&&h.isInAnimationFrame(CAAT.getCurrentSceneTime())){h=h.getPreferredSize();if(e<h.width)e=h.width;if(f<h.height)f=h.height}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+c*e+(c-1)*this.hgap,this.padding.top+this.padding.bottom+b*f+(b-1)*this.vgap)}}});
CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(a,b,c,d,e,f){this.x=parseFloat(a);this.y=parseFloat(b);this.width=parseFloat(c);this.height=parseFloat(d);this.setGL(a/e,b/f,(a+c-1)/e,(b+d-1)/f);return this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(a,b,c,d){this.u=a;this.v=b;this.u1=c;this.v1=d;return this}}});
CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(a,b,c){this.animation=a;this.time=b;this.onEndPlayCallback=c;return this},animation:null,time:0,onEndPlayCallback:null}}});
CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){this.paint=this.paintN;this.setAnimationImageIndex([0]);this.mapInfo={};this.animationsMap={};arguments.length===3&&this.initialize.apply(this,
arguments);return this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1E3,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(a,b,c,d){this.animationsMap[a]=new CAAT.Foundation.SpriteImageAnimationHelper(b,
c,d);return this},setAnimationEndCallback:function(a){this.callback=a},playAnimation:function(a){if(a===this.currentAnimation)return this;var b=this.animationsMap[a];if(!b)return this;this.currentAnimation=a;this.setAnimationImageIndex(b.animation);this.changeFPS=b.time;this.callback=b.onEndPlayCallback;return this},setOwner:function(a){this.ownerActor=a;return this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){return this.mapInfo[this.spriteIndex].width},
getHeight:function(){return this.mapInfo[this.spriteIndex].height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var a=new CAAT.Foundation.SpriteImage;a.image=this.image;a.rows=this.rows;a.columns=this.columns;a.width=this.width;a.height=this.height;a.singleWidth=this.singleWidth;a.singleHeight=this.singleHeight;a.mapInfo=this.mapInfo;a.offsetX=this.offsetX;a.offsetY=this.offsetY;a.scaleX=this.scaleX;a.scaleY=
this.scaleY;a.animationsMap=this.animationsMap;a.parentOffsetX=this.parentOffsetX;a.parentOffsetY=this.parentOffsetY;a.scaleFont=this.scaleFont;return a},setOffsetX:function(a){this.offsetX=a;return this},setOffsetY:function(a){this.offsetY=a;return this},setOffset:function(a,b){this.offsetX=a;this.offsetY=b;return this},initialize:function(a,b,c){a||console.log("Null image for SpriteImage.");isString(a)&&(a=CAAT.currentDirector.getImage(a));this.parentOffsetY=this.parentOffsetX=0;this.rows=b;this.columns=
c;if(a instanceof CAAT.Foundation.SpriteImage||a instanceof CAAT.SpriteImage){this.image=a.image;var d=a.mapInfo[0];this.width=d.width;this.height=d.height;this.parentOffsetX=d.x;this.parentOffsetY=d.y;this.width=a.mapInfo[0].width;this.height=a.mapInfo[0].height}else this.image=a,this.width=a.width,this.height=a.height,this.mapInfo={};this.singleWidth=Math.floor(this.width/c);this.singleHeight=Math.floor(this.height/b);var e,f,g;if(a.__texturePage){a.__du=this.singleWidth/a.__texturePage.width;a.__dv=
this.singleHeight/a.__texturePage.height;e=this.singleWidth;f=this.singleHeight;var h=this.columns;if(a.inverted)d=e,e=f,f=d,h=this.rows;for(var a=this.image.__tx,i=this.image.__ty,j=this.image.__texturePage,d=0;d<b*c;d++){g=a+(d%h>>0)*e;var k=i+(d/h>>0)*f,m=g+e,o=k+f;g=(new CAAT.Foundation.SpriteImageHelper(g,k,m-g,o-k,j.width,j.height)).setGL(g/j.width,k/j.height,m/j.width,o/j.height);this.mapInfo[d]=g}}else for(d=0;d<b*c;d++)e=(d%this.columns|0)*this.singleWidth+this.parentOffsetX,f=(d/this.columns|
0)*this.singleHeight+this.parentOffsetY,g=new CAAT.Foundation.SpriteImageHelper(e,f,this.singleWidth,this.singleHeight,a.width,a.height),this.mapInfo[d]=g;return this},paintTiled:function(a){var b=this.mapInfo[this.spriteIndex],c=new CAAT.Math.Rectangle;this.ownerActor.AABB.intersect(a.AABB,c);var d=this.getWidth(),e=this.getHeight(),f=(this.offsetX-this.ownerActor.x)%d;f>0&&(f-=d);var g=(this.offsetY-this.ownerActor.y)%e;g>0&&(g-=e);for(var d=((c.width-f)/d>>0)+1,e=((c.height-g)/e>>0)+1,h,i=a.ctx,
a=0;a<e;a++)for(h=0;h<d;h++)i.drawImage(this.image,b.x,b.y,b.width,b.height,c.x-this.ownerActor.x+f+h*b.width>>0,c.y-this.ownerActor.y+g+a*b.height>>0,b.width,b.height)},paintInvertedH:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];a=a.ctx;a.save();a.translate((c|0)+b.width,d|0);a.scale(-1,1);a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height);a.restore();return this},paintInvertedV:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];a=a.ctx;a.save();
a.translate(c|0,d+b.height|0);a.scale(1,-1);a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height);a.restore();return this},paintInvertedHV:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];a=a.ctx;a.save();a.translate(c|0,d+b.height|0);a.scale(1,-1);a.translate(b.width,0);a.scale(-1,1);a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height);a.restore();return this},paintN:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];
a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,b.width,b.height);return this},paintAtRect:function(a,b,c,d,e,f){b=this.mapInfo[this.spriteIndex];a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,e,f);return this},paintScaledWidth:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,this.ownerActor.width,b.height);return this},paintChunk:function(a,
b,c,d,e,f,g){a.drawImage(this.image,d,e,f,g,b,c,f,g)},paintTile:function(a,b,c,d){b=this.mapInfo[b];a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,b.width,b.height);return this},paintScaled:function(a,b,c,d){b=this.mapInfo[this.spriteIndex];a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,this.ownerActor.width,this.ownerActor.height);return this},getCurrentSpriteImageCSSPosition:function(){var a=this.mapInfo[this.spriteIndex];
return""+-(a.x+this.parentOffsetX-this.offsetX)+"px "+-(a.y+this.parentOffsetY-this.offsetY)+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(a,b){var c=this.image;if(c.__texturePage){var d=b,e=this.mapInfo[this.spriteIndex],f=e.u,g=e.v,h=e.u1,e=e.v1;if(this.offsetX||this.offsetY)f=c.__texturePage,g=-this.offsetY/f.height,h=(this.ownerActor.width-this.offsetX)/f.width,e=(this.ownerActor.height-
this.offsetY)/f.height,f=-this.offsetX/f.width+c.__u,g+=c.__v,h+=c.__u,e+=c.__v;c.inverted?(a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e,a[d++]=f,a[d++]=g):(a[d++]=f,a[d++]=g,a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e)}},setChangeFPS:function(a){this.changeFPS=a;return this},setSpriteTransformation:function(a){this.transformation=a;var b=CAAT.Foundation.SpriteImage;switch(a){case b.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case b.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;
break;case b.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case b.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case b.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case b.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}this.ownerActor.invalidate();return this},resetAnimationTime:function(){this.prevAnimationTime=-1;return this},setAnimationImageIndex:function(a){this.animationImageIndex=a;this.spriteIndex=a[0];this.prevAnimationTime=-1;return this},
setSpriteIndex:function(a){this.spriteIndex=a;return this},setSpriteIndexAtTime:function(a){if(this.animationImageIndex.length>1){if(this.prevAnimationTime===-1)this.prevAnimationTime=a,this.spriteIndex=this.animationImageIndex[0],this.prevIndex=0;else{var b=a;b-=this.prevAnimationTime;b/=this.changeFPS;b%=this.animationImageIndex.length;b=Math.floor(b);b<this.prevIndex&&this.callback&&this.callback(this,a);this.prevIndex=b;this.spriteIndex=this.animationImageIndex[b]}this.ownerActor.invalidate()}},
getMapInfo:function(a){return this.mapInfo[a]},initializeFromMap:function(a,b){this.initialize(a,1,1);var c,d,e=0;for(c in b)d=b[c],d=new CAAT.Foundation.SpriteImageHelper(parseFloat(d.x)+this.parentOffsetX,parseFloat(d.y)+this.parentOffsetY,parseFloat(d.width),parseFloat(d.height),a.width,a.height),this.mapInfo[c]=d,e||this.setAnimationImageIndex([c]),e++;return this},addElement:function(a,b){var c=new CAAT.Foundation.SpriteImageHelper(parseFloat(b.x)+this.parentOffsetX,parseFloat(b.y)+this.parentOffsetY,
parseFloat(b.width),parseFloat(b.height),this.image.width,this.image.height);c.xoffset=typeof b.xoffset==="undefined"?0:parseFloat(b.xoffset);c.yoffset=typeof b.yoffset==="undefined"?0:parseFloat(b.yoffset);c.xadvance=typeof b.xadvance==="undefined"?b.width:parseFloat(b.xadvance);this.mapInfo[a]=c;return this},initializeAsGlyphDesigner:function(a,b){this.initialize(a,1,1);var c,d,e=0;for(c in b){var f=b[c];d=new CAAT.Foundation.SpriteImageHelper(parseFloat(f.x)+this.parentOffsetX,parseFloat(f.y)+
this.parentOffsetX,parseFloat(f.width),parseFloat(f.height),a.width,a.height);d.xoffset=typeof f.xoffset==="undefined"?0:f.xoffset;d.yoffset=typeof f.yoffset==="undefined"?0:f.yoffset;d.xadvance=typeof f.xadvance==="undefined"?f.width:f.xadvance;this.mapInfo[c]=d;e||this.setAnimationImageIndex([c]);e++}return this},initializeAsFontMap:function(a,b){this.initialize(a,1,1);for(var c,d=0,e=0;e<b.length;e++){var f=b[e];c=new CAAT.Foundation.SpriteImageHelper(parseFloat(d)+this.parentOffsetX,0+this.parentOffsetY,
parseFloat(f.width),a.height,a.width,a.height);c.xoffset=0;c.yoffset=0;c.xadvance=f.width;d+=f.width;this.mapInfo[b[e].c]=c;e||this.setAnimationImageIndex([b[e].c])}return this},initializeAsMonoTypeFontMap:function(a,b){for(var c=[],d=b.split(""),e=a.width/d.length>>0,f=0;f<d.length;f++)c.push({c:d[f],width:e});return this.initializeAsFontMap(a,c)},stringWidth:function(a){var b,c,d=0,e;for(b=0,c=a.length;b<c;b++)(e=this.mapInfo[a.charAt(b)])&&(d+=e.xadvance*this.fontScale);return d},stringHeight:function(){if(this.fontHeight)return this.fontHeight*
this.fontScale;var a=0,b;for(b in this.mapInfo){var c=this.mapInfo[b],c=c.height+c.yoffset;c>a&&(a=c)}this.fontHeight=a;return this.fontHeight*this.fontScale},drawText:function(a,b,c,d){var e,f,g;for(e=0;e<a.length;e++)if(f=this.mapInfo[a.charAt(e)])g=f.width,g>0&&f.height>0&&b.drawImage(this.image,f.x,f.y,g,f.height,c+f.xoffset*this.fontScale,d+f.yoffset*this.fontScale,g*this.fontScale,f.height*this.fontScale),c+=f.xadvance*this.fontScale},getFontData:function(){var a=this.stringHeight()*0.8>>0;
return{height:this.stringHeight(),ascent:a,descent:this.stringHeight()-a}}}}});
CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:"CAAT.Event.AnimationLoop,CAAT.Foundation.SpriteImage,CAAT.Core.Constants,CAAT.Behavior.PathBehavior,CAAT.Behavior.RotateBehavior,CAAT.Behavior.ScaleBehavior,CAAT.Behavior.Scale1Behavior,CAAT.PathUtil.LinearPath,CAAT.Event.AnimationLoop".split(","),constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,
CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var a=0;return{__init:function(){this.behaviorList=[];this.lifecycleListenerList=[];this.AABB=new CAAT.Math.Rectangle;this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)];this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER;this.modelViewMatrix=new CAAT.Math.Matrix;this.worldModelViewMatrix=new CAAT.Math.Matrix;this.resetTransform();this.setScale(1,1);this.setRotation(0);
this.id=a++;return this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:false,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:0.5,scaleTY:0.5,scaleAnchor:0,rotationAngle:0,rotationY:0.5,rotationX:0.5,alpha:1,isGlobalAlpha:false,frameAlpha:1,expired:false,discardable:false,pointed:false,mouseEnabled:true,visible:true,fillStyle:null,strokeStyle:null,time:0,AABB:null,
viewVertices:null,inFrame:false,dirty:true,wdirty:true,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:false,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:false,invalid:true,cached:0,preventLayout:false,isAA:true,setPreventLayout:function(a){this.preventLayout=a;return this},invalidateLayout:function(){this.parent&&!this.parent.layoutInvalidated&&this.parent.invalidateLayout();return this},
__validateLayout:function(){},setPreferredSize:function(a,c){if(!this.preferredSize)this.preferredSize=new CAAT.Math.Dimension;this.preferredSize.width=a;this.preferredSize.height=c;return this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(a,c){if(!this.minimumSize)this.minimumSize=new CAAT.Math.Dimension;this.minimumSize.width=a;this.minimumSize.height=c;return this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:
new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(a,c,d,e,f,g){if(!(a===this.x&&c===this.y)){var h=this.getBehavior("__moveTo");h||(h=(new CAAT.Behavior.PathBehavior).setId("__moveTo").setValues(new CAAT.PathUtil.LinearPath),this.addBehavior(h));h.path.setInitialPosition(this.x,this.y).setFinalPosition(a,c);h.setDelayTime(e?e:0,d);f&&h.setInterpolator(f);if(g)h.lifecycleListenerList=[],h.addListener({behaviorExpired:function(a,b,c){g(a,b,c)}});return this}},
rotateTo:function(a,c,d,e,f,g){if(a!==this.rotationAngle){var h=this.getBehavior("__rotateTo");h||(h=(new CAAT.Behavior.RotateBehavior).setId("__rotateTo").setValues(0,0,0.5,0.5),this.addBehavior(h));h.setValues(this.rotationAngle,a,e,f).setDelayTime(d?d:0,c);g&&h.setInterpolator(g);return this}},scaleTo:function(a,c,d,e,f,g,h){if(!(this.scaleX===a&&this.scaleY===c)){var i=this.getBehavior("__scaleTo");i||(i=(new CAAT.Behavior.ScaleBehavior).setId("__scaleTo").setValues(1,1,1,1,0.5,0.5),this.addBehavior(i));
i.setValues(this.scaleX,a,this.scaleY,c,f,g).setDelayTime(e?e:0,d);h&&i.setInterpolator(h);return this}},scaleXTo:function(a,c,d,e,f,g){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,a,c,d,e,f,g)},scaleYTo:function(a,c,d,e,f,g){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,a,c,d,e,f,g)},__scale1To:function(a,c,d,e,f,g,h){if(!(a===CAAT.Behavior.Scale1Behavior.AXIS_X&&c===this.scaleX||a===CAAT.Behavior.Scale1Behavior.AXIS_Y&&c===this.scaleY)){var i=this.getBehavior("__scaleXTo");
i||(i=(new CAAT.Behavior.Scale1Behavior).setId("__scaleXTo").setValues(1,1,a===CAAT.Behavior.Scale1Behavior.AXIS_X,0.5,0.5),this.addBehavior(i));i.setValues(a?this.scaleX:this.scaleY,c,f,g).setDelayTime(e?e:0,d);h&&i.setInterpolator(h);return this}},touchStart:function(){},touchMove:function(){},touchEnd:function(){},gestureStart:function(){},gestureChange:function(a,c,d){this.gestureEnabled&&(this.setRotation(a),this.setScale(c,d));return this},gestureEnd:function(){},isVisible:function(){return this.visible},
invalidate:function(){this.invalid=true;return this},setGestureEnabled:function(a){this.gestureEnabled=!!a;return this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(a){this.id=a;return this},setParent:function(a){this.parent=a;return this},setBackgroundImage:function(a,c){if(a){a=a instanceof CAAT.Foundation.SpriteImage?a.getRef():isString(a)?(new CAAT.Foundation.SpriteImage).initialize(CAAT.currentDirector.getImage(a),1,1):(new CAAT.Foundation.SpriteImage).initialize(a,
1,1);a.setOwner(this);this.backgroundImage=a;if(typeof c==="undefined"||c)this.width=a.getWidth(),this.height=a.getHeight();this.glEnabled=true;this.invalidate()}else this.backgroundImage=null;return this},setSpriteIndex:function(a){this.backgroundImage&&(this.backgroundImage.setSpriteIndex(a),this.invalidate());return this},setBackgroundImageOffset:function(a,c){this.backgroundImage&&this.backgroundImage.setOffset(a,c);return this},setAnimationImageIndex:function(a){this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),
this.backgroundImage.setAnimationImageIndex(a),this.invalidate());return this},addAnimation:function(a,c,d,e){this.backgroundImage&&this.backgroundImage.addAnimation(a,c,d,e);return this},playAnimation:function(a){this.backgroundImage&&this.backgroundImage.playAnimation(a);return this},setAnimationEndCallback:function(a){this.backgroundImage&&this.backgroundImage.setAnimationEndCallback(a);return this},resetAnimationTime:function(){this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),
this.invalidate());return this},setChangeFPS:function(a){this.backgroundImage&&this.backgroundImage.setChangeFPS(a);return this},setImageTransformation:function(a){this.backgroundImage&&this.backgroundImage.setSpriteTransformation(a);return this},centerOn:function(a,c){this.setPosition(a-this.width/2,c-this.height/2);return this},centerAt:function(a,c){this.setPosition(a-this.width*(0.5-this.tAnchorX),c-this.height*(0.5-this.tAnchorY));return this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},
setVisible:function(a){this.invalidate();CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!a&&this.visible&&CAAT.currentDirector.scheduleDirtyRect(this.AABB);this.visible=a;return this},setOutOfFrameTime:function(){this.setFrameTime(-1,0);return this},addListener:function(a){this.lifecycleListenerList.push(a);return this},removeListener:function(a){for(var c=this.lifecycleListenerList.length;c--;)if(this.lifecycleListenerList[c]===a){this.lifecycleListenerList.splice(c,1);break}},setGlobalAlpha:function(a){this.isGlobalAlpha=
a;return this},fireEvent:function(a,c){for(var d=0;d<this.lifecycleListenerList.length;d++)this.lifecycleListenerList[d].actorLifeCycleEvent(this,a,c)},setExpired:function(a){this.expired=true;this.fireEvent("expired",a);return this},enableEvents:function(a){this.mouseEnabled=a;return this},emptyBehaviorList:function(){this.behaviorList=[];return this},setFillStyle:function(a){this.fillStyle=a;this.invalidate();return this},setStrokeStyle:function(a){this.strokeStyle=a;this.invalidate();return this},
setPaint:function(a){return this.setFillStyle(a)},setAlpha:function(a){this.alpha=a;this.invalidate();return this},resetTransform:function(){this.rotationAngle=0;this.rotationY=this.rotationX=0.5;this.scaleY=this.scaleX=1;this.scaleTY=this.scaleTX=0.5;this.scaleAnchor=0;this.oldY=this.oldX=-1;this.dirty=true;return this},setFrameTime:function(a,c){this.start_time=a;this.duration=c;this.expired=false;this.dirty=true;return this},paint:function(a,c){if(this.backgroundImage)this.backgroundImage.paint(a,
c,0,0);else if(this.fillStyle){var d=a.ctx;d.fillStyle=this.fillStyle;d.fillRect(0,0,this.width,this.height)}},setScale:function(a,c){this.scaleX=a;this.scaleY=c;this.dirty=true;return this},getAnchorPercent:function(a){var c=[0.5,0.5,0.5,0,0.5,1,0,0.5,1,0.5,0,0,1,0,0,1,1,1];return{x:c[a*2],y:c[a*2+1]}},getAnchor:function(a){var c=0,d=0,e=CAAT.Foundation.Actor;switch(a){case e.ANCHOR_CENTER:d=c=0.5;break;case e.ANCHOR_TOP:c=0.5;d=0;break;case e.ANCHOR_BOTTOM:c=0.5;d=1;break;case e.ANCHOR_LEFT:c=0;
d=0.5;break;case e.ANCHOR_RIGHT:c=1;d=0.5;break;case e.ANCHOR_TOP_RIGHT:c=1;d=0;break;case e.ANCHOR_BOTTOM_LEFT:c=0;d=1;break;case e.ANCHOR_BOTTOM_RIGHT:d=c=1;break;case e.ANCHOR_TOP_LEFT:d=c=0}return{x:c,y:d}},setGlobalAnchor:function(a,c){this.scaleTX=this.rotationX=this.tAnchorX=a;this.scaleTY=this.rotationY=this.tAnchorY=c;this.dirty=true;return this},setScaleAnchor:function(a,c){this.scaleTX=a;this.scaleTY=c;this.dirty=true;return this},setScaleAnchored:function(a,c,d,e){this.scaleTX=d;this.scaleTY=
e;this.scaleX=a;this.scaleY=c;this.dirty=true;return this},setRotationAnchor:function(a,c){this.rotationX=c;this.rotationY=a;this.dirty=true;return this},setRotation:function(a){this.rotationAngle=a;this.dirty=true;return this},setRotationAnchored:function(a,c,d){this.rotationAngle=a;this.rotationX=c;this.rotationY=d;this.dirty=true;return this},setSize:function(a,c){this.width=a;this.height=c;this.dirty=true;return this},setBounds:function(a,c,d,e){this.x=a;this.y=c;this.width=d;this.height=e;this.dirty=
true;return this},setLocation:function(a,c){this.x=a;this.y=c;this.oldX=a;this.oldY=c;this.dirty=true;return this},setPosition:function(a,c){return this.setLocation(a,c)},setPositionAnchor:function(a,c){this.tAnchorX=a;this.tAnchorY=c;return this},setPositionAnchored:function(a,c,d,e){this.setLocation(a,c);this.tAnchorX=d;this.tAnchorY=e;return this},isInAnimationFrame:function(a){if(this.expired)return false;if(this.duration===Number.MAX_VALUE)return this.start_time<=a;return a>=this.start_time+
this.duration?(this.expired||this.setExpired(a),false):this.start_time<=a&&a<this.start_time+this.duration},contains:function(a,c){return a>=0&&c>=0&&a<this.width&&c<this.height},addBehavior:function(a){this.behaviorList.push(a);return this},removeBehaviour:function(a){for(var c=this.behaviorList,d=c.length-1;d;)if(c[d]===a){c.splice(d,1);break}return this},removeBehaviorById:function(a){for(var c=this.behaviorList,d=0;d<c.length;d++)c[d].id===a&&c.splice(d,1);return this},getBehavior:function(a){for(var c=
this.behaviorList,d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}return null},setDiscardable:function(a){this.discardable=a;return this},destroy:function(a){this.parent&&this.parent.removeChild(this);this.fireEvent("destroyed",a)},modelToView:function(a){var c,d,e,f;this.dirty&&this.setModelViewMatrix();f=this.worldModelViewMatrix.matrix;if(a instanceof Array)for(var g=0;g<a.length;g++)e=a[g],c=e.x,d=e.y,e.x=c*f[0]+d*f[1]+f[2],e.y=c*f[3]+d*f[4]+f[5];else c=a.x,d=a.y,a.x=c*f[0]+d*f[1]+f[2],a.y=
c*f[3]+d*f[4]+f[5];return a},modelToModel:function(a,c){this.dirty&&this.setModelViewMatrix();return c.viewToModel(this.modelToView(a))},viewToModel:function(a){this.dirty&&this.setModelViewMatrix();this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse();this.worldModelViewMatrixI.transformCoord(a);return a},findActorAtPosition:function(a){if(this.scaleX===0||this.scaleY===0)return null;if(!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time))return null;this.modelViewMatrixI=
this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(a);return this.contains(a.x,a.y)?this:null},enableDrag:function(){this.ay=this.ax=0;this.asy=this.asx=1;this.screeny=this.screenx=this.ara=0;this.mouseEnter=function(){this.__d_ay=this.__d_ax=-1;this.pointed=true;CAAT.setCursor("move")};this.mouseExit=function(){this.__d_ay=this.__d_ax=-1;this.pointed=false;CAAT.setCursor("default")};this.mouseMove=function(){};this.mouseUp=function(){this.__d_ay=this.__d_ax=-1};this.mouseDrag=
function(a){var c;c=this.modelToView(new CAAT.Math.Point(a.x,a.y));this.parent.viewToModel(c);if(this.__d_ax===-1||this.__d_ay===-1)this.__d_ax=c.x,this.__d_ay=c.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=a.screenPoint.x,this.__d_screeny=a.screenPoint.y;if(a.isShiftDown()){var d=(a.screenPoint.x-this.__d_screenx)/100,e=(a.screenPoint.y-this.__d_screeny)/100;a.isAltDown()||(e=d=a=Math.max(d,e));this.setScale(d+this.__d_asx,e+this.__d_asy)}else a.isControlDown()?
this.setRotation(-Math.atan2(a.screenPoint.x-this.__d_screenx,a.screenPoint.y-this.__d_screeny)+this.__d_ara):(this.x+=c.x-this.__d_ax,this.y+=c.y-this.__d_ay);this.__d_ax=c.x;this.__d_ay=c.y};return this},disableDrag:function(){this.mouseEnter=function(){};this.mouseExit=function(){};this.mouseMove=function(){};this.mouseUp=function(){};this.mouseDrag=function(){};return this},mouseClick:function(){},mouseDblClick:function(){},mouseEnter:function(){this.pointed=true},mouseExit:function(){this.pointed=
false},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseOut:function(){},mouseOver:function(){},mouseDrag:function(){},drawScreenBoundingBox:function(a){if(null!==this.AABB&&this.inFrame){var c=this.AABB,a=a.ctx;a.strokeStyle=CAAT.DEBUGAABBCOLOR;a.strokeRect(0.5+(c.x|0),0.5+(c.y|0),c.width|0,c.height|0);if(CAAT.DEBUGBB)c=this.viewVertices,a.beginPath(),a.lineTo(c[0].x,c[0].y),a.lineTo(c[1].x,c[1].y),a.lineTo(c[2].x,c[2].y),a.lineTo(c[3].x,c[3].y),a.closePath(),a.strokeStyle=
CAAT.DEBUGBBCOLOR,a.stroke()}},animate:function(a,c){if(!this.visible)return false;var d;if(!this.isInAnimationFrame(c))return this.inFrame=false,this.dirty=true,false;if(this.x!==this.oldX||this.y!==this.oldY)this.dirty=true,this.oldX=this.x,this.oldY=this.y;for(d=0;d<this.behaviorList.length;d++)this.behaviorList[d].apply(c,this);this.clipPath&&this.clipPath.applyBehaviors(c);this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid)a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB),this.setScreenBounds(),
a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB);this.invalid=this.dirty=false;this.inFrame=true;this.backgroundImage&&this.backgroundImage.setSpriteIndexAtTime(c);return this.AABB.intersects(a.AABB)},setModelViewMatrix:function(){var a,c,d,e,f,g,h,i,j,k,m;this.wdirty=false;m=this.modelViewMatrix.matrix;if(this.dirty){h=1;j=e=0;g=1;i=this.x-this.tAnchorX*this.width;k=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var o=this.rotationX*this.width,n=this.rotationY*this.height;i+=h*o+e*n;k+=j*
o+g*n;a=Math.cos(this.rotationAngle);c=Math.sin(this.rotationAngle);d=h;f=j;h=d*a+e*c;e=-d*c+e*a;j=f*a+g*c;g=-f*c+g*a;i+=-h*o-e*n;k+=-j*o-g*n}if(this.scaleX!=1||this.scaleY!=1)a=this.scaleTX*this.width,c=this.scaleTY*this.height,i+=h*a+e*c,k+=j*a+g*c,h*=this.scaleX,e*=this.scaleY,j*=this.scaleX,g*=this.scaleY,i+=-h*a-e*c,k+=-j*a-g*c;m[0]=h;m[1]=e;m[2]=i;m[3]=j;m[4]=g;m[5]=k}if(this.parent){if(this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1&&this.parent.isAA,this.dirty||this.parent.wdirty)this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix),
this.isAA?(h=this.worldModelViewMatrix.matrix,h[2]+=m[2],h[5]+=m[5]):this.worldModelViewMatrix.multiply(this.modelViewMatrix),this.wdirty=true}else{if(this.dirty)this.wdirty=true;this.worldModelViewMatrix.identity();this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1}},setScreenBounds:function(){var a=this.AABB,c=this.viewVertices,d,e,f,g,h;if(this.isAA){d=this.worldModelViewMatrix.matrix;e=d[2];f=d[5];g=this.width;h=this.height;a.x=e;a.y=f;a.x1=e+g;a.y1=f+h;a.width=g;a.height=h;if(CAAT.GLRENDER)d=
c[0],d.x=e,d.y=f,d=c[1],d.x=e+g,d.y=f,d=c[2],d.x=e+g,d.y=f+h,d=c[3],d.x=e,d.y=f+h;return this}d=c[0];d.x=0;d.y=0;d=c[1];d.x=this.width;d.y=0;d=c[2];d.x=this.width;d.y=this.height;d=c[3];d.x=0;d.y=this.height;this.modelToView(this.viewVertices);e=Number.MAX_VALUE;f=-Number.MAX_VALUE;g=Number.MAX_VALUE;h=-Number.MAX_VALUE;d=c[0];if(d.x<e)e=d.x;if(d.x>f)f=d.x;if(d.y<g)g=d.y;if(d.y>h)h=d.y;d=c[1];if(d.x<e)e=d.x;if(d.x>f)f=d.x;if(d.y<g)g=d.y;if(d.y>h)h=d.y;d=c[2];if(d.x<e)e=d.x;if(d.x>f)f=d.x;if(d.y<g)g=
d.y;if(d.y>h)h=d.y;d=c[3];if(d.x<e)e=d.x;if(d.x>f)f=d.x;if(d.y<g)g=d.y;if(d.y>h)h=d.y;a.x=e;a.y=g;a.x1=f;a.y1=h;a.width=f-e;a.height=h-g;return this},paintActor:function(a,c){if(!this.visible||!a.inDirtyRect(this))return true;var d=a.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;d.globalAlpha=this.frameAlpha;a.modelViewMatrix.transformRenderingContextSet(d);this.worldModelViewMatrix.transformRenderingContext(d);this.clip&&(d.beginPath(),this.clipPath?this.clipPath.applyAsPath(a):
d.rect(0,0,this.width,this.height),d.clip());this.paint(a,c);return true},__paintActor:function(a,c){if(!this.visible)return true;var d=a.ctx;this.frameAlpha=this.alpha;var e=this.worldModelViewMatrix.matrix;d.setTransform(e[0],e[3],e[1],e[4],e[2],e[5],this.frameAlpha);this.paint(a,c);return true},paintActorGL:function(a){this.frameAlpha=this.parent.frameAlpha*this.alpha;if(this.glEnabled&&this.visible)if(this.glNeedsFlush(a)){a.glFlush();this.glSetShader(a);if(!this.__uv)this.__uv=new Float32Array(8);
if(!this.__vv)this.__vv=new Float32Array(12);this.setGLCoords(this.__vv,0);this.setUV(this.__uv,0);a.glRender(this.__vv,12,this.__uv)}else{var c=a.coordsIndex;this.setGLCoords(a.coords,c);a.coordsIndex=c+12;this.setUV(a.uv,a.uvIndex);a.uvIndex+=8}},setGLCoords:function(a,c){var d=this.viewVertices;a[c++]=d[0].x;a[c++]=d[0].y;a[c++]=0;a[c++]=d[1].x;a[c++]=d[1].y;a[c++]=0;a[c++]=d[2].x;a[c++]=d[2].y;a[c++]=0;a[c++]=d[3].x;a[c++]=d[3].y;a[c]=0},setUV:function(a,c){this.backgroundImage.setUV(a,c)},glNeedsFlush:function(a){return this.getTextureGLPage()!==
a.currentTexturePage?true:this.frameAlpha!==a.currentOpacity?true:false},glSetShader:function(a){var c=this.getTextureGLPage();c!==a.currentTexturePage&&a.setGLTexturePage(c);this.frameAlpha!==a.currentOpacity&&a.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(){return this},initialize:function(a){if(a)for(var c in a)this[c]=a[c];return this},setClip:function(a,c){this.clip=a;this.clipPath=c;return this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){if(this.cached)this.backgroundImage=
null,this.cached=CAAT.Foundation.Actor.CACHE_NONE},cacheAsBitmap:function(a,c){if(this.width<=0||this.height<=0)return this;var a=a||0,d=document.createElement("canvas");d.width=this.width;d.height=this.height;var e=d.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,a);var e={ctx:e,modelViewMatrix:new CAAT.Math.Matrix,worldModelViewMatrix:new CAAT.Math.Matrix,dirtyRectsEnabled:false,inDirtyRect:function(){return true},AABB:new CAAT.Math.Rectangle(0,0,this.width,
this.height)},f=this.modelViewMatrix,g=this.worldModelViewMatrix;this.modelViewMatrix=new CAAT.Math.Matrix;this.worldModelViewMatrix=new CAAT.Math.Matrix;this.cached=CAAT.Foundation.Actor.CACHE_NONE;if(typeof c==="undefined")c=CAAT.Foundation.Actor.CACHE_SIMPLE;c===CAAT.Foundation.Actor.CACHE_DEEP?(this.animate(e,a),this.paintActor(e,a)):this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer?CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,e,a):(this.animate(e,
a),this.paintActor(e,a));this.setBackgroundImage(d);this.cached=c;this.modelViewMatrix=f;this.worldModelViewMatrix=g;return this},resetAsButton:function(){this.actionPerformed=null;this.mouseEnter=function(){};this.mouseExit=function(){};this.mouseDown=function(){};this.mouseUp=function(){};this.mouseClick=function(){};this.mouseDrag=function(){};return this},setAsButton:function(a,c,d,e,f,g){this.setBackgroundImage(a,true);this.iNormal=c||0;this.iOver=d||this.iNormal;this.iPress=e||this.iNormal;
this.iDisabled=f||this.iNormal;this.fnOnClick=g;this.enabled=true;this.setSpriteIndex(c);this.setEnabled=function(a){this.enabled=a;this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled);return this};this.actionPerformed=function(){this.enabled&&this.fnOnClick&&this.fnOnClick(this)};this.mouseEnter=function(){this.enabled&&(this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer"))};this.mouseExit=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),
CAAT.setCursor("default"))};this.mouseDown=function(){this.enabled&&this.setSpriteIndex(this.iPress)};this.mouseUp=function(){if(this.enabled)this.setSpriteIndex(this.iNormal),this.dragging=false};this.mouseClick=function(){};this.mouseDrag=function(){if(this.enabled)this.dragging=true};this.setButtonImageIndex=function(a,b,c,d){this.iNormal=a||0;this.iOver=b||this.iNormal;this.iPress=c||this.iNormal;this.iDisabled=d||this.iNormal;this.setSpriteIndex(this.iNormal);return this};return this},findActorById:function(a){return this.id===
a?this:null}}}});
CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var a=CAAT.Foundation.Actor.CACHE_DEEP,b=CAAT.Foundation.ActorContainer.superclass,c=b.drawScreenBoundingBox,d=b.paintActor,e=b.paintActorGL,f=b.animate,g=b.findActorAtPosition,h=b.destroy;return{__init:function(a){this.__super();this.childrenList=[];
this.activeChildren=[];this.pendingChildrenList=[];if(typeof a!=="undefined")this.addHint=a,this.boundingBox=new CAAT.Math.Rectangle;return this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle,layoutManager:null,layoutInvalidated:true,setLayout:function(a){this.layoutManager=a;return this},setBounds:function(a,b,c,d){CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,a,b,c,d);CAAT.currentDirector&&!CAAT.currentDirector.inValidation&&
this.invalidateLayout();return this},__validateLayout:function(){this.__validateTree();this.layoutInvalidated=false},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=true;this.layoutManager.doLayout(this);for(var a=0;a<this.getNumChildren();a+=1)this.getChildAt(a).__validateLayout()}},invalidateLayout:function(){this.layoutInvalidated=true;if(this.layoutManager){this.layoutManager.invalidateLayout(this);for(var a=0;a<this.getNumChildren();a+=
1)this.getChildAt(a).invalidateLayout()}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(a,b){if(this.inFrame){for(var d=this.activeChildren,e=0;e<d.length;e++)d[e].drawScreenBoundingBox(a,b);c.call(this,a,b)}},emptyChildren:function(){this.childrenList=[];return this},paintActor:function(b,c){if(!this.visible)return false;var e=b.ctx;e.save();if(!d.call(this,b,c))return false;if(this.cached===a)return false;if(!this.isGlobalAlpha)this.frameAlpha=this.parent?this.parent.frameAlpha:
1;for(var g=0,f=this.activeChildren.length;g<f;++g){var h=this.activeChildren[g];h.visible&&(e.save(),h.paintActor(b,c),e.restore())}e.restore();return true},__paintActor:function(a,b){if(!this.visible)return true;var c=a.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var d=this.worldModelViewMatrix.matrix;c.setTransform(d[0],d[3],d[1],d[4],d[2],d[5],this.frameAlpha);this.paint(a,b);if(!this.isGlobalAlpha)this.frameAlpha=this.parent?this.parent.frameAlpha:1;c=0;for(d=this.activeChildren.length;c<
d;++c)this.activeChildren[c].paintActor(a,b);return true},paintActorGL:function(a,b){var c,d,g;if(!this.visible)return true;e.call(this,a,b);if(!this.isGlobalAlpha)this.frameAlpha=this.parent.frameAlpha;for(c=0,d=this.activeChildren.length;c<d;++c)g=this.activeChildren[c],g.paintActorGL(a,b)},animate:function(b,c){if(!this.visible)return false;this.activeChildren=[];if(false===f.call(this,b,c))return false;if(this.cached===a)return true;this.__validateLayout();CAAT.currentDirector.inValidation=false;
var d,e,g=this.pendingChildrenList;for(d=0;d<g.length;d++)e=g[d],this.addChildImmediately(e.child,e.constraint);this.pendingChildrenList=[];g=[];e=this.childrenList;this.size_total=this.size_active=1;for(d=0;d<e.length;d++){var h=e[d];h.time=c;this.size_total+=h.size_total;h.animate(b,c)?(this.activeChildren.push(h),this.size_active+=h.size_active):h.expired&&h.discardable&&g.push(h)}for(d=0,e=g.length;d<e;d++)h=g[d],h.destroy(c),b.dirtyRectsEnabled&&b.addDirtyRect(h.AABB);return true},endAnimate:function(){},
addChildImmediately:function(a,b){return this.addChild(a,b)},addChild:function(a,b){if(a.parent!=null)throw"adding to a container an element with parent.";a.parent=this;this.childrenList.push(a);a.dirty=true;this.layoutManager?(this.layoutManager.addChild(a,b),this.invalidateLayout()):this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM&&this.recalcSize();return this},recalcSize:function(){var a=this.boundingBox;a.setEmpty();for(var b=this.childrenList,c,d=0;d<b.length;d++)c=b[d],this.runion.setBounds(c.x<
0?0:c.x,c.y<0?0:c.y,c.width,c.height),a.unionRectangle(this.runion);this.setSize(a.x1,a.y1);return this},addChildDelayed:function(a,b){this.pendingChildrenList.push({child:a,constraint:b});return this},addChildAt:function(a,b){if(b<=0)return a.parent=this,a.dirty=true,this.childrenList.splice(0,0,a),this.invalidateLayout(),this;else if(b>=this.childrenList.length)b=this.childrenList.length;a.parent=this;a.dirty=true;this.childrenList.splice(b,0,a);this.invalidateLayout();return this},findActorById:function(a){for(var b=
this.childrenList,c=0,d=b.length;c<d;c++){var e=b[c].findActorById(a);if(null!=e)return e}return null},findChild:function(a){var b=this.childrenList,c,d=b.length;for(c=0;c<d;c++)if(b[c]===a)return c;return-1},removeChildAt:function(a){var b=this.childrenList;return-1!==a&&a>=0&&a<this.childrenList.length?(b[a].setParent(null),a=b.splice(a,1),a[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a[0].AABB),this.invalidateLayout(),a[0]):null},removeChild:function(a){return this.removeChildAt(this.findChild(a))},
removeFirstChild:function(){var a=this.childrenList.shift();a.parent=null;a.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a.AABB);this.invalidateLayout();return a},removeLastChild:function(){if(this.childrenList.length){var a=this.childrenList.pop();a.parent=null;a.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a.AABB);this.invalidateLayout();return a}return null},findActorAtPosition:function(a){if(null===g.call(this,
a))return null;for(var b=this.childrenList.length-1;b>=0;b--){var c=this.childrenList[b],d=new CAAT.Math.Point(a.x,a.y,0),c=c.findActorAtPosition(d);if(null!==c)return c}return this},destroy:function(){for(var a=this.childrenList,b=a.length-1;b>=0;b--)a[b].destroy();h.call(this);return this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(a){return this.childrenList[a]},setZOrder:function(a,b){var c=
this.findChild(a);if(-1!==c){var d=this.childrenList;if(b!==c){if(b>=d.length)d.splice(c,1),d.push(a);else{c=d.splice(c,1);if(b<0)b=0;else if(b>d.length)b=d.length;d.splice(b,0,c[0])}this.invalidateLayout()}}}}}});
CAAT.Module({defines:"CAAT.Foundation.Scene",depends:"CAAT.Math.Point,CAAT.Math.Matrix,CAAT.PathUtil.Path,CAAT.Behavior.GenericBehavior,CAAT.Behavior.ContainerBehavior,CAAT.Behavior.ScaleBehavior,CAAT.Behavior.AlphaBehavior,CAAT.Behavior.RotateBehavior,CAAT.Behavior.PathBehavior,CAAT.Foundation.ActorContainer,CAAT.Foundation.Timer.TimerManager".split(","),aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){this.__super();
this.timerManager=new CAAT.TimerManager;this.fillStyle=null;this.isGlobalAlpha=true;return this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:false,paused:false,timerManager:null,isPaused:function(){return this.paused},setPaused:function(a){this.paused=a},createTimer:function(a,b,c,d,e){return this.timerManager.createTimer(a,b,c,d,e,this)},setTimeout:function(a,b,c,d){return this.timerManager.createTimer(this.time,a,b,c,d,this)},createAlphaBehaviour:function(a,b){var c=new CAAT.Behavior.AlphaBehavior;
c.setFrameTime(0,a);c.startAlpha=b?0:1;c.endAlpha=b?1:0;this.easeContainerBehaviour.addBehavior(c)},easeTranslationIn:function(a,b,c,d){this.easeTranslation(a,b,c,true,d)},easeTranslationOut:function(a,b,c,d){this.easeTranslation(a,b,c,false,d)},easeTranslation:function(a,b,c,d,e){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;this.easeIn=d;var f=new CAAT.Behavior.PathBehavior;e&&f.setInterpolator(e);f.setFrameTime(0,a);c<1?c=1:c>4&&(c=4);switch(c){case CAAT.Foundation.Actor.ANCHOR_TOP:d?
(f.setPath((new CAAT.PathUtil.Path).setLinear(0,-this.height+1,0,0)),this.setPosition(0,-this.height+1)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,-this.height+1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(0,this.height-1,0,0)),this.setPosition(0,this.height-1)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,this.height-1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_LEFT:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(-this.width+
1,0,0,0)),this.setPosition(-this.width+1,0)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,-this.width+1,0)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(this.width-1,0,0,0)),this.setPosition(this.width-1,0)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,this.width-1,0)),this.setPosition(0,0))}b&&this.createAlphaBehaviour(a,d);this.easeContainerBehaviour.addBehavior(f);this.easeContainerBehaviour.setFrameTime(this.time,
a);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(a,b,c,d,e){this.easeScale(a,b,c,d,true,e);this.easeIn=true},easeScaleOut:function(a,b,c,d,e){this.easeScale(a,b,c,d,false,e);this.easeIn=false},easeScale:function(a,b,c,d,e,f){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var g=0,h=0,i=0,j=0;switch(d){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:j=
i=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:i=g=1;h=0;j=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:j=h=1;g=0;i=1;break;default:alert("scale anchor ?? "+d)}if(!e){var k;k=g;g=i;i=k;k=h;h=j;j=k}c&&this.createAlphaBehaviour(b,e);c=this.getAnchorPercent(d);a=(new CAAT.Behavior.ScaleBehavior).setFrameTime(a,b).setValues(g,i,h,j,c.x,c.y);f&&a.setInterpolator(f);this.easeContainerBehaviour.addBehavior(a);this.easeContainerBehaviour.setFrameTime(this.time,
b);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(){return this},easeRotationIn:function(a,b,c,d){this.easeRotation(a,b,c,true,d);this.easeIn=true},easeRotationOut:function(a,b,c,d){this.easeRotation(a,b,c,false,d);this.easeIn=false},easeRotation:function(a,b,c,d,e){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var f=0,g=0;if(c==CAAT.Foundation.Actor.ANCHOR_CENTER)c=
CAAT.Foundation.Actor.ANCHOR_TOP;switch(c){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:f=Math.PI*(Math.random()<0.5?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:f=Math.PI/2*(Math.random()<0.5?1:-1);break;default:alert("rot anchor ?? "+c)}if(false===
d)var h=f,f=g,g=h;b&&this.createAlphaBehaviour(a,d);b=this.getAnchorPercent(c);f=(new CAAT.Behavior.RotateBehavior).setFrameTime(0,a).setValues(f,g,b.x,b.y);e&&f.setInterpolator(e);this.easeContainerBehaviour.addBehavior(f);this.easeContainerBehaviour.setFrameTime(this.time,a);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(a){this.easeContainerBehaviourListener=a},
behaviorExpired:function(){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(a){this.expired=a},paint:function(a){if(this.fillStyle)a=a.ctx,a.fillStyle=this.fillStyle,a.fillRect(0,0,this.width,this.height)},findActorAtPosition:function(a){var b,c,d=new CAAT.Math.Point;if(this.inputList){var e=this.inputList;for(b=0;b<e.length;b++){var f=e[b];for(c=0;c<f.length;c++)if(f[c].visible&&(d.set(a.x,a.y),f[c].worldModelViewMatrix.getInverse().transformCoord(d),
f[c].contains(d.x,d.y)))return f[c]}}d.set(a.x,a.y);return CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,d)},enableInputList:function(a){this.inputList=[];for(var b=0;b<a;b++)this.inputList.push([]);return this},addActorToInputList:function(a,b,c){b<0?b=0:b>=this.inputList.length&&(b=this.inputList.length-1);b=this.inputList[b];typeof c==="undefined"||c>=b.length?b.push(a):c<=0?b.unshift(a):b.splice(c,0,a);return this},emptyInputList:function(a){a<0?a=0:a>=this.inputList.length&&
(a=this.inputList.length-1);this.inputList[a]=[];return this},removeActorFromInputList:function(a,b){if(typeof b==="undefined"){var c,d;for(c=0;c<this.inputList.length;c++){var e=this.inputList[c];for(d=0;d<e.length;d++)e[d]==a&&e.splice(d,1)}return this}b<0?b=0:b>=this.inputList.length&&(b=this.inputList.length-1);e=this.inputList[b];for(d=0;d<e.length;d++)e[d]==a&&e.splice(d,1);return this},getIn:function(){},goOut:function(){}}}});
CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:"CAAT.Core.Class,CAAT.Core.Constants,CAAT.Foundation.ActorContainer,CAAT.Module.Audio.AudioManager,CAAT.Module.Runtime.BrowserInfo,CAAT.Module.Debug.Debug,CAAT.Math.Point,CAAT.Math.Rectangle,CAAT.Math.Matrix,CAAT.Foundation.Timer.TimerManager,CAAT.Foundation.Actor,CAAT.Foundation.Scene,CAAT.Event.AnimationLoop,CAAT.Event.Input,CAAT.Event.KeyEvent,CAAT.Event.MouseEvent,CAAT.Event.TouchEvent,CAAT.WebGL.Program,CAAT.WebGL.ColorProgram,CAAT.WebGL.TextureProgram,CAAT.WebGL.GLU,CAAT.Module.TexturePacker.TexturePageManager".split(","),
constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:true,CLEAR_NONE:false,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super();this.browserInfo=CAAT.Module.Runtime.BrowserInfo;this.audioManager=(new CAAT.Module.Audio.AudioManager).initialize(8);this.scenes=[];this.mousePoint=new CAAT.Math.Point(0,0,0);this.prevMousePoint=new CAAT.Math.Point(0,0,0);this.screenMousePoint=new CAAT.Math.Point(0,
0,0);this.isMouseDown=false;this.lastSelectedActor=null;this.dragging=false;this.sDirtyRects=[];this.dirtyRects=[];for(var a=0;a<64;a++)this.dirtyRects.push(new CAAT.Math.Rectangle);this.dirtyRectsIndex=0;this.touches={};this.timerManager=new CAAT.Foundation.Timer.TimerManager;this.__map={};return this},debug:false,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:false,lastSelectedActor:null,
dragging:false,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:false,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:false,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,
frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:false,nDirtyRects:0,drDiscarded:0,stopped:false,needsRepaint:false,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){this.audioManager=this.imagesCache=this.currentScene=this.scenes=null;this.isMouseDown=false;this.lastSelectedActor=null;this.dragging=false;this.__gestureRotation=this.__gestureScale=0;this.dirty=true;this.dirtyRects=
null;this.dirtyRectsIndex=0;this.dirtyRectsEnabled=false;this.nDirtyRects=0;this.onResizeCallback=null;this.__map={};return this},cancelPlay:function(a){return this.audioManager.cancelPlay(a)},cancelPlayByChannel:function(a){return this.audioManager.cancelPlayByChannel(a)},setValueForKey:function(a,b){this.__map[a]=b;return this},getValueForKey:function(a){return this.__map[a]},createTimer:function(a,b,c,d,e){return this.timerManager.createTimer(a,b,c,d,e,this)},requestRepaint:function(){this.needsRepaint=
true},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var a=(new CAAT.Module.Debug.Debug).initialize(this.width,60);this.debugInfo=a.debugInfo.bind(a)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(a,b){var c=CAAT.Foundation.Director;switch(this.resize){case c.RESIZE_WIDTH:this.setBounds(0,0,a,this.height);break;case c.RESIZE_HEIGHT:this.setBounds(0,0,this.width,b);break;case c.RESIZE_BOTH:this.setBounds(0,
0,a,b);break;case c.RESIZE_PROPORTIONAL:this.setScaleProportional(a,b)}this.glEnabled&&this.glReset();if(this.onResizeCallback)this.onResizeCallback(this,a,b)},setScaleProportional:function(a,b){var c=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.canvas.width=this.referenceWidth*c;this.canvas.height=this.referenceHeight*c;this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.__setupRetina();this.setScaleAnchored(c*this.scaleX,c*this.scaleY,0,0);this.glEnabled&&
this.glReset()},enableResizeEvents:function(a,b){var c=CAAT.Foundation.Director;a===c.RESIZE_BOTH||a===c.RESIZE_WIDTH||a===c.RESIZE_HEIGHT||a===c.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=a,CAAT.registerResizeListener(this),this.onResizeCallback=b,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null);return this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var a=
CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio,b=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,c=a/b;a!==b?(a=this.canvas.width,b=this.canvas.height,this.canvas.width=a*c,this.canvas.height=b*c,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.setScaleAnchored(c,c,0,0)):this.setScaleAnchored(1,1,0,0);this.SCREEN_RATIO=c}else this.setScaleAnchored(1,
1,0,0);for(c=0;c<this.scenes.length;c++)this.scenes[c].setBounds(0,0,this.width,this.height)},setBounds:function(a,b,c,d){CAAT.Foundation.Director.superclass.setBounds.call(this,a,b,c,d);if(this.canvas.width!==c)this.canvas.width=c;if(this.canvas.height!==d)this.canvas.height=d;this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.__setupRetina();this.glEnabled&&this.glReset();return this},initialize:function(a,b,c,d){typeof c!=="undefined"&&(isString(c)?c=document.getElementById(c):
c instanceof HTMLCanvasElement||console.log("Canvas is a: "+c+" ???"));c||(c=document.createElement("canvas"),document.body.appendChild(c));this.canvas=c;typeof d==="undefined"&&(d=c);this.setBounds(0,0,a,b);this.enableEvents(d);this.timeline=(new Date).getTime();if(CAAT.CACHE_SCENE_ON_CHANGE)this.transitionScene=(new CAAT.Foundation.Scene).setBounds(0,0,a,b),c=document.createElement("canvas"),c.width=a,c.height=b,a=(new CAAT.Foundation.Actor).setBackgroundImage(c),this.transitionScene.ctx=c.getContext("2d"),
this.transitionScene.addChildImmediately(a),this.transitionScene.setEaseListener(this);this.checkDebug();return this},glReset:function(){this.pMatrix=CAAT.WebGL.GLU.makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1);this.gl.viewport(0,0,this.canvas.width,this.canvas.height);this.glColorProgram.setMatrixUniform(this.pMatrix);this.glTextureProgram.setMatrixUniform(this.pMatrix);this.gl.viewportWidth=this.canvas.width;this.gl.viewportHeight=this.canvas.height},initializeGL:function(a,b,c){c||
(c=document.createElement("canvas"),document.body.appendChild(c));c.width=a;c.height=b;this.referenceWidth=a;this.referenceHeight=b;try{this.gl=c.getContext("experimental-webgl"),this.gl.viewportWidth=a,this.gl.viewportHeight=b,CAAT.GLRENDER=true}catch(d){}if(this.gl)this.canvas=c,this.setBounds(0,0,a,b),this.enableEvents(c),this.timeline=(new Date).getTime(),this.glColorProgram=(new CAAT.WebGL.ColorProgram(this.gl)).create().initialize(),this.glTextureProgram=(new CAAT.WebGL.TextureProgram(this.gl)).create().initialize(),
this.glTextureProgram.useProgram(),this.glReset(),this.coords=new Float32Array(6144),this.uv=new Float32Array(4096),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=true,this.checkDebug();else return this.initialize(a,b,c);return this},createScene:function(){var a=new CAAT.Scene;
this.addScene(a);return a},setImagesCache:function(a,b,c){var d;if(null!==this.glTextureManager)this.glTextureManager.deletePages(),this.glTextureManager=null;if(this.imagesCache){var e=[];for(d=0;d<this.imagesCache.length;d++)e.push(this.imagesCache[d].id);for(d=0;d<e.length;d++)delete this.imagesCache[e[d]]}if(this.imagesCache=a)for(d=0;d<a.length;d++)this.imagesCache[a[d].id]=a[d].image;this.tpW=b||2048;this.tpH=c||2048;this.updateGLPages();return this},updateGLPages:function(){if(this.glEnabled)this.glTextureManager=
new CAAT.Module.TexturePacker.TexturePageManager,this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture)},setGLTexturePage:function(a){this.currentTexturePage=a;this.glTextureProgram.setTexture(a.texture);return this},addImage:function(a,b,c){if(this.getImage(a))for(var d=0;d<this.imagesCache.length;d++){if(this.imagesCache[d].id===a){this.imagesCache[d].image=
b;break}}else this.imagesCache.push({id:a,image:b});this.imagesCache[a]=b;c||this.updateGLPages()},deleteImage:function(a,b){for(var c=0;c<this.imagesCache.length;c++)if(this.imagesCache[c].id===a){delete this.imagesCache[a];this.imagesCache.splice(c,1);break}b||this.updateGLPages()},setGLCurrentOpacity:function(a){this.currentOpacity=a;this.glTextureProgram.setAlpha(a)},glRender:function(a,b,c){var a=a||this.coords,c=c||this.uv,b=b||this.coordsIndex,d=this.gl,b=b/12*2;this.glTextureProgram.updateVertexBuffer(a);
this.glTextureProgram.updateUVBuffer(c);d.drawElements(d.TRIANGLES,3*b,d.UNSIGNED_SHORT,0)},glFlush:function(){this.coordsIndex!==0&&this.glRender(this.coords,this.coordsIndex,this.uv);this.uvIndex=this.coordsIndex=0;this.statistics.draws++},findActorAtPosition:function(a){for(var b=this.childrenList.length-1;b>=0;b--){var c=this.childrenList[b],d=new CAAT.Math.Point(a.x,a.y,0),c=c.findActorAtPosition(d);if(null!==c)return c}return this},resetStats:function(){this.statistics.size_total=0;this.statistics.size_active=
0;this.statistics.draws=0;this.statistics.size_discarded_by_dirty_rects=0},render:function(a){if(!this.currentScene||!this.currentScene.isPaused()){this.time+=a;for(e=0,l=this.childrenList.length;e<l;e++){var b=this.childrenList[e];if(b.isInAnimationFrame(this.time)&&!b.isPaused()){var c=b.time-b.start_time;b.timerManager.checkTimers(c);b.timerManager.removeExpiredTimers()}}this.animate(this,this.time);!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();var d=this.childrenList.length,e,f=this.ctx;
if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);for(e=this.uvIndex=this.coordsIndex=0;e<d;e++)if(b=this.childrenList[e],b.isInAnimationFrame(this.time)){c=b.time-b.start_time;if(b.onRenderStart)b.onRenderStart(c);b.paintActorGL(this,c);if(b.onRenderEnd)b.onRenderEnd(c);b.isPaused()||(b.time+=a);!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=b.size_total,this.statistics.size_active+=b.size_active)}this.glFlush()}else{f.globalAlpha=1;f.globalCompositeOperation=
"source-over";f.save();if(this.dirtyRectsEnabled)if(this.modelViewMatrix.transformRenderingContext(f),CAAT.DEBUG_DIRTYRECTS)f.clearRect(0,0,this.canvas.width,this.canvas.height);else{f.beginPath();this.nDirtyRects=0;b=this.cDirtyRects;for(e=0;e<b.length;e++)c=b[e],c.isEmpty()||(f.rect(c.x|0,c.y|0,1+(c.width|0),1+(c.height|0)),this.nDirtyRects++);f.clip()}else this.clear===CAAT.Foundation.Director.CLEAR_ALL&&f.clearRect(0,0,this.canvas.width,this.canvas.height);for(e=0;e<d;e++)if(b=this.childrenList[e],
b.isInAnimationFrame(this.time)){c=b.time-b.start_time;f.save();if(b.onRenderStart)b.onRenderStart(c);!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&b.paintActor(this,c):b.paintActor(this,c);if(b.onRenderEnd)b.onRenderEnd(c);f.restore();if(CAAT.DEBUGAABB)f.globalAlpha=1,f.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(f),b.drawScreenBoundingBox(this,c);b.isPaused()||(b.time+=a);if(!navigator.isCocoonJS&&CAAT.DEBUG)this.statistics.size_total+=
b.size_total,this.statistics.size_active+=b.size_active,this.statistics.size_dirtyRects=this.nDirtyRects}if(this.nDirtyRects>0&&!navigator.isCocoonJS&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){f.beginPath();this.nDirtyRects=0;b=this.cDirtyRects;for(e=0;e<b.length;e++)c=b[e],c.isEmpty()||(f.rect(c.x|0,c.y|0,1+(c.width|0),1+(c.height|0)),this.nDirtyRects++);f.clip();f.fillStyle="rgba(160,255,150,.4)";f.fillRect(0,0,this.canvas.width,this.canvas.height)}f.restore()}this.frameCounter++}},inDirtyRect:function(a){if(!this.dirtyRectsEnabled||
CAAT.DEBUG_DIRTYRECTS)return true;var b=this.cDirtyRects,c,d=a.AABB;for(c=0;c<b.length;c++)if(b[c].intersects(d))return true;this.statistics.size_discarded_by_dirty_rects+=a.size_total;return false},animate:function(a,b){this.timerManager.checkTimers(b);this.setModelViewMatrix(this);this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.setScreenBounds();this.invalid=this.dirty=false;this.dirtyRectsIndex=-1;var c=this.childrenList,d,e;if(this.dirtyRectsEnabled){var f=this.sDirtyRects;if(f.length){for(e=
0,d=f.length;e<d;e++)this.addDirtyRect(f[e]);this.sDirtyRects=[]}}for(e=0;e<c.length;e++)d=c[e],d.animate(this,d.time-d.start_time);this.timerManager.removeExpiredTimers();return this},scheduleDirtyRect:function(a){this.sDirtyRects.push(a)},addDirtyRect:function(a){if(!a.isEmpty()){var b,c,d,e,f=this.cDirtyRects;for(b=0;b<f.length;b++)if(c=f[b],!c.isEmpty()&&c.intersects(a)){for(var g=true;g;){c.unionRectangle(a);for(d=0;d<f.length;d++)if(d!==b&&(e=f[d],!e.isEmpty()&&e.intersects(c))){c.unionRectangle(e);
e.setEmpty();break}d==f.length&&(g=false)}for(d=0;d<f.length;d++)f[d].isEmpty()&&f.splice(d,1);return}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length)for(b=0;b<32;b++)this.dirtyRects.push(new CAAT.Math.Rectangle);b=this.dirtyRects[this.dirtyRectsIndex];b.x=a.x;b.y=a.y;b.x1=a.x1;b.y1=a.y1;b.width=a.width;b.height=a.height;this.cDirtyRects.push(b)}},renderToContext:function(a,b){if(b.isInAnimationFrame(this.time)){a.setTransform(1,0,0,1,0,0);a.globalAlpha=1;a.globalCompositeOperation=
"source-over";a.clearRect(0,0,this.width,this.height);var c=this.ctx;this.ctx=a;a.save();var d=this.modelViewMatrix,e=this.worldModelViewMatrix;this.modelViewMatrix=this.worldModelViewMatrix=new CAAT.Math.Matrix;this.wdirty=true;b.animate(this,b.time);if(b.onRenderStart)b.onRenderStart(b.time);b.paintActor(this,b.time);if(b.onRenderEnd)b.onRenderEnd(b.time);this.worldModelViewMatrix=e;this.modelViewMatrix=d;a.restore();this.ctx=c}},addScene:function(a){a.setBounds(0,0,this.width,this.height);this.scenes.push(a);
a.setEaseListener(this);null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(a,b,c,d,e,f,g,h,i,j){if(a!==this.getCurrentSceneIndex()){a=this.scenes[a];d=this.scenes[d];if(!CAAT.__CSS__&&CAAT.CACHE_SCENE_ON_CHANGE)this.renderToContext(this.transitionScene.ctx,d),d=this.transitionScene;a.setExpired(false);d.setExpired(false);a.mouseEnabled=false;d.mouseEnabled=false;a.resetTransform();d.resetTransform();a.setLocation(0,0);d.setLocation(0,
0);a.alpha=1;d.alpha=1;b===CAAT.Foundation.Scene.EASE_ROTATION?a.easeRotationIn(g,h,c,i):b===CAAT.Foundation.Scene.EASE_SCALE?a.easeScaleIn(0,g,h,c,i):a.easeTranslationIn(g,h,c,i);e===CAAT.Foundation.Scene.EASE_ROTATION?d.easeRotationOut(g,h,f,j):e===CAAT.Foundation.Scene.EASE_SCALE?d.easeScaleOut(0,g,h,f,j):d.easeTranslationOut(g,h,f,j);this.childrenList=[];d.goOut(a);a.getIn(d);this.addChild(d);this.addChild(a)}},easeInOutRandom:function(a,b,c,d){var e=Math.random(),f=Math.random(),g;e<0.33?(e=
CAAT.Foundation.Scene.EASE_ROTATION,g=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):e<0.66?(e=CAAT.Foundation.Scene.EASE_SCALE,g=(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,0.4)):(e=CAAT.Foundation.Scene.EASE_TRANSLATE,g=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());var h;f<0.33?(f=CAAT.Foundation.Scene.EASE_ROTATION,h=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):f<0.66?(f=CAAT.Foundation.Scene.EASE_SCALE,
h=(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4)):(f=CAAT.Foundation.Scene.EASE_TRANSLATE,h=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());this.easeInOut(a,e,Math.random()*8.99>>0,b,f,Math.random()*8.99>>0,c,d,g,h)},easeIn:function(a,b,c,d,e,f){a=this.scenes[a];b===CAAT.Foundation.Scene.EASE_ROTATION?a.easeRotationIn(c,d,e,f):b===CAAT.Foundation.Scene.EASE_SCALE?a.easeScaleIn(0,c,d,e,f):a.easeTranslationIn(c,d,e,f);this.childrenList=[];this.addChild(a);a.resetTransform();
a.setLocation(0,0);a.alpha=1;a.mouseEnabled=false;a.setExpired(false)},setScene:function(a){a=this.scenes[a];this.childrenList=[];this.addChild(a);this.currentScene=a;a.setExpired(false);a.mouseEnabled=true;a.resetTransform();a.setLocation(0,0);a.alpha=1;a.getIn();a.activated()},switchToScene:function(a,b,c,d){var e=this.getSceneIndex(this.currentScene);d?this.easeInOutRandom(a,e,b,c):this.setScene(a)},switchToPrevScene:function(a,b,c){var d=this.getSceneIndex(this.currentScene);this.getNumScenes()<=
1||d===0||(c?this.easeInOutRandom(d-1,d,a,b):this.setScene(d-1))},switchToNextScene:function(a,b,c){var d=this.getSceneIndex(this.currentScene);this.getNumScenes()<=1||d===this.getNumScenes()-1||(c?this.easeInOutRandom(d+1,d,a,b):this.setScene(d+1))},mouseEnter:function(){},mouseExit:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseDrag:function(){},easeEnd:function(a,b){b?(this.currentScene=a,this.currentScene.activated()):a.setExpired(true);a.mouseEnabled=true;
a.emptyBehaviorList()},getSceneIndex:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b]===a)return b;return-1},getScene:function(a){return this.scenes[a]},getSceneById:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b].id===a)return this.scenes[b];return null},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},
getImage:function(a){var b=this.imagesCache[a];if(b)return b;for(b=0;b<this.imagesCache.length;b++)if(this.imagesCache[b].id===a)return this.imagesCache[b].image;return null},musicPlay:function(a){return this.audioManager.playMusic(a)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(a,b){this.audioManager.addAudio(a,b);return this},audioPlay:function(a){return this.audioManager.play(a)},audioLoop:function(a){return this.audioManager.loop(a)},endSound:function(){return this.audioManager.endSound()},
setSoundEffectsEnabled:function(a){return this.audioManager.setSoundEffectsEnabled(a)},setMusicEnabled:function(a){return this.audioManager.setMusicEnabled(a)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(a,b){return this.audioManager.setVolume(a,b)},emptyScenes:function(){this.scenes=[]},addChild:function(a){a.parent=this;this.childrenList.push(a)},loop:function(a,b,c){if(c)this.onRenderStart=
b,this.onRenderEnd=c;else if(b)this.onRenderEnd=b;CAAT.loop()},renderFrame:function(){CAAT.currentDirector=this;if(!this.stopped){var a=(new Date).getTime(),b=a-this.timeline;b>500&&(b=500);if(this.onRenderStart)this.onRenderStart(b);this.render(b);this.debugInfo&&this.debugInfo(this.statistics);this.timeline=a;if(this.onRenderEnd)this.onRenderEnd(b);this.needsRepaint=false}},resetTimeline:function(){this.timeline=(new Date).getTime()},endLoop:function(){},setClear:function(a){this.clear=a;this.dirtyRectsEnabled=
this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS?true:false;return this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(a,b,c){var d=c+"Left";c+="Top";for(var e=0,f=0,g;navigator.browser!=="iOS"&&a&&a.style;)if(g=a.currentStyle?a.currentStyle.position:(g=(a.ownerDocument.defaultView||a.ownerDocument.parentWindow).getComputedStyle(a,null))?g.getPropertyValue("position"):null,/^(fixed)$/.test(g))break;else e+=a[d],f+=a[c],a=a[b];return{x:e,y:f,style:g}},getOffset:function(a){var b=
this.cumulateOffset(a,"offsetParent","offset");return b.style==="fixed"?(a=this.cumulateOffset(a,a.parentNode?"parentNode":"parentElement","scroll"),{x:b.x+a.x,y:b.y+a.y}):{x:b.x,y:b.y}},getCanvasCoord:function(a,b){var c=new CAAT.Math.Point,d=0,e=0;if(!b)b=window.event;if(b.pageX||b.pageY)d=b.pageX,e=b.pageY;else if(b.clientX||b.clientY)d=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=b.clientY+document.body.scrollTop+document.documentElement.scrollTop;var f=this.getOffset(this.canvas);
d-=f.x;e-=f.y;d*=this.SCREEN_RATIO;e*=this.SCREEN_RATIO;c.x=d;c.y=e;if(!this.modelViewMatrixI)this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(c);d=c.x;e=c.y;a.set(d,e);this.screenMousePoint.set(d,e)},__mouseDownHandler:function(a){if(this.dragging&&this.lastSelectedActor)this.__mouseUpHandler(a);else{this.getCanvasCoord(this.mousePoint,a);this.isMouseDown=true;var b=this.findActorAtPosition(this.mousePoint);if(null!==b){var c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,
this.screenMousePoint.y,0));b.mouseDown((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=b}},__mouseUpHandler:function(a){this.isMouseDown=false;this.getCanvasCoord(this.mousePoint,a);var b=null,c=this.lastSelectedActor;null!==c&&(b=c.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),c.actionPerformed&&c.contains(b.x,b.y)&&c.actionPerformed(a),c.mouseUp((new CAAT.Event.MouseEvent).init(b.x,
b.y,a,c,this.screenMousePoint,this.currentScene.time)));!this.dragging&&null!==c&&c.contains(b.x,b.y)&&c.mouseClick((new CAAT.Event.MouseEvent).init(b.x,b.y,a,c,this.screenMousePoint,this.currentScene.time));this.in_=this.dragging=false},__mouseMoveHandler:function(a){var b,c,d=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){if(b=this.lastSelectedActor,c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.dragging||
!(Math.abs(this.prevMousePoint.x-c.x)<CAAT.DRAG_THRESHOLD_X||Math.abs(this.prevMousePoint.y-c.y)<CAAT.DRAG_THRESHOLD_Y)){this.dragging=true;var e=b.x,f=b.y;b.mouseDrag((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),d));this.prevMousePoint.x=c.x;this.prevMousePoint.y=c.y;if(e===b.x&&f===b.y){e=b.contains(c.x,c.y);if(this.in_&&!e)b.mouseExit((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.in_=false;if(!this.in_&&
e)b.mouseEnter((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.in_=true}}}else this.in_=true,b=this.findActorAtPosition(this.mousePoint),b!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(c=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.Event.MouseEvent).init(c.x,c.y,a,this.lastSelectedActor,this.screenMousePoint,d))),null!==b&&(c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,
this.screenMousePoint.y,0)),b.mouseEnter((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)))),c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),null!==b&&b.mouseMove((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.prevMousePoint.x=c.x,this.prevMousePoint.y=c.y,this.lastSelectedActor=b},__mouseOutHandler:function(a){if(!this.dragging)if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,a);var b=new CAAT.Math.Point(this.mousePoint.x,
this.mousePoint.y,0);this.lastSelectedActor.viewToModel(b);a=(new CAAT.Event.MouseEvent).init(b.x,b.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);this.lastSelectedActor.mouseExit(a);this.lastSelectedActor.mouseOut(a);if(!this.dragging)this.lastSelectedActor=null}else this.in_=this.isMouseDown=false},__mouseOverHandler:function(a){if(!this.dragging){var b,c;null==this.lastSelectedActor?(b=this.findActorAtPosition(this.mousePoint),null!==b&&(c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,
this.screenMousePoint.y,0)),a=(new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene?this.currentScene.time:0),b.mouseOver(a),b.mouseEnter(a)),this.lastSelectedActor=b):(b=this.lastSelectedActor,c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),a=(new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene.time),b.mouseOver(a),b.mouseEnter(a))}},__mouseDBLClickHandler:function(a){this.getCanvasCoord(this.mousePoint,
a);null!==this.lastSelectedActor&&this.lastSelectedActor.mouseDblClick((new CAAT.Event.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(a){if(a.target===this.canvas){a.preventDefault();a.returnValue=false;var a=a.targetTouches[0],b=this.mousePoint;this.getCanvasCoord(b,a);if(!(b.x<0||b.y<0||b.x>=this.width||b.y>=this.height))this.touching=true,this.__mouseDownHandler(a)}},__touchEndHandler:function(a){if(this.touching)a.preventDefault(),
a.returnValue=false,a=a.changedTouches[0],this.getCanvasCoord(this.mousePoint,a),this.touching=false,this.__mouseUpHandler(a)},__touchMoveHandler:function(a){if(this.touching&&(a.preventDefault(),a.returnValue=false,!this.gesturing))for(var b=0;b<a.targetTouches.length;b++){var c=a.targetTouches[b];this.getCanvasCoord(this.mousePoint,c);this.__mouseMoveHandler(c)}},__gestureStart:function(){this.gesturing=true;this.__gestureRotation=this.lastSelectedActor.rotationAngle;this.__gestureSX=this.lastSelectedActor.scaleX-
1;this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(a,b){if(!(typeof a==="undefined"||typeof b==="undefined")&&this.lastSelectedActor!==null&&this.lastSelectedActor.isGestureEnabled())this.lastSelectedActor.setRotation(b*Math.PI/180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+a,this.__gestureSY+a)},__gestureEnd:function(){this.gesturing=false;this.__gestureScale=this.__gestureRotation=0},__touchEndHandlerMT:function(a){a.preventDefault();a.returnValue=
false;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b].identifier;c.push(d)}var e={};for(b=0;b<c.length;b++){var f=c[b];if(this.touches[f])d=this.touches[f].actor,e[d.id]||(e[d.id]={actor:d,touch:(new CAAT.Event.TouchEvent).init(a,d,this.currentScene.time)}),e[d.id].touch.addChangedTouch(this.touches[f].touch)}for(b=0;b<a.changedTouches.length;b++)c=a.changedTouches[b],d=c.identifier,delete this.touches[d];for(var g in e){var a=e[g],d=a.actor,c=a.touch,h;for(h in this.touches)a=
this.touches[h],a.actor.id===d.id&&c.addTouch(a.touch);d.touchEnd(c)}},__touchMoveHandlerMT:function(a){a.preventDefault();a.returnValue=false;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=d.identifier;if(this.touches[e]){var f=this.mousePoint;this.getCanvasCoord(f,d);var g=this.touches[e].actor,f=g.viewToModel(f);this.touches[e]={actor:g,touch:new CAAT.Event.TouchInfo(e,f.x,f.y,g)};c.push(e)}}e={};for(b=0;b<c.length;b++)d=c[b],g=this.touches[d].actor,e[g.id]||(e[g.id]=
{actor:g,touch:(new CAAT.Event.TouchEvent).init(a,g,this.currentScene.time)}),g=e[g.id].touch,g.addTouch(this.touches[d].touch),g.addChangedTouch(this.touches[d].touch);for(var h in e){var a=e[h],g=a.actor,d=a.touch,i;for(i in this.touches)a=this.touches[i],a.actor.id===g.id&&d.addTouch(a.touch);g.touchMove(d)}},__touchCancelHandleMT:function(a){this.__touchEndHandlerMT(a)},__touchStartHandlerMT:function(a){a.preventDefault();a.returnValue=false;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=
a.changedTouches[b],e=d.identifier,f=this.mousePoint;this.getCanvasCoord(f,d);if(!(f.x<0||f.y<0||f.x>=this.width||f.y>=this.height)){var g=this.findActorAtPosition(f);g!==null&&(f=g.viewToModel(f),this.touches[e]||(this.touches[e]={actor:g,touch:new CAAT.Event.TouchInfo(e,f.x,f.y,g)},c.push(e)))}}e={};for(b=0;b<c.length;b++)d=c[b],g=this.touches[d].actor,e[g.id]||(e[g.id]={actor:g,touch:(new CAAT.Event.TouchEvent).init(a,g,this.currentScene.time)}),g=e[g.id].touch,g.addTouch(this.touches[d].touch),
g.addChangedTouch(this.touches[d].touch);for(var h in e){var a=e[h],g=a.actor,d=a.touch,i;for(i in this.touches)a=this.touches[i],a.actor.id===g.id&&d.addTouch(a.touch);g.touchStart(d)}},__findTouchFirstActor:function(){var a=Number.MAX_VALUE,b=null,c;for(c in this.touches){var d=this.touches[c];if(d.touch.time&&d.touch.time<a&&d.actor.isGestureEnabled())b=d.actor,a=d.touch.time}return b},__gesturedActor:null,__touchGestureStartHandleMT:function(a){var b=this.__findTouchFirstActor();if(b!==null&&
b.isGestureEnabled())this.__gesturedActor=b,this.__gestureRotation=b.rotationAngle,this.__gestureSX=b.scaleX-1,this.__gestureSY=b.scaleY-1,b.gestureStart(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY)},__touchGestureEndHandleMT:function(a){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY);this.__gestureScale=this.__gestureRotation=0},__touchGestureChangeHandleMT:function(a){this.__gesturedActor!==
null&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(a.rotation*Math.PI/180,this.__gestureSX+a.scale,this.__gestureSY+a.scale)},addHandlers:function(a){var b=this;window.addEventListener("mouseup",function(a){if(b.touching)a.preventDefault(),a.cancelBubble=true,a.stopPropagation&&a.stopPropagation(),b.getCanvasCoord(b.mousePoint,a),b.__mouseUpHandler(a),b.touching=false},false);window.addEventListener("mousedown",function(c){if(c.target===a){c.preventDefault();c.cancelBubble=
true;c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c);if(!(d.x<0||d.y<0||d.x>=b.width||d.y>=b.height))b.touching=true,b.__mouseDownHandler(c)}},false);window.addEventListener("mouseover",function(c){if(c.target===a&&!b.dragging){c.preventDefault();c.cancelBubble=true;c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c);d.x<0||d.y<0||d.x>=b.width||d.y>=b.height||b.__mouseOverHandler(c)}},false);window.addEventListener("mouseout",function(c){if(c.target===
a&&!b.dragging)c.preventDefault(),c.cancelBubble=true,c.stopPropagation&&c.stopPropagation(),b.getCanvasCoord(b.mousePoint,c),b.__mouseOutHandler(c)},false);window.addEventListener("mousemove",function(a){a.preventDefault();a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,a);(b.dragging||!(d.x<0||d.y<0||d.x>=b.width||d.y>=b.height))&&b.__mouseMoveHandler(a)},false);window.addEventListener("dblclick",function(c){if(c.target===a){c.preventDefault();c.cancelBubble=
true;c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c);d.x<0||d.y<0||d.x>=b.width||d.y>=b.height||b.__mouseDBLClickHandler(c)}},false);CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(a.addEventListener("touchstart",this.__touchStartHandler.bind(this),false),a.addEventListener("touchmove",this.__touchMoveHandler.bind(this),false),a.addEventListener("touchend",this.__touchEndHandler.bind(this),false),a.addEventListener("gesturestart",function(c){if(c.target===a)c.preventDefault(),
c.returnValue=false,b.__gestureStart(c.scale,c.rotation)},false),a.addEventListener("gestureend",function(c){if(c.target===a)c.preventDefault(),c.returnValue=false,b.__gestureEnd(c.scale,c.rotation)},false),a.addEventListener("gesturechange",function(c){if(c.target===a)c.preventDefault(),c.returnValue=false,b.__gestureChange(c.scale,c.rotation)},false)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(a.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),false),a.addEventListener("touchmove",
this.__touchMoveHandlerMT.bind(this),false),a.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),false),a.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),false),a.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),false),a.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),false),a.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),false))},enableEvents:function(a){CAAT.RegisterDirector(this);
this.in_=false;this.createEventHandler(a)},createEventHandler:function(a){this.in_=false;this.addHandlers(a)}}},onCreate:function(){if(typeof CAAT.__CSS__!=="undefined")CAAT.Foundation.Director.prototype.clip=true,CAAT.Foundation.Director.prototype.glEnabled=false,CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Foundation.Director.prototype.setScaleProportional=function(a,b){var c=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.setScaleAnchored(c,c,0,0);this.eventHandler.style.width=
""+this.referenceWidth+"px";this.eventHandler.style.height=""+this.referenceHeight+"px"},CAAT.Foundation.Director.prototype.setBounds=function(a,b,c,d){CAAT.Foundation.Director.superclass.setBounds.call(this,a,b,c,d);for(a=0;a<this.scenes.length;a++)this.scenes[a].setBounds(0,0,c,d);this.eventHandler.style.width=c+"px";this.eventHandler.style.height=d+"px";return this},CAAT.Foundation.Director.prototype.initialize=function(a,b,c){this.timeline=(new Date).getTime();this.domElement=c;this.style("position",
"absolute");this.style("width",""+a+"px");this.style("height",""+b+"px");this.style("overflow","hidden");this.enableEvents(c);this.setBounds(0,0,a,b);this.checkDebug();return this},CAAT.Foundation.Director.prototype.render=function(a){this.time+=a;this.animate(this,a);var b,c,d;!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();for(b=0,c=this.childrenList.length;b<c;b++){var e=this.childrenList[b];e.isInAnimationFrame(this.time)&&!e.isPaused()&&(d=e.time-e.start_time,e.timerManager.checkTimers(d),
e.timerManager.removeExpiredTimers())}for(b=0,c=this.childrenList.length;b<c;b++)if(e=this.childrenList[b],e.isInAnimationFrame(this.time)){d=e.time-e.start_time;if(e.onRenderStart)e.onRenderStart(d);e.paintActor(this,d);if(e.onRenderEnd)e.onRenderEnd(d);e.isPaused()||(e.time+=a);if(!navigator.isCocoonJS&&CAAT.DEBUG)this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded,this.statistics.size_total+=e.size_total,this.statistics.size_active+=e.size_active,this.statistics.size_dirtyRects=this.nDirtyRects}this.frameCounter++},
CAAT.Foundation.Director.prototype.addScene=function(a){a.setVisible(true);a.setBounds(0,0,this.width,this.height);this.scenes.push(a);a.setEaseListener(this);null===this.currentScene&&this.setScene(0);this.domElement.appendChild(a.domElement)},CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[];this.domElement.innerHTML="";this.createEventHandler()},CAAT.Foundation.Director.prototype.setClear=function(){return this},CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=
document.createElement("div");this.domElement.appendChild(this.eventHandler);this.eventHandler.style.position="absolute";this.eventHandler.style.left="0";this.eventHandler.style.top="0";this.eventHandler.style.zIndex=999999;this.eventHandler.style.width=""+this.width+"px";this.eventHandler.style.height=""+this.height+"px";this.canvas=this.eventHandler;this.in_=false;this.addHandlers(this.canvas)},CAAT.Foundation.Director.prototype.inDirtyRect=function(){return true}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(a){this.scene=a;return this},setApplicationRange:function(a){this.range=a;return this},setLayoutOp:function(a){this.layoutOp=a;return this},
setSizes:function(a,b){this.minSize=a;this.maxSize=b;for(var c=0;c<this.childrenList.length;c++)this.childrenList[c].width=a,this.childrenList[c].height=a;return this},layout:function(){var a,b,c=CAAT.Foundation.UI.Dock;if(this.layoutOp===c.OP_LAYOUT_BOTTOM||this.layoutOp===c.OP_LAYOUT_TOP){var d=b=0;for(a=0;a<this.getNumChildren();a++)b+=this.getChildAt(a).width;d=(this.width-b)/2;for(a=0;a<this.getNumChildren();a++)b=this.getChildAt(a),b.x=d,d+=b.width,b.y=this.layoutOp===c.OP_LAYOUT_BOTTOM?this.maxSize-
b.height:0}else{for(a=d=b=0;a<this.getNumChildren();a++)b+=this.getChildAt(a).height;d=(this.height-b)/2;for(a=0;a<this.getNumChildren();a++)b=this.getChildAt(a),b.y=d,d+=b.height,b.x=this.layoutOp===c.OP_LAYOUT_LEFT?0:this.width-b.width}},mouseMove:function(){this.actorNotPointed()},mouseExit:function(){this.actorNotPointed()},actorNotPointed:function(){var a,b=this;for(a=0;a<this.getNumChildren();a++){var c=this.getChildAt(a);c.emptyBehaviorList();c.addBehavior((new CAAT.Behavior.GenericBehavior).setValues(c.width,
this.minSize,c,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.Behavior.GenericBehavior).setValues(c.height,this.minSize,c,"height").setFrameTime(this.scene.time,250));a===this.getNumChildren()-1&&c.behaviorList[0].addListener({behaviorApplied:function(a,b,c,g){g.parent.layout()},behaviorExpired:function(d,e,f){for(a=0;a<b.getNumChildren();a++)c=b.getChildAt(a),c.width=b.minSize,c.height=b.minSize;f.parent.layout()}})}},actorPointed:function(a,b,c){for(var d=this.findChild(c),e=
CAAT.Foundation.UI.Dock,f=0,f=this.layoutOp===e.OP_LAYOUT_BOTTOM||this.layoutOp===e.OP_LAYOUT_TOP?a/c.width:b/c.height,a=0;a<this.childrenList.length;a++)b=this.childrenList[a],b.emptyBehaviorList(),c=0,c=a<d-this.range||a>d+this.range?this.minSize:a===d?this.maxSize:a<d?this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-f+1)/this.range*Math.PI)+1)/2:this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-f)/this.range*Math.PI)+1)/2,b.height=c,b.width=c;this.layout()},actorMouseExit:function(){null!==
this.ttask&&this.ttask.cancel();var a=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(){a.actorNotPointed()},null,null)},actorMouseEnter:function(){if(null!==this.ttask)this.ttask.cancel(),this.ttask=null},addChild:function(a){var b=this;a.__Dock_mouseEnter=a.mouseEnter;a.__Dock_mouseExit=a.mouseExit;a.__Dock_mouseMove=a.mouseMove;a.mouseEnter=function(a){b.actorMouseEnter(a);this.__Dock_mouseEnter(a)};a.mouseExit=function(a){b.actorMouseExit(a);this.__Dock_mouseExit(a)};a.mouseMove=
function(a){b.actorPointed(a.point.x,a.point.y,a.source);this.__Dock_mouseMove(a)};a.width=this.minSize;a.height=this.minSize;return CAAT.Foundation.UI.Dock.superclass.addChild.call(this,a)}}});
CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(a){this.gap=a;return this},setInterpolator:function(a,b){this.interpolator=a;this.contour=a.getContour(b||this.S);return this},paint:function(a,b){CAAT.InterpolatorActor.superclass.paint.call(this,a,b);if(this.backgroundImage)return this;if(this.interpolator){var c=
a.ctx,d=this.width-2*this.gap,e=this.height-2*this.gap;c.beginPath();c.moveTo(this.gap+d*this.contour[0].x,-this.gap+this.height-e*this.contour[0].y);for(var f=1;f<this.contour.length;f++)c.lineTo(this.gap+d*this.contour[f].x,-this.gap+this.height-e*this.contour[f].y);c.strokeStyle=this.strokeStyle;c.stroke()}},getInterpolator:function(){return this.interpolator}}});
CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var a=function(a){this.ctx=a;return this};a.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,
setDefault:function(a){this.defaultFS=24;this.font="Arial";this.fontSize=this.defaultFS;this.fill="#000";this.stroke="#f00";this.filled=true;this.stroked=false;this.strokeSize=1;this.bold=this.italic=false;this.alignment="left";this.tabSize=75;this.shadow=false;this.shadowBlur=0;this.shadowColor="#000";for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.__setFont();return this},setStyle:function(a){if(typeof a!=="undefined")for(var b in a)this[b]=a[b];return this},applyStyle:function(){this.__setFont();
return this},clone:function(){var b=new a(this.ctx),c;for(c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);for(var d=this;d.chain;)for(c in d=d.chain,d)b[c]===null&&d.hasOwnProperty(c)&&(b[c]=d[c]);b.__setFont();return b},__getProperty:function(a){var b=this,c;do{c=b[a];if(c!==null)return c;b=b.chain}while(b);return null},image:function(a){this.__setShadow(a)},text:function(a,b,c,d){this.__setShadow(a);a.font=this.__getProperty("sfont");this.filled&&this.__fillText(a,b,c,d);this.stroked&&this.__strokeText(a,
b,c,d)},__setShadow:function(a){if(this.__getProperty("shadow"))a.shadowBlur=this.__getProperty("shadowBlur"),a.shadowColor=this.__getProperty("shadowColor")},__fillText:function(a,b,c,d){a.fillStyle=this.__getProperty("fill");a.fillText(b,c,d)},__strokeText:function(a,b,c,d){a.strokeStyle=this.__getProperty("stroke");a.lineWidth=this.__getProperty("strokeSize");a.beginPath();a.strokeText(b,c,d)},__setFont:function(){var a=this.__getProperty("italic"),b=this.__getProperty("bold"),c=this.__getProperty("fontSize"),
d=this.__getProperty("font");this.sfont=(a?"italic ":"")+(b?"bold ":"")+c+"px "+d;this.ctx.font=this.__getProperty("sfont")},setBold:function(a){if(a!=this.bold)this.bold=a,this.__setFont()},setItalic:function(a){if(a!=this.italic)this.italic=a,this.__setFont()},setStroked:function(a){this.stroked=a},setFilled:function(a){this.filled=a},getTabPos:function(a){var b=this.__getProperty("tabSize");return((a/b>>0)+1)*b},setFillStyle:function(a){this.fill=a},setStrokeStyle:function(a){this.stroke=a},setStrokeSize:function(a){this.strokeSize=
a},setAlignment:function(a){this.alignment=a},setFontSize:function(a){if(a!==this.fontSize)this.fontSize=a,this.__setFont()}};var b=function(){this.text="";return this};b.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0;this.currentLine=new f;this.lines.push(this.currentLine)},__image:function(a,b,c){var e;e=b&&c?a.getWidth():a.getWrappedImageWidth();this.width&&e+this.x>this.width&&this.x>0&&
this.__nextLine();this.currentLine.addElementImage(new d(this.x,a,b,c,this.crcs.clone(),this.__getCurrentAnchor()));this.x+=e},__text:function(){if(this.text.length!==0){var a=this.ctx.measureText(this.text).width;this.width&&a+this.x>this.width&&this.x>0&&this.__nextLine();this.currentLine.addElement(new e(this.text,this.x,a,0,this.crcs.clone(),this.__getCurrentAnchor()));this.x+=a;this.text=""}},fchar:function(a){a===" "?(this.__text(),this.x+=this.ctx.measureText(a).width,this.width&&this.x>this.width&&
this.__nextLine()):this.text+=a},end:function(){this.text.length>0&&this.__text();for(var a=0,b=0,c=0;c<this.lines.length;c++){var d=this.lines[c].getHeight();if(d===0)d=this.styles["default"].fontSize;a+=d;c===this.lines.length-1&&(b=d*0.25>>0);this.lines[c].setY(a)}this.documentHeight=a+b},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){return this.anchorStack.length?this.anchorStack[this.anchorStack.length-1]:null},__resetAppliedStyles:function(){this.rcs=
[];this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=(new a(this.ctx)).setDefault(this.styles["default"]);this.rcs.push(this.crcs)},__pushStyle:function(b){var c=this.crcs;this.crcs=new a(this.ctx);this.crcs.chain=c;this.crcs.setStyle(b);this.crcs.applyStyle();this.rcs.push(this.crcs)},__popStyle:function(){if(this.rcs.length>1)this.rcs.pop(),this.crcs=this.rcs[this.rcs.length-1],this.crcs.applyStyle()},__popAnchor:function(){this.anchorStack.length>0&&this.anchorStack.pop()},__pushAnchor:function(a){this.anchorStack.push(a)},
start:function(a,b,c,d){this.y=this.x=0;this.width=typeof d!=="undefined"?d:0;this.ctx=a;this.lines=[];this.styles=b;this.images=c;this.anchorStack=[];this.__resetAppliedStyles();this.__nextLine()},setTag:function(a){this.__text();a=a.toLowerCase();if(a==="b")this.crcs.setBold(true);else if(a==="/b")this.crcs.setBold(false);else if(a==="i")this.crcs.setItalic(true);else if(a==="/i")this.crcs.setItalic(false);else if(a==="stroked")this.crcs.setStroked(true);else if(a==="/stroked")this.crcs.setStroked(false);
else if(a==="filled")this.crcs.setFilled(true);else if(a==="/filled")this.crcs.setFilled(false);else if(a==="tab")this.x=this.crcs.getTabPos(this.x);else if(a==="br")this.__nextLine();else if(a==="/a")this.__popAnchor();else if(a==="/style")this.rcs.length>1&&this.__popStyle();else if(a.indexOf("fillcolor")===0)a=a.split("="),this.crcs.setFillStyle(a[1]);else if(a.indexOf("strokecolor")===0)a=a.split("="),this.crcs.setStrokeStyle(a[1]);else if(a.indexOf("strokesize")===0)a=a.split("="),this.crcs.setStrokeSize(a[1]|
0);else if(a.indexOf("fontsize")===0)a=a.split("="),this.crcs.setFontSize(a[1]|0);else if(a.indexOf("style")===0)a=a.split("="),(a=this.styles[a[1]])&&this.__pushStyle(a);else if(a.indexOf("image")===0){var a=a.split("=")[1].split(","),b=a[0];if(this.images[b]){var c=0,d=0;a.length>=3&&(c=a[1]|0,d=a[2]|0);this.__image(this.images[b],c,d)}}else a.indexOf("a=")===0&&(a=a.split("="),this.__pushAnchor(a[1]))}};var c=function(a,b){this.link=a;this.style=b;return this};c.prototype={x:null,y:null,width:null,
height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(a){this.link=a;return this},getLink:function(){return this.link},contains:function(){return false}};var d=function(a,b,c,e,f,m){d.superclass.constructor.call(this,m,f);this.x=a;this.image=b;this.row=c;this.column=e;this.width=b.getWidth();this.height=b.getHeight();if(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage)this.spriteIndex=c*b.columns+e,this.paint=this.paintSI;return this};
d.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(a){this.style.image(a);a.drawImage(this.image,this.x,-this.height+1)},paintSI:function(a){this.style.image(a);this.image.setSpriteIndex(this.spriteIndex);this.image.paint({ctx:a},0,this.x,-this.height+1)},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.singleHeight:this.image.height},getFontMetrics:function(){return null},contains:function(a,b){return a>=this.x&&a<=this.x+this.width&&
b>=this.y&&b<this.y+this.height},setYPosition:function(a){this.y=a-this.height+1}};var e=function(a,b,c,d,f,m){e.superclass.constructor.call(this,m,f);this.x=b;this.y=0;this.width=c;this.text=a;this.style=f;this.fm=CAAT.Module.Font.Font.getFontMetrics(f.sfont);this.height=this.fm.height;return this};e.prototype={text:null,style:null,fm:null,bl:null,paint:function(a){this.style.text(a,this.text,this.x,0)},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(a,
b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height},setYPosition:function(a){this.bl=a;this.y=a-this.fm.ascent}};extend(d,c);extend(e,c);var f=function(){this.elements=[];return this};f.prototype={elements:null,width:0,height:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(a){this.width=Math.max(this.width,a.x+a.width);this.height=Math.max(this.height,a.height);this.elements.push(a);this.alignment=a.style.__getProperty("alignment")},addElementImage:function(a){this.width=
Math.max(this.width,a.x+a.width);this.height=Math.max(this.height,a.height);this.elements.push(a)},getHeight:function(){return this.height},setY:function(a){this.y=a},getY:function(){return this.y},paint:function(a){a.save();a.translate(this.x,this.y+this.baselinePos);for(var b=0;b<this.elements.length;b++)this.elements[b].paint(a);a.restore()},setAlignment:function(a){var b;if(this.alignment==="center")this.x=(a-this.width)/2;else if(this.alignment==="right")this.x=a-this.width;else if(this.alignment===
"justify"&&this.width/a>=0.6&&this.elements.length>1){var c=a-this.width,c=c/(this.elements.length-1)|0;for(b=1;b<this.elements.length;b++)this.elements[b].x+=b*c;c=a-this.width-c*(this.elements.length-1);for(b=0;b<c;b++)this.elements[this.elements.length-1-b].x+=c-b}},adjustHeight:function(){var a=null,b=null,c;for(c=0;c<this.elements.length;c+=1){var d=this.elements[c],e=d.getFontMetrics();null!=e?a?e.ascent>a.ascent&&(a=e):a=e:b?d.getHeight()>d.getHeight()&&(b=d):b=d}this.baselinePos=Math.max(a?
a.ascent:0,b?b.getHeight():0);this.height=this.baselinePos+(a!=null?a.descent:0);for(c=0;c<this.elements.length;c++)this.elements[c].setYPosition(this.baselinePos);return this.height},__getElementAt:function(a,b){for(var c=0;c<this.elements.length;c++){var d=this.elements[c];if(d.contains(a,b))return d}return null}};return{__init:function(){this.__super();this.rc=new b;this.lines=[];this.styles={};this.images={};return this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,
text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:true,lines:null,images:null,clickCallback:null,setStyle:function(a,b){this.styles[a]=b;return this},addImage:function(a,b){this.images[a]=b;return this},setSize:function(a,b){CAAT.Foundation.UI.Label.superclass.setSize.call(this,a,b);this.setText(this.text,this.width);return this},setBounds:function(a,b,c,d){CAAT.Foundation.UI.Label.superclass.setBounds.call(this,a,b,c,d);this.setText(this.text,this.width);
return this},setText:function(a,b){if(null!==a){var c=this.cached;c&&this.stopCacheAsBitmap();this.documentHeight=this.documentWidth=0;this.text=a;var d,e,f,o,n,q,p=CAAT.currentDirector.ctx;p.save();f=this.text;d=0;e=f.length;for(this.rc.start(p,this.styles,this.images,b);d<e;)q=f.charAt(d),q==="\\"?(d+=1,this.rc.fchar(f.charAt(d)),d+=1):q==="<"?(o=f.indexOf(">",d+1),-1!==o&&(n=f.substr(d+1,o-d-1),n.indexOf("<")!==-1?(this.rc.fchar(q),d+=1):(this.rc.setTag(n),d=o+1))):(this.rc.fchar(q),d+=1);this.rc.end();
this.lines=this.rc.lines;this.__calculateDocumentDimension(typeof b==="undefined"?0:b);this.setLinesAlignment();p.restore();this.setPreferredSize(this.documentWidth,this.documentHeight);this.invalidateLayout();this.setDocumentPosition();c&&this.cacheAsBitmap(0,c);return this}},setVerticalAlignment:function(a){this.valignment=a;this.setDocumentPosition();return this},setHorizontalAlignment:function(a){this.halignment=a;this.setDocumentPosition();return this},setDocumentPosition:function(){var a=0,
b=0;this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?b=(this.height-this.documentHeight)/2:this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM&&(b=this.height-this.documentHeight);this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?a=(this.width-this.documentWidth)/2:this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT&&(a=this.width-this.documentWidth);this.documentX=a;this.documentY=b},__calculateDocumentDimension:function(a){var b,
c=0;for(b=this.documentHeight=this.documentWidth=0;b<this.lines.length;b++)this.lines[b].y=c,this.documentWidth=Math.max(this.documentWidth,this.lines[b].width),this.documentHeight+=this.lines[b].adjustHeight(),c+=this.lines[b].getHeight();this.documentWidth=Math.max(this.documentWidth,a);return this},setLinesAlignment:function(){for(var a=0;a<this.lines.length;a++)this.lines[a].setAlignment(this.documentWidth)},paint:function(a,b){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var c=a.ctx;c.save();
c.textBaseline="alphabetic";c.translate(this.documentX,this.documentY);for(var d=0;d<this.lines.length;d++)this.lines[d].paint(a.ctx);c.restore()}else this.backgroundImage&&this.backgroundImage.paint(a,b,0,0)},__getDocumentElementAt:function(a,b){a-=this.documentX;b-=this.documentY;for(var c=0;c<this.lines.length;c++){var d=this.lines[c];if(d.x<=a&&d.y<=b&&d.x+d.width>=a&&d.y+d.height>=b)return d.__getElementAt(a-d.x,b-d.y)}return null},mouseExit:function(){CAAT.setCursor("default")},mouseMove:function(a){(a=
this.__getDocumentElementAt(a.x,a.y))&&a.getLink()?CAAT.setCursor("pointer"):CAAT.setCursor("default")},mouseClick:function(a){this.clickCallback&&(a=this.__getDocumentElementAt(a.x,a.y),a.getLink()&&this.clickCallback(a.getLink()))},setClickCallback:function(a){this.clickCallback=a;return this}}}});
CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:false,outlineColor:"black",onUpdateCallback:null,interactive:false,getPath:function(){return this.path},setPath:function(a){this.path=a;if(a!=null)this.pathBoundingRectangle=a.getBoundingBox(),this.setInteractive(this.interactive);return this},paint:function(a,b){CAAT.Foundation.UI.PathActor.superclass.paint.call(this,
a,b);if(this.path){var c=a.ctx;c.strokeStyle="#000";this.path.paint(a,this.interactive);if(this.bOutline)c.strokeStyle=this.outlineColor,c.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height)}},showBoundingBox:function(a,b){if((this.bOutline=a)&&b)this.outlineColor=b;return this},setInteractive:function(a){this.interactive=a;this.path&&this.path.setInteractive(a);return this},setOnUpdateCallback:function(a){this.onUpdateCallback=
a;return this},mouseDrag:function(a){this.path.drag(a.point.x,a.point.y,this.onUpdateCallback)},mouseDown:function(a){this.path.press(a.point.x,a.point.y)},mouseUp:function(){this.path.release()}}});
CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){this.__super();this.compositeOp="source-over";this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE);return this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=
a;return this},setLineJoin:function(a){this.lineJoin=a;return this},setMiterLimit:function(a){this.miterLimit=a;return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(a){this.shape=a;this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle;return this},setCompositeOp:function(a){this.compositeOp=
a;return this},paint:function(){},paintCircle:function(a,b){if(this.cached)CAAT.Foundation.ActorContainer.prototype.paint.call(this,a,b);else{var c=a.ctx;c.lineWidth=this.lineWidth;c.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle)c.fillStyle=this.fillStyle,c.beginPath(),c.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,false),c.fill();if(null!==this.strokeStyle)c.strokeStyle=this.strokeStyle,c.beginPath(),c.arc(this.width/2,this.height/
2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,false),c.stroke()}},paintRectangle:function(a,b){if(this.cached)CAAT.Foundation.ActorContainer.prototype.paint.call(this,a,b);else{var c=a.ctx;c.lineWidth=this.lineWidth;if(this.lineCap)c.lineCap=this.lineCap;if(this.lineJoin)c.lineJoin=this.lineJoin;if(this.miterLimit)c.miterLimit=this.miterLimit;c.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle)c.fillStyle=this.fillStyle,c.beginPath(),c.fillRect(0,0,this.width,
this.height),c.fill();if(null!==this.strokeStyle)c.strokeStyle=this.strokeStyle,c.beginPath(),c.strokeRect(0,0,this.width,this.height),c.stroke()}}}});
CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){this.__super();this.compositeOp="source-over";return this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=a;return this},setLineJoin:function(a){this.lineJoin=
a;return this},setMiterLimit:function(a){this.miterLimit=a;return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(){return this},setOutlined:function(){return this},setCompositeOp:function(a){this.compositeOp=a;return this},setInitialAngle:function(a){this.initialAngle=a;return this},initialize:function(a,b,c){this.setSize(2*b,2*b);this.nPeaks=
a;this.maxRadius=b;this.minRadius=c;return this},paint:function(a){var a=a.ctx,b=this.width/2,c=this.height/2,d=this.maxRadius,e=this.minRadius,f=b+d*Math.cos(this.initialAngle),g=c+d*Math.sin(this.initialAngle);a.lineWidth=this.lineWidth;if(this.lineCap)a.lineCap=this.lineCap;if(this.lineJoin)a.lineJoin=this.lineJoin;if(this.miterLimit)a.miterLimit=this.miterLimit;a.globalCompositeOperation=this.compositeOp;a.beginPath();a.moveTo(f,g);for(f=1;f<this.nPeaks*2;f++){var h=Math.PI/this.nPeaks*f+this.initialAngle,
i=f%2===0?d:e,g=b+i*Math.cos(h),h=c+i*Math.sin(h);a.lineTo(g,h)}a.lineTo(b+d*Math.cos(this.initialAngle),c+d*Math.sin(this.initialAngle));a.closePath();if(this.fillStyle)a.fillStyle=this.fillStyle,a.fill();if(this.strokeStyle)a.strokeStyle=this.strokeStyle,a.stroke()}}});
CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){this.__super();this.font="10px sans-serif";this.textAlign="left";this.outlineColor="black";this.clip=false;this.__calcFontData();return this},font:null,fontData:null,
textAlign:null,textBaseline:"top",fill:true,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:false,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:1E4,sign:1,lx:0,ly:0,setFill:function(a){this.stopCacheAsBitmap();this.fill=a;return this},setLineWidth:function(a){this.stopCacheAsBitmap();this.lineWidth=a;return this},setTextFillStyle:function(a){this.stopCacheAsBitmap();this.textFillStyle=a;return this},setOutline:function(a){this.stopCacheAsBitmap();this.outline=
a;return this},setPathTraverseDirection:function(a){this.sign=a;return this},setOutlineColor:function(a){this.stopCacheAsBitmap();this.outlineColor=a;return this},setText:function(a){this.stopCacheAsBitmap();this.text=a;if(null===this.text||this.text==="")this.width=this.height=0;this.calcTextSize(CAAT.currentDirector);this.invalidate();return this},setTextAlign:function(a){this.textAlign=a;this.__setLocation();return this},setAlign:function(a){return this.setTextAlign(a)},setTextBaseline:function(a){this.stopCacheAsBitmap();
this.textBaseline=a;return this},setBaseline:function(a){this.stopCacheAsBitmap();return this.setTextBaseline(a)},setFont:function(a){this.stopCacheAsBitmap();a||(a="10px sans-serif");a instanceof CAAT.Module.Font.Font&&a.setAsSpriteImage();this.font=a;this.__calcFontData();this.calcTextSize(CAAT.director[0]);return this},setLocation:function(a,b){this.lx=a;this.ly=b;this.__setLocation();return this},setPosition:function(a,b){this.lx=a;this.ly=b;this.__setLocation();return this},setBounds:function(a,
b,c,d){this.lx=a;this.ly=b;this.setSize(c,d);this.__setLocation();return this},setSize:function(a,b){CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,a,b);this.__setLocation();return this},__setLocation:function(){CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,this.textAlign==="center"?this.lx-this.width/2:this.textAlign==="right"||this.textAlign==="end"?this.lx-this.width:this.lx,this.textBaseline==="bottom"?this.ly-this.height:this.textBaseline==="middle"?this.ly-this.height/
2:this.textBaseline==="alphabetic"?this.ly-this.fontData.ascent:this.ly)},centerAt:function(a,b){this.textAlign="left";this.textBaseline="top";return CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,a,b)},calcTextSize:function(a){if(typeof this.text==="undefined"||null===this.text||""===this.text)return this.textHeight=this.textWidth=0,this;if(a.glEnabled)return this;if(this.font instanceof CAAT.Foundation.SpriteImage)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=
this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;if(this.font instanceof CAAT.Module.Font.Font)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;a=a.ctx;a.save();a.font=this.font;this.textWidth=a.measureText(this.text).width;if(this.width===0)this.width=this.textWidth;this.textHeight=
this.fontData.height;this.setSize(this.textWidth,this.textHeight);a.restore();return this},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(a,b){if(this.text&&(CAAT.Foundation.UI.TextActor.superclass.paint.call(this,a,b),!this.cached&&null!==this.text)){(this.textWidth===0||this.textHeight===0)&&this.calcTextSize(a);var c=a.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage)this.drawSpriteText(a,
b);else{if(null!==this.font)c.font=this.font;c.textBaseline="alphabetic";if(null===this.path){if(null!==this.textAlign)c.textAlign=this.textAlign;var d=0;if(this.textAlign==="center")d=this.width/2|0;else if(this.textAlign==="right")d=this.width;if(this.fill){if(null!==this.textFillStyle)c.fillStyle=this.textFillStyle;c.fillText(this.text,d,this.fontData.ascent)}if(this.outline){if(null!==this.outlineColor)c.strokeStyle=this.outlineColor;c.lineWidth=this.lineWidth;c.beginPath();c.strokeText(this.text,
d,this.fontData.ascent)}}else this.drawOnPath(a,b)}}},drawOnPath:function(a,b){var c=a.ctx;if(this.fill&&null!==this.textFillStyle)c.fillStyle=this.textFillStyle;if(this.outline&&null!==this.outlineColor)c.strokeStyle=this.outlineColor;for(var d=this.sign*this.pathInterpolator.getPosition(b%this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Math.Point(0,0,0),f=new CAAT.Math.Point(0,0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),i=c.measureText(h).width,f=d,e=this.path.getPositionFromLength(f).clone(),
f=this.path.getPositionFromLength(f-0.1).clone(),f=Math.atan2(e.y-f.y,e.x-f.x);c.save();CAAT.CLAMP?c.translate(e.x>>0,e.y>>0):c.translate(e.x,e.y);c.rotate(f);this.fill&&c.fillText(h,0,0);if(this.outline)c.beginPath(),c.lineWidth=this.lineWidth,c.strokeText(h,0,0);c.restore();d+=i}},drawSpriteText:function(a,b){null===this.path?this.font.drawText(this.text,a.ctx,0,0):this.drawSpriteTextOnPath(a,b)},drawSpriteTextOnPath:function(a,b){for(var c=a.ctx,d=this.sign*this.pathInterpolator.getPosition(b%
this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Math.Point(0,0,0),f=new CAAT.Math.Point(0,0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),i=this.font.stringWidth(h),f=i/2+d,e=this.path.getPositionFromLength(f).clone(),f=this.path.getPositionFromLength(f-0.1).clone(),f=Math.atan2(e.y-f.y,e.x-f.x);c.save();CAAT.CLAMP?c.translate(e.x|0,e.y|0):c.translate(e.x,e.y);c.rotate(f);e=this.textBaseline==="bottom"?0-this.font.getHeight():0;this.font.drawText(h,c,0,e);c.restore();
d+=i}},setPath:function(a,b,c){this.path=a;this.pathInterpolator=b||(new CAAT.Behavior.Interpolator).createLinearInterpolator();this.pathDuration=c||1E4;this.mouseEnabled=false;return this}}});CAAT.ModuleManager.solveAll();
>>>>>>> upstream/master
